<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>爬虫 - Zhang&#39;s Blog的博客</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<meta name="author" content="Zhang&#39;s Blog" /><meta name="description" content="不同操作系统浏览器配置 Ubuntu20.04 1 2 3 headers = { &amp;#39;User-Agent&amp;#39;:&amp;#39;Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/94.0.4606.71 Safari/537.36&amp;#39; } Windows10 1 2 3 headers = { &amp;#39;User-Agent&amp;#39;:&amp;#39;Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/96.0.4664.45 Safari/537.36&amp;#39; } MacOS 1 ... 请求 Step01.获取百度网页 1 2 3 4" /><meta name="keywords" content="Hugo, theme, even" />






<meta name="generator" content="Hugo 0.67.1 with theme even" />


<link rel="canonical" href="http://localhost:1313/post/%E7%88%AC%E8%99%AB/" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">



<link href="/sass/main.min.b5a744db6de49a86cadafb3b70f555ab443f83c307a483402259e94726b045ff.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.css" integrity="sha256-7TyXnr2YU040zfSP+rEcz29ggW4j56/ujTPwjMzyqFY=" crossorigin="anonymous">


<meta property="og:title" content="爬虫" />
<meta property="og:description" content="不同操作系统浏览器配置 Ubuntu20.04 1 2 3 headers = { &#39;User-Agent&#39;:&#39;Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/94.0.4606.71 Safari/537.36&#39; } Windows10 1 2 3 headers = { &#39;User-Agent&#39;:&#39;Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/96.0.4664.45 Safari/537.36&#39; } MacOS 1 ... 请求 Step01.获取百度网页 1 2 3 4" />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://localhost:1313/post/%E7%88%AC%E8%99%AB/" />
<meta property="article:published_time" content="2022-01-06T00:00:00+00:00" />
<meta property="article:modified_time" content="2022-01-06T00:00:00+00:00" />
<meta itemprop="name" content="爬虫">
<meta itemprop="description" content="不同操作系统浏览器配置 Ubuntu20.04 1 2 3 headers = { &#39;User-Agent&#39;:&#39;Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/94.0.4606.71 Safari/537.36&#39; } Windows10 1 2 3 headers = { &#39;User-Agent&#39;:&#39;Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/96.0.4664.45 Safari/537.36&#39; } MacOS 1 ... 请求 Step01.获取百度网页 1 2 3 4">
<meta itemprop="datePublished" content="2022-01-06T00:00:00&#43;00:00" />
<meta itemprop="dateModified" content="2022-01-06T00:00:00&#43;00:00" />
<meta itemprop="wordCount" content="36604">



<meta itemprop="keywords" content="python," /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="爬虫"/>
<meta name="twitter:description" content="不同操作系统浏览器配置 Ubuntu20.04 1 2 3 headers = { &#39;User-Agent&#39;:&#39;Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/94.0.4606.71 Safari/537.36&#39; } Windows10 1 2 3 headers = { &#39;User-Agent&#39;:&#39;Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/96.0.4664.45 Safari/537.36&#39; } MacOS 1 ... 请求 Step01.获取百度网页 1 2 3 4"/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">Zhang&#39;s Blog</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/home/">
        <li class="mobile-menu-item">Home</li>
      </a><a href="/post/">
        <li class="mobile-menu-item">MyBlog</li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">Tags</li>
      </a><a href="/categories/">
        <li class="mobile-menu-item">Categories</li>
      </a><a href="/about/">
        <li class="mobile-menu-item">About</li>
      </a>
  </ul>

  


</nav>

  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/" class="logo">Zhang&#39;s Blog</a>
</div>





<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="/home/">Home</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/post/">MyBlog</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/tags/">Tags</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/categories/">Categories</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/about/">About</a>
      </li>
  </ul>
</nav>

    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">爬虫</h1>

      <div class="post-meta">
        <span class="post-time"> 2022-01-06 </span>
        
        
      </div>
    </header>

    <div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">Contents</h2>
  <div class="post-toc-content always-active">
    <nav id="TableOfContents">
  <ul>
    <li><a href="#不同操作系统浏览器配置">不同操作系统浏览器配置</a></li>
    <li><a href="#请求">请求</a>
      <ul>
        <li><a href="#step01获取百度网页">Step01.获取百度网页</a></li>
        <li><a href="#step02实现百度简单搜索">Step02.实现百度简单搜索</a></li>
        <li><a href="#step03实现百度翻译">Step03.实现百度翻译</a></li>
        <li><a href="#step04爬取豆瓣电影排行榜">Step04.爬取豆瓣电影排行榜</a></li>
        <li><a href="#step05肯德基餐厅信息查询">Step05.肯德基餐厅信息查询</a></li>
        <li><a href="#step06爬取化妆品生产许可信息管理系统服务平台许可证">Step06.爬取化妆品生产许可信息管理系统服务平台<code>许可证</code></a>
          <ul>
            <li><a href="#爬列表基本信息">爬列表基本信息</a></li>
            <li><a href="#爬每个公司详细证书内容">爬每个公司详细证书内容</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#数据解析">数据解析</a>
      <ul>
        <li><a href="#step07正则">Step07.正则</a>
          <ul>
            <li><a href="#爬取糗事百科图片">爬取<code>糗事百科</code>图片</a></li>
            <li><a href="#爬取中国大学排名">爬取<code>中国大学排名</code></a></li>
          </ul>
        </li>
        <li><a href="#step08bs4">Step08.bs4</a>
          <ul>
            <li><a href="#概述">概述</a></li>
            <li><a href="#爬取诗词名句网的小说">爬取诗词名句网的小说</a></li>
          </ul>
        </li>
        <li><a href="#step09xpath">Step09.xpath</a>
          <ul>
            <li><a href="#概述-1">概述</a></li>
            <li><a href="#爬中国所有城市名称">爬中国所有城市名称</a></li>
            <li><a href="#爬58二手房数据">爬58二手房数据</a></li>
            <li><a href="#爬彼岸图网上4k美女图片">爬彼岸图网上4K美女图片</a></li>
            <li><a href="#爬取三国演义小说">爬取三国演义小说</a></li>
            <li><a href="#爬取美食杰一些菜谱">爬取美食杰一些菜谱</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#登录验证">登录验证</a>
      <ul>
        <li><a href="#step10验证码识别">Step10.验证码识别</a>
          <ul>
            <li><a href="#图像识别opencv--tesseract">图像识别(opencv + tesseract)</a></li>
          </ul>
        </li>
        <li><a href="#step11cookie和session验证">Step11.Cookie和session验证</a>
          <ul>
            <li><a href="#获取豆瓣登录页面的cookies">获取豆瓣登录页面的cookies</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#代理">代理</a></li>
    <li><a href="#异步爬虫">异步爬虫</a>
      <ul>
        <li><a href="#概述-2">概述</a></li>
        <li><a href="#之多线程and多进程">之多线程and多进程</a></li>
        <li><a href="#线程池and进程池回收分配机制">线程池and进程池(回收分配机制)</a></li>
        <li><a href="#协程">协程</a>
          <ul>
            <li><a href="#协程相关步骤">协程相关步骤</a></li>
            <li><a href="#多任务异步协程">多任务异步协程</a></li>
          </ul>
        </li>
        <li><a href="#aiohttp">aiohttp</a>
          <ul>
            <li><a href="#模块引入">模块引入</a></li>
            <li><a href="#aiohttp实现异步请求">aiohttp实现异步请求</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#selenium动态爬取">selenium动态爬取</a>
      <ul>
        <li><a href="#selenium体验">selenium体验</a></li>
        <li><a href="#selenium模拟淘宝搜索">selenium模拟淘宝搜索</a></li>
        <li><a href="#使用selenium处理iframe">使用selenium处理iframe</a></li>
        <li><a href="#12306模拟登录">12306模拟登录</a></li>
        <li><a href="#无窗口和规避检测">无窗口和规避检测</a></li>
        <li><a href="#selenium遍历元素标签例如ul下的li并获取子元素的文本内容或属性值">selenium遍历元素标签(例如ul下的li)并获取子元素的文本内容或属性值</a></li>
        <li><a href="#selenium获取元素内容">selenium获取元素内容</a></li>
      </ul>
    </li>
    <li><a href="#scrapy">scrapy</a>
      <ul>
        <li><a href="#框架安装">框架安装</a>
          <ul>
            <li><a href="#linux">Linux</a></li>
          </ul>
        </li>
        <li><a href="#scrapy基本操作">scrapy基本操作</a>
          <ul>
            <li><a href="#创建一个scrapy项目">创建一个scrapy项目</a></li>
            <li><a href="#然后就生成了下面的目录">然后就生成了下面的目录</a></li>
            <li><a href="#spiders是爬虫源文件也就是代码">spiders是爬虫源文件,也就是代码</a></li>
            <li><a href="#在终端中进入spiders目录创建爬虫源文件">在终端中进入spiders目录,创建爬虫源文件</a></li>
            <li><a href="#运行结束后spiders目录下就出现了爬虫源文件">运行结束后,spiders目录下就出现了爬虫源文件</a></li>
            <li><a href="#编写爬虫源文件代码">编写爬虫源文件代码</a></li>
            <li><a href="#在spiders目录下启动项目">在spiders目录下启动项目</a></li>
            <li><a href="#运行后终端就会打印吧啦巴拉一大堆日志如果想取消打印只打印response的关键信息">运行后终端就会打印吧啦巴拉一大堆日志,如果想取消打印,只打印response的关键信息</a></li>
            <li><a href="#如果爬虫源文件代码有错误终端默认不会显示">如果爬虫源文件代码有错误,终端默认不会显示</a></li>
            <li><a href="#settingspy中有这样一行代码">settings.py中有这样一行代码</a></li>
          </ul>
        </li>
        <li><a href="#scrapy随便爬一个紫可可主页视频页面地址">scrapy随便爬一个紫可可主页视频页面地址</a></li>
        <li><a href="#持久化存储">持久化存储</a>
          <ul>
            <li><a href="#基于终端的持久化存储">基于终端的持久化存储</a></li>
            <li><a href="#基于管道的持久化存储">基于管道的持久化存储</a></li>
          </ul>
        </li>
        <li><a href="#全站爬取彼岸图网的4k壁纸图片">全站爬取(彼岸图网的4K壁纸图片)</a></li>
        <li><a href="#scrapy框架设计模式">scrapy框架设计模式</a></li>
        <li><a href="#请求传参">请求传参</a></li>
        <li><a href="#中间件">中间件</a></li>
      </ul>
    </li>
    <li><a href="#反爬机制">反爬机制</a>
      <ul>
        <li><a href="#css反爬">css反爬</a></li>
        <li><a href="#数字加密反爬">数字加密反爬</a></li>
        <li><a href="#动态生成静态页面">动态生成静态页面</a></li>
      </ul>
    </li>
    <li><a href="#代理ip">代理IP</a></li>
    <li><a href="#综合项目">综合项目</a>
      <ul>
        <li><a href="#使用ajax--selenium爬取战恋雪小说">使用ajax + selenium爬取<code>战恋雪</code>小说</a></li>
      </ul>
    </li>
    <li><a href="#api汇总">API汇总</a>
      <ul>
        <li><a href="#网易云">网易云</a></li>
      </ul>
    </li>
    <li><a href="#爬虫工具">爬虫工具</a>
      <ul>
        <li><a href="#fiddler">Fiddler</a></li>
      </ul>
    </li>
    <li><a href="#验证码识别库">验证码识别库</a></li>
    <li><a href="#项目">项目</a>
      <ul>
        <li><a href="#哔哩哔哩视频下载">哔哩哔哩视频下载</a>
          <ul>
            <li><a href="#代码实现">代码实现</a></li>
            <li><a href="#ffmpeg环境配置">ffmpeg环境配置</a></li>
            <li><a href="#付费视频">付费视频</a></li>
          </ul>
        </li>
        <li><a href="#古诗词网登录---超级鹰识别验证码">古诗词网登录 - 超级鹰识别验证码</a></li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
</div>
    <div class="post-content">
      <h1 id="不同操作系统浏览器配置">不同操作系统浏览器配置</h1>
<p><code>Ubuntu20.04</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell"><span class="nv">headers</span> <span class="o">=</span> <span class="o">{</span>
        <span class="s1">&#39;User-Agent&#39;</span>:<span class="s1">&#39;Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/94.0.4606.71 Safari/537.36&#39;</span>
    <span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p><code>Windows10</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell"><span class="nv">headers</span> <span class="o">=</span> <span class="o">{</span>
        <span class="s1">&#39;User-Agent&#39;</span>:<span class="s1">&#39;Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/96.0.4664.45 Safari/537.36&#39;</span>
    <span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p><code>MacOS</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">...
</code></pre></td></tr></table>
</div>
</div><h1 id="请求">请求</h1>
<h2 id="step01获取百度网页">Step01.获取百度网页</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">requests</span>
<span class="n">requests</span><span class="o">.</span><span class="n">packages</span><span class="o">.</span><span class="n">urllib3</span><span class="o">.</span><span class="n">disable_warnings</span><span class="p">()</span> <span class="c1"># 有些时候requests有警告...</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">url</span> <span class="o">=</span> <span class="s1">&#39;https://www.baidu.com&#39;</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">)</span>
    <span class="n">page_text</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">text</span>
    <span class="k">print</span><span class="p">(</span><span class="n">page_text</span><span class="p">)</span>

    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;./baidu.html&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
        <span class="n">fp</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">page_text</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;爬虫爬取结束&#39;</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><hr>
<h2 id="step02实现百度简单搜索">Step02.实现百度简单搜索</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">requests</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="c1"># 请求url</span>
    <span class="n">url</span> <span class="o">=</span> <span class="s2">&#34;https://www.baidu.com/s?&#34;</span>

    <span class="c1"># 请求头,用于模拟浏览器请求骗过服务器</span>
    <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;User-Agent&#39;</span><span class="p">:</span><span class="s1">&#39;Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/94.0.4606.71 Safari/537.36&#39;</span>
    <span class="p">}</span>

    <span class="n">kw</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s1">&#39;enter a word&#39;</span><span class="p">)</span>

    <span class="c1"># headers和参数都是json格式</span>
    <span class="n">param</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;wd&#39;</span><span class="p">:</span> <span class="n">kw</span>
    <span class="p">}</span>

    <span class="c1"># 通过requests库的get方法进行请求,响应的是response对象</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">param</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>

    <span class="c1"># 获取response对象的text文本内容</span>
    <span class="n">page_text</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">text</span>

    <span class="n">fileName</span> <span class="o">=</span> <span class="n">kw</span> <span class="o">+</span> <span class="s1">&#39;.html&#39;</span>
    <span class="k">print</span><span class="p">(</span><span class="n">page_text</span><span class="p">)</span>

    <span class="s1">&#39;&#39;&#39;
</span><span class="s1">        with 语句适用于对资源进行访问的场合，确保不管使用过程中是否发生异常都会执行必要的“清理”操作，释放资源，比如文件使用后自动关闭、线程中锁的自动获取和释放等。
</span><span class="s1">        with open语句用法：
</span><span class="s1">        由于文件读写时都有可能产生IOError，一旦出错，后面的f.close()就不会调用。所以，为了保证无论是否出错都能正确地关闭文件，我们可以使用try … finally来实现：
</span><span class="s1">        try:
</span><span class="s1">            f = open(’/path/to/file’, ‘r’)
</span><span class="s1">            print(f.read())
</span><span class="s1">        finally:
</span><span class="s1">            if f:
</span><span class="s1">                f.close()
</span><span class="s1">        但是每次都这么写实在太繁琐，所以，Python引入了with语句来自动帮我们调用close()方法：
</span><span class="s1">        with open(’/path/to/file’, ‘r’) as f:
</span><span class="s1">            print(f.read())
</span><span class="s1">    &#39;&#39;&#39;</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">fileName</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
        <span class="n">fp</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">page_text</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;爬虫爬取结束&#39;</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><hr>
<h2 id="step03实现百度翻译">Step03.实现百度翻译</h2>
<p><img src="https://img-blog.csdnimg.cn/edacb7b8a45a4b20921a11f18286d448.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA5a2k5ZCNQA==,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"></p>
<p><img src="https://img-blog.csdnimg.cn/725024aab8184f6582e723d7ea74d464.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA5a2k5ZCNQA==,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"></p>
<p><img src="https://img-blog.csdnimg.cn/ab881584d7874e8ca59341f082a600ed.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA5a2k5ZCNQA==,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">import</span> <span class="nn">json</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">url</span> <span class="o">=</span> <span class="s2">&#34;https://fanyi.baidu.com/sug&#34;</span>

    <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;User-Agent&#39;</span><span class="p">:</span><span class="s1">&#39;Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/94.0.4606.71 Safari/537.36&#39;</span>
    <span class="p">}</span>

    <span class="n">kw</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s1">&#39;enter a word&#39;</span><span class="p">)</span>

    <span class="n">param</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;kw&#39;</span><span class="p">:</span> <span class="n">kw</span>
    <span class="p">}</span>

    <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">param</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>

    <span class="n">page_json</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>

    <span class="n">fileName</span> <span class="o">=</span> <span class="n">kw</span> <span class="o">+</span> <span class="s1">&#39;.json&#39;</span>

    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">fileName</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
        <span class="n">fp</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">page_json</span><span class="p">))</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;爬虫爬取结束&#39;</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><hr>
<h2 id="step04爬取豆瓣电影排行榜">Step04.爬取豆瓣电影排行榜</h2>
<p><img src="https://img-blog.csdnimg.cn/44b4c8833d634d11a8ec2da861dcfb4a.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA5a2k5ZCNQA==,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"></p>
<p><img src="https://img-blog.csdnimg.cn/f3a4a41f18024270b88571e84fe01577.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA5a2k5ZCNQA==,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"></p>
<p><img src="https://img-blog.csdnimg.cn/9e03fc01c3684183996e8bfcac317958.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA5a2k5ZCNQA==,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"></p>
<p><img src="https://img-blog.csdnimg.cn/4971f3af851c4087bcf33cc8b3624078.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA5a2k5ZCNQA==,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">requests</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">url</span> <span class="o">=</span> <span class="s2">&#34;https://movie.douban.com/j/chart/top_list?&#34;</span>

    <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;User-Agent&#39;</span><span class="p">:</span> <span class="s1">&#39;Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/94.0.4606.71 Safari/537.36&#39;</span>
    <span class="p">}</span>

    <span class="n">params</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;11&#39;</span><span class="p">,</span>
        <span class="s1">&#39;interval_id&#39;</span><span class="p">:</span> <span class="s1">&#39;100:90&#39;</span><span class="p">,</span>
        <span class="s1">&#39;action&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
        <span class="s1">&#39;start&#39;</span><span class="p">:</span> <span class="s1">&#39;0&#39;</span><span class="p">,</span>
        <span class="s1">&#39;limit&#39;</span><span class="p">:</span> <span class="s1">&#39;10&#39;</span>
    <span class="p">}</span>

    <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">params</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>

    <span class="n">page_json</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>

    <span class="n">fileName</span> <span class="o">=</span> <span class="s1">&#39;douban.json&#39;</span>

    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">fileName</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
        <span class="n">fp</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">page_json</span><span class="p">))</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;爬虫爬取结束&#39;</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-json" data-lang="json"><span class="p">[{</span><span class="err">&#39;rating&#39;:</span> <span class="err">[&#39;9.7&#39;,</span> <span class="err">&#39;50&#39;],</span> <span class="err">&#39;rank&#39;:</span> <span class="err">1,</span> <span class="err">&#39;cover_url&#39;:</span> <span class="err">&#39;https://img2.doubanio.com/view/photo/s_ratio_poster/public/p480747492.jpg&#39;,</span> <span class="err">&#39;is_playable&#39;:</span> <span class="err">True,</span> <span class="err">&#39;id&#39;:</span> <span class="err">&#39;1292052&#39;,</span> <span class="err">&#39;types&#39;:</span> <span class="err">[&#39;犯罪&#39;,</span> <span class="err">&#39;剧情&#39;],</span> <span class="err">&#39;regions&#39;:</span> <span class="err">[&#39;美国&#39;],</span> <span class="err">&#39;title&#39;:</span> <span class="err">&#39;肖申克的救赎&#39;,</span> <span class="err">&#39;url&#39;:</span> <span class="err">&#39;https://movie.douban.com/subject/1292052/&#39;,</span> <span class="err">&#39;release_date&#39;:</span> <span class="err">&#39;1994-09-10&#39;,</span> <span class="err">&#39;actor_count&#39;:</span> <span class="err">25,</span> <span class="err">&#39;vote_count&#39;:</span> <span class="err">2520707,</span> <span class="err">&#39;score&#39;:</span> <span class="err">&#39;9.7&#39;,</span> <span class="err">&#39;actors&#39;:</span> <span class="err">[&#39;蒂姆·罗宾斯&#39;,</span> <span class="err">&#39;摩根·弗里曼&#39;,</span> <span class="err">&#39;鲍勃·冈顿&#39;,</span> <span class="err">&#39;威廉姆·赛德勒&#39;,</span> <span class="err">&#39;克兰西·布朗&#39;,</span> <span class="err">&#39;吉尔·贝罗斯&#39;,</span> <span class="err">&#39;马克·罗斯顿&#39;,</span> <span class="err">&#39;詹姆斯·惠特摩&#39;,</span> <span class="err">&#39;杰弗里·德曼&#39;,</span> <span class="err">&#39;拉里·布兰登伯格&#39;,</span> <span class="err">&#39;尼尔·吉恩托利&#39;,</span> <span class="err">&#39;布赖恩·利比&#39;,</span> <span class="err">&#39;大卫·普罗瓦尔&#39;,</span> <span class="err">&#39;约瑟夫·劳格诺&#39;,</span> <span class="err">&#39;祖德·塞克利拉&#39;,</span> <span class="err">&#39;保罗·麦克兰尼&#39;,</span> <span class="err">&#39;芮妮·布莱恩&#39;,</span> <span class="err">&#39;阿方索·弗里曼&#39;,</span> <span class="err">&#39;V·J·福斯特&#39;,</span> <span class="err">&#39;弗兰克·梅德拉诺&#39;,</span> <span class="err">&#39;马克·迈尔斯&#39;,</span> <span class="err">&#39;尼尔·萨默斯&#39;,</span> <span class="err">&#39;耐德·巴拉米&#39;,</span> <span class="err">&#39;布赖恩·戴拉特&#39;,</span> <span class="err">&#39;唐·麦克马纳斯&#39;],</span> <span class="err">&#39;is_watched&#39;:</span> <span class="err">False</span><span class="p">},</span> <span class="p">{</span><span class="err">&#39;rating&#39;:</span> <span class="err">[&#39;9.6&#39;,</span> <span class="err">&#39;50&#39;],</span> <span class="err">&#39;rank&#39;:</span> <span class="err">2,</span> <span class="err">&#39;cover_url&#39;:</span> <span class="err">&#39;https://img3.doubanio.com/view/photo/s_ratio_poster/public/p2561716440.jpg&#39;,</span> <span class="err">&#39;is_playable&#39;:</span> <span class="err">True,</span> <span class="err">&#39;id&#39;:</span> <span class="err">&#39;1291546&#39;,</span> <span class="err">&#39;types&#39;:</span> <span class="err">[&#39;剧情&#39;,</span> <span class="err">&#39;爱情&#39;,</span> <span class="err">&#39;同性&#39;],</span> <span class="err">&#39;regions&#39;:</span> <span class="err">[&#39;中国大陆&#39;,</span> <span class="err">&#39;中国香港&#39;],</span> <span class="err">&#39;title&#39;:</span> <span class="err">&#39;霸王别姬&#39;,</span> <span class="err">&#39;url&#39;:</span> <span class="err">&#39;https://movie.douban.com/subject/1291546/&#39;,</span> <span class="err">&#39;release_date&#39;:</span> <span class="err">&#39;1993-07-26&#39;,</span> <span class="err">&#39;actor_count&#39;:</span> <span class="err">26,</span> <span class="err">&#39;vote_count&#39;:</span> <span class="err">1874001,</span> <span class="err">&#39;score&#39;:</span> <span class="err">&#39;9.6&#39;,</span> <span class="err">&#39;actors&#39;:</span> <span class="err">[&#39;张国荣&#39;,</span> <span class="err">&#39;张丰毅&#39;,</span> <span class="err">&#39;巩俐&#39;,</span> <span class="err">&#39;葛优&#39;,</span> <span class="err">&#39;英达&#39;,</span> <span class="err">&#39;蒋雯丽&#39;,</span> <span class="err">&#39;吴大维&#39;,</span> <span class="err">&#39;吕齐&#39;,</span> <span class="err">&#39;雷汉&#39;,</span> <span class="err">&#39;尹治&#39;,</span> <span class="err">&#39;马明威&#39;,</span> <span class="err">&#39;费振翔&#39;,</span> <span class="err">&#39;智一桐&#39;,</span> <span class="err">&#39;李春&#39;,</span> <span class="err">&#39;赵海龙&#39;,</span> <span class="err">&#39;李丹&#39;,</span> <span class="err">&#39;童弟&#39;,</span> <span class="err">&#39;沈慧芬&#39;,</span> <span class="err">&#39;黄斐&#39;,</span> <span class="err">&#39;徐杰&#39;,</span> <span class="err">&#39;黄磊&#39;,</span> <span class="err">&#39;冯远征&#39;,</span> <span class="err">&#39;杨立新&#39;,</span> <span class="err">&#39;方征&#39;,</span> <span class="err">&#39;周璞&#39;,</span> <span class="err">&#39;隋永清&#39;],</span> <span class="err">&#39;is_watched&#39;:</span> <span class="err">False</span><span class="p">},</span> <span class="p">{</span><span class="err">&#39;rating&#39;:</span> <span class="err">[&#39;9.6&#39;,</span> <span class="err">&#39;50&#39;],</span> <span class="err">&#39;rank&#39;:</span> <span class="err">3,</span> <span class="err">&#39;cover_url&#39;:</span> <span class="err">&#39;https://img2.doubanio.com/view/photo/s_ratio_poster/public/p2578474613.jpg&#39;,</span> <span class="err">&#39;is_playable&#39;:</span> <span class="err">True,</span> <span class="err">&#39;id&#39;:</span> <span class="err">&#39;1292063&#39;,</span> <span class="err">&#39;types&#39;:</span> <span class="err">[&#39;剧情&#39;,</span> <span class="err">&#39;喜剧&#39;,</span> <span class="err">&#39;爱情&#39;,</span> <span class="err">&#39;战争&#39;],</span> <span class="err">&#39;regions&#39;:</span> <span class="err">[&#39;意大利&#39;],</span> <span class="err">&#39;title&#39;:</span> <span class="err">&#39;美丽人生&#39;,</span> <span class="err">&#39;url&#39;:</span> <span class="err">&#39;https://movie.douban.com/subject/1292063/&#39;,</span> <span class="err">&#39;release_date&#39;:</span> <span class="err">&#39;2020-01-03&#39;,</span> <span class="err">&#39;actor_count&#39;:</span> <span class="err">29,</span> <span class="err">&#39;vote_count&#39;:</span> <span class="err">1161664,</span> <span class="err">&#39;score&#39;:</span> <span class="err">&#39;9.6&#39;,</span> <span class="err">&#39;actors&#39;:</span> <span class="err">[&#39;罗伯托·贝尼尼&#39;,</span> <span class="err">&#39;尼可莱塔·布拉斯基&#39;,</span> <span class="err">&#39;乔治·坎塔里尼&#39;,</span> <span class="err">&#39;朱斯蒂诺·杜拉诺&#39;,</span> <span class="err">&#39;赛尔乔·比尼·布斯特里克&#39;,</span> <span class="err">&#39;玛丽萨·帕雷德斯&#39;,</span> <span class="err">&#39;霍斯特·布赫霍尔茨&#39;,</span> <span class="err">&#39;利迪娅·阿方西&#39;,</span> <span class="err">&#39;朱利亚娜·洛约迪切&#39;,</span> <span class="err">&#39;亚美利哥·丰塔尼&#39;,</span> <span class="err">&#39;彼得·德·席尔瓦&#39;,</span> <span class="err">&#39;弗朗西斯·古佐&#39;,</span> <span class="err">&#39;拉法埃拉·莱博罗尼&#39;,</span> <span class="err">&#39;克劳迪奥·阿方西&#39;,</span> <span class="err">&#39;吉尔·巴罗尼&#39;,</span> <span class="err">&#39;马西莫·比安奇&#39;,</span> <span class="err">&#39;恩尼奥·孔萨尔维&#39;,</span> <span class="err">&#39;吉安卡尔洛·科森蒂诺&#39;,</span> <span class="err">&#39;阿伦·克雷格&#39;,</span> <span class="err">&#39;汉尼斯·赫尔曼&#39;,</span> <span class="err">&#39;弗兰科·梅斯科利尼&#39;,</span> <span class="err">&#39;安东尼奥·普雷斯特&#39;,</span> <span class="err">&#39;吉娜·诺维勒&#39;,</span> <span class="err">&#39;理查德·塞梅尔&#39;,</span> <span class="err">&#39;安德烈提多娜&#39;,</span> <span class="err">&#39;迪尔克·范登贝格&#39;,</span> <span class="err">&#39;奥梅罗·安东努蒂&#39;,</span> <span class="err">&#39;沈晓谦&#39;,</span> <span class="err">&#39;张欣&#39;],</span> <span class="err">&#39;is_watched&#39;:</span> <span class="err">False</span><span class="p">},</span> <span class="p">{</span><span class="err">&#39;rating&#39;:</span> <span class="err">[&#39;9.6&#39;,</span> <span class="err">&#39;50&#39;],</span> <span class="err">&#39;rank&#39;:</span> <span class="err">4,</span> <span class="err">&#39;cover_url&#39;:</span> <span class="err">&#39;https://img1.doubanio.com/view/photo/s_ratio_poster/public/p1505392928.jpg&#39;,</span> <span class="err">&#39;is_playable&#39;:</span> <span class="err">True,</span> <span class="err">&#39;id&#39;:</span> <span class="err">&#39;1296141&#39;,</span> <span class="err">&#39;types&#39;:</span> <span class="err">[&#39;剧情&#39;,</span> <span class="err">&#39;犯罪&#39;,</span> <span class="err">&#39;悬疑&#39;],</span> <span class="err">&#39;regions&#39;:</span> <span class="err">[&#39;美国&#39;],</span> <span class="err">&#39;title&#39;:</span> <span class="err">&#39;控方证人&#39;,</span> <span class="err">&#39;url&#39;:</span> <span class="err">&#39;https://movie.douban.com/subject/1296141/&#39;,</span> <span class="err">&#39;release_date&#39;:</span> <span class="err">&#39;1957-12-17&#39;,</span> <span class="err">&#39;actor_count&#39;:</span> <span class="err">51,</span> <span class="err">&#39;vote_count&#39;:</span> <span class="err">418065,</span> <span class="err">&#39;score&#39;:</span> <span class="err">&#39;9.6&#39;,</span> <span class="err">&#39;actors&#39;:</span> <span class="err">[&#39;泰隆·鲍华&#39;,</span> <span class="err">&#39;玛琳·黛德丽&#39;,</span> <span class="err">&#39;查尔斯·劳顿&#39;,</span> <span class="err">&#39;爱尔莎·兰切斯特&#39;,</span> <span class="err">&#39;约翰·威廉姆斯&#39;,</span> <span class="err">&#39;亨利·丹尼尔&#39;,</span> <span class="err">&#39;伊安·沃尔夫&#39;,</span> <span class="err">&#39;托林·撒切尔&#39;,</span> <span class="err">&#39;诺玛·威登&#39;,</span> <span class="err">&#39;尤娜·奥康纳&#39;,</span> <span class="err">&#39;茹塔·李&#39;,</span> <span class="err">&#39;贝丝·弗劳尔斯&#39;,</span> <span class="err">&#39;比尔·厄尔文&#39;,</span> <span class="err">&#39;J·帕特·奥马利&#39;,</span> <span class="err">&#39;本·怀特&#39;,</span> <span class="err">&#39;Paul</span> <span class="err">Kruger&#39;,</span> <span class="err">&#39;Jack</span> <span class="err">Raine&#39;,</span> <span class="err">&#39;Paul</span> <span class="err">Power&#39;,</span> <span class="err">&#39;乔治·佩林&#39;,</span> <span class="err">&#39;威廉·H·奥布莱恩&#39;,</span> <span class="err">&#39;奥托拉内史密斯&#39;,</span> <span class="err">&#39;Frank</span> <span class="err">McClure&#39;,</span> <span class="err">&#39;Colin</span> <span class="err">Kenny&#39;,</span> <span class="err">&#39;Jeanne</span> <span class="err">Lafayette&#39;,</span> <span class="err">&#39;Wilbur</span> <span class="err">Mack&#39;,</span> <span class="err">&#39;Fred</span> <span class="err">Rapport&#39;,</span> <span class="err">&#39;利奥达·理查德斯&#39;,</span> <span class="err">&#39;Glen</span> <span class="err">Walters&#39;,</span> <span class="err">&#39;Arthur</span> <span class="err">Tovey&#39;,</span> <span class="err">&#39;伯特史蒂文斯&#39;,</span> <span class="err">&#39;Cap</span> <span class="err">Somers&#39;,</span> <span class="err">&#39;Lucille</span> <span class="err">Sewall&#39;,</span> <span class="err">&#39;斯考特西顿&#39;,</span> <span class="err">&#39;Norbert</span> <span class="err">Schiller&#39;,</span> <span class="err">&#39;杰弗里·塞尔&#39;,</span> <span class="err">&#39;John</span> <span class="err">Roy&#39;,</span> <span class="err">&#39;Al</span> <span class="err">Roberts&#39;,</span> <span class="err">&#39;Art</span> <span class="err">Howard&#39;,</span> <span class="err">&#39;Stuart</span> <span class="err">Hall&#39;,</span> <span class="err">&#39;Francis</span> <span class="err">Compton&#39;,</span> <span class="err">&#39;Philip</span> <span class="err">Tonge&#39;,</span> <span class="err">&#39;帕特里克·艾亨&#39;,</span> <span class="err">&#39;富兰克林·法纳姆&#39;,</span> <span class="err">&#39;玛乔丽·伊顿&#39;,</span> <span class="err">&#39;史蒂夫·卡鲁瑟斯&#39;,</span> <span class="err">&#39;George</span> <span class="err">Calliga&#39;,</span> <span class="err">&#39;乔治布鲁格曼&#39;,</span> <span class="err">&#39;丹尼·鲍沙其&#39;,</span> <span class="err">&#39;Brandon</span> <span class="err">Beach&#39;,</span> <span class="err">&#39;埃迪·贝克&#39;,</span> <span class="err">&#39;沃尔特·培根&#39;],</span> <span class="err">&#39;is_watched&#39;:</span> <span class="err">False</span><span class="p">},</span> <span class="p">{</span><span class="err">&#39;rating&#39;:</span> <span class="err">[&#39;9.6&#39;,</span> <span class="err">&#39;50&#39;],</span> <span class="err">&#39;rank&#39;:</span> <span class="err">5,</span> <span class="err">&#39;cover_url&#39;:</span> <span class="err">&#39;https://img2.doubanio.com/view/photo/s_ratio_poster/public/p2264336223.jpg&#39;,</span> <span class="err">&#39;is_playable&#39;:</span> <span class="err">False,</span> <span class="err">&#39;id&#39;:</span> <span class="err">&#39;24877005&#39;,</span> <span class="err">&#39;types&#39;:</span> <span class="err">[&#39;剧情&#39;,</span> <span class="err">&#39;歌舞&#39;],</span> <span class="err">&#39;regions&#39;:</span> <span class="err">[&#39;Austria&#39;],</span> <span class="err">&#39;title&#39;:</span> <span class="err">&#39;伊丽莎白&#39;,</span> <span class="err">&#39;url&#39;:</span> <span class="err">&#39;https://movie.douban.com/subject/24877005/&#39;,</span> <span class="err">&#39;release_date&#39;:</span> <span class="err">&#39;2005-12-05&#39;,</span> <span class="err">&#39;actor_count&#39;:</span> <span class="err">3,</span> <span class="err">&#39;vote_count&#39;:</span> <span class="err">6519,</span> <span class="err">&#39;score&#39;:</span> <span class="err">&#39;9.6&#39;,</span> <span class="err">&#39;actors&#39;:</span> <span class="err">[&#39;玛雅·哈克福特&#39;,</span> <span class="err">&#39;Máté</span> <span class="err">Kamarás&#39;,</span> <span class="err">&#39;安德烈</span> <span class="err">鲍尔&#39;],</span> <span class="err">&#39;is_watched&#39;:</span> <span class="err">False</span><span class="p">},</span> <span class="p">{</span><span class="err">&#39;rating&#39;:</span> <span class="err">[&#39;9.5&#39;,</span> <span class="err">&#39;50&#39;],</span> <span class="err">&#39;rank&#39;:</span> <span class="err">6,</span> <span class="err">&#39;cover_url&#39;:</span> <span class="err">&#39;https://img2.doubanio.com/view/photo/s_ratio_poster/public/p2372307693.jpg&#39;,</span> <span class="err">&#39;is_playable&#39;:</span> <span class="err">True,</span> <span class="err">&#39;id&#39;:</span> <span class="err">&#39;1292720&#39;,</span> <span class="err">&#39;types&#39;:</span> <span class="err">[&#39;剧情&#39;,</span> <span class="err">&#39;爱情&#39;],</span> <span class="err">&#39;regions&#39;:</span> <span class="err">[&#39;美国&#39;],</span> <span class="err">&#39;title&#39;:</span> <span class="err">&#39;阿甘正传&#39;,</span> <span class="err">&#39;url&#39;:</span> <span class="err">&#39;https://movie.douban.com/subject/1292720/&#39;,</span> <span class="err">&#39;release_date&#39;:</span> <span class="err">&#39;1994-06-23&#39;,</span> <span class="err">&#39;actor_count&#39;:</span> <span class="err">51,</span> <span class="err">&#39;vote_count&#39;:</span> <span class="err">1893869,</span> <span class="err">&#39;score&#39;:</span> <span class="err">&#39;9.5&#39;,</span> <span class="err">&#39;actors&#39;:</span> <span class="err">[&#39;汤姆·汉克斯&#39;,</span> <span class="err">&#39;罗宾·怀特&#39;,</span> <span class="err">&#39;加里·西尼斯&#39;,</span> <span class="err">&#39;麦凯尔泰·威廉逊&#39;,</span> <span class="err">&#39;莎莉·菲尔德&#39;,</span> <span class="err">&#39;海利·乔·奥斯蒙&#39;,</span> <span class="err">&#39;迈克尔·康纳·亨弗里斯&#39;,</span> <span class="err">&#39;哈罗德·G·赫瑟姆&#39;,</span> <span class="err">&#39;山姆·安德森&#39;,</span> <span class="err">&#39;伊俄涅·M·特雷奇&#39;,</span> <span class="err">&#39;彼得·道博森&#39;,</span> <span class="err">&#39;希博汗·法隆&#39;,</span> <span class="err">&#39;伊丽莎白·汉克斯&#39;,</span> <span class="err">&#39;汉娜·豪尔&#39;,</span> <span class="err">&#39;克里斯托弗·琼斯&#39;,</span> <span class="err">&#39;罗布·兰德里&#39;,</span> <span class="err">&#39;杰森·麦克奎尔&#39;,</span> <span class="err">&#39;桑尼·施罗耶&#39;,</span> <span class="err">&#39;艾德·戴维斯&#39;,</span> <span class="err">&#39;丹尼尔C.斯瑞派克&#39;,</span> <span class="err">&#39;大卫·布里斯宾&#39;,</span> <span class="err">&#39;德博拉·麦克蒂尔&#39;,</span> <span class="err">&#39;艾尔·哈林顿&#39;,</span> <span class="err">&#39;阿非莫·奥米拉&#39;,</span> <span class="err">&#39;约翰·沃德斯塔德&#39;,</span> <span class="err">&#39;迈克尔·伯吉斯&#39;,</span> <span class="err">&#39;埃里克·安德伍德&#39;,</span> <span class="err">&#39;拜伦·明斯&#39;,</span> <span class="err">&#39;斯蒂芬·布吉格沃特&#39;,</span> <span class="err">&#39;约翰·威廉·高尔特&#39;,</span> <span class="err">&#39;希拉里·沙普兰&#39;,</span> <span class="err">&#39;伊莎贝尔·罗斯&#39;,</span> <span class="err">&#39;理查德·达历山德罗&#39;,</span> <span class="err">&#39;迪克·史迪威&#39;,</span> <span class="err">&#39;迈克尔-杰斯&#39;,</span> <span class="err">&#39;杰弗里·布莱克&#39;,</span> <span class="err">&#39;瓦妮莎·罗斯&#39;,</span> <span class="err">&#39;迪克·卡维特&#39;,</span> <span class="err">&#39;马拉·苏查雷特扎&#39;,</span> <span class="err">&#39;乔·阿拉斯奇&#39;,</span> <span class="err">&#39;W·本森·泰瑞&#39;,</span> <span class="err">&#39;约翰·列侬&#39;,</span> <span class="err">&#39;埃尔维斯·普雷斯利&#39;,</span> <span class="err">&#39;罗纳德·里根&#39;,</span> <span class="err">&#39;鲍勃·霍普&#39;,</span> <span class="err">&#39;约翰·肯尼迪&#39;,</span> <span class="err">&#39;理查德·尼克松&#39;,</span> <span class="err">&#39;吴俊全&#39;,</span> <span class="err">&#39;蒂莫西·麦克尼尔&#39;,</span> <span class="err">&#39;杰拉尔德·福特&#39;,</span> <span class="err">&#39;布雷特·赖斯&#39;],</span> <span class="err">&#39;is_watched&#39;:</span> <span class="err">False</span><span class="p">},</span> <span class="p">{</span><span class="err">&#39;rating&#39;:</span> <span class="err">[&#39;9.5&#39;,</span> <span class="err">&#39;50&#39;],</span> <span class="err">&#39;rank&#39;:</span> <span class="err">7,</span> <span class="err">&#39;cover_url&#39;:</span> <span class="err">&#39;https://img2.doubanio.com/view/photo/s_ratio_poster/public/p492406163.jpg&#39;,</span> <span class="err">&#39;is_playable&#39;:</span> <span class="err">True,</span> <span class="err">&#39;id&#39;:</span> <span class="err">&#39;1295124&#39;,</span> <span class="err">&#39;types&#39;:</span> <span class="err">[&#39;剧情&#39;,</span> <span class="err">&#39;历史&#39;,</span> <span class="err">&#39;战争&#39;],</span> <span class="err">&#39;regions&#39;:</span> <span class="err">[&#39;美国&#39;],</span> <span class="err">&#39;title&#39;:</span> <span class="err">&#39;辛德勒的名单&#39;,</span> <span class="err">&#39;url&#39;:</span> <span class="err">&#39;https://movie.douban.com/subject/1295124/&#39;,</span> <span class="err">&#39;release_date&#39;:</span> <span class="err">&#39;1993-11-30&#39;,</span> <span class="err">&#39;actor_count&#39;:</span> <span class="err">47,</span> <span class="err">&#39;vote_count&#39;:</span> <span class="err">968953,</span> <span class="err">&#39;score&#39;:</span> <span class="err">&#39;9.5&#39;,</span> <span class="err">&#39;actors&#39;:</span> <span class="err">[&#39;连姆·尼森&#39;,</span> <span class="err">&#39;本·金斯利&#39;,</span> <span class="err">&#39;拉尔夫·费因斯&#39;,</span> <span class="err">&#39;卡罗琳·古多尔&#39;,</span> <span class="err">&#39;乔纳森·萨加尔&#39;,</span> <span class="err">&#39;艾伯丝·戴维兹&#39;,</span> <span class="err">&#39;马尔戈萨·格贝尔&#39;,</span> <span class="err">&#39;马克·伊瓦涅&#39;,</span> <span class="err">&#39;碧翠斯·马科拉&#39;,</span> <span class="err">&#39;安德烈·瑟韦林&#39;,</span> <span class="err">&#39;弗里德里希·冯·图恩&#39;,</span> <span class="err">&#39;克齐斯茨托夫·拉夫特&#39;,</span> <span class="err">&#39;诺伯特·魏塞尔&#39;,</span> <span class="err">&#39;维斯瓦夫·科马萨&#39;,</span> <span class="err">&#39;皮奥特·赛尔沃斯&#39;,</span> <span class="err">&#39;Tadeusz</span> <span class="err">Huk&#39;,</span> <span class="err">&#39;马丁·塞梅洛格&#39;,</span> <span class="err">&#39;托马斯·德德克&#39;,</span> <span class="err">&#39;奥拉夫·卢巴申科&#39;,</span> <span class="err">&#39;马瑞安·格林卡&#39;,</span> <span class="err">&#39;约亨·尼克尔&#39;,</span> <span class="err">&#39;艾尔文·莱德&#39;,</span> <span class="err">&#39;Maciej</span> <span class="err">Orlos&#39;,</span> <span class="err">&#39;吴俊全&#39;,</span> <span class="err">&#39;佐久间玲&#39;,</span> <span class="err">&#39;约阿希姆·保罗·阿斯波克&#39;,</span> <span class="err">&#39;彭河&#39;,</span> <span class="err">&#39;戈兹·奥托&#39;,</span> <span class="err">&#39;玛雅·奥丝塔泽斯卡&#39;,</span> <span class="err">&#39;Maciej</span> <span class="err">Kozlowski&#39;,</span> <span class="err">&#39;阿格尼兹卡·旺格&#39;,</span> <span class="err">&#39;阿格涅兹卡·克鲁科沃娜&#39;,</span> <span class="err">&#39;Eugeniusz</span> <span class="err">Priwieziencew&#39;,</span> <span class="err">&#39;布兰科·拉斯蒂格&#39;,</span> <span class="err">&#39;Marta</span> <span class="err">Bizon&#39;,</span> <span class="err">&#39;Ezra</span> <span class="err">Dagan&#39;,</span> <span class="err">&#39;吉恩·莱赫纳&#39;,</span> <span class="err">&#39;Razia</span> <span class="err">Israeli&#39;,</span> <span class="err">&#39;拉米·希尔伯格&#39;,</span> <span class="err">&#39;路德格·皮斯特&#39;,</span> <span class="err">&#39;埃琳娜·勒文松&#39;,</span> <span class="err">&#39;胡契克·卡勒塔&#39;,</span> <span class="err">&#39;塔德乌什·布拉德茨基&#39;,</span> <span class="err">&#39;亨里克·比斯塔&#39;,</span> <span class="err">&#39;帕维·德朗柯&#39;,</span> <span class="err">&#39;耶日·诺瓦克&#39;,</span> <span class="err">&#39;安娜·穆查&#39;],</span> <span class="err">&#39;is_watched&#39;:</span> <span class="err">False</span><span class="p">},</span> <span class="p">{</span><span class="err">&#39;rating&#39;:</span> <span class="err">[&#39;9.5&#39;,</span> <span class="err">&#39;50&#39;],</span> <span class="err">&#39;rank&#39;:</span> <span class="err">8,</span> <span class="err">&#39;cover_url&#39;:</span> <span class="err">&#39;https://img1.doubanio.com/view/photo/s_ratio_poster/public/p2505048077.jpg&#39;,</span> <span class="err">&#39;is_playable&#39;:</span> <span class="err">True,</span> <span class="err">&#39;id&#39;:</span> <span class="err">&#39;1307856&#39;,</span> <span class="err">&#39;types&#39;:</span> <span class="err">[&#39;剧情&#39;],</span> <span class="err">&#39;regions&#39;:</span> <span class="err">[&#39;中国大陆&#39;,</span> <span class="err">&#39;中国香港&#39;],</span> <span class="err">&#39;title&#39;:</span> <span class="err">&#39;背靠背，脸对脸&#39;,</span> <span class="err">&#39;url&#39;:</span> <span class="err">&#39;https://movie.douban.com/subject/1307856/&#39;,</span> <span class="err">&#39;release_date&#39;:</span> <span class="err">&#39;1994-09-10&#39;,</span> <span class="err">&#39;actor_count&#39;:</span> <span class="err">18,</span> <span class="err">&#39;vote_count&#39;:</span> <span class="err">89296,</span> <span class="err">&#39;score&#39;:</span> <span class="err">&#39;9.5&#39;,</span> <span class="err">&#39;actors&#39;:</span> <span class="err">[&#39;牛振华&#39;,</span> <span class="err">&#39;雷恪生&#39;,</span> <span class="err">&#39;李强&#39;,</span> <span class="err">&#39;句号&#39;,</span> <span class="err">&#39;王劲松&#39;,</span> <span class="err">&#39;戈治均&#39;,</span> <span class="err">&#39;佘南南&#39;,</span> <span class="err">&#39;张嘉益&#39;,</span> <span class="err">&#39;刘国祥&#39;,</span> <span class="err">&#39;徐学政&#39;,</span> <span class="err">&#39;林海海&#39;,</span> <span class="err">&#39;温谦&#39;,</span> <span class="err">&#39;马载军&#39;,</span> <span class="err">&#39;吴玮玲&#39;,</span> <span class="err">&#39;张艺&#39;,</span> <span class="err">&#39;韩炳杰&#39;,</span> <span class="err">&#39;杨亚洲&#39;,</span> <span class="err">&#39;王洪光&#39;],</span> <span class="err">&#39;is_watched&#39;:</span> <span class="err">False</span><span class="p">},</span> <span class="p">{</span><span class="err">&#39;rating&#39;:</span> <span class="err">[&#39;9.5&#39;,</span> <span class="err">&#39;50&#39;],</span> <span class="err">&#39;rank&#39;:</span> <span class="err">9,</span> <span class="err">&#39;cover_url&#39;:</span> <span class="err">&#39;https://img9.doubanio.com/view/photo/s_ratio_poster/public/p2528965424.jpg&#39;,</span> <span class="err">&#39;is_playable&#39;:</span> <span class="err">True,</span> <span class="err">&#39;id&#39;:</span> <span class="err">&#39;1461403&#39;,</span> <span class="err">&#39;types&#39;:</span> <span class="err">[&#39;剧情&#39;,</span> <span class="err">&#39;历史&#39;],</span> <span class="err">&#39;regions&#39;:</span> <span class="err">[&#39;中国大陆&#39;],</span> <span class="err">&#39;title&#39;:</span> <span class="err">&#39;茶馆&#39;,</span> <span class="err">&#39;url&#39;:</span> <span class="err">&#39;https://movie.douban.com/subject/1461403/&#39;,</span> <span class="err">&#39;release_date&#39;:</span> <span class="err">&#39;1982&#39;,</span> <span class="err">&#39;actor_count&#39;:</span> <span class="err">36,</span> <span class="err">&#39;vote_count&#39;:</span> <span class="err">87266,</span> <span class="err">&#39;score&#39;:</span> <span class="err">&#39;9.5&#39;,</span> <span class="err">&#39;actors&#39;:</span> <span class="err">[&#39;于是之&#39;,</span> <span class="err">&#39;郑榕&#39;,</span> <span class="err">&#39;蓝天野&#39;,</span> <span class="err">&#39;英若诚&#39;,</span> <span class="err">&#39;黄宗洛&#39;,</span> <span class="err">&#39;童超&#39;,</span> <span class="err">&#39;金昭&#39;,</span> <span class="err">&#39;林连昆&#39;,</span> <span class="err">&#39;牛星丽&#39;,</span> <span class="err">&#39;谭宗尧&#39;,</span> <span class="err">&#39;童弟&#39;,</span> <span class="err">&#39;吴淑昆&#39;,</span> <span class="err">&#39;胡宗温&#39;,</span> <span class="err">&#39;程中&#39;,</span> <span class="err">&#39;李大千&#39;,</span> <span class="err">&#39;李源&#39;,</span> <span class="err">&#39;李翔&#39;,</span> <span class="err">&#39;张瞳&#39;,</span> <span class="err">&#39;任宝贤&#39;,</span> <span class="err">&#39;尚丽娟&#39;,</span> <span class="err">&#39;米铁增&#39;,</span> <span class="err">&#39;田春奎&#39;,</span> <span class="err">&#39;冯增祥&#39;,</span> <span class="err">&#39;雷飞&#39;,</span> <span class="err">&#39;林东升&#39;,</span> <span class="err">&#39;孟瑾&#39;,</span> <span class="err">&#39;孙峻峰&#39;,</span> <span class="err">&#39;平原&#39;,</span> <span class="err">&#39;曹世骧&#39;,</span> <span class="err">&#39;王大年&#39;,</span> <span class="err">&#39;张华&#39;,</span> <span class="err">&#39;丁海涛&#39;,</span> <span class="err">&#39;朱旭&#39;,</span> <span class="err">&#39;孙敬修&#39;,</span> <span class="err">&#39;董行佶&#39;,</span> <span class="err">&#39;王淑华&#39;],</span> <span class="err">&#39;is_watched&#39;:</span> <span class="err">False</span><span class="p">},</span> <span class="p">{</span><span class="err">&#39;rating&#39;:</span> <span class="err">[&#39;9.5&#39;,</span> <span class="err">&#39;50&#39;],</span> <span class="err">&#39;rank&#39;:</span> <span class="err">10,</span> <span class="err">&#39;cover_url&#39;:</span> <span class="err">&#39;https://img2.doubanio.com/view/photo/s_ratio_poster/public/p2367853261.jpg&#39;,</span> <span class="err">&#39;is_playable&#39;:</span> <span class="err">True,</span> <span class="err">&#39;id&#39;:</span> <span class="err">&#39;5294851&#39;,</span> <span class="err">&#39;types&#39;:</span> <span class="err">[&#39;剧情&#39;,</span> <span class="err">&#39;犯罪&#39;,</span> <span class="err">&#39;悬疑&#39;],</span> <span class="err">&#39;regions&#39;:</span> <span class="err">[&#39;美国&#39;,</span> <span class="err">&#39;英国&#39;],</span> <span class="err">&#39;title&#39;:</span> <span class="err">&#39;控方证人&#39;,</span> <span class="err">&#39;url&#39;:</span> <span class="err">&#39;https://movie.douban.com/subject/5294851/&#39;,</span> <span class="err">&#39;release_date&#39;:</span> <span class="err">&#39;1982-12-04&#39;,</span> <span class="err">&#39;actor_count&#39;:</span> <span class="err">8,</span> <span class="err">&#39;vote_count&#39;:</span> <span class="err">41235,</span> <span class="err">&#39;score&#39;:</span> <span class="err">&#39;9.5&#39;,</span> <span class="err">&#39;actors&#39;:</span> <span class="err">[&#39;拉尔夫·理查德森&#39;,</span> <span class="err">&#39;黛博拉·蔻儿&#39;,</span> <span class="err">&#39;博·布里奇斯&#39;,</span> <span class="err">&#39;黛安娜·里格&#39;,</span> <span class="err">&#39;温蒂·希勒&#39;,</span> <span class="err">&#39;唐纳德·普利森斯&#39;,</span> <span class="err">&#39;彼得·萨利斯&#39;,</span> <span class="err">&#39;弗兰克·米尔斯&#39;],</span> <span class="err">&#39;is_watched&#39;:</span> <span class="err">False</span><span class="p">}]</span>
</code></pre></td></tr></table>
</div>
</div><hr>
<h2 id="step05肯德基餐厅信息查询">Step05.肯德基餐厅信息查询</h2>
<p><img src="https://img-blog.csdnimg.cn/706f62fadd9a4fcb87ebc8f17eb4f46f.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA5a2k5ZCNQA==,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"></p>
<ul>
<li>
<p>还是ajax</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">requests</span>
  
<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">url</span> <span class="o">=</span> <span class="s2">&#34;http://www.kfc.com.cn/kfccda/ashx/GetStoreList.ashx?op=keyword&#34;</span>
  
    <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;User-Agent&#39;</span><span class="p">:</span><span class="s1">&#39;Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/96.0.4664.45 Safari/537.36&#39;</span>
    <span class="p">}</span>
  
    <span class="n">kw</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s1">&#39;enter a word&#39;</span><span class="p">)</span>
  
    <span class="n">param</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;cname&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
        <span class="s1">&#39;pid&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
        <span class="s1">&#39;keyword&#39;</span><span class="p">:</span> <span class="n">kw</span><span class="p">,</span>
        <span class="s1">&#39;pageIndex&#39;</span><span class="p">:</span> <span class="s1">&#39;1&#39;</span><span class="p">,</span>
        <span class="s1">&#39;pageSize&#39;</span><span class="p">:</span> <span class="s1">&#39;10&#39;</span>
    <span class="p">}</span>
  
    <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">param</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>
  
    <span class="n">page_json</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
  
    <span class="n">fileName</span> <span class="o">=</span> <span class="s1">&#39;kfc.json&#39;</span>
  
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">fileName</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
        <span class="n">fp</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">page_json</span><span class="p">))</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;爬虫爬取结束&#39;</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div></li>
</ul>
<hr>
<h2 id="step06爬取化妆品生产许可信息管理系统服务平台许可证">Step06.爬取化妆品生产许可信息管理系统服务平台<code>许可证</code></h2>
<p><a href="http://scxk.nmpa.gov.cn:81/xk/">网址</a></p>
<h3 id="爬列表基本信息">爬列表基本信息</h3>
<p><img src="https://img-blog.csdnimg.cn/43b8f0ab9f4242a9a73127517f7c7bd5.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA5a2k5ZCNQA==,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"></p>
<p><img src="https://img-blog.csdnimg.cn/4bc49df9e2c042788f3f6e1cbf3d6d3b.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA5a2k5ZCNQA==,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"></p>
<ul>
<li>又是ajax&hellip;</li>
</ul>
<p><img src="https://img-blog.csdnimg.cn/c1d5a1cf12924a28b4fc61b3b7e3076c.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA5a2k5ZCNQA==,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"></p>
<p><img src="https://img-blog.csdnimg.cn/291211ba2d354ca8873f634af99cfe22.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA5a2k5ZCNQA==,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"></p>
<ul>
<li>
<p>爬这个列表就正常请求就好了</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">requests</span>
  
<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">url</span> <span class="o">=</span> <span class="s2">&#34;http://scxk.nmpa.gov.cn:81/xk/itownet/portalAction.do?method=getXkzsList&#34;</span>
  
    <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;User-Agent&#39;</span><span class="p">:</span> <span class="s1">&#39;Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/94.0.4606.71 Safari/537.36&#39;</span>
    <span class="p">}</span>
  
    <span class="n">params</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;on&#39;</span><span class="p">:</span> <span class="s1">&#39;true&#39;</span><span class="p">,</span>
        <span class="s1">&#39;page&#39;</span><span class="p">:</span> <span class="s1">&#39;1&#39;</span><span class="p">,</span>
        <span class="s1">&#39;pageSize&#39;</span><span class="p">:</span> <span class="s1">&#39;15&#39;</span><span class="p">,</span>
        <span class="s1">&#39;productName&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
        <span class="s1">&#39;conditionType&#39;</span><span class="p">:</span> <span class="s1">&#39;1&#39;</span><span class="p">,</span>
        <span class="s1">&#39;applyname&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
        <span class="s1">&#39;applysn&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span>
    <span class="p">}</span>
  
    <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">params</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>
  
    <span class="n">page_json</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
  
    <span class="n">fileName</span> <span class="o">=</span> <span class="s1">&#39;DrugCompanyList.json&#39;</span>
  
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">fileName</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
        <span class="n">fp</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">page_json</span><span class="p">))</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;爬虫爬取结束&#39;</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div></li>
</ul>
<h3 id="爬每个公司详细证书内容">爬每个公司详细证书内容</h3>
<ul>
<li>
<p>还是ajax</p>
<p><img src="https://img-blog.csdnimg.cn/0514f1fa3059405588599306f559f02f.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA5a2k5ZCNQA==,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"></p>
</li>
<li>
<p>不同公司的证书只有一个<code>id参数</code>不一样</p>
<p><img src="https://img-blog.csdnimg.cn/b765e72103d54dd4b8bbc74afda5efa9.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA5a2k5ZCNQA==,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"></p>
</li>
<li>
<p>而这个id在主页请求(也就是上面请求列表的响应)中有</p>
<p><img src="https://img-blog.csdnimg.cn/bf712d68fb084271827bf6c6755276d7.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA5a2k5ZCNQA==,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">import</span> <span class="nn">json</span>
  
<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">json_url</span> <span class="o">=</span> <span class="s2">&#34;http://scxk.nmpa.gov.cn:81/xk/itownet/portalAction.do?method=getXkzsList&#34;</span>
  
    <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;User-Agent&#39;</span><span class="p">:</span> <span class="s1">&#39;Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/94.0.4606.71 Safari/537.36&#39;</span>
    <span class="p">}</span>
  
    <span class="n">json_params</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;on&#39;</span><span class="p">:</span> <span class="s1">&#39;true&#39;</span><span class="p">,</span>
        <span class="s1">&#39;page&#39;</span><span class="p">:</span> <span class="s1">&#39;1&#39;</span><span class="p">,</span>
        <span class="s1">&#39;pageSize&#39;</span><span class="p">:</span> <span class="s1">&#39;15&#39;</span><span class="p">,</span>
        <span class="s1">&#39;productName&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
        <span class="s1">&#39;conditionType&#39;</span><span class="p">:</span> <span class="s1">&#39;1&#39;</span><span class="p">,</span>
        <span class="s1">&#39;applyname&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
        <span class="s1">&#39;applysn&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span>
    <span class="p">}</span>
  
    <span class="c1"># 获取主页列表json</span>
    <span class="n">json_response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">json_url</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">json_params</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
    <span class="n">id_list</span> <span class="o">=</span> <span class="p">[]</span>
  
    <span class="c1"># 从主页json中提取每个公司的id</span>
    <span class="k">for</span> <span class="n">dit</span> <span class="ow">in</span> <span class="n">json_response</span><span class="p">[</span><span class="s1">&#39;list&#39;</span><span class="p">]:</span>
        <span class="n">id_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dit</span><span class="p">[</span><span class="s1">&#39;ID&#39;</span><span class="p">])</span>
  
    <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">post_url</span> <span class="o">=</span> <span class="s2">&#34;http://scxk.nmpa.gov.cn:81/xk/itownet/portalAction.do?method=getXkzsById&#34;</span>
    <span class="c1"># 对每个id进行请求,获取到每个公司的详细信息</span>
    <span class="k">for</span> <span class="nb">id</span> <span class="ow">in</span> <span class="n">id_list</span><span class="p">:</span>
        <span class="n">count</span> <span class="o">=</span> <span class="n">count</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="nb">id</span>
        <span class="p">}</span>
        <span class="n">result_json</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">post_url</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
        <span class="k">print</span><span class="p">(</span><span class="n">count</span><span class="p">,</span> <span class="s1">&#39;---&#39;</span><span class="p">,</span> <span class="n">result_json</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><p><img src="https://img-blog.csdnimg.cn/2f810d7597c548f891864731ac0100a6.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA5a2k5ZCNQA==,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"></p>
</li>
</ul>
<hr>
<h1 id="数据解析">数据解析</h1>
<h2 id="step07正则">Step07.正则</h2>
<h3 id="爬取糗事百科图片">爬取<code>糗事百科</code>图片</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">os</span><span class="o">,</span> <span class="nn">re</span><span class="o">,</span> <span class="nn">requests</span>

<span class="c1"># 如果这个路径不存在,就在指定路径下创建文件夹</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="s1">&#39;./xiushibaike&#39;</span><span class="p">):</span>
    <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="s1">&#39;./xiushibaike&#39;</span><span class="p">)</span>

<span class="n">url</span> <span class="o">=</span> <span class="s1">&#39;https://www.qiushibaike.com/imgrank/page/</span><span class="si">%d</span><span class="s1">/&#39;</span>
<span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;User-Agent&#39;</span><span class="p">:</span> <span class="s1">&#39;Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/94.0.4606.71 Safari/537.36&#39;</span>
<span class="p">}</span>
<span class="k">for</span> <span class="n">page</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">6</span><span class="p">):</span>
    <span class="c1"># 相当于C语言的printf函数,将字符串中的格式化参数替换为指定的变量</span>
    <span class="n">new_url</span> <span class="o">=</span> <span class="n">format</span><span class="p">(</span><span class="n">url</span> <span class="o">%</span> <span class="n">page</span><span class="p">)</span>

    <span class="n">page_text</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">new_url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
    <span class="n">html</span> <span class="o">=</span> <span class="s1">&#39;&lt;div class=&#34;thumb&#34;&gt;.*?&lt;img src=&#34;(.*?)&#34; alt.*?&lt;/div&gt;&#39;</span>

    <span class="c1"># 在指定字符串中和子串进行匹配,返回结果为  所有匹配成功的子串    列表</span>
    <span class="c1"># 第一个参数是模式串,第二个参数是整体字符串,第三个是匹配模式</span>
    <span class="n">img_src_list</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">html</span><span class="p">,</span> <span class="n">page_text</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">S</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">src</span> <span class="ow">in</span> <span class="n">img_src_list</span><span class="p">:</span>
        <span class="n">src</span> <span class="o">=</span> <span class="s2">&#34;https:&#34;</span> <span class="o">+</span> <span class="n">src</span>
        <span class="n">img_data</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">src</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span><span class="o">.</span><span class="n">content</span>
        <span class="n">img_name</span> <span class="o">=</span> <span class="n">src</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">img_path</span> <span class="o">=</span> <span class="s2">&#34;./xiushibaike&#34;</span> <span class="o">+</span> <span class="n">img_name</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">img_path</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
            <span class="n">fp</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">img_data</span><span class="p">)</span>
            <span class="k">print</span><span class="p">(</span><span class="n">img_name</span><span class="p">,</span> <span class="s2">&#34;下载成功&#34;</span><span class="p">)</span>

    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;------------OVER-----------&#39;</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><hr>
<h3 id="爬取中国大学排名">爬取<code>中国大学排名</code></h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="c1"># -*- encoding:UTF-8 -*-</span>

<span class="s2">&#34;&#34;&#34;
</span><span class="s2">@File     :   drug_list.py
</span><span class="s2">@Time     :   2022/1/21 20:55
</span><span class="s2">@Author   :   张宇航
</span><span class="s2">@Contact  :   zhangzyh666@163.com
</span><span class="s2">@MyWeb    :   https://zhang666zyh.github.io
</span><span class="s2">&#34;&#34;&#34;</span>

<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">requests</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">main_url</span> <span class="o">=</span> <span class="s1">&#39;https://www.shanghairanking.cn/rankings/bcur/202011&#39;</span>
    <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;User-Agent&#39;</span><span class="p">:</span> <span class="s1">&#39;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/99.0.4844.84 Safari/537.36&#39;</span>
    <span class="p">}</span>

    <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">main_url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>
    <span class="n">response</span><span class="o">.</span><span class="n">encoding</span> <span class="o">=</span> <span class="s1">&#39;utf-8&#39;</span>
    <span class="n">response_text</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">text</span>

    <span class="n">name_str</span> <span class="o">=</span> <span class="s1">&#39;&lt;div class=&#34;link-container&#34; data-v-b80b4d60&gt;&lt;a href=&#34;.*?&#34; class=&#34;name-cn&#34; data-v-b80b4d60&gt;(.*?)&lt;/a&gt;&#39;</span>
    <span class="n">name_list</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">name_str</span><span class="p">,</span> <span class="n">response_text</span><span class="p">)</span>
    <span class="c1"># print(name_list)</span>

    <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">name_list</span><span class="p">)):</span>
        <span class="k">print</span><span class="p">(</span><span class="s1">&#39;第&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">index</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;名&#39;</span><span class="p">,</span> <span class="n">name_list</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;大学&#39;</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><hr>
<h2 id="step08bs4">Step08.bs4</h2>
<h3 id="概述">概述</h3>
<blockquote>
<p><strong>解析的局部的文本内容都会在标签之间或者标签对应的属性中进行存储</strong></p>
</blockquote>
<ul>
<li>1.进行指定标签的定位</li>
<li>2.标签或者标签对应的属性中存储的数据值进行提取(解析)</li>
</ul>
<blockquote>
<p>就是将HTML文档转成树结构方便API内部处理</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">bs4</span> <span class="kn">import</span> <span class="n">BeautifulSoup</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">fp</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;getHtmlPageCode.html&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
    <span class="n">soup</span> <span class="o">=</span> <span class="n">BeautifulSoup</span><span class="p">(</span><span class="n">fp</span><span class="p">,</span> <span class="s1">&#39;lxml&#39;</span><span class="p">)</span>

    <span class="c1"># 返回html的bs4对象</span>
    <span class="k">print</span><span class="p">(</span><span class="n">soup</span><span class="p">)</span>

    <span class="c1"># 返回html的bs4对象中的第一个a标签</span>
    <span class="k">print</span><span class="p">(</span><span class="n">soup</span><span class="o">.</span><span class="n">a</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="n">soup</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">))</span>
        <span class="c1"># 获取指定类指定标签名的第一个标签内容</span>
    <span class="k">print</span><span class="p">(</span><span class="n">soup</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;div&#39;</span><span class="p">,</span> <span class="n">class_</span><span class="o">=</span><span class="s1">&#39;macDownload&#39;</span><span class="p">))</span>
        <span class="c1"># 获取指定类指定标签名的所有标签内容</span>
    <span class="k">print</span><span class="p">(</span><span class="n">soup</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span><span class="s1">&#39;p&#39;</span><span class="p">))</span>

    <span class="c1"># select函数获取指定选择器的标签内容,返回值是列表</span>
    <span class="k">print</span><span class="p">(</span><span class="n">soup</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s1">&#39;.macDownload-right&#39;</span><span class="p">))</span>
    <span class="k">print</span><span class="p">(</span><span class="n">soup</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s1">&#39;.macDownload-right &gt; .macClick-up&#39;</span><span class="p">))</span>

    <span class="c1"># 获取标签之间的文本数据有三种方法</span>
        <span class="c1"># + text/get_text():获取当前标签内部的所有文本数据(包括子标签的文本数据,不包括标签代码自身)</span>
        <span class="c1"># + string:获取当前标签内部的```直系文本数据```,而且还```隐式规定```当前标签中含有子标签的```直系文本数据```不作数</span>
    <span class="k">print</span><span class="p">(</span><span class="n">soup</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;div&#39;</span><span class="p">,</span> <span class="n">class_</span><span class="o">=</span><span class="s1">&#39;suspension4openmusicplan&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="n">soup</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;div&#39;</span><span class="p">,</span> <span class="n">class_</span><span class="o">=</span><span class="s1">&#39;suspension4openmusicplan&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">get_text</span><span class="p">())</span>
    <span class="k">print</span><span class="p">(</span><span class="n">soup</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;div&#39;</span><span class="p">,</span> <span class="n">class_</span><span class="o">=</span><span class="s1">&#39;suspension4openmusicplan&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">string</span><span class="p">)</span>

    <span class="c1"># 获取标签的属性值,直接在返回值的标签对象后面[&#39;属性名&#39;]</span>
    <span class="k">print</span><span class="p">(</span><span class="n">soup</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s1">&#39;.macDownload-right&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;class&#39;</span><span class="p">])</span>
</code></pre></td></tr></table>
</div>
</div><ul>
<li>文档来源可以是本地,也可以是<code>response.text</code>等</li>
</ul>
<h3 id="爬取诗词名句网的小说">爬取诗词名句网的小说</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">bs4</span> <span class="kn">import</span> <span class="n">BeautifulSoup</span>
<span class="kn">import</span> <span class="nn">requests</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">url</span> <span class="o">=</span> <span class="s1">&#39;https://www.shicimingju.com/book/hongloumeng.html&#39;</span>
    <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;User-Agent&#39;</span><span class="p">:</span> <span class="s1">&#39;Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/94.0.4606.71 Safari/537.36&#39;</span>
    <span class="p">}</span>

    <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>

    <span class="c1"># 指定响应对象的编码</span>
        <span class="c1"># 注意:要先转后.text</span>
    <span class="n">response</span><span class="o">.</span><span class="n">encoding</span> <span class="o">=</span> <span class="s1">&#39;utf-8&#39;</span>
    <span class="n">response_text</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">text</span>

    <span class="n">soup</span> <span class="o">=</span> <span class="n">BeautifulSoup</span><span class="p">(</span><span class="n">response_text</span><span class="p">,</span> <span class="s1">&#39;lxml&#39;</span><span class="p">)</span>
    <span class="n">li_list</span> <span class="o">=</span> <span class="n">soup</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s1">&#39;.book-mulu &gt; ul &gt; li&#39;</span><span class="p">)</span>

    <span class="c1"># fp.write方法是每次重新打开文档清除原有内容并将新内容写入,所以不能写在循环体中,要保持文档一直打开</span>
    <span class="n">fp</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;./红楼梦.txt&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">li</span> <span class="ow">in</span> <span class="n">li_list</span><span class="p">:</span>
        <span class="n">title</span> <span class="o">=</span> <span class="n">li</span><span class="o">.</span><span class="n">a</span><span class="o">.</span><span class="n">string</span>
        <span class="n">res_url</span> <span class="o">=</span> <span class="s2">&#34;https://www.shicimingju.com&#34;</span> <span class="o">+</span> <span class="n">li</span><span class="o">.</span><span class="n">a</span><span class="p">[</span><span class="s1">&#39;href&#39;</span><span class="p">]</span>
        <span class="n">res_response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">res_url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>
        <span class="n">res_response</span><span class="o">.</span><span class="n">encoding</span> <span class="o">=</span> <span class="s1">&#39;utf-8&#39;</span>
        <span class="n">res_soup</span> <span class="o">=</span> <span class="n">BeautifulSoup</span><span class="p">(</span><span class="n">res_response</span><span class="o">.</span><span class="n">text</span><span class="p">,</span> <span class="s1">&#39;lxml&#39;</span><span class="p">)</span>
        <span class="n">res_data</span> <span class="o">=</span> <span class="n">res_soup</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;div&#39;</span><span class="p">,</span> <span class="n">class_</span><span class="o">=</span><span class="s1">&#39;chapter_content&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
        <span class="n">res_content</span> <span class="o">=</span> <span class="n">res_soup</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;h1&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
        <span class="n">fp</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">title</span> <span class="o">+</span> <span class="s2">&#34;:&#34;</span> <span class="o">+</span> <span class="n">res_content</span> <span class="o">+</span> <span class="s2">&#34;</span><span class="se">\n</span><span class="s2">&#34;</span> <span class="o">+</span> <span class="n">res_data</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="n">title</span> <span class="o">+</span> <span class="s2">&#34;爬取完成!!!&#34;</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><hr>
<h2 id="step09xpath">Step09.xpath</h2>
<h3 id="概述-1">概述</h3>
<ul>
<li>一种比bs4更好的甚至说最好的数据解析的方式</li>
<li>和bs4类似,也是将html文档数据保存到xpath对象中(树结构)</li>
<li>然后调用API函数内部处理</li>
</ul>
<p><code>getHtmlPageCode.html</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html"><span class="p">&lt;</span><span class="nt">html</span> <span class="na">lang</span><span class="o">=</span><span class="s">&#34;en&#34;</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">style</span><span class="p">&gt;</span>
        <span class="o">*</span><span class="p">{</span>
            <span class="k">margin</span><span class="p">:</span><span class="mi">0</span><span class="p">;</span>
            <span class="k">padding</span><span class="p">:</span><span class="mi">0</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="p">.</span><span class="nc">main</span><span class="p">{</span>
            <span class="k">width</span><span class="p">:</span><span class="mi">100</span><span class="kt">vw</span><span class="p">;</span>
            <span class="k">height</span><span class="p">:</span><span class="mi">100</span><span class="kt">vh</span><span class="p">;</span>
            <span class="k">background-color</span><span class="p">:</span><span class="mh">#bfa</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">&lt;/</span><span class="nt">style</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>getHtmlPageCode<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;main&#34;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>Xpath Study<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>This is my website<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">table</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">tr</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;</span>Java<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;</span>Python<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">tr</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">tr</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;</span>C++<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;</span>C#<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">tr</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">table</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;nav&#34;</span><span class="p">&gt;</span>am headBar of website<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">img</span> <span class="na">src</span><span class="o">=</span><span class="s">&#34;https://pic.netbian.com/d/file/2021/04/13/120916305id.jpg&#34;</span> <span class="na">alt</span><span class="o">=</span><span class="s">&#34;meimei&#34;</span> <span class="p">/&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">lxml</span> <span class="kn">import</span> <span class="n">etree</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="c1"># 将文档转换为xpath对象(树结构)</span>
    <span class="n">tree</span> <span class="o">=</span> <span class="n">etree</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="s1">&#39;getHtmlPageCode.html&#39;</span><span class="p">)</span>

    <span class="c1"># 获取html内部的body内部的所有div标签对象</span>
    <span class="s1">&#39;&#39;&#39;
</span><span class="s1">        html
</span><span class="s1">            body
</span><span class="s1">                div
</span><span class="s1">                div
</span><span class="s1">            body
</span><span class="s1">        html
</span><span class="s1">    &#39;&#39;&#39;</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s1">&#39;/html/body/div&#39;</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>

    <span class="c1"># // 代表多级结构</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s1">&#39;/html//div&#39;</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s1">&#39;//div&#39;</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>

    <span class="c1"># 获取指定类名的指定标签名对象</span>
    <span class="n">xpath_nav</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s1">&#39;//div[@class=&#34;nav&#34;]&#39;</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="n">xpath_nav</span><span class="p">)</span>

    <span class="c1"># 获取某个元素的多个子元素的其中一个,可以通过数组索引的方式获取(索引从1开始)</span>
    <span class="n">xpath_table_td</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s1">&#39;/html/body/div[@class=&#34;main&#34;]/table/tr[1]/td[1]&#39;</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="n">xpath_table_td</span><span class="p">)</span>

    <span class="c1"># text()获取指定标签中的文本信息</span>
    <span class="n">xpath_table_td</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s1">&#39;/html/body/div[@class=&#34;main&#34;]/table/tr[1]/td[1]/text()&#39;</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="n">xpath_table_td</span><span class="p">)</span>

    <span class="c1"># /@属性名  获取标签的属性值</span>
    <span class="n">xpath_div_className</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s1">&#39;/html/body/div[@class=&#34;main&#34;]/img/@src&#39;</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="n">xpath_div_className</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><p><strong>本地HTML文档直接parse-&gt;xpath就行了</strong></p>
<p><strong>request来的HTML.text需要使用etree.HTML加载才能被xpath正确识别</strong></p>
<h3 id="爬中国所有城市名称">爬中国所有城市名称</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">from</span> <span class="nn">lxml</span> <span class="kn">import</span> <span class="n">etree</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">city_hot_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">city_all_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">url</span> <span class="o">=</span> <span class="s1">&#39;https://www.aqistudy.cn/historydata/&#39;</span>
    <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;User-Agent&#39;</span><span class="p">:</span> <span class="s1">&#39;Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/94.0.4606.71 Safari/537.36&#39;</span>
    <span class="p">}</span>

    <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>
    <span class="n">response</span><span class="o">.</span><span class="n">encoding</span> <span class="o">=</span> <span class="s1">&#39;utf-8&#39;</span>
    <span class="n">response_text</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">text</span>

    <span class="c1"># 要用etree.HTML加载网络文档</span>
    <span class="n">tree</span> <span class="o">=</span> <span class="n">etree</span><span class="o">.</span><span class="n">HTML</span><span class="p">(</span><span class="n">response_text</span><span class="p">)</span>

    <span class="c1"># xpath默认获取全部(li),返回值是列表</span>
    <span class="n">hot_list</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s1">&#39;//div[@class=&#34;bottom&#34;]/ul/li&#39;</span><span class="p">)</span>
    <span class="n">all_list</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s1">&#39;//div[@class=&#34;bottom&#34;]/ul/div[2]/li&#39;</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">li</span> <span class="ow">in</span> <span class="n">hot_list</span><span class="p">:</span>
        <span class="c1"># 总之获取第一个a就对了</span>
        <span class="n">city_hot_name</span> <span class="o">=</span> <span class="n">li</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s1">&#39;./a/text()&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">city_hot_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">city_hot_name</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">&#34;---------------------------热门城市----------------------------------&#34;</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="n">city_hot_list</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="k">print</span><span class="p">()</span>

    <span class="k">for</span> <span class="n">li</span> <span class="ow">in</span> <span class="n">all_list</span><span class="p">:</span>
        <span class="n">city_all_name</span> <span class="o">=</span> <span class="n">li</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s1">&#39;./a/text()&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">city_all_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">city_all_name</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">&#34;---------------------------全部城市----------------------------------&#34;</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="n">city_all_list</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><p><code>爬取结果</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">---------------------------热门城市----------------------------------
<span class="o">[</span><span class="s1">&#39;北京&#39;</span>, <span class="s1">&#39;上海&#39;</span>, <span class="s1">&#39;广州&#39;</span>, <span class="s1">&#39;深圳&#39;</span>, <span class="s1">&#39;杭州&#39;</span>, <span class="s1">&#39;天津&#39;</span>, <span class="s1">&#39;成都&#39;</span>, <span class="s1">&#39;南京&#39;</span>, <span class="s1">&#39;西安&#39;</span>, <span class="s1">&#39;武汉&#39;</span><span class="o">]</span>	
---------------------------全部城市----------------------------------
<span class="o">[</span><span class="s1">&#39;阿坝州&#39;</span>, <span class="s1">&#39;安康&#39;</span>, <span class="s1">&#39;阿克苏地区&#39;</span>, <span class="s1">&#39;阿里地区&#39;</span>, <span class="s1">&#39;阿拉善盟&#39;</span>, <span class="s1">&#39;阿勒泰地区&#39;</span>, <span class="s1">&#39;安庆&#39;</span>, <span class="s1">&#39;安顺&#39;</span>, <span class="s1">&#39;鞍山&#39;</span>, <span class="s1">&#39;克孜勒苏州&#39;</span>, <span class="s1">&#39;安阳&#39;</span>, <span class="s1">&#39;蚌埠&#39;</span>, <span class="s1">&#39;白城&#39;</span>, <span class="s1">&#39;保定&#39;</span>, <span class="s1">&#39;北海&#39;</span>, <span class="s1">&#39;宝鸡&#39;</span>, <span class="s1">&#39;北京&#39;</span>, <span class="s1">&#39;毕节&#39;</span>, <span class="s1">&#39;博州&#39;</span>, <span class="s1">&#39;白山&#39;</span>, <span class="s1">&#39;百色&#39;</span>, <span class="s1">&#39;保山&#39;</span>, <span class="s1">&#39;白沙&#39;</span>, <span class="s1">&#39;包头&#39;</span>, <span class="s1">&#39;保亭&#39;</span>, <span class="s1">&#39;本溪&#39;</span>, <span class="s1">&#39;巴彦淖尔&#39;</span>, <span class="s1">&#39;白银&#39;</span>, <span class="s1">&#39;巴中&#39;</span>, <span class="s1">&#39;滨州&#39;</span>, <span class="s1">&#39;亳州&#39;</span>, <span class="s1">&#39;长春&#39;</span>, <span class="s1">&#39;昌都&#39;</span>, <span class="s1">&#39;常德&#39;</span>, <span class="s1">&#39;成都&#39;</span>, <span class="s1">&#39;承德&#39;</span>, <span class="s1">&#39;赤峰&#39;</span>, <span class="s1">&#39;昌吉州&#39;</span>, <span class="s1">&#39;五家渠&#39;</span>, <span class="s1">&#39;昌江&#39;</span>, <span class="s1">&#39;澄迈&#39;</span>, <span class="s1">&#39;重庆&#39;</span>, <span class="s1">&#39;长沙&#39;</span>, <span class="s1">&#39;常熟&#39;</span>, <span class="s1">&#39;楚雄州&#39;</span>, <span class="s1">&#39;朝阳&#39;</span>, <span class="s1">&#39;沧州&#39;</span>, <span class="s1">&#39;长治&#39;</span>, <span class="s1">&#39;常州&#39;</span>, <span class="s1">&#39;潮州&#39;</span>, <span class="s1">&#39;郴州&#39;</span>, <span class="s1">&#39;池州&#39;</span>, <span class="s1">&#39;崇左&#39;</span>, <span class="s1">&#39;滁州&#39;</span>, <span class="s1">&#39;定安&#39;</span>, <span class="s1">&#39;丹东&#39;</span>, <span class="s1">&#39;东方&#39;</span>, <span class="s1">&#39;东莞&#39;</span>, <span class="s1">&#39;德宏州&#39;</span>, <span class="s1">&#39;大理州&#39;</span>, <span class="s1">&#39;大连&#39;</span>, <span class="s1">&#39;大庆&#39;</span>, <span class="s1">&#39;大同&#39;</span>, <span class="s1">&#39;定西&#39;</span>, <span class="s1">&#39;大兴安岭地区&#39;</span>, <span class="s1">&#39;德阳&#39;</span>, <span class="s1">&#39;东营&#39;</span>, <span class="s1">&#39;黔南州&#39;</span>, <span class="s1">&#39;达州&#39;</span>, <span class="s1">&#39;德州&#39;</span>, <span class="s1">&#39;儋州&#39;</span>, <span class="s1">&#39;鄂尔多斯&#39;</span>, <span class="s1">&#39;恩施州&#39;</span>, <span class="s1">&#39;鄂州&#39;</span>, <span class="s1">&#39;防城港&#39;</span>, <span class="s1">&#39;佛山&#39;</span>, <span class="s1">&#39;抚顺&#39;</span>, <span class="s1">&#39;阜新&#39;</span>, <span class="s1">&#39;阜阳&#39;</span>, <span class="s1">&#39;富阳&#39;</span>, <span class="s1">&#39;抚州&#39;</span>, <span class="s1">&#39;福州&#39;</span>, <span class="s1">&#39;广安&#39;</span>, <span class="s1">&#39;贵港&#39;</span>, <span class="s1">&#39;桂林&#39;</span>, <span class="s1">&#39;果洛州&#39;</span>, <span class="s1">&#39;甘南州&#39;</span>, <span class="s1">&#39;固原&#39;</span>, <span class="s1">&#39;广元&#39;</span>, <span class="s1">&#39;贵阳&#39;</span>, <span class="s1">&#39;甘孜州&#39;</span>, <span class="s1">&#39;赣州&#39;</span>, <span class="s1">&#39;广州&#39;</span>, <span class="s1">&#39;淮安&#39;</span>, <span class="s1">&#39;海北州&#39;</span>, <span class="s1">&#39;鹤壁&#39;</span>, <span class="s1">&#39;淮北&#39;</span>, <span class="s1">&#39;河池&#39;</span>, <span class="s1">&#39;海东地区&#39;</span>, <span class="s1">&#39;邯郸&#39;</span>, <span class="s1">&#39;哈尔滨&#39;</span>, <span class="s1">&#39;合肥&#39;</span>, <span class="s1">&#39;鹤岗&#39;</span>, <span class="s1">&#39;黄冈&#39;</span>, <span class="s1">&#39;黑河&#39;</span>, <span class="s1">&#39;红河州&#39;</span>, <span class="s1">&#39;怀化&#39;</span>, <span class="s1">&#39;呼和浩特&#39;</span>, <span class="s1">&#39;海口&#39;</span>, <span class="s1">&#39;呼伦贝尔&#39;</span>, <span class="s1">&#39;葫芦岛&#39;</span>, <span class="s1">&#39;哈密地区&#39;</span>, <span class="s1">&#39;海门&#39;</span>, <span class="s1">&#39;海南州&#39;</span>, <span class="s1">&#39;淮南&#39;</span>, <span class="s1">&#39;黄南州&#39;</span>, <span class="s1">&#39;衡水&#39;</span>, <span class="s1">&#39;黄山&#39;</span>, <span class="s1">&#39;黄石&#39;</span>, <span class="s1">&#39;和田地区&#39;</span>, <span class="s1">&#39;海西州&#39;</span>, <span class="s1">&#39;河源&#39;</span>, <span class="s1">&#39;衡阳&#39;</span>, <span class="s1">&#39;汉中&#39;</span>, <span class="s1">&#39;杭州&#39;</span>, <span class="s1">&#39;菏泽&#39;</span>, <span class="s1">&#39;贺州&#39;</span>, <span class="s1">&#39;湖州&#39;</span>, <span class="s1">&#39;惠州&#39;</span>, <span class="s1">&#39;吉安&#39;</span>, <span class="s1">&#39;金昌&#39;</span>, <span class="s1">&#39;晋城&#39;</span>, <span class="s1">&#39;景德镇&#39;</span>, <span class="s1">&#39;金华&#39;</span>, <span class="s1">&#39;西双版纳州&#39;</span>, <span class="s1">&#39;九江&#39;</span>, <span class="s1">&#39;吉林&#39;</span>, <span class="s1">&#39;即墨&#39;</span>, <span class="s1">&#39;江门&#39;</span>, <span class="s1">&#39;荆门&#39;</span>, <span class="s1">&#39;佳木斯&#39;</span>, <span class="s1">&#39;济南&#39;</span>, <span class="s1">&#39;济宁&#39;</span>, <span class="s1">&#39;胶南&#39;</span>, <span class="s1">&#39;酒泉&#39;</span>, <span class="s1">&#39;句容&#39;</span>, <span class="s1">&#39;湘西州&#39;</span>, <span class="s1">&#39;金坛&#39;</span>, <span class="s1">&#39;鸡西&#39;</span>, <span class="s1">&#39;嘉兴&#39;</span>, <span class="s1">&#39;江阴&#39;</span>, <span class="s1">&#39;揭阳&#39;</span>, <span class="s1">&#39;济源&#39;</span>, <span class="s1">&#39;嘉峪关&#39;</span>, <span class="s1">&#39;胶州&#39;</span>, <span class="s1">&#39;焦作&#39;</span>, <span class="s1">&#39;锦州&#39;</span>, <span class="s1">&#39;晋中&#39;</span>, <span class="s1">&#39;荆州&#39;</span>, <span class="s1">&#39;库尔勒&#39;</span>, <span class="s1">&#39;开封&#39;</span>, <span class="s1">&#39;黔东南州&#39;</span>, <span class="s1">&#39;克拉玛依&#39;</span>, <span class="s1">&#39;昆明&#39;</span>, <span class="s1">&#39;喀什地区&#39;</span>, <span class="s1">&#39;昆山&#39;</span>, <span class="s1">&#39;临安&#39;</span>, <span class="s1">&#39;六安&#39;</span>, <span class="s1">&#39;来宾&#39;</span>, <span class="s1">&#39;聊城&#39;</span>, <span class="s1">&#39;临沧&#39;</span>, <span class="s1">&#39;娄底&#39;</span>, <span class="s1">&#39;乐东&#39;</span>, <span class="s1">&#39;廊坊&#39;</span>, <span class="s1">&#39;临汾&#39;</span>, <span class="s1">&#39;临高&#39;</span>, <span class="s1">&#39;漯河&#39;</span>, <span class="s1">&#39;丽江&#39;</span>, <span class="s1">&#39;吕梁&#39;</span>, <span class="s1">&#39;陇南&#39;</span>, <span class="s1">&#39;六盘水&#39;</span>, <span class="s1">&#39;拉萨&#39;</span>, <span class="s1">&#39;乐山&#39;</span>, <span class="s1">&#39;丽水&#39;</span>, <span class="s1">&#39;凉山州&#39;</span>, <span class="s1">&#39;陵水&#39;</span>, <span class="s1">&#39;莱芜&#39;</span>, <span class="s1">&#39;莱西&#39;</span>, <span class="s1">&#39;临夏州&#39;</span>, <span class="s1">&#39;溧阳&#39;</span>, <span class="s1">&#39;辽阳&#39;</span>, <span class="s1">&#39;辽源&#39;</span>, <span class="s1">&#39;临沂&#39;</span>, <span class="s1">&#39;龙岩&#39;</span>, <span class="s1">&#39;洛阳&#39;</span>, <span class="s1">&#39;连云港&#39;</span>, <span class="s1">&#39;莱州&#39;</span>, <span class="s1">&#39;兰州&#39;</span>, <span class="s1">&#39;林芝&#39;</span>, <span class="s1">&#39;柳州&#39;</span>, <span class="s1">&#39;泸州&#39;</span>, <span class="s1">&#39;马鞍山&#39;</span>, <span class="s1">&#39;牡丹江&#39;</span>, <span class="s1">&#39;茂名&#39;</span>, <span class="s1">&#39;眉山&#39;</span>, <span class="s1">&#39;绵阳&#39;</span>, <span class="s1">&#39;梅州&#39;</span>, <span class="s1">&#39;宁波&#39;</span>, <span class="s1">&#39;南昌&#39;</span>, <span class="s1">&#39;南充&#39;</span>, <span class="s1">&#39;宁德&#39;</span>, <span class="s1">&#39;内江&#39;</span>, <span class="s1">&#39;南京&#39;</span>, <span class="s1">&#39;怒江州&#39;</span>, <span class="s1">&#39;南宁&#39;</span>, <span class="s1">&#39;南平&#39;</span>, <span class="s1">&#39;那曲地区&#39;</span>, <span class="s1">&#39;南通&#39;</span>, <span class="s1">&#39;南阳&#39;</span>, <span class="s1">&#39;平度&#39;</span>, <span class="s1">&#39;平顶山&#39;</span>, <span class="s1">&#39;普洱&#39;</span>, <span class="s1">&#39;盘锦&#39;</span>, <span class="s1">&#39;蓬莱&#39;</span>, <span class="s1">&#39;平凉&#39;</span>, <span class="s1">&#39;莆田&#39;</span>, <span class="s1">&#39;萍乡&#39;</span>, <span class="s1">&#39;濮阳&#39;</span>, <span class="s1">&#39;攀枝花&#39;</span>, <span class="s1">&#39;青岛&#39;</span>, <span class="s1">&#39;琼海&#39;</span>, <span class="s1">&#39;秦皇岛&#39;</span>, <span class="s1">&#39;曲靖&#39;</span>, <span class="s1">&#39;潜江&#39;</span>, <span class="s1">&#39;齐齐哈尔&#39;</span>, <span class="s1">&#39;七台河&#39;</span>, <span class="s1">&#39;黔西南州&#39;</span>, <span class="s1">&#39;清远&#39;</span>, <span class="s1">&#39;庆阳&#39;</span>, <span class="s1">&#39;钦州&#39;</span>, <span class="s1">&#39;衢州&#39;</span>, <span class="s1">&#39;泉州&#39;</span>, <span class="s1">&#39;琼中&#39;</span>, <span class="s1">&#39;荣成&#39;</span>, <span class="s1">&#39;日喀则&#39;</span>, <span class="s1">&#39;乳山&#39;</span>, <span class="s1">&#39;日照&#39;</span>, <span class="s1">&#39;韶关&#39;</span>, <span class="s1">&#39;寿光&#39;</span>, <span class="s1">&#39;上海&#39;</span>, <span class="s1">&#39;绥化&#39;</span>, <span class="s1">&#39;石河子&#39;</span>, <span class="s1">&#39;石家庄&#39;</span>, <span class="s1">&#39;商洛&#39;</span>, <span class="s1">&#39;三明&#39;</span>, <span class="s1">&#39;三门峡&#39;</span>, <span class="s1">&#39;山南&#39;</span>, <span class="s1">&#39;遂宁&#39;</span>, <span class="s1">&#39;神农架林区&#39;</span>, <span class="s1">&#39;四平&#39;</span>, <span class="s1">&#39;商丘&#39;</span>, <span class="s1">&#39;宿迁&#39;</span>, <span class="s1">&#39;上饶&#39;</span>, <span class="s1">&#39;汕头&#39;</span>, <span class="s1">&#39;汕尾&#39;</span>, <span class="s1">&#39;绍兴&#39;</span>, <span class="s1">&#39;三亚&#39;</span>, <span class="s1">&#39;邵阳&#39;</span>, <span class="s1">&#39;沈阳&#39;</span>, <span class="s1">&#39;十堰&#39;</span>, <span class="s1">&#39;松原&#39;</span>, <span class="s1">&#39;双鸭山&#39;</span>, <span class="s1">&#39;深圳&#39;</span>, <span class="s1">&#39;朔州&#39;</span>, <span class="s1">&#39;宿州&#39;</span>, <span class="s1">&#39;随州&#39;</span>, <span class="s1">&#39;苏州&#39;</span>, <span class="s1">&#39;石嘴山&#39;</span>, <span class="s1">&#39;泰安&#39;</span>, <span class="s1">&#39;塔城地区&#39;</span>, <span class="s1">&#39;太仓&#39;</span>, <span class="s1">&#39;铜川&#39;</span>, <span class="s1">&#39;屯昌&#39;</span>, <span class="s1">&#39;通化&#39;</span>, <span class="s1">&#39;天津&#39;</span>, <span class="s1">&#39;铁岭&#39;</span>, <span class="s1">&#39;通辽&#39;</span>, <span class="s1">&#39;铜陵&#39;</span>, <span class="s1">&#39;吐鲁番地区&#39;</span>, <span class="s1">&#39;天门&#39;</span>, <span class="s1">&#39;铜仁地区&#39;</span>, <span class="s1">&#39;唐山&#39;</span>, <span class="s1">&#39;天水&#39;</span>, <span class="s1">&#39;太原&#39;</span>, <span class="s1">&#39;台州&#39;</span>, <span class="s1">&#39;泰州&#39;</span>, <span class="s1">&#39;文昌&#39;</span>, <span class="s1">&#39;文登&#39;</span>, <span class="s1">&#39;潍坊&#39;</span>, <span class="s1">&#39;瓦房店&#39;</span>, <span class="s1">&#39;威海&#39;</span>, <span class="s1">&#39;乌海&#39;</span>, <span class="s1">&#39;芜湖&#39;</span>, <span class="s1">&#39;武汉&#39;</span>, <span class="s1">&#39;吴江&#39;</span>, <span class="s1">&#39;乌兰察布&#39;</span>, <span class="s1">&#39;乌鲁木齐&#39;</span>, <span class="s1">&#39;渭南&#39;</span>, <span class="s1">&#39;万宁&#39;</span>, <span class="s1">&#39;文山州&#39;</span>, <span class="s1">&#39;武威&#39;</span>, <span class="s1">&#39;无锡&#39;</span>, <span class="s1">&#39;温州&#39;</span>, <span class="s1">&#39;吴忠&#39;</span>, <span class="s1">&#39;梧州&#39;</span>, <span class="s1">&#39;五指山&#39;</span>, <span class="s1">&#39;西安&#39;</span>, <span class="s1">&#39;兴安盟&#39;</span>, <span class="s1">&#39;许昌&#39;</span>, <span class="s1">&#39;宣城&#39;</span>, <span class="s1">&#39;襄阳&#39;</span>, <span class="s1">&#39;孝感&#39;</span>, <span class="s1">&#39;迪庆州&#39;</span>, <span class="s1">&#39;辛集&#39;</span>, <span class="s1">&#39;锡林郭勒盟&#39;</span>, <span class="s1">&#39;厦门&#39;</span>, <span class="s1">&#39;西宁&#39;</span>, <span class="s1">&#39;咸宁&#39;</span>, <span class="s1">&#39;湘潭&#39;</span>, <span class="s1">&#39;邢台&#39;</span>, <span class="s1">&#39;仙桃&#39;</span>, <span class="s1">&#39;新乡&#39;</span>, <span class="s1">&#39;咸阳&#39;</span>, <span class="s1">&#39;新余&#39;</span>, <span class="s1">&#39;信阳&#39;</span>, <span class="s1">&#39;忻州&#39;</span>, <span class="s1">&#39;徐州&#39;</span>, <span class="s1">&#39;雅安&#39;</span>, <span class="s1">&#39;延安&#39;</span>, <span class="s1">&#39;延边州&#39;</span>, <span class="s1">&#39;宜宾&#39;</span>, <span class="s1">&#39;盐城&#39;</span>, <span class="s1">&#39;宜昌&#39;</span>, <span class="s1">&#39;宜春&#39;</span>, <span class="s1">&#39;银川&#39;</span>, <span class="s1">&#39;运城&#39;</span>, <span class="s1">&#39;伊春&#39;</span>, <span class="s1">&#39;云浮&#39;</span>, <span class="s1">&#39;阳江&#39;</span>, <span class="s1">&#39;营口&#39;</span>, <span class="s1">&#39;榆林&#39;</span>, <span class="s1">&#39;玉林&#39;</span>, <span class="s1">&#39;伊犁哈萨克州&#39;</span>, <span class="s1">&#39;阳泉&#39;</span>, <span class="s1">&#39;玉树州&#39;</span>, <span class="s1">&#39;烟台&#39;</span>, <span class="s1">&#39;鹰潭&#39;</span>, <span class="s1">&#39;义乌&#39;</span>, <span class="s1">&#39;宜兴&#39;</span>, <span class="s1">&#39;玉溪&#39;</span>, <span class="s1">&#39;益阳&#39;</span>, <span class="s1">&#39;岳阳&#39;</span>, <span class="s1">&#39;扬州&#39;</span>, <span class="s1">&#39;永州&#39;</span>, <span class="s1">&#39;淄博&#39;</span>, <span class="s1">&#39;自贡&#39;</span>, <span class="s1">&#39;珠海&#39;</span>, <span class="s1">&#39;湛江&#39;</span>, <span class="s1">&#39;镇江&#39;</span>, <span class="s1">&#39;诸暨&#39;</span>, <span class="s1">&#39;张家港&#39;</span>, <span class="s1">&#39;张家界&#39;</span>, <span class="s1">&#39;张家口&#39;</span>, <span class="s1">&#39;周口&#39;</span>, <span class="s1">&#39;驻马店&#39;</span>, <span class="s1">&#39;章丘&#39;</span>, <span class="s1">&#39;肇庆&#39;</span>, <span class="s1">&#39;中山&#39;</span>, <span class="s1">&#39;舟山&#39;</span>, <span class="s1">&#39;昭通&#39;</span>, <span class="s1">&#39;中卫&#39;</span>, <span class="s1">&#39;张掖&#39;</span>, <span class="s1">&#39;招远&#39;</span>, <span class="s1">&#39;资阳&#39;</span>, <span class="s1">&#39;遵义&#39;</span>, <span class="s1">&#39;枣庄&#39;</span>, <span class="s1">&#39;漳州&#39;</span>, <span class="s1">&#39;郑州&#39;</span>, <span class="s1">&#39;株洲&#39;</span><span class="o">]</span>	
</code></pre></td></tr></table>
</div>
</div><hr>
<h3 id="爬58二手房数据">爬58二手房数据</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">from</span> <span class="nn">lxml</span> <span class="kn">import</span> <span class="n">etree</span>
<span class="kn">import</span> <span class="nn">os</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">url</span> <span class="o">=</span> <span class="s1">&#39;https://sh.58.com/ershoufang/&#39;</span>
    <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;User-Agent&#39;</span><span class="p">:</span> <span class="s1">&#39;Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/94.0.4606.71 Safari/537.36&#39;</span>
    <span class="p">}</span>

    <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>
    <span class="n">response</span><span class="o">.</span><span class="n">encoding</span> <span class="o">=</span> <span class="s1">&#39;utf-8&#39;</span>
    <span class="n">response_text</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">text</span>

    <span class="n">tree</span> <span class="o">=</span> <span class="n">etree</span><span class="o">.</span><span class="n">HTML</span><span class="p">(</span><span class="n">response_text</span><span class="p">)</span>
    <span class="n">section_list</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s1">&#39;//section[@class=&#34;list&#34;]/div[@tongji_tag=&#34;fcpc_ersflist_gzcount&#34;]&#39;</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">title</span> <span class="ow">in</span> <span class="n">section_list</span><span class="p">:</span>
        <span class="n">title_name</span> <span class="o">=</span> <span class="n">title</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s1">&#39;.//div[@class=&#34;property-content-title&#34;]/h3/text()&#39;</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="n">title_name</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><p><code>结果</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell"><span class="o">[</span><span class="s1">&#39;必看好房 次新小区双南两房 无个税 高楼层 采光好 可议价&#39;</span><span class="o">]</span>
<span class="o">[</span><span class="s1">&#39;紧邻地铁,周边配套设施齐全,性价比超高91.1平华悦家园&#39;</span><span class="o">]</span>
<span class="o">[</span><span class="s1">&#39;共和小区，三房一厅，中间楼层，近宝山万达，近万达&#39;</span><span class="o">]</span>
<span class="o">[</span><span class="s1">&#39;好位置!好房子!南北全新装修送家电!&#39;</span><span class="o">]</span>
<span class="o">[</span><span class="s1">&#39;房东急置换 诚意买房 看中价格好谈 小区前排 视野采光好&#39;</span><span class="o">]</span>
<span class="o">[</span><span class="s1">&#39;浦江宝邸 原始动迁 三房纯毛坯 随时看 诚心出售 商业中心&#39;</span><span class="o">]</span>
<span class="o">[</span><span class="s1">&#39;大平层，精装三房，南北通透，送中央空调，房东诚意出售，&#39;</span><span class="o">]</span>
<span class="o">[</span><span class="s1">&#39;芝大厦（建襄）又名衡山路41号，2房，带1产权车位，诚意出售&#39;</span><span class="o">]</span>
<span class="o">[</span><span class="s1">&#39;电梯房 精装修 南北通透 60平 居家自住 保养好&#39;</span><span class="o">]</span>
<span class="o">[</span><span class="s1">&#39;精装南北通三房 向阳   品质楼盘 管理严格 拎包入住近地铁&#39;</span><span class="o">]</span>
<span class="o">[</span><span class="s1">&#39;澧溪改善类三房，临河景观位置，13年房龄，自住精装，双卫设计&#39;</span><span class="o">]</span>
<span class="o">[</span><span class="s1">&#39;3室2厅2卫 精装修 禹洲丁香里 电梯房 采光好 商圈成熟&#39;</span><span class="o">]</span>
<span class="o">[</span><span class="s1">&#39;电梯房 满五  住房 一品漫城(二期公寓住宅) 精装修 南北&#39;</span><span class="o">]</span>
<span class="o">[</span><span class="s1">&#39;保眞老客户房源，婚房装修全送，业主定好房子急售，带車位&#39;</span><span class="o">]</span>
<span class="o">[</span><span class="s1">&#39;静安不夜城 精装地暖 通燃气大平层  厨卫全明 不要房票可买&#39;</span><span class="o">]</span>
<span class="o">[</span><span class="s1">&#39;新上2室2厅 81平 电梯房 精装修 诚心出售 价格可议&#39;</span><span class="o">]</span>
<span class="o">[</span><span class="s1">&#39;打浦桥限购热搜丨附赠全屋精装修丨单身外地亦可买丨月租金三万起&#39;</span><span class="o">]</span>
<span class="o">[</span><span class="s1">&#39;全新精装修25万全送，动迁满五没有税费，诚意卖，付款好还能谈&#39;</span><span class="o">]</span>
<span class="o">[</span><span class="s1">&#39;（保真）杜绝虚假，无需社保，可公积金，自带产权车位，家电全送&#39;</span><span class="o">]</span>
<span class="o">[</span><span class="s1">&#39;景观楼层 豪华装修 近文馨   出门公交总站 低首付&#39;</span><span class="o">]</span>
<span class="o">[</span><span class="s1">&#39;新上笋盘2014年新小区有车位高区一线江景电梯南北两房&#39;</span><span class="o">]</span>
<span class="o">[</span><span class="s1">&#39;美兰湖高尔夫球场独栋大别墅丨送500平使用面积丨随时看房&#39;</span><span class="o">]</span>
<span class="o">[</span><span class="s1">&#39;虹桥一手新房现房发售 班车接驳2号线 新房无需积分。&#39;</span><span class="o">]</span>
<span class="o">[</span><span class="s1">&#39;满五为一，双南大房间，小区位置大气&#39;</span><span class="o">]</span>
<span class="o">[</span><span class="s1">&#39;上外云间 小区中心位置 已满五年 业主诚意出售 可议价&#39;</span><span class="o">]</span>
<span class="o">[</span><span class="s1">&#39;孙桥 4室2厅2卫 149.28平米 1380.00万元&#39;</span><span class="o">]</span>
<span class="o">[</span><span class="s1">&#39;双地铁静安寺景观房 通燃气 外地人有钱可买 送智能家具家电&#39;</span><span class="o">]</span>
<span class="o">[</span><span class="s1">&#39;精装修，自住光照充足，保养好位置安静，诚心出售&#39;</span><span class="o">]</span>
<span class="o">[</span><span class="s1">&#39;新上，新上，外滩品质豪宅，出国急售低市场价，本周必卖&#39;</span><span class="o">]</span>
<span class="o">[</span><span class="s1">&#39;中粮天悦壹号 186平4居 南北向精装修&#39;</span><span class="o">]</span>
<span class="o">[</span><span class="s1">&#39;美兰湖香岛品质小区丨豪华装修拎包入住丨满五  带车位丨急卖&#39;</span><span class="o">]</span>
<span class="o">[</span><span class="s1">&#39;精装修 育秀五区 97平 满五  住房 看房方便 有钥匙&#39;</span><span class="o">]</span>
<span class="o">[</span><span class="s1">&#39;龙湖租售推荐房源，上叠边套,有钥匙，诚意出售&#39;</span><span class="o">]</span>
<span class="o">[</span><span class="s1">&#39;来电立减8万 外地人单身可买无需社保 精装修送车位 安家魔都&#39;</span><span class="o">]</span>
<span class="o">[</span><span class="s1">&#39;来电立减5万，外地人专属，手付8W精装修送车位，莱电可大刀砍&#39;</span><span class="o">]</span>
<span class="o">[</span><span class="s1">&#39;静安寺 地铁旁 近2号线地铁带车位外地人有钱可买送30万精装&#39;</span><span class="o">]</span>
<span class="o">[</span><span class="s1">&#39;急降50万，超大户型3个房间一样大 户型方正 采光好南北通透&#39;</span><span class="o">]</span>
<span class="o">[</span><span class="s1">&#39;繁华地段，诚意出售，近地铁，随时看房&#39;</span><span class="o">]</span>
<span class="o">[</span><span class="s1">&#39;急降50万！内环次新小区！飞机户型！温州老板工厂急需资金周转&#39;</span><span class="o">]</span>
<span class="o">[</span><span class="s1">&#39;国企开发临港自贸区重磅级城市综合体!装修品质高，通勤便捷！&#39;</span><span class="o">]</span>
<span class="o">[</span><span class="s1">&#39;新上 一楼带天井 看房方便 边套 南北通透 采光好 满五  &#39;</span><span class="o">]</span>
<span class="o">[</span><span class="s1">&#39;业主自住装修 性价比两房 看房随时 急置换 随时配合谈判&#39;</span><span class="o">]</span>
<span class="o">[</span><span class="s1">&#39;房源采光好，南北通透，业主诚意出&#39;</span><span class="o">]</span>
<span class="o">[</span><span class="s1">&#39;蓝宝石保护建筑旁 户型方正 全明户型 没有税 价格空间大&#39;</span><span class="o">]</span>
<span class="o">[</span><span class="s1">&#39;小区中芯位置，高区景观房，复式四房 ，满五年诚意出售&#39;</span><span class="o">]</span>
<span class="o">[</span><span class="s1">&#39;优选房源  电梯房景观楼层  全南大一房  豪华装修全送&#39;</span><span class="o">]</span>
<span class="o">[</span><span class="s1">&#39;降40万！！联富假日公寓，欧式精装小复式，带车位！！&#39;</span><span class="o">]</span>
<span class="o">[</span><span class="s1">&#39;2室1厅 和康苑 76平 电梯房 居家自住 保养好&#39;</span><span class="o">]</span>
<span class="o">[</span><span class="s1">&#39;本地中介丨一佰万以内都是虚假丨近22号线轨交丨家电家具全送&#39;</span><span class="o">]</span>
<span class="o">[</span><span class="s1">&#39;复城国际(别墅)房屋出售！周边设施齐全！环境优雅！值得拥有！&#39;</span><span class="o">]</span>
<span class="o">[</span><span class="s1">&#39;陆家浜路，8.9.13三轨交，双南电梯两房，有钥匙，五年  &#39;</span><span class="o">]</span>
<span class="o">[</span><span class="s1">&#39;汇贤雅苑 电梯房 简单装修 满二  住房 房东急置换 诚意卖&#39;</span><span class="o">]</span>
<span class="o">[</span><span class="s1">&#39;金硕河畔西区，电梯南北通两房，清水毛坯动迁房，看房有钥匙&#39;</span><span class="o">]</span>
<span class="o">[</span><span class="s1">&#39;店长力荐！不受政策影响！来电立减5万！低首付可谈！家具全送！&#39;</span><span class="o">]</span>
<span class="o">[</span><span class="s1">&#39;静安寺 双地铁 送产权车位 有钱可买 送家具家电阳光炸裂&#39;</span><span class="o">]</span>
<span class="o">[</span><span class="s1">&#39;美兰湖大别墅丨地铁500米丨豪装带电梯丨随时看房丨急卖&#39;</span><span class="o">]</span>
<span class="o">[</span><span class="s1">&#39;钥匙在脖子上看房随时看，诚意出售首付40万，价格可谈送车位&#39;</span><span class="o">]</span>
<span class="o">[</span><span class="s1">&#39;莱茵半岛近地铁花园式住宅小区送产权车位&#39;</span><span class="o">]</span>
<span class="o">[</span><span class="s1">&#39;急售！嘉定新城近地铁品质小区人车分流 双南一  3房视野开阔&#39;</span><span class="o">]</span>
<span class="o">[</span><span class="s1">&#39;正规电梯复式！带60平超大露台，业主降价诚售！有钥匙随时看房&#39;</span><span class="o">]</span>
<span class="o">[</span><span class="s1">&#39;地铁口 南北通正气两房 诚意出售 价格看中可谈 看房有钥匙&#39;</span><span class="o">]</span>
<span class="o">[</span><span class="s1">&#39;正对前滩太古里，一室一厅，满五  精装修，94年房龄。随时看&#39;</span><span class="o">]</span>
<span class="o">[</span><span class="s1">&#39;程桥二村 10号线地铁口 南北通2房 看房方便&#39;</span><span class="o">]</span>
<span class="o">[</span><span class="s1">&#39;商圈位置  房型方正 交通便捷&#39;</span><span class="o">]</span>
<span class="o">[</span><span class="s1">&#39;一梯两户全明户型，动迁产权免  税，近龙阳路地铁站&#39;</span><span class="o">]</span>
<span class="o">[</span><span class="s1">&#39;13号线地铁口，南北电梯2房，动迁无税费，业主卖掉打新房&#39;</span><span class="o">]</span>
<span class="o">[</span><span class="s1">&#39;正南 3室2厅  星金家园 精装修&#39;</span><span class="o">]</span>
<span class="o">[</span><span class="s1">&#39;惊爆！笋盘丨150W豪装惜售丨300平露台丨3轨交丨到价签字&#39;</span><span class="o">]</span>
<span class="o">[</span><span class="s1">&#39;观望一次涨一次,朋友,是不是还要重复  的故事&#39;</span><span class="o">]</span>
<span class="o">[</span><span class="s1">&#39;直通式一室一厅，厅带西窗，精装修，全明户型，满五  ，随时看&#39;</span><span class="o">]</span>
<span class="o">[</span><span class="s1">&#39;玉兰小区新上好房20万豪华装修，小区中间位置3楼，动迁无税费&#39;</span><span class="o">]</span>
<span class="o">[</span><span class="s1">&#39;有话好好说,有房好好看!天天好房,天天好价!&#39;</span><span class="o">]</span>
<span class="o">[</span><span class="s1">&#39;世博 1室1厅1卫 42.0平米 280.00万元&#39;</span><span class="o">]</span>
<span class="o">[</span><span class="s1">&#39;青麦总经理推荐，美兰湖地铁口新上三房，精装修，诚心出售，看房&#39;</span><span class="o">]</span>
<span class="o">[</span><span class="s1">&#39;精装修 电梯房 75平   住房 楼层好 视野无遮挡&#39;</span><span class="o">]</span>
<span class="o">[</span><span class="s1">&#39;双南全明户型，送40平米双天井，动迁满五  无税&#39;</span><span class="o">]</span>
<span class="o">[</span><span class="s1">&#39;上门降此价只卖3天！3天！  真实！因置换好急售&#39;</span><span class="o">]</span>
<span class="o">[</span><span class="s1">&#39;十里繁华！可投可住！看！带车位！能！地铁口！送装修！景观楼层&#39;</span><span class="o">]</span>
<span class="o">[</span><span class="s1">&#39;罗新苑 梯队.新出电梯房，南北通透，一手动迁，豪装全明户型&#39;</span><span class="o">]</span>
<span class="o">[</span><span class="s1">&#39;万科金域澜湾(公寓住宅) 2室2厅 75平 精装修 诚心出售&#39;</span><span class="o">]</span>
<span class="o">[</span><span class="s1">&#39;非沪籍可购，安家大上海，70年产权精装修，拎包入住，送车位&#39;</span><span class="o">]</span>
<span class="o">[</span><span class="s1">&#39;万科物业二手房，稀有电梯房出售，高层景观房&#39;</span><span class="o">]</span>
<span class="o">[</span><span class="s1">&#39;动迁  ！本周必卖，朝南一房带超大阳台，采光不挡阳光好，诚售&#39;</span><span class="o">]</span>
<span class="o">[</span><span class="s1">&#39;房东急置换，外地人无社保可，可公积金，近地铁交通便利&#39;</span><span class="o">]</span>
<span class="o">[</span><span class="s1">&#39;政府核价 空间布局有致，和谐有序，清新空气自由穿行&#39;</span><span class="o">]</span>
<span class="o">[</span><span class="s1">&#39;13号线,张江 川杨新苑 疯狂降价低于市场价80万 不靠高架&#39;</span><span class="o">]</span>
<span class="o">[</span><span class="s1">&#39;4 10双轨交汇 海伦路地铁旁 电梯3房 人车分流 满五税少&#39;</span><span class="o">]</span>
<span class="o">[</span><span class="s1">&#39;万科物业二手房 诚意出售 满五  &#39;</span><span class="o">]</span>
<span class="o">[</span><span class="s1">&#39;嘉和花苑,居家必选,这么好的机会,您还在等什么出手就是您的&#39;</span><span class="o">]</span>
<span class="o">[</span><span class="s1">&#39;双南带厅，在卖15天，看房有钥匙，小区花园位置，7号13号线&#39;</span><span class="o">]</span>
<span class="o">[</span><span class="s1">&#39;金平新村 精装修大两房 双南 采光很好 房东急卖 看房随时！&#39;</span><span class="o">]</span>
<span class="o">[</span><span class="s1">&#39;精装修 南北通透 电梯房 德六高层 2室2厅 满五  住房&#39;</span><span class="o">]</span>
<span class="o">[</span><span class="s1">&#39;16.18号线旁改善电梯3房，中高楼层，15年次新小区，无税&#39;</span><span class="o">]</span>
<span class="o">[</span><span class="s1">&#39;精装修 电梯房 50平 二联家园(西区) 南北通透 房东急置&#39;</span><span class="o">]</span>
<span class="o">[</span><span class="s1">&#39;新上~！烫金地段 南北户型 环景优美 豪装全屋地暖 随时看！&#39;</span><span class="o">]</span>
<span class="o">[</span><span class="s1">&#39;1号线莲花路 精装修，无遮挡，视野佳，居住舒适,业主诚售&#39;</span><span class="o">]</span>
<span class="o">[</span><span class="s1">&#39;郑重 国人不骗国人 立约立看 24小时随时 税费少 采光绝好&#39;</span><span class="o">]</span>
<span class="o">[</span><span class="s1">&#39;望族苑不仅给您家的温馨,更是一中生活品味&#39;</span><span class="o">]</span>
<span class="o">[</span><span class="s1">&#39;小区中间位置，南北全明2房，动迁没有税，随时看房&#39;</span><span class="o">]</span>
<span class="o">[</span><span class="s1">&#39;笋盘 金光小区 双轨 近前滩 上实可用 满五 配套全 有钥匙&#39;</span><span class="o">]</span>
<span class="o">[</span><span class="s1">&#39;新挂牌双南大两房，正对前滩太古里，19号线旁，满五  ，&#39;</span><span class="o">]</span>
<span class="o">[</span><span class="s1">&#39;地铁口精装好房  外地人单身可买 5米挑高 民水民电通燃气&#39;</span><span class="o">]</span>
<span class="o">[</span><span class="s1">&#39;业主很诚意出售 看中价格不是问题 本小区一套 你还在等吗&#39;</span><span class="o">]</span>
<span class="o">[</span><span class="s1">&#39;恒大品质瀚锦苑 小区中心位置 电梯高区 满五  税费少&#39;</span><span class="o">]</span>
<span class="o">[</span><span class="s1">&#39;急售急售！！！房东已经定好房子 看中可以谈 看房随时方便&#39;</span><span class="o">]</span>
<span class="o">[</span><span class="s1">&#39;梦里有她心里安 生活有他梦长存 朝向南北通透待君来&#39;</span><span class="o">]</span>
<span class="o">[</span><span class="s1">&#39;正南 1室1厅  银丰苑 精装修&#39;</span><span class="o">]</span>
<span class="o">[</span><span class="s1">&#39;   源，随时看房，无需社保，花桥捡漏房源，距地铁站600米&#39;</span><span class="o">]</span>
<span class="o">[</span><span class="s1">&#39;璀璨北外滩 江景无遮挡丨明星同住！俯瞰陆家嘴！精装带车位！&#39;</span><span class="o">]</span>
<span class="o">[</span><span class="s1">&#39;新出新装两年，房东市区看好房急售，拎包入住，十万火急&#39;</span><span class="o">]</span>
<span class="o">[</span><span class="s1">&#39;万科物业二手房，满五  税少，高区景观房，采光好&#39;</span><span class="o">]</span>
<span class="o">[</span><span class="s1">&#39;  济阳好房推荐，两房两厅，接受周期，可提前交房，价格还可谈&#39;</span><span class="o">]</span>
<span class="o">[</span><span class="s1">&#39;急卖，逸夫二中教育，双南大两房，低总价，可改三房，户型正气！&#39;</span><span class="o">]</span>
<span class="o">[</span><span class="s1">&#39;陕西南路建国西路绍兴路瑞雪大楼 卢湾二小，向明，电梯房&#39;</span><span class="o">]</span>
<span class="o">[</span><span class="s1">&#39;正规大1房 满五年维壹 澧溪 有钥匙 随时看 总价超低&#39;</span><span class="o">]</span>
<span class="o">[</span><span class="s1">&#39;济阳新村，好房推荐，精装修30万两房一厅，交通方便，配套成熟&#39;</span><span class="o">]</span>
<span class="o">[</span><span class="s1">&#39;精装修南北通透大两房&#39;</span><span class="o">]</span>
<span class="o">[</span><span class="s1">&#39;馨宁公寓13年电梯房 满五   朝南 电梯房采光好 商圈成熟&#39;</span><span class="o">]</span>
<span class="o">[</span><span class="s1">&#39;边套户型,南北通透1房1厅,临地铁口,近滨江西岸,各付各税！&#39;</span><span class="o">]</span>
<span class="o">[</span><span class="s1">&#39;精装双南两房，业主急售出价就卖，有钥匙随时看房，价格好谈&#39;</span><span class="o">]</span>
</code></pre></td></tr></table>
</div>
</div><hr>
<h3 id="爬彼岸图网上4k美女图片">爬彼岸图网上4K美女图片</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">from</span> <span class="nn">lxml</span> <span class="kn">import</span> <span class="n">etree</span>
<span class="kn">import</span> <span class="nn">os</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="s1">&#39;./meimei&#39;</span><span class="p">):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="s1">&#39;./meimei&#39;</span><span class="p">)</span>

    <span class="c1"># 只能爬一页,最后在最外面加上一个死循环就可以了</span>
    <span class="n">page_index</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s1">&#39;请输入想要爬取的页数:&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">page_index</span> <span class="o">==</span> <span class="s1">&#39;1&#39;</span><span class="p">:</span>
        <span class="n">url</span> <span class="o">=</span> <span class="s1">&#39;https://pic.netbian.com/4kmeinv/index.html&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">url</span> <span class="o">=</span> <span class="s1">&#39;https://pic.netbian.com/4kmeinv/index_&#39;</span> <span class="o">+</span> <span class="n">page_index</span> <span class="o">+</span> <span class="s1">&#39;.html&#39;</span>
    <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;User-Agent&#39;</span><span class="p">:</span> <span class="s1">&#39;Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/94.0.4606.71 Safari/537.36&#39;</span>
    <span class="p">}</span>

    <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>
    <span class="n">response</span><span class="o">.</span><span class="n">encoding</span> <span class="o">=</span> <span class="s1">&#39;utf-8&#39;</span>
    <span class="n">response_text</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">text</span>

    <span class="n">tree</span> <span class="o">=</span> <span class="n">etree</span><span class="o">.</span><span class="n">HTML</span><span class="p">(</span><span class="n">response_text</span><span class="p">)</span>

    <span class="c1"># 获取当前页中所有图片对应的详细地址</span>
    <span class="n">li_list</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s1">&#39;//div[@class=&#34;slist&#34;]/ul/li&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">li_list</span><span class="p">:</span>
        <span class="c1"># 获取每个列表中的个元素拼成主页每个缩略图对应的详情页地址</span>
        <span class="c1"># xpath返回值是列表</span>
        <span class="n">a_url</span> <span class="o">=</span> <span class="s1">&#39;https://pic.netbian.com&#39;</span> <span class="o">+</span> <span class="n">a</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s1">&#39;./a/@href&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">a_response_tree</span> <span class="o">=</span> <span class="n">etree</span><span class="o">.</span><span class="n">HTML</span><span class="p">(</span><span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">a_url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
        <span class="n">img_src</span> <span class="o">=</span> <span class="s1">&#39;https://pic.netbian.com&#39;</span> <span class="o">+</span> <span class="n">a_response_tree</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s1">&#39;//div[@class=&#34;photo-pic&#34;]/a/img/@src&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">img_name</span> <span class="o">=</span> <span class="n">img_src</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">img_response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">img_src</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span><span class="o">.</span><span class="n">content</span>

        <span class="c1"># 第一个参数是图片保存的路径</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">img_name</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
            <span class="c1"># 要想保存指定路径的图片,需要对这个路径发起请求,将响应体传进write中</span>
            <span class="n">fp</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">img_response</span><span class="p">)</span>
            <span class="k">print</span><span class="p">(</span><span class="n">img_src</span><span class="p">,</span> <span class="s2">&#34;下载成功&#34;</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><hr>
<h3 id="爬取三国演义小说">爬取三国演义小说</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="c1"># -*- encoding:UTF-8 -*-</span>

<span class="s2">&#34;&#34;&#34;
</span><span class="s2">@File     :   drug_list.py
</span><span class="s2">@Time     :   2022/1/21 20:55
</span><span class="s2">@Author   :   张宇航
</span><span class="s2">@Contact  :   zhangzyh666@163.com
</span><span class="s2">@MyWeb    :   https://zhang666zyh.github.io
</span><span class="s2">&#34;&#34;&#34;</span>

<span class="kn">from</span> <span class="nn">lxml</span> <span class="kn">import</span> <span class="n">etree</span>
<span class="kn">import</span> <span class="nn">requests</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">main_url</span> <span class="o">=</span> <span class="s1">&#39;https://www.bqkan8.com/50_50096&#39;</span>
    <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;User-Agent&#39;</span><span class="p">:</span> <span class="s1">&#39;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/99.0.4844.84 Safari/537.36&#39;</span>
    <span class="p">}</span>

    <span class="n">response_text</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">main_url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>

    <span class="n">child_url_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">child_name_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">tree</span> <span class="o">=</span> <span class="n">etree</span><span class="o">.</span><span class="n">HTML</span><span class="p">(</span><span class="n">response_text</span><span class="p">)</span>
    <span class="n">a_list</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s1">&#39;/html/body/div[@class=&#34;listmain&#34;]/dl/dd&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">13</span><span class="p">,</span> <span class="mi">133</span><span class="p">):</span>
        <span class="n">child_url_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="s1">&#39;https://www.bqkan8.com&#39;</span> <span class="o">+</span> <span class="n">tree</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s1">&#39;/html/body/div[@class=&#34;listmain&#34;]/dl/dd[&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;]/a/@href&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">child_name_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s1">&#39;/html/body/div[@class=&#34;listmain&#34;]/dl/dd[&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;]/a/text()&#39;</span><span class="p">))</span>

    <span class="n">fp</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;三国演义.txt&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
    <span class="n">pos</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">child_url_list</span><span class="p">:</span>
        <span class="n">tree</span> <span class="o">=</span> <span class="n">etree</span><span class="o">.</span><span class="n">HTML</span><span class="p">(</span><span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">item</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
        <span class="n">res</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s1">&#39;//*[@id=&#34;content&#34;]/text()&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\xa0</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;&amp;1t;/p&gt;&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\n\t</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">fp</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">child_name_list</span><span class="p">[</span><span class="n">pos</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&#34;</span><span class="se">\n</span><span class="s2">&#34;</span> <span class="o">+</span> <span class="n">res</span><span class="p">)</span>
        <span class="n">fp</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&#34;</span><span class="se">\n</span><span class="s2">&#34;</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">pos</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;章节爬取完成!!!&#39;</span><span class="p">)</span>
        <span class="n">pos</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="n">fp</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;爬取完成!!!&#39;</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><hr>
<h3 id="爬取美食杰一些菜谱">爬取美食杰一些菜谱</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span><span class="lnt">78
</span><span class="lnt">79
</span><span class="lnt">80
</span><span class="lnt">81
</span><span class="lnt">82
</span><span class="lnt">83
</span><span class="lnt">84
</span><span class="lnt">85
</span><span class="lnt">86
</span><span class="lnt">87
</span><span class="lnt">88
</span><span class="lnt">89
</span><span class="lnt">90
</span><span class="lnt">91
</span><span class="lnt">92
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">from</span> <span class="nn">lxml</span> <span class="kn">import</span> <span class="n">etree</span>

<span class="n">url</span> <span class="o">=</span> <span class="s1">&#39;https://www.meishij.net/&#39;</span>

<span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;user-agent&#39;</span><span class="p">:</span> <span class="s1">&#39;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/101.0.4951.7 Safari/537.36&#39;</span><span class="p">,</span>
<span class="p">}</span>

<span class="n">pos</span> <span class="o">=</span> <span class="mi">1</span>

<span class="k">def</span> <span class="nf">start</span><span class="p">():</span>
    <span class="k">global</span> <span class="n">pos</span>
    <span class="n">pos</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="n">getClass</span><span class="p">()</span>


<span class="k">def</span> <span class="nf">getClass</span><span class="p">():</span>
    <span class="k">global</span> <span class="n">pos</span>
    <span class="n">response_text</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
    <span class="n">tree</span> <span class="o">=</span> <span class="n">etree</span><span class="o">.</span><span class="n">HTML</span><span class="p">(</span><span class="n">response_text</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="mi">10</span><span class="p">):</span>
            <span class="n">classList</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s1">&#39;/html/body/header/div/div/nav/div[2]/div/dl[&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;]/dd/strong&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">classList</span><span class="p">):</span>  <span class="c1"># 遍历分类</span>
                <span class="k">if</span> <span class="n">index</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">print</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s1">&#39;./a/text()&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>  <span class="c1"># 分类名</span>
                    <span class="n">child_res_text</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">item</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s1">&#39;./a/@href&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
                    <span class="n">child_tree</span> <span class="o">=</span> <span class="n">etree</span><span class="o">.</span><span class="n">HTML</span><span class="p">(</span><span class="n">child_res_text</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">9</span><span class="p">):</span>  <span class="c1"># 当前分类中每个菜谱的url</span>
                        <span class="n">last_url</span> <span class="o">=</span> \
                            <span class="n">child_tree</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span>
                                <span class="s1">&#39;/html/body/div[2]/article/div[2]/div[1]/div[&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">j</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;]/div/a[1]/@href&#39;</span><span class="p">)[</span>
                                <span class="mi">0</span><span class="p">]</span>
                        <span class="k">if</span> <span class="n">last_url</span><span class="p">:</span>
                            <span class="c1"># print(last_url)</span>
                            <span class="n">last_res_text</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">last_url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
                            <span class="n">last_tree</span> <span class="o">=</span> <span class="n">etree</span><span class="o">.</span><span class="n">HTML</span><span class="p">(</span><span class="n">last_res_text</span><span class="p">)</span>
                            <span class="n">div_list</span> <span class="o">=</span> <span class="n">last_tree</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s1">&#39;//*[@id=&#34;app&#34;]/div[2]/div[1]/   div[2]/div&#39;</span><span class="p">)</span>
                            <span class="n">res_list</span> <span class="o">=</span> <span class="p">[]</span>
                            <span class="n">one_eat</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># 制作步骤</span>
                            <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>  <span class="c1"># 菜名</span>
                            <span class="n">main_eat</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;主料&#39;</span><span class="p">]</span>
                            <span class="n">other_eat</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;辅料&#39;</span><span class="p">]</span>
                            <span class="n">img_list</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;步骤图&#39;</span><span class="p">]</span>  <span class="c1"># 图片列表</span>
                            <span class="n">face_img</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;封面&#39;</span><span class="p">]</span>

                            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">div_list</span><span class="p">:</span>
                                <span class="n">name</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span>
                                    <span class="s1">&#39;//*[@id=&#34;app&#34;]/div[1]/div/div[@class=&#34;recipe_header_info&#34;]/h1/text()&#39;</span><span class="p">)</span>
                                <span class="n">one_eat</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s1">&#39;./div[2]/p/text()&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
                            <span class="n">gongyi</span> <span class="o">=</span> <span class="n">last_tree</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span>
                                <span class="s1">&#39;//*[@id=&#34;app&#34;]/div[1]/div/div[@class=&#34;recipe_header_info&#34;]/div[1]/div[1]/strong/text()&#39;</span><span class="p">)[</span>
                                <span class="mi">0</span><span class="p">]</span>  <span class="c1"># 工艺</span>
                            <span class="n">kouwei</span> <span class="o">=</span> <span class="n">last_tree</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span>
                                <span class="s1">&#39;//*[@id=&#34;app&#34;]/div[1]/div/div[@class=&#34;recipe_header_info&#34;]/div[1]/div[2]/strong/text()&#39;</span><span class="p">)[</span>
                                <span class="mi">0</span><span class="p">]</span>  <span class="c1"># 口味</span>
                            <span class="n">time</span> <span class="o">=</span> <span class="n">last_tree</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span>
                                <span class="s1">&#39;//*[@id=&#34;app&#34;]/div[1]/div/div[@class=&#34;recipe_header_info&#34;]/div[1]/div[3]/strong/text()&#39;</span><span class="p">)[</span>
                                <span class="mi">0</span><span class="p">]</span>  <span class="c1"># 时间</span>
                            <span class="n">top</span> <span class="o">=</span> <span class="n">last_tree</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span>
                                <span class="s1">&#39;//*[@id=&#34;app&#34;]/div[1]/div/div[@class=&#34;recipe_header_info&#34;]/div[1]/div[4]/strong/text()&#39;</span><span class="p">)[</span>
                                <span class="mi">0</span><span class="p">]</span>  <span class="c1"># 难度</span>
                            <span class="n">main_eat_list</span> <span class="o">=</span> <span class="n">last_tree</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span>
                                <span class="s1">&#39;//*[@id=&#34;app&#34;]/div[1]/div/div[@class=&#34;recipe_header_info&#34;]/div[2]/div[1]/div[2]/strong&#39;</span><span class="p">)</span>
                            <span class="n">other_eat_list</span> <span class="o">=</span> <span class="n">last_tree</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span>
                                <span class="s1">&#39;//*[@id=&#34;app&#34;]/div[1]/div/div[@class=&#34;recipe_header_info&#34;]/div[2]/div[2]/div[2]/strong&#39;</span><span class="p">)</span>
                            <span class="k">for</span> <span class="n">item1</span><span class="p">,</span> <span class="n">item2</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">main_eat_list</span><span class="p">,</span> <span class="n">other_eat_list</span><span class="p">):</span>
                                <span class="n">main_eat</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item1</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s1">&#39;./a/text()&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
                                <span class="n">other_eat</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item2</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s1">&#39;./a/text()&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>

                            <span class="n">res_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
                            <span class="n">res_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">one_eat</span><span class="p">)</span>
                            <span class="n">res_list</span><span class="o">.</span><span class="n">append</span><span class="p">([[</span><span class="s1">&#39;工艺&#39;</span><span class="p">,</span> <span class="n">gongyi</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;口味&#39;</span><span class="p">,</span> <span class="n">kouwei</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;时间&#39;</span><span class="p">,</span> <span class="n">time</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;难度&#39;</span><span class="p">,</span> <span class="n">top</span><span class="p">]])</span>
                            <span class="n">r</span>	<span class="n">es_list</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">main_eat</span><span class="p">,</span> <span class="n">other_eat</span><span class="p">])</span>
                            <span class="n">img_list_div</span> <span class="o">=</span> <span class="n">last_tree</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s1">&#39;//*[@id=&#34;app&#34;]/div[2]/div[1]/div[2]/div&#39;</span><span class="p">)</span>
                            <span class="k">for</span> <span class="n">item4</span> <span class="ow">in</span> <span class="n">img_list_div</span><span class="p">:</span>
                                <span class="n">img_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item4</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s1">&#39;./div[2]/img/@src&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>

                            <span class="n">res_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">img_list</span><span class="p">)</span>

                            <span class="n">face_img</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">last_tree</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s1">&#39;//*[@id=&#34;app&#34;]/div[1]/div/div[1]/img/@src&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
                            <span class="n">res_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">face_img</span><span class="p">)</span>

                            <span class="k">print</span><span class="p">(</span><span class="n">res_list</span><span class="p">)</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s1">&#39;退出!!!&#39;</span><span class="p">)</span>
        <span class="n">start</span><span class="p">()</span>


<span class="n">getClass</span><span class="p">()</span>
</code></pre></td></tr></table>
</div>
</div><h1 id="登录验证">登录验证</h1>
<h2 id="step10验证码识别">Step10.验证码识别</h2>
<h3 id="图像识别opencv--tesseract">图像识别(opencv + tesseract)</h3>
<ul>
<li>
<p>Windows10上配置tesseract环境</p>
<ul>
<li>
<p>下载tesseract.exe</p>
<blockquote>
<p>中文路径以防幺蛾子</p>
</blockquote>
</li>
<li>
<p>配置环境变量</p>
<blockquote>
<p>上栏创建</p>
<table>
<thead>
<tr>
<th>TESSDATA_PREFIX</th>
<th>安装路径</th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
</blockquote>
<blockquote>
<p>下栏中<code>Path</code>中添加<code>安装路径</code></p>
</blockquote>
</li>
<li>
<p>验证配置是否成功</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash">tesseract -v
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p><code>pycharm</code>中安装<code>PIL</code>和<code>pytesseract</code>库</p>
</li>
</ul>
</li>
<li>
<p>代码</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span><span class="lnt">78
</span><span class="lnt">79
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="c1"># -*- encoding:UTF-8 -*-</span>
  
<span class="s2">&#34;&#34;&#34;
</span><span class="s2">@File     :   ImageVerification.py
</span><span class="s2">@Time     :   2022/1/13 17:00
</span><span class="s2">@Author   :   张宇航
</span><span class="s2">@Contact  :   zhangzyh666@163.com
</span><span class="s2">@MyWeb    :   https://zhang666zyh.github.io
</span><span class="s2">&#34;&#34;&#34;</span>
  
<span class="kn">import</span> <span class="nn">cv2</span>
<span class="kn">from</span> <span class="nn">PIL</span> <span class="kn">import</span> <span class="n">Image</span>
<span class="kn">import</span> <span class="nn">pytesseract</span> <span class="kn">as</span> <span class="nn">tess</span>
  
  
<span class="k">def</span> <span class="nf">recongize_text</span><span class="p">(</span><span class="n">image</span><span class="p">):</span>
    <span class="n">gray</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">COLOR_BGR2GRAY</span><span class="p">)</span>  <span class="c1"># 转灰度图</span>
  
    <span class="c1"># 二值化处理完后的图像是文字是黑色其他都是白色(cv2.THRESH_BINARY 超过阈值部分取maxval（最大值），否则取0)</span>
    <span class="n">ret</span><span class="p">,</span> <span class="n">binary</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">threshold</span><span class="p">(</span><span class="n">gray</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">THRESH_BINARY</span> <span class="o">|</span> <span class="n">cv2</span><span class="o">.</span><span class="n">THRESH_OTSU</span><span class="p">)</span>  <span class="c1"># 二值化处理</span>
    <span class="c1"># cv2.imshow(&#39;binary&#39;, binary)</span>
  
    <span class="s1">&#39;&#39;&#39;
</span><span class="s1">        cv2.getStructuringElement() 返回指定形状和尺寸的结构元素。
</span><span class="s1">          
</span><span class="s1">        这个函数的第一个参数表示内核的形状，有三种形状可以选择。
</span><span class="s1">          
</span><span class="s1">        矩形：MORPH_RECT;
</span><span class="s1">          
</span><span class="s1">        交叉形：MORPH_CROSS;
</span><span class="s1">          
</span><span class="s1">        椭圆形：MORPH_ELLIPSE;
</span><span class="s1">          
</span><span class="s1">        第二和第三个参数分别是内核的尺寸以及锚点的位置。一般在调用erode以及dilate函数之前，先定义一个Mat类型的变量来获得
</span><span class="s1">          
</span><span class="s1">        getStructuringElement函数的返回值: 对于锚点的位置，有默认值Point（-1,-1）,表示锚点位于中心点
</span><span class="s1">        element形状唯一依赖锚点位置，其他情况下，锚点只是影响了形态学运算结果的偏移
</span><span class="s1">          
</span><span class="s1">        getStructuringElement() 与 morphologyEx() 两个函数使用时，经常是放在一起的，后者函数中用到的参数是由前者提供
</span><span class="s1">  
</span><span class="s1">        返回一个特定大小与形状的结构元素用于形态学操作
</span><span class="s1">        生成的结构学元素进一步传入 Opencv 的 erode、dilate、morphologyEx 函数中完成形态学操作
</span><span class="s1">        除此之外，也可以自己构建一个任意形状的二进制掩码，作为结构元素 
</span><span class="s1">    &#39;&#39;&#39;</span>
    <span class="c1"># 第一次 获取形状-开操作</span>
    <span class="c1"># 获取形状其实就是生成一个矩阵,然后用这个矩阵对图像进行开操作处理</span>
    <span class="c1"># 腐蚀操作和膨胀操作内部不就是使用过矩阵处理图像的吗,所以说getStructuringElement函数不难</span>
    <span class="c1"># 比如这里就是生成一个 1*2的矩阵, 正好开操作还能接收这个参数</span>
    <span class="n">kernel1</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">getStructuringElement</span><span class="p">(</span><span class="n">cv2</span><span class="o">.</span><span class="n">MORPH_RECT</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>  <span class="c1"># 获取形状</span>
  
    <span class="c1"># 注意,开操作是先腐蚀后膨胀</span>
    <span class="n">bin1</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">morphologyEx</span><span class="p">(</span><span class="n">binary</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">MORPH_OPEN</span><span class="p">,</span> <span class="n">kernel1</span><span class="p">)</span>  <span class="c1"># 开操作处理</span>
  
    <span class="c1"># 第二次获取形状-开操作(第一次开操作的结果作为第二次开操作的参数)</span>
    <span class="c1"># 它还 获取形状-开操作了两次...我不知道这样是否会提升精度</span>
    <span class="n">kernel2</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">getStructuringElement</span><span class="p">(</span><span class="n">cv2</span><span class="o">.</span><span class="n">MORPH_RECT</span><span class="p">,</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>  <span class="c1"># 获取形状</span>
    <span class="n">open_out</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">morphologyEx</span><span class="p">(</span><span class="n">bin1</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">MORPH_OPEN</span><span class="p">,</span> <span class="n">kernel2</span><span class="p">)</span>  <span class="c1"># 开操作处理</span>
    <span class="n">cv2</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="s2">&#34;binary_image1&#34;</span><span class="p">,</span> <span class="n">open_out</span><span class="p">)</span>
  
    <span class="c1"># 非操作</span>
    <span class="n">cv2</span><span class="o">.</span><span class="n">bitwise_not</span><span class="p">(</span><span class="n">open_out</span><span class="p">,</span> <span class="n">open_out</span><span class="p">)</span>
  
    <span class="c1"># 图像转换为numpy数组类型</span>
    <span class="n">textImage</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">fromarray</span><span class="p">(</span><span class="n">open_out</span><span class="p">)</span>
  
    <span class="c1"># 文字进行识别</span>
    <span class="c1"># tesseract对numpy数组进行的形状识别</span>
    <span class="n">text</span> <span class="o">=</span> <span class="n">tess</span><span class="o">.</span><span class="n">image_to_string</span><span class="p">(</span><span class="n">textImage</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">&#34;识别结果：</span><span class="si">%s</span><span class="s2">&#34;</span> <span class="o">%</span> <span class="n">text</span><span class="p">)</span>
  
  
<span class="k">print</span><span class="p">(</span><span class="s2">&#34;-----------------&#34;</span><span class="p">)</span>
  
<span class="c1"># 路径要双斜杠,有必要还要将特殊字符进行转义</span>
<span class="n">src</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="s2">&#34;F:</span><span class="se">\\</span><span class="s2">Code</span><span class="se">\\</span><span class="s2">WriteCodes</span><span class="se">\\</span><span class="s2">Python</span><span class="se">\\</span><span class="s2">PythonProject</span><span class="se">\\</span><span class="s2">WebClower</span><span class="se">\\</span><span class="s2">VerificationCode</span><span class="se">\\</span><span class="s2">v_code02.png&#34;</span><span class="p">)</span>
<span class="n">cv2</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="s2">&#34;source_image&#34;</span><span class="p">,</span> <span class="n">src</span><span class="p">)</span>
<span class="n">recongize_text</span><span class="p">(</span><span class="n">src</span><span class="p">)</span>
<span class="n">cv2</span><span class="o">.</span><span class="n">waitKey</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">cv2</span><span class="o">.</span><span class="n">destroyAllWindows</span><span class="p">()</span>
</code></pre></td></tr></table>
</div>
</div><p><img src="https://img-blog.csdnimg.cn/d71919734ff249cf8da2a8fd8be4007d.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA5a2k5ZCNQA==,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"></p>
</li>
</ul>
<h2 id="step11cookie和session验证">Step11.Cookie和session验证</h2>
<p><strong>设置用户名和密码获取登录后的cookies实现重复登录的功能,教程不多,可能有点危险(暂时搁置)</strong></p>
<h3 id="获取豆瓣登录页面的cookies">获取豆瓣登录页面的cookies</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">requests</span>
<span class="c1"># from requests.cookies import RequestsCookieJar</span>

<span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;Host&#39;</span><span class="p">:</span> <span class="s1">&#39;www.douban.com&#39;</span><span class="p">,</span>
            <span class="s1">&#39;User-Agent&#39;</span><span class="p">:</span> <span class="s1">&#39;Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/94.0.4606.71 Safari/537.36&#39;</span><span class="p">,</span>
            <span class="s1">&#39;Accept&#39;</span><span class="p">:</span> <span class="s1">&#39;text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9&#39;</span><span class="p">,</span>
            <span class="s1">&#39;Accept-Language&#39;</span><span class="p">:</span> <span class="s1">&#39;zh-CN,zh;q=0.9,en;q=0.8&#39;</span><span class="p">,</span>
            <span class="s1">&#39;Accept-Encoding&#39;</span><span class="p">:</span> <span class="s1">&#39;gzip, deflate, br&#39;</span><span class="p">,</span>
            <span class="s1">&#39;Connection&#39;</span><span class="p">:</span> <span class="s1">&#39;keep-alive&#39;</span>
           <span class="p">}</span>
<span class="n">request_url</span> <span class="o">=</span> <span class="s2">&#34;https://www.douban.com/&#34;</span>
<span class="n">res</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">request_url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>

<span class="n">status_code</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="n">status_code</span>
<span class="n">res_header</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="n">headers</span>
<span class="n">res_cookies</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="n">cookies</span>
<span class="n">cookie1111</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="n">cookies</span><span class="o">.</span><span class="n">get_dict</span><span class="p">()</span>                             <span class="c1"># 格式化 字典形式输出</span>
<span class="n">cookie2222</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">dict_from_cookiejar</span><span class="p">(</span><span class="n">res_cookies</span><span class="p">)</span>    <span class="c1"># 格式化 字典形式输出</span>
<span class="k">for</span> <span class="n">cookie</span> <span class="ow">in</span> <span class="n">res_cookies</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="n">cookie</span><span class="o">.</span><span class="n">name</span><span class="o">+</span><span class="s2">&#34;</span><span class="se">\t</span><span class="s2">&#34;</span><span class="o">+</span><span class="n">cookie</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="s2">&#34;响应状态码：&#34;</span><span class="p">,</span> <span class="n">status_code</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s2">&#34;响应请求请求头：&#34;</span><span class="p">,</span> <span class="n">res_header</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s2">&#34;响应cookies：&#34;</span><span class="p">,</span> <span class="n">res_cookies</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s2">&#34;格式化cookie1111 :&#34;</span><span class="p">,</span> <span class="n">cookie1111</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s2">&#34;格式化cookie2222 :&#34;</span><span class="p">,</span> <span class="n">cookie2222</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><p><code>运行结果</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">bid	9sffETew6IU
ll	<span class="s2">&#34;118160&#34;</span>
响应状态码： <span class="m">200</span>
响应请求请求头： <span class="o">{</span><span class="s1">&#39;Date&#39;</span>: <span class="s1">&#39;Sat, 15 Jan 2022 08:59:42 GMT&#39;</span>, <span class="s1">&#39;Content-Type&#39;</span>: <span class="s1">&#39;text/html; charset=utf-8&#39;</span>, <span class="s1">&#39;Transfer-Encoding&#39;</span>: <span class="s1">&#39;chunked&#39;</span>, <span class="s1">&#39;Connection&#39;</span>: <span class="s1">&#39;keep-alive&#39;</span>, <span class="s1">&#39;Keep-Alive&#39;</span>: <span class="s1">&#39;timeout=30&#39;</span>, <span class="s1">&#39;X-Xss-Protection&#39;</span>: <span class="s1">&#39;1; mode=block&#39;</span>, <span class="s1">&#39;X-Douban-Mobileapp&#39;</span>: <span class="s1">&#39;0&#39;</span>, <span class="s1">&#39;Expires&#39;</span>: <span class="s1">&#39;Sun, 1 Jan 2006 01:00:00 GMT&#39;</span>, <span class="s1">&#39;Pragma&#39;</span>: <span class="s1">&#39;no-cache&#39;</span>, <span class="s1">&#39;Cache-Control&#39;</span>: <span class="s1">&#39;must-revalidate, no-cache, private&#39;</span>, <span class="s1">&#39;Set-Cookie&#39;</span>: <span class="s1">&#39;ll=&#34;118160&#34;; path=/; domain=.douban.com; expires=Sun, 15-Jan-2023 08:59:42 GMT, bid=9sffETew6IU; Expires=Sun, 15-Jan-23 08:59:42 GMT; Domain=.douban.com; Path=/&#39;</span>, <span class="s1">&#39;X-DAE-App&#39;</span>: <span class="s1">&#39;sns&#39;</span>, <span class="s1">&#39;X-DAE-Instance&#39;</span>: <span class="s1">&#39;home&#39;</span>, <span class="s1">&#39;X-DAE-Mountpoint&#39;</span>: <span class="s1">&#39;True&#39;</span>, <span class="s1">&#39;X-DOUBAN-NEWBID&#39;</span>: <span class="s1">&#39;9sffETew6IU&#39;</span>, <span class="s1">&#39;Server&#39;</span>: <span class="s1">&#39;dae&#39;</span>, <span class="s1">&#39;X-Frame-Options&#39;</span>: <span class="s1">&#39;SAMEORIGIN&#39;</span>, <span class="s1">&#39;Strict-Transport-Security&#39;</span>: <span class="s1">&#39;max-age=15552000;&#39;</span>, <span class="s1">&#39;Content-Encoding&#39;</span>: <span class="s1">&#39;br&#39;</span><span class="o">}</span>
响应cookies： &lt;RequestsCookieJar<span class="o">[</span>&lt;Cookie <span class="nv">bid</span><span class="o">=</span>9sffETew6IU <span class="k">for</span> .douban.com/&gt;, &lt;Cookie <span class="nv">ll</span><span class="o">=</span><span class="s2">&#34;118160&#34;</span> <span class="k">for</span> .douban.com/&gt;<span class="o">]</span>&gt;
格式化cookie1111 : <span class="o">{</span><span class="s1">&#39;bid&#39;</span>: <span class="s1">&#39;9sffETew6IU&#39;</span>, <span class="s1">&#39;ll&#39;</span>: <span class="s1">&#39;&#34;118160&#34;&#39;</span><span class="o">}</span>
格式化cookie2222 : <span class="o">{</span><span class="s1">&#39;bid&#39;</span>: <span class="s1">&#39;9sffETew6IU&#39;</span>, <span class="s1">&#39;ll&#39;</span>: <span class="s1">&#39;&#34;118160&#34;&#39;</span><span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><hr>
<h1 id="代理">代理</h1>
<p><strong>一些服务器有着这样一种反爬机制</strong></p>
<blockquote>
<p>统计单位时间同一ip对服务器的请求次数</p>
<p>如果次数过多,那么服务器就会在下一次直接拒绝同一ip的请求</p>
<p>这个称为<code>我们的这个ip被服务器封掉了</code></p>
</blockquote>
<ul>
<li>
<p>什么是代理</p>
<blockquote>
<p>代理服务器</p>
<p>中转站</p>
</blockquote>
</li>
<li>
<p>代理的作用</p>
<blockquote>
<p>突破自身IP访问的限制</p>
<p>隐藏自身真实IP</p>
</blockquote>
</li>
<li>
<p>原理</p>
<blockquote>
<p>将请求<code>不直接发送给服务器</code>而是发送给<code>代理服务器</code>,然后代理服务器将请求发送给<code>目标服务器</code></p>
<p>然后代理服务器将请求的response返回给客户端</p>
</blockquote>
</li>
</ul>
<hr>
<h1 id="异步爬虫">异步爬虫</h1>
<p><img src="https://img-blog.csdnimg.cn/b9a6ff92f1754cb58b822139027636d3.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA5a2k5ZCNQA==,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"></p>
<h2 id="概述-2">概述</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">requests</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">url</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;https://pic.netbian.com/uploads/allimg/220114/233827-1642174707aa9d.jpg&#39;</span><span class="p">,</span>
           <span class="s1">&#39;https://pic.netbian.com/uploads/allimg/211219/114328-1639885408db64.jpg&#39;</span><span class="p">,</span>
           <span class="s1">&#39;https://pic.netbian.com/uploads/allimg/210831/102129-16303764895142.jpg&#39;</span><span class="p">]</span>
    <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;User-Agent&#39;</span><span class="p">:</span> <span class="s1">&#39;Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/94.0.4606.71 Safari/537.36&#39;</span>
    <span class="p">}</span>
    
    <span class="k">for</span> <span class="n">url_true</span> <span class="ow">in</span> <span class="n">url</span><span class="p">:</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">url_true</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><ul>
<li>对于这个程序,这里有三个下载请求任务</li>
<li>对于每一个url,上一个的get未运行结束,它就因为线程堵塞而无法发起请求</li>
<li>这里有3个请求url,那假设有300个,3000个,30000个&hellip;</li>
<li>这种爬取不是不行,对于数据采集这种操作效率是非常低的</li>
<li>所以需要异步爬取(asynchronous)</li>
</ul>
<h2 id="之多线程and多进程">之多线程and多进程</h2>
<ul>
<li>
<p>多线程 多进程</p>
<blockquote>
<p><code>好处</code>:可以为相关阻塞的请求操作单独开启线程或进程,阻塞操作可以异步进行</p>
<p><code>弊端</code>:无法无限制的开启多线程或多进程</p>
</blockquote>
</li>
</ul>
<h2 id="线程池and进程池回收分配机制">线程池and进程池(回收分配机制)</h2>
<ul>
<li>
<p>好处</p>
<blockquote>
<p>可以降低系统对进程或者线程创建和销毁的频率,从而很好的降低系统的开小</p>
</blockquote>
</li>
<li>
<p>弊端</p>
<blockquote>
<p>池中线程或进程的数量有上限</p>
</blockquote>
</li>
</ul>
<p><code>这里写一个单线程串行方式执行</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">time</span>
<span class="c1"># import requests</span>

<span class="k">def</span> <span class="nf">get_page</span><span class="p">(</span><span class="nb">str</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;正在下载&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="s1">&#39;下载完成&#39;</span><span class="p">)</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="nb">list</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;aa&#39;</span><span class="p">,</span> <span class="s1">&#39;bb&#39;</span><span class="p">,</span> <span class="s1">&#39;cc&#39;</span><span class="p">,</span> <span class="s1">&#39;dd&#39;</span><span class="p">]</span>

    <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">:</span>
        <span class="n">get_page</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
    <span class="n">end_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;全部下载完毕,共计耗时&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">end_time</span> <span class="o">-</span> <span class="n">start_time</span><span class="p">))</span>
</code></pre></td></tr></table>
</div>
</div><p><code>运行结果</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash">正在下载 aa
aa 下载完成
正在下载 bb
bb 下载完成
正在下载 cc
cc 下载完成
正在下载 dd
dd 下载完成
全部下载完毕,共计耗时 8.007583856582642
</code></pre></td></tr></table>
</div>
</div><ul>
<li>就是普通的执行方式</li>
<li>下面使用Python线程池进行异步下载操作</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">time</span>
<span class="kn">from</span> <span class="nn">multiprocessing.dummy</span> <span class="kn">import</span> <span class="n">Pool</span>


<span class="k">def</span> <span class="nf">get_page</span><span class="p">(</span><span class="nb">str</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;正在下载&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="s1">&#39;下载完成&#39;</span><span class="p">)</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="nb">list</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;aa&#39;</span><span class="p">,</span> <span class="s1">&#39;bb&#39;</span><span class="p">,</span> <span class="s1">&#39;cc&#39;</span><span class="p">,</span> <span class="s1">&#39;dd&#39;</span><span class="p">]</span>
    <span class="c1"># 实例化一个有4个线程的线程池对象</span>
    <span class="n">pool</span> <span class="o">=</span> <span class="n">Pool</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>

    <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
    <span class="c1"># 将list中的元素遍历出来,并将这每个元素都交给get_page函数托管</span>
    <span class="c1"># 在pool.map函数中的函数,对于不同参数属于不同线程</span>
    <span class="n">pool</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">get_page</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span>
    <span class="n">end_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;全部下载完毕,共计耗时&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">end_time</span> <span class="o">-</span> <span class="n">start_time</span><span class="p">))</span>
</code></pre></td></tr></table>
</div>
</div><p><code>运行结果</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash">正在下载正在下载 bb
正在下载 cc aa正在下载
 
dd
bb aa 下载完成
下载完成
dd 下载完成cc
 下载完成
全部下载完毕,共计耗时 2.0032341480255127
</code></pre></td></tr></table>
</div>
</div><h2 id="协程">协程</h2>
<h3 id="协程相关步骤">协程相关步骤</h3>
<h4 id="普通协程">普通协程</h4>
<ul>
<li>使用<code>async</code>关键字修饰的函数,其默认返回一个该函数的<code>协程对象</code></li>
<li>将返回的协程对象注册到<code>loop(事件循环)</code>中</li>
<li>启动loop</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">asyncio</span>

<span class="n">async</span> <span class="k">def</span> <span class="nf">request</span><span class="p">(</span><span class="n">url</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">&#34;正在请求的url是&#34;</span><span class="p">,</span> <span class="n">url</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="s2">&#34;请求成功&#34;</span><span class="p">)</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="c1"># 定义一个协程对象</span>
    <span class="n">coroutine</span> <span class="o">=</span> <span class="n">request</span><span class="p">(</span><span class="s2">&#34;http://www.zhangyuhang.games&#34;</span><span class="p">)</span>

    <span class="c1"># 创建一个事件循环对象</span>
    <span class="n">loop</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">get_event_loop</span><span class="p">()</span>

    <span class="c1"># 将协程对象注册到loop中,然后启动loop</span>
    <span class="n">loop</span><span class="o">.</span><span class="n">run_until_complete</span><span class="p">(</span><span class="n">coroutine</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><p><code>运行结果</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">正在请求的url是 http://www.zhangyuhang.games
http://www.zhangyuhang.games 请求成功
</code></pre></td></tr></table>
</div>
</div><h4 id="task处理">task处理</h4>
<ul>
<li>就是在普通协程基础上给协程对象通过<code>事件循环创建的task对象</code>进行进一步封装</li>
<li>加工后的task对象中含有当前协程的<code>运行状态</code>等信息</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">asyncio</span>


<span class="n">async</span> <span class="k">def</span> <span class="nf">request</span><span class="p">(</span><span class="n">url</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">&#34;正在请求的url是&#34;</span><span class="p">,</span> <span class="n">url</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="s2">&#34;请求成功&#34;</span><span class="p">)</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="c1"># -------------------------------普通协程----------------------------------</span>
    <span class="c1"># # 定义一个协程对象</span>
    <span class="c1"># coroutine = request(&#34;http://www.zhangyuhang.games&#34;)</span>
    <span class="c1">#</span>
    <span class="c1"># # 创建一个事件循环对象</span>
    <span class="c1"># loop = asyncio.get_event_loop()</span>
    <span class="c1">#</span>
    <span class="c1"># # 将协程对象注册到loop中,然后启动loop</span>
    <span class="c1"># loop.run_until_complete(coroutine)</span>

    <span class="c1"># -----------------------------------------------------------------------</span>

    <span class="c1"># -------------------------------task------------------------------------</span>

    <span class="c1"># 定义一个协程对象</span>
    <span class="n">coroutine</span> <span class="o">=</span> <span class="n">request</span><span class="p">(</span><span class="s2">&#34;http://www.zhangyuhang.games&#34;</span><span class="p">)</span>

    <span class="c1"># 创建一个事件循环对象</span>
    <span class="n">loop</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">get_event_loop</span><span class="p">()</span>

    <span class="c1"># 使用事件循环创建一个task对象</span>
    <span class="n">task</span> <span class="o">=</span> <span class="n">loop</span><span class="o">.</span><span class="n">create_task</span><span class="p">(</span><span class="n">coroutine</span><span class="p">)</span>
    <span class="c1"># 打印状态</span>
    <span class="k">print</span><span class="p">(</span><span class="n">task</span><span class="p">)</span>

    <span class="c1"># 将协程对象注册到loop中,然后启动loop</span>
    <span class="n">loop</span><span class="o">.</span><span class="n">run_until_complete</span><span class="p">(</span><span class="n">task</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="n">task</span><span class="p">)</span>

    <span class="c1"># -----------------------------------------------------------------------</span>
</code></pre></td></tr></table>
</div>
</div><p><code>运行结果</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">&lt;Task pending <span class="nv">name</span><span class="o">=</span><span class="s1">&#39;Task-1&#39;</span> <span class="nv">coro</span><span class="o">=</span>&lt;request<span class="o">()</span> running at /home/zhangyuhang/PycharmProjects/WebClower/AsynchronousWebClower/coroutine/coroutine_init.py:4&gt;&gt;
正在请求的url是 http://www.zhangyuhang.games
http://www.zhangyuhang.games 请求成功
&lt;Task finished <span class="nv">name</span><span class="o">=</span><span class="s1">&#39;Task-1&#39;</span> <span class="nv">coro</span><span class="o">=</span>&lt;request<span class="o">()</span> <span class="k">done</span>, defined at /home/zhangyuhang/PycharmProjects/WebClower/AsynchronousWebClower/coroutine/coroutine_init.py:4&gt; <span class="nv">result</span><span class="o">=</span>None&gt;
</code></pre></td></tr></table>
</div>
</div><h4 id="future处理">future处理</h4>
<ul>
<li>future处理结果和task一样,代码无非就是由原来的循环事件对象创建task对象变为asyncio库创建future对象</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">asyncio</span>


<span class="n">async</span> <span class="k">def</span> <span class="nf">request</span><span class="p">(</span><span class="n">url</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">&#34;正在请求的url是&#34;</span><span class="p">,</span> <span class="n">url</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="s2">&#34;请求成功&#34;</span><span class="p">)</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="c1"># -------------------------------普通协程----------------------------------</span>
    <span class="c1"># # 定义一个协程对象</span>
    <span class="c1"># coroutine = request(&#34;http://www.zhangyuhang.games&#34;)</span>
    <span class="c1">#</span>
    <span class="c1"># # 创建一个事件循环对象</span>
    <span class="c1"># loop = asyncio.get_event_loop()</span>
    <span class="c1">#</span>
    <span class="c1"># # 将协程对象注册到loop中,然后启动loop</span>
    <span class="c1"># loop.run_until_complete(coroutine)</span>

    <span class="c1"># -----------------------------------------------------------------------</span>

    <span class="c1"># -------------------------------task------------------------------------</span>

    <span class="c1"># # 定义一个协程对象</span>
    <span class="c1"># coroutine = request(&#34;http://www.zhangyuhang.games&#34;)</span>
    <span class="c1">#</span>
    <span class="c1"># # 创建一个事件循环对象</span>
    <span class="c1"># loop = asyncio.get_event_loop()</span>
    <span class="c1">#</span>
    <span class="c1"># # 使用事件循环创建一个task对象</span>
    <span class="c1"># task = loop.create_task(coroutine)</span>
    <span class="c1"># # 打印状态</span>
    <span class="c1"># print(task)</span>
    <span class="c1">#</span>
    <span class="c1"># # 将task对象注册到loop中,然后启动loop</span>
    <span class="c1"># loop.run_until_complete(task)</span>
    <span class="c1"># print(task)</span>

    <span class="c1"># -----------------------------------------------------------------------</span>

    <span class="c1"># --------------------------------future---------------------------------</span>

    <span class="c1"># 定义一个协程对象</span>
    <span class="n">coroutine</span> <span class="o">=</span> <span class="n">request</span><span class="p">(</span><span class="s2">&#34;http://www.zhangyuhang.games&#34;</span><span class="p">)</span>

    <span class="c1"># 创建一个事件循环对象</span>
    <span class="n">loop</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">get_event_loop</span><span class="p">()</span>

    <span class="c1"># 使用事件循环创建一个future对象</span>
    <span class="n">task</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">ensure_future</span><span class="p">(</span><span class="n">coroutine</span><span class="p">)</span>
    <span class="c1"># 打印状态</span>
    <span class="k">print</span><span class="p">(</span><span class="n">task</span><span class="p">)</span>

    <span class="c1"># 将future对象注册到loop中,然后启动loop</span>
    <span class="n">loop</span><span class="o">.</span><span class="n">run_until_complete</span><span class="p">(</span><span class="n">task</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="n">task</span><span class="p">)</span>

    <span class="c1"># -----------------------------------------------------------------------</span>
</code></pre></td></tr></table>
</div>
</div><h4 id="task对象绑定回调函数">task对象绑定回调函数</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span><span class="lnt">78
</span><span class="lnt">79
</span><span class="lnt">80
</span><span class="lnt">81
</span><span class="lnt">82
</span><span class="lnt">83
</span><span class="lnt">84
</span><span class="lnt">85
</span><span class="lnt">86
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">asyncio</span>


<span class="n">async</span> <span class="k">def</span> <span class="nf">request</span><span class="p">(</span><span class="n">url</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">&#34;正在请求的url是&#34;</span><span class="p">,</span> <span class="n">url</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="s2">&#34;请求成功&#34;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">url</span>


<span class="c1"># 函数被作为参数传进了```task绑定回调函数的方法```中</span>
<span class="c1"># 这样这个函数就作为了```task对象```的回调函数,在协程执行完毕时调用它</span>
<span class="c1"># ```task绑定回调函数的方法```将自身作为参数传递进回调函数</span>
<span class="c1"># task.result()结果为```async协程对象定义函数```的返回值</span>
<span class="k">def</span> <span class="nf">callback_func</span><span class="p">(</span><span class="n">task</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="n">task</span><span class="o">.</span><span class="n">result</span><span class="p">())</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="c1"># -------------------------------普通协程----------------------------------</span>
    <span class="c1"># # 定义一个协程对象</span>
    <span class="c1"># coroutine = request(&#34;http://www.zhangyuhang.games&#34;)</span>
    <span class="c1">#</span>
    <span class="c1"># # 创建一个事件循环对象</span>
    <span class="c1"># loop = asyncio.get_event_loop()</span>
    <span class="c1">#</span>
    <span class="c1"># # 将协程对象注册到loop中,然后启动loop</span>
    <span class="c1"># loop.run_until_complete(coroutine)</span>

    <span class="c1"># -----------------------------------------------------------------------</span>

    <span class="c1"># -------------------------------task------------------------------------</span>

    <span class="c1"># # 定义一个协程对象</span>
    <span class="c1"># coroutine = request(&#34;http://www.zhangyuhang.games&#34;)</span>
    <span class="c1">#</span>
    <span class="c1"># # 创建一个事件循环对象</span>
    <span class="c1"># loop = asyncio.get_event_loop()</span>
    <span class="c1">#</span>
    <span class="c1"># # 使用事件循环创建一个task对象</span>
    <span class="c1"># task = loop.create_task(coroutine)</span>
    <span class="c1"># # 打印状态</span>
    <span class="c1"># print(task)</span>
    <span class="c1">#</span>
    <span class="c1"># # 将task对象注册到loop中,然后启动loop</span>
    <span class="c1"># loop.run_until_complete(task)</span>
    <span class="c1"># print(task)</span>

    <span class="c1"># -----------------------------------------------------------------------</span>

    <span class="c1"># --------------------------------future---------------------------------</span>

    <span class="c1"># # 定义一个协程对象</span>
    <span class="c1"># coroutine = request(&#34;http://www.zhangyuhang.games&#34;)</span>
    <span class="c1">#</span>
    <span class="c1"># # 创建一个事件循环对象</span>
    <span class="c1"># loop = asyncio.get_event_loop()</span>
    <span class="c1">#</span>
    <span class="c1"># # 使用事件循环创建一个future对象</span>
    <span class="c1"># task = asyncio.ensure_future(coroutine)</span>
    <span class="c1"># # 打印状态</span>
    <span class="c1"># print(task)</span>
    <span class="c1">#</span>
    <span class="c1"># # 将future对象注册到loop中,然后启动loop</span>
    <span class="c1"># loop.run_until_complete(task)</span>
    <span class="c1"># print(task)</span>

    <span class="c1"># -----------------------------------------------------------------------</span>

    <span class="c1"># ---------------------------------绑定回调函数-----------------------------</span>

    <span class="c1"># 定义一个协程对象</span>
    <span class="n">coroutine</span> <span class="o">=</span> <span class="n">request</span><span class="p">(</span><span class="s2">&#34;http://www.zhangyuhang.games&#34;</span><span class="p">)</span>

    <span class="c1"># 创建一个事件循环对象</span>
    <span class="n">loop</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">get_event_loop</span><span class="p">()</span>

    <span class="c1"># 使用事件循环创建一个task对象</span>
    <span class="n">task</span> <span class="o">=</span> <span class="n">loop</span><span class="o">.</span><span class="n">create_task</span><span class="p">(</span><span class="n">coroutine</span><span class="p">)</span>

    <span class="c1"># 给task对象绑定回调函数,参数为函数名</span>
    <span class="n">task</span><span class="o">.</span><span class="n">add_done_callback</span><span class="p">(</span><span class="n">callback_func</span><span class="p">)</span>

    <span class="c1"># 将协程对象注册到loop中,然后启动loop</span>
    <span class="n">loop</span><span class="o">.</span><span class="n">run_until_complete</span><span class="p">(</span><span class="n">task</span><span class="p">)</span>

    <span class="c1"># -----------------------------------------------------------------------</span>
</code></pre></td></tr></table>
</div>
</div><p><code>运行结果</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">正在请求的url是 http://www.zhangyuhang.games
http://www.zhangyuhang.games 请求成功
http://www.zhangyuhang.games
</code></pre></td></tr></table>
</div>
</div><hr>
<h3 id="多任务异步协程">多任务异步协程</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">import asyncio
import <span class="nb">time</span>


async def request<span class="o">(</span>url<span class="o">)</span>:
    print<span class="o">(</span><span class="s2">&#34;下载&#34;</span>, url<span class="o">)</span>

    <span class="c1"># 使用传统时间会很慢</span>
    <span class="c1"># 换成asyncio中的时间,asyncio中遇到阻塞必须使用await修饰手动挂起</span>
    <span class="c1"># time.sleep(2)</span>
    await asyncio.sleep<span class="o">(</span>2<span class="o">)</span>
    print<span class="o">(</span>url, <span class="s2">&#34;下载完成&#34;</span><span class="o">)</span>


<span class="nv">start</span> <span class="o">=</span> time.time<span class="o">()</span>
<span class="nv">urls</span> <span class="o">=</span> <span class="o">[</span>
    <span class="s1">&#39;https://www.baidu.com&#39;</span>,
    <span class="s1">&#39;http://www.zhangyuhang.games&#39;</span>,
    <span class="s1">&#39;https://www.qq.com&#39;</span>
<span class="o">]</span>
<span class="nv">coroutine_list</span> <span class="o">=</span> <span class="o">[]</span>

<span class="c1"># 将所有需要下载的路径全部定义为future对象并推到列表中</span>
<span class="k">for</span> url in urls:
    <span class="nv">coroutine</span> <span class="o">=</span> request<span class="o">(</span>url<span class="o">)</span>
    <span class="nv">future</span> <span class="o">=</span> asyncio.ensure_future<span class="o">(</span>coroutine<span class="o">)</span>
    coroutine_list.append<span class="o">(</span>future<span class="o">)</span>

<span class="nv">loop</span> <span class="o">=</span> asyncio.get_event_loop<span class="o">()</span>
<span class="c1"># 在循环事件中注册多个协程集合需要传指定格式</span>
loop.run_until_complete<span class="o">(</span>asyncio.wait<span class="o">(</span>coroutine_list<span class="o">))</span>

<span class="nv">end</span> <span class="o">=</span> time.time<span class="o">()</span>
print<span class="o">(</span><span class="s2">&#34;耗时&#34;</span>, <span class="o">(</span>end - start<span class="o">))</span>
</code></pre></td></tr></table>
</div>
</div><hr>
<h2 id="aiohttp">aiohttp</h2>
<h3 id="模块引入">模块引入</h3>
<ul>
<li>
<p>这里先使用flask搭建一个模拟服务器</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">Flask</span>
<span class="kn">import</span> <span class="nn">time</span>
  
<span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
  
  
<span class="nd">@app.route</span><span class="p">(</span><span class="s1">&#39;/sunyanzi&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">index_bobo</span><span class="p">():</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
    <span class="k">return</span> <span class="s1">&#39;Hello sunyanzi&#39;</span>
  
  
<span class="nd">@app.route</span><span class="p">(</span><span class="s1">&#39;/jay&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">index_jay</span><span class="p">():</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
    <span class="k">return</span> <span class="s1">&#39;Hello jay&#39;</span>
  
  
<span class="nd">@app.route</span><span class="p">(</span><span class="s1">&#39;/jj&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">index_jj</span><span class="p">():</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
    <span class="k">return</span> <span class="s1">&#39;Hello jj&#39;</span>
  
  
<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">app</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">threaded</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><blockquote>
<p>三个路由,对应三个不同的请求</p>
</blockquote>
</li>
<li>
<p>然后写一个爬虫对这个网站进行爬取</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">asyncio</span>
<span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">import</span> <span class="nn">time</span>
  
  
<span class="n">async</span> <span class="k">def</span> <span class="nf">get_page</span><span class="p">(</span><span class="n">url</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;正在下载:&#39;</span><span class="p">,</span> <span class="n">url</span><span class="p">)</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;下载成功,结果为:&#39;</span><span class="p">,</span> <span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
  
<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
  
    <span class="n">urls</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s1">&#39;http://127.0.0.1:5000/sunyanzi&#39;</span><span class="p">,</span>
        <span class="s1">&#39;http://127.0.0.1:5000/jay&#39;</span><span class="p">,</span>
        <span class="s1">&#39;http://127.0.0.1:5000/jj&#39;</span>
    <span class="p">]</span>
  
    <span class="n">tasks</span> <span class="o">=</span> <span class="p">[]</span>
  
    <span class="k">for</span> <span class="n">url</span> <span class="ow">in</span> <span class="n">urls</span><span class="p">:</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">get_page</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
        <span class="n">task</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">ensure_future</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
        <span class="n">tasks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">task</span><span class="p">)</span>
  
    <span class="c1"># 创建事件循环</span>
    <span class="n">loop</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">get_event_loop</span><span class="p">()</span>
  
    <span class="c1"># 在事件循环中将事件对象注册后运行</span>
    <span class="n">loop</span><span class="o">.</span><span class="n">run_until_complete</span><span class="p">(</span><span class="n">asyncio</span><span class="o">.</span><span class="n">wait</span><span class="p">(</span><span class="n">tasks</span><span class="p">))</span>
  
    <span class="n">end</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;总耗时:&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">end</span> <span class="o">-</span> <span class="n">start</span><span class="p">))</span>
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>耗时6秒多</p>
</li>
<li>
<p>requests.get()是基于同步</p>
</li>
<li>
<p>异步需要使用aiohttp模块进行请求</p>
</li>
</ul>
<h3 id="aiohttp实现异步请求">aiohttp实现异步请求</h3>
<ul>
<li>
<p>服务器照常</p>
</li>
<li>
<p>aiohttp异步爬虫</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">asyncio</span>
<span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">aiohttp</span>
  
  
<span class="n">async</span> <span class="k">def</span> <span class="nf">get_page</span><span class="p">(</span><span class="n">url</span><span class="p">):</span>
    <span class="c1"># 创建session对象</span>
    <span class="n">async</span> <span class="k">with</span> <span class="n">aiohttp</span><span class="o">.</span><span class="n">ClientSession</span><span class="p">()</span> <span class="k">as</span> <span class="n">session</span><span class="p">:</span>
        <span class="c1"># 通过session进行请求</span>
        <span class="c1"># 请求之前一定要用await进行手动挂起</span>
        <span class="n">async</span> <span class="k">with</span> <span class="n">await</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">)</span> <span class="k">as</span> <span class="n">response</span><span class="p">:</span>
            <span class="c1"># wait response.json() 返回的是json对象</span>
            <span class="c1"># await response.text() 返回字符串对应的响应数据</span>
            <span class="c1"># await response.read() 返回二进制形式的响应数据</span>
  
            <span class="c1"># 获取请求内容体操作前需要使用await手动挂载</span>
            <span class="n">page_text</span> <span class="o">=</span> <span class="n">await</span> <span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
            <span class="k">print</span><span class="p">(</span><span class="n">page_text</span><span class="p">)</span>
  
<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
  
    <span class="n">urls</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s1">&#39;http://127.0.0.1:5000/sunyanzi&#39;</span><span class="p">,</span>
        <span class="s1">&#39;http://127.0.0.1:5000/jay&#39;</span><span class="p">,</span>
        <span class="s1">&#39;http://127.0.0.1:5000/jj&#39;</span>
    <span class="p">]</span>
  
    <span class="n">tasks</span> <span class="o">=</span> <span class="p">[]</span>
  
    <span class="k">for</span> <span class="n">url</span> <span class="ow">in</span> <span class="n">urls</span><span class="p">:</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">get_page</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
        <span class="n">task</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">ensure_future</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
        <span class="n">tasks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">task</span><span class="p">)</span>
  
    <span class="c1"># 创建事件循环</span>
    <span class="n">loop</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">get_event_loop</span><span class="p">()</span>
  
    <span class="c1"># 在事件循环中将事件对象注册后运行</span>
    <span class="n">loop</span><span class="o">.</span><span class="n">run_until_complete</span><span class="p">(</span><span class="n">asyncio</span><span class="o">.</span><span class="n">wait</span><span class="p">(</span><span class="n">tasks</span><span class="p">))</span>
  
    <span class="n">end</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;总耗时:&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">end</span> <span class="o">-</span> <span class="n">start</span><span class="p">))</span>
</code></pre></td></tr></table>
</div>
</div><p><code>运行结果</code></p>
<ul>
<li>
<p>服务器</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell"> * Serving Flask app <span class="s1">&#39;FlaskServer&#39;</span> <span class="o">(</span>lazy loading<span class="o">)</span>
 * Environment: production
   WARNING: This is a development server. Do not use it in a production deployment.
   Use a production WSGI server instead.
 * Debug mode: off
 * Running on http://127.0.0.1:5000/ <span class="o">(</span>Press CTRL+C to quit<span class="o">)</span>
127.0.0.1 - - <span class="o">[</span>21/Jan/2022 19:59:37<span class="o">]</span> <span class="s2">&#34;GET /sunyanzi HTTP/1.1&#34;</span> <span class="m">200</span> -
127.0.0.1 - - <span class="o">[</span>21/Jan/2022 19:59:37<span class="o">]</span> <span class="s2">&#34;GET /jay HTTP/1.1&#34;</span> <span class="m">200</span> -
127.0.0.1 - - <span class="o">[</span>21/Jan/2022 19:59:37<span class="o">]</span> <span class="s2">&#34;GET /jj HTTP/1.1&#34;</span> <span class="m">200</span> -
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>爬虫</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">Hello sunyanzi
Hello jj
Hello jay
总耗时: 2.009291172027588
</code></pre></td></tr></table>
</div>
</div></li>
</ul>
</li>
</ul>
<hr>
<h1 id="selenium动态爬取">selenium动态爬取</h1>
<h2 id="selenium体验">selenium体验</h2>
<ul>
<li>
<p>不同浏览器下载不同的<code>浏览器驱动</code></p>
</li>
<li>
<p>chrome就下载chromedriver,firefox就下载firefoxdriver&hellip;</p>
</li>
<li>
<p>还得根据浏览器版本下载对应驱动</p>
<ul>
<li>
<p>chrome查看版本号</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-http" data-lang="http"><span class="err">Chrome://version
</span></code></pre></td></tr></table>
</div>
</div></li>
</ul>
<p><a href="https://npm.taobao.org/mirrors/chromedriver/">chrome-driver下载地址</a></p>
</li>
<li>
<p>解压将里面的可执行文件复制到任意地址,反正写代码的时候传的也是路径</p>
</li>
<li>
<p>编写代码,因为上面的化妆品监管局主页列表,在url的response中没有列表信息</p>
</li>
<li>
<p>而在调试工具抓包查看可以找到</p>
</li>
<li>
<p>动态爬取其实就是<code>抓包获取网页源代码</code></p>
<p><code>selenium_windows.py</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="c1"># -*- encoding:UTF-8 -*-</span>
  
<span class="s2">&#34;&#34;&#34;
</span><span class="s2">@File     :   drug_list.py
</span><span class="s2">@Time     :   2022/1/21 20:55
</span><span class="s2">@Author   :   张宇航
</span><span class="s2">@Contact  :   zhangzyh666@163.com
</span><span class="s2">@MyWeb    :   https://zhang666zyh.github.io
</span><span class="s2">&#34;&#34;&#34;</span>
  
<span class="kn">from</span> <span class="nn">selenium</span> <span class="kn">import</span> <span class="n">webdriver</span>
<span class="kn">from</span> <span class="nn">lxml</span> <span class="kn">import</span> <span class="n">etree</span>
<span class="kn">import</span> <span class="nn">time</span>
  
<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="c1"># 使用下载的chromedriver创建一个模拟浏览器对象</span>
    <span class="n">browser</span> <span class="o">=</span> <span class="n">webdriver</span><span class="o">.</span><span class="n">Chrome</span><span class="p">(</span><span class="n">executable_path</span><span class="o">=</span><span class="s1">&#39;./chromedriver.exe&#39;</span><span class="p">)</span>
      
    <span class="c1"># 使用 &#34;浏览器&#34; 进行get请求</span>
    <span class="n">browser</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;http://scxk.nmpa.gov.cn:81/xk/&#39;</span><span class="p">)</span>
    <span class="c1"># 获取网页源数据</span>
    <span class="n">page_text</span> <span class="o">=</span> <span class="n">browser</span><span class="o">.</span><span class="n">page_source</span>
  
    <span class="n">tree</span> <span class="o">=</span> <span class="n">etree</span><span class="o">.</span><span class="n">HTML</span><span class="p">(</span><span class="n">page_text</span><span class="p">)</span>
  
    <span class="n">li_list</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s1">&#39;//ul[@id=&#34;gzlist&#34;]/li&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">li</span> <span class="ow">in</span> <span class="n">li_list</span><span class="p">:</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">li</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s1">&#39;./dl/@title&#39;</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
      
    <span class="c1"># 退出浏览器,不然它会一直停留,直到你手动关闭它</span>
    <span class="n">browser</span><span class="o">.</span><span class="n">quit</span><span class="p">()</span>
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p><code>运行结果</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">  <span class="nv">browser</span> <span class="o">=</span> webdriver.Chrome<span class="o">(</span><span class="nv">executable_path</span><span class="o">=</span><span class="s1">&#39;./chromedriver.exe&#39;</span><span class="o">)</span>
<span class="o">[</span><span class="s1">&#39;贵阳科福科技有限公司香料化妆品分公司&#39;</span><span class="o">]</span>
<span class="o">[</span><span class="s1">&#39;上海西西艾尔启东日用化学品有限公司&#39;</span><span class="o">]</span>
<span class="o">[</span><span class="s1">&#39;哈尔滨北星药业有限公司&#39;</span><span class="o">]</span>
<span class="o">[</span><span class="s1">&#39;中山英杰化妆品有限公司&#39;</span><span class="o">]</span>
<span class="o">[</span><span class="s1">&#39;汕头市圣佳美化妆品有限公司&#39;</span><span class="o">]</span>
<span class="o">[</span><span class="s1">&#39;广州安美化妆品有限公司&#39;</span><span class="o">]</span>
<span class="o">[</span><span class="s1">&#39;广州阿里郎化妆品有限公司&#39;</span><span class="o">]</span>
<span class="o">[</span><span class="s1">&#39;汕头市诺依颜化妆品有限公司&#39;</span><span class="o">]</span>
<span class="o">[</span><span class="s1">&#39;深圳能子膏药科技有限公司&#39;</span><span class="o">]</span>
<span class="o">[</span><span class="s1">&#39;广东泓立化妆品有限公司&#39;</span><span class="o">]</span>
<span class="o">[</span><span class="s1">&#39;广州市花都区雅宝日用化妆品厂&#39;</span><span class="o">]</span>
<span class="o">[</span><span class="s1">&#39;广州臻颜化妆品有限公司&#39;</span><span class="o">]</span>
<span class="o">[</span><span class="s1">&#39;广州中汉口腔用品有限公司&#39;</span><span class="o">]</span>
<span class="o">[</span><span class="s1">&#39;科丝美诗（广州）化妆品有限公司&#39;</span><span class="o">]</span>
<span class="o">[</span><span class="s1">&#39;无锡宾西利悦科技有限公司&#39;</span><span class="o">]</span>
</code></pre></td></tr></table>
</div>
</div></li>
</ul>
<h2 id="selenium模拟淘宝搜索">selenium模拟淘宝搜索</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="c1"># -*- encoding:UTF-8 -*-</span>

<span class="s2">&#34;&#34;&#34;
</span><span class="s2">@File     :   taobao_search.py
</span><span class="s2">@Time     :   2022/1/21 21:21
</span><span class="s2">@Author   :   张宇航
</span><span class="s2">@Contact  :   zhangzyh666@163.com
</span><span class="s2">@MyWeb    :   https://zhang666zyh.github.io
</span><span class="s2">&#34;&#34;&#34;</span>
<span class="kn">from</span> <span class="nn">selenium</span> <span class="kn">import</span> <span class="n">webdriver</span>
<span class="kn">from</span> <span class="nn">lxml</span> <span class="kn">import</span> <span class="n">etree</span>
<span class="kn">import</span> <span class="nn">time</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="c1"># 使用下载的chromedriver创建一个模拟浏览器对象</span>
    <span class="n">browser</span> <span class="o">=</span> <span class="n">webdriver</span><span class="o">.</span><span class="n">Chrome</span><span class="p">(</span><span class="n">executable_path</span><span class="o">=</span><span class="s1">&#39;../chromedriver.exe&#39;</span><span class="p">)</span>

    <span class="c1"># 使用 &#34;浏览器&#34; 进行get请求</span>
    <span class="n">browser</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;https://www.taobao.com/&#39;</span><span class="p">)</span>
    <span class="c1"># 获取网页源数据</span>
    <span class="n">page_text</span> <span class="o">=</span> <span class="n">browser</span><span class="o">.</span><span class="n">page_source</span>

    <span class="c1"># selenium标签定位</span>
    <span class="n">search_input</span> <span class="o">=</span> <span class="n">browser</span><span class="o">.</span><span class="n">find_element_by_id</span><span class="p">(</span><span class="s1">&#39;q&#39;</span><span class="p">)</span>
    <span class="c1"># 在输入框中输入数据</span>
    <span class="n">search_input</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="s1">&#39;华为&#39;</span><span class="p">)</span>

    <span class="c1"># 输入完毕后定位到搜索按钮,然后点击按钮进行搜索</span>
    <span class="n">button</span> <span class="o">=</span> <span class="n">browser</span><span class="o">.</span><span class="n">find_element_by_css_selector</span><span class="p">(</span><span class="s1">&#39;.btn-search&#39;</span><span class="p">)</span>
    <span class="n">button</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>

    <span class="n">browser</span><span class="o">.</span><span class="n">quit</span><span class="p">()</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="使用selenium处理iframe">使用selenium处理iframe</h2>
<p><a href="https://www.runoob.com/try/try.php?filename=jqueryui-api-droppable">测试网址</a></p>
<p><img src="https://img-blog.csdnimg.cn/a09f1fb33ffc41dbb60360c4d8feb84b.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA5a2k5ZCNQA==,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="c1"># -*- encoding:UTF-8 -*-</span>

<span class="s2">&#34;&#34;&#34;
</span><span class="s2">@File     :   main.py
</span><span class="s2">@Time     :   2022/1/21 21:35
</span><span class="s2">@Author   :   张宇航
</span><span class="s2">@Contact  :   zhangzyh666@163.com
</span><span class="s2">@MyWeb    :   https://zhang666zyh.github.io
</span><span class="s2">&#34;&#34;&#34;</span>
<span class="c1"># -*- encoding:UTF-8 -*-</span>

<span class="s2">&#34;&#34;&#34;
</span><span class="s2">@File     :   taobao_search.py
</span><span class="s2">@Time     :   2022/1/21 21:21
</span><span class="s2">@Author   :   张宇航
</span><span class="s2">@Contact  :   zhangzyh666@163.com
</span><span class="s2">@MyWeb    :   https://zhang666zyh.github.io
</span><span class="s2">&#34;&#34;&#34;</span>
<span class="kn">from</span> <span class="nn">selenium</span> <span class="kn">import</span> <span class="n">webdriver</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver</span> <span class="kn">import</span> <span class="n">ActionChains</span>  <span class="c1"># 导入动作链</span>
<span class="kn">import</span> <span class="nn">time</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="c1"># 使用下载的chromedriver创建一个模拟浏览器对象</span>
    <span class="n">browser</span> <span class="o">=</span> <span class="n">webdriver</span><span class="o">.</span><span class="n">Chrome</span><span class="p">(</span><span class="n">executable_path</span><span class="o">=</span><span class="s1">&#39;../chromedriver.exe&#39;</span><span class="p">)</span>

    <span class="c1"># 使用 &#34;浏览器&#34; 进行get请求</span>
    <span class="n">browser</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;https://www.runoob.com/try/try.php?filename=jqueryui-api-droppable&#39;</span><span class="p">)</span>

    <span class="c1"># 通过id定位到iframe区域</span>
    <span class="n">browser</span><span class="o">.</span><span class="n">switch_to</span><span class="o">.</span><span class="n">frame</span><span class="p">(</span><span class="s1">&#39;iframeResult&#39;</span><span class="p">)</span>

    <span class="c1"># 定位iframe中的元素</span>
    <span class="n">div</span> <span class="o">=</span> <span class="n">browser</span><span class="o">.</span><span class="n">find_element_by_id</span><span class="p">(</span><span class="s1">&#39;draggable&#39;</span><span class="p">)</span>

    <span class="c1"># 实例化动作链,</span>
    <span class="n">action_chains</span> <span class="o">=</span> <span class="n">ActionChains</span><span class="p">(</span><span class="n">browser</span><span class="p">)</span>
    <span class="c1"># 点击并抓住div</span>
    <span class="n">action_chains</span><span class="o">.</span><span class="n">click_and_hold</span><span class="p">(</span><span class="n">div</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>
        <span class="n">action_chains</span><span class="o">.</span><span class="n">move_by_offset</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">perform</span><span class="p">()</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.3</span><span class="p">)</span>

    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>

    <span class="c1"># 释放动作链</span>
    <span class="n">action_chains</span><span class="o">.</span><span class="n">release</span><span class="p">()</span>

    <span class="n">browser</span><span class="o">.</span><span class="n">quit</span><span class="p">()</span>
</code></pre></td></tr></table>
</div>
</div><p><strong>selenium中的<code>find_element_by_id</code>、<code>find_element_by_css_selector</code>等方法在最新版本中已经被舍弃了,全部通过<code>xpath</code>定位元素,实际使用在下面的模拟12306登录即可查看</strong></p>
<h2 id="12306模拟登录">12306模拟登录</h2>
<p><a href="https://kyfw.12306.cn/otn/resources/login.html">12306登录页面</a></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="c1"># -*- encoding:UTF-8 -*-</span>

<span class="s2">&#34;&#34;&#34;
</span><span class="s2">@File     :   main.py
</span><span class="s2">@Time     :   2022/1/21 21:55
</span><span class="s2">@Author   :   张宇航
</span><span class="s2">@Contact  :   zhangzyh666@163.com
</span><span class="s2">@MyWeb    :   https://zhang666zyh.github.io
</span><span class="s2">&#34;&#34;&#34;</span>

<span class="kn">from</span> <span class="nn">selenium</span> <span class="kn">import</span> <span class="n">webdriver</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.common.by</span> <span class="kn">import</span> <span class="n">By</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="c1"># 使用下载的chromedriver创建一个模拟浏览器对象</span>
    <span class="n">browser</span> <span class="o">=</span> <span class="n">webdriver</span><span class="o">.</span><span class="n">Chrome</span><span class="p">(</span><span class="n">executable_path</span><span class="o">=</span><span class="s1">&#39;../chromedriver.exe&#39;</span><span class="p">)</span>

    <span class="c1"># 使用 &#34;浏览器&#34; 进行get请求</span>
    <span class="n">browser</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;https://kyfw.12306.cn/otn/resources/login.html&#39;</span><span class="p">)</span>

    <span class="c1"># 获取网页源数据</span>
    <span class="n">page_text</span> <span class="o">=</span> <span class="n">browser</span><span class="o">.</span><span class="n">page_source</span>	

    <span class="c1"># selenium标签定位</span>
    <span class="c1"># 输入用户名、密码</span>
    <span class="n">username_input</span> <span class="o">=</span> <span class="n">browser</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="s1">&#39;//div[@class=&#34;login-account&#34;]/div[@class=&#34;login-item&#34;]/input[@id=&#34;J-userName&#34;]&#39;</span><span class="p">)</span>
    <span class="n">username_input</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="s1">&#39;ZYH18746539365TT&#39;</span><span class="p">)</span>
    <span class="n">password_input</span> <span class="o">=</span> <span class="n">browser</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="s1">&#39;//div[@class=&#34;login-account&#34;]/div[@class=&#34;login-item&#34;]/input[@id=&#34;J-password&#34;]&#39;</span><span class="p">)</span>
    <span class="n">password_input</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="s1">&#39;cg789140aa&#39;</span><span class="p">)</span>

    <span class="c1"># 点击登录</span>
    <span class="n">button_login</span> <span class="o">=</span> <span class="n">browser</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="s1">&#39;//div[@class=&#34;login-btn&#34;]/a[@id=&#34;J-login&#34;]&#39;</span><span class="p">)</span>
    <span class="n">button_login</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="无窗口和规避检测">无窗口和规避检测</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="c1"># -*- encoding:UTF-8 -*-</span>

<span class="s2">&#34;&#34;&#34;
</span><span class="s2">@File     :   main.py
</span><span class="s2">@Time     :   2022/1/21 23:04
</span><span class="s2">@Author   :   张宇航
</span><span class="s2">@Contact  :   zhangzyh666@163.com
</span><span class="s2">@MyWeb    :   https://zhang666zyh.github.io
</span><span class="s2">&#34;&#34;&#34;</span>

<span class="kn">from</span> <span class="nn">selenium</span> <span class="kn">import</span> <span class="n">webdriver</span>
<span class="kn">import</span> <span class="nn">time</span>

<span class="c1"># 实现无窗口</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.chrome.options</span> <span class="kn">import</span> <span class="n">Options</span>
<span class="n">chrome_options</span> <span class="o">=</span> <span class="n">Options</span><span class="p">()</span>
<span class="n">chrome_options</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--headless&#39;</span><span class="p">)</span>
<span class="n">chrome_options</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--disable-gpu&#39;</span><span class="p">)</span>

<span class="c1"># 实现规避监测</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver</span> <span class="kn">import</span> <span class="n">ChromeOptions</span>
<span class="n">options</span> <span class="o">=</span> <span class="n">ChromeOptions</span><span class="p">()</span>
<span class="n">options</span><span class="o">.</span><span class="n">add_experimental_option</span><span class="p">(</span><span class="s1">&#39;excludeSwitches&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;enable-automation&#39;</span><span class="p">])</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="c1"># 如果只传递一个参数,参数旧版本是chrome_options,新版本使用options</span>
    <span class="n">browser</span> <span class="o">=</span> <span class="n">webdriver</span><span class="o">.</span><span class="n">Chrome</span><span class="p">(</span><span class="n">executable_path</span><span class="o">=</span><span class="s1">&#39;../chromedriver.exe&#39;</span><span class="p">,</span> <span class="n">chrome_options</span><span class="o">=</span><span class="n">chrome_options</span><span class="p">,</span> <span class="n">options</span><span class="o">=</span><span class="n">options</span><span class="p">)</span>
    <span class="n">browser</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;https://kyfw.12306.cn/otn/resources/login.html&#39;</span><span class="p">)</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">browser</span><span class="o">.</span><span class="n">quit</span><span class="p">()</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="selenium遍历元素标签例如ul下的li并获取子元素的文本内容或属性值">selenium遍历元素标签(例如ul下的li)并获取子元素的文本内容或属性值</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">selenium</span> <span class="kn">import</span> <span class="n">webdriver</span>
<span class="kn">import</span> <span class="nn">time</span>

<span class="n">d</span> <span class="o">=</span> <span class="n">webdriver</span><span class="o">.</span><span class="n">Chrome</span><span class="p">()</span>
<span class="n">d</span><span class="o">.</span><span class="n">maximize_window</span><span class="p">()</span>  <span class="c1"># 窗口最大化</span>
<span class="c1">###登录某网站</span>
<span class="n">d</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;http://xx.xxx.xx.xx:xxxx/&#39;</span><span class="p">)</span>
<span class="n">d</span><span class="o">.</span><span class="n">find_element_by_xpath</span><span class="p">(</span><span class="s1">&#39;//*[@id=&#34;userName&#34;]&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="s1">&#39;xxx&#39;</span><span class="p">)</span>
<span class="n">d</span><span class="o">.</span><span class="n">find_element_by_xpath</span><span class="p">(</span><span class="s1">&#39;//*[@id=&#34;userPwd&#34;]&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="s1">&#39;xxx&#39;</span><span class="p">)</span>
<span class="n">d</span><span class="o">.</span><span class="n">find_element_by_xpath</span><span class="p">(</span><span class="s1">&#39;//*[@id=&#34;login&#34;]&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>
<span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="c1">###切换表单，进入到操作页面</span>
<span class="n">d</span><span class="o">.</span><span class="n">find_element_by_xpath</span><span class="p">(</span><span class="s1">&#39;//*[@id=&#34;menu_ul&#34;]/li[5]/a&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>
<span class="n">d</span><span class="o">.</span><span class="n">switch_to_frame</span><span class="p">(</span><span class="s1">&#39;mainframe2&#39;</span><span class="p">)</span>
<span class="n">d</span><span class="o">.</span><span class="n">find_element_by_xpath</span><span class="p">(</span><span class="s1">&#39;//*[@id=&#34;nav-accordion&#34;]/li[2]/a&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>
<span class="n">d</span><span class="o">.</span><span class="n">switch_to_frame</span><span class="p">(</span><span class="s1">&#39;mainframe&#39;</span><span class="p">)</span>
<span class="n">d</span><span class="o">.</span><span class="n">switch_to_frame</span><span class="p">(</span><span class="s1">&#39;vehIframe&#39;</span><span class="p">)</span>
<span class="c1">###定位到要获取标签的顶级元素，并使用for循环获取</span>
<span class="n">names</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">find_elements_by_xpath</span><span class="p">(</span><span class="s1">&#39;//*[@id=&#34;vehGroupTree_1&#34;]&#39;</span><span class="p">)</span>
<span class="n">lists</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">names</span><span class="p">:</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">i</span><span class="o">.</span><span class="n">text</span>
    <span class="n">lists</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">i</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s2">&#34;href&#34;</span><span class="p">))</span>  <span class="c1"># 打印遍历标签出来的内容和获取href属性的内容</span>
<span class="k">print</span><span class="p">(</span><span class="n">lists</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">lists</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">))</span>
<span class="k">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">lists</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)))</span>  <span class="c1"># 打印列表元素数目</span>
</code></pre></td></tr></table>
</div>
</div><hr>
<h2 id="selenium获取元素内容">selenium获取元素内容</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="n">browser</span><span class="o">.</span><span class="n">find_elements_by_xpath</span><span class="p">(</span><span class="s1">&#39;xxx&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
</code></pre></td></tr></table>
</div>
</div><hr>
<h1 id="scrapy">scrapy</h1>
<h2 id="框架安装">框架安装</h2>
<h3 id="linux">Linux</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">pip3 install scrapy -i https://pypi.doubanio.com/simple/
</code></pre></td></tr></table>
</div>
</div><ul>
<li>写代码:去你妈的windows</li>
<li>赚钱:去你妈的linux</li>
</ul>
<h2 id="scrapy基本操作">scrapy基本操作</h2>
<h3 id="创建一个scrapy项目">创建一个scrapy项目</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">scrapy startproject scrapy_project_01
</code></pre></td></tr></table>
</div>
</div><h3 id="然后就生成了下面的目录">然后就生成了下面的目录</h3>
<p><img src="https://img-blog.csdnimg.cn/112797002c6749ed903ea7a77ca30917.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA5a2k5ZCNQA==,size_9,color_FFFFFF,t_70,g_se,x_16" alt="img"></p>
<h3 id="spiders是爬虫源文件也就是代码">spiders是爬虫源文件,也就是代码</h3>
<h3 id="在终端中进入spiders目录创建爬虫源文件">在终端中进入spiders目录,创建爬虫源文件</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">scrapy genspider 爬虫源文件名<span class="o">(</span>不能和项目名重复<span class="o">)</span> www.xxx.com<span class="o">(</span>可以任意指定,这个url是规定url列表中哪些url是可以进行请求的<span class="o">)</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="运行结束后spiders目录下就出现了爬虫源文件">运行结束后,spiders目录下就出现了爬虫源文件</h3>
<p><img src="https://img-blog.csdnimg.cn/7e7f82049c46425fa7f246cf27df4f4e.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA5a2k5ZCNQA==,size_15,color_FFFFFF,t_70,g_se,x_16" alt="img"></p>
<h3 id="编写爬虫源文件代码">编写爬虫源文件代码</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">scrapy</span>


<span class="k">class</span> <span class="nc">ScrapyTestSpider</span><span class="p">(</span><span class="n">scrapy</span><span class="o">.</span><span class="n">Spider</span><span class="p">):</span>
    <span class="c1"># 爬虫文件的名称:就是爬虫源文件的唯一标识</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;scrapy_test&#39;</span>

    <span class="c1"># 允许的域名, 用来限定哪些url可以被解析</span>
    <span class="c1"># 比如这里的www.xxx.com,那么下面的url列表中除了www.xxx.com之外的所有url全都无法被解析</span>
    <span class="c1"># allowed_domains = [&#39;www.xxx.com&#39;]</span>
    
    <span class="c1"># 起始的url列表,该列表中存放的url都会被scrapy框架自动请求</span>
    <span class="n">start_urls</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;http://www.baidu.com/&#39;</span><span class="p">,</span> <span class="s1">&#39;https://www.sogou.com/&#39;</span><span class="p">]</span>

    <span class="c1"># 数据解析</span>
    <span class="c1"># response就是框架对url列表进行请求的返回信息</span>
    <span class="k">def</span> <span class="nf">parse</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">response</span><span class="p">):</span>
        <span class="k">print</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="在spiders目录下启动项目">在spiders目录下启动项目</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">scrapy crawl 爬虫源文件名称
</code></pre></td></tr></table>
</div>
</div><h3 id="运行后终端就会打印吧啦巴拉一大堆日志如果想取消打印只打印response的关键信息">运行后终端就会打印吧啦巴拉一大堆日志,如果想取消打印,只打印response的关键信息</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="n">scrapy</span> <span class="n">crawl</span> <span class="err">爬虫源文件名称</span> <span class="o">--</span><span class="n">nolog</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="如果爬虫源文件代码有错误终端默认不会显示">如果爬虫源文件代码有错误,终端默认不会显示</h3>
<ul>
<li>
<p>在<code>settings.py</code>中任意位置添加这样一行代码</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="n">LOG_LEVEL</span> <span class="o">=</span> <span class="s1">&#39;ERROR&#39;</span>
</code></pre></td></tr></table>
</div>
</div></li>
</ul>
<h3 id="settingspy中有这样一行代码">settings.py中有这样一行代码</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="n">ROBOTSTXT_OBEY</span> <span class="o">=</span> <span class="bp">True</span>
</code></pre></td></tr></table>
</div>
</div><ul>
<li><code>scrapy</code>框架默认遵守<code>robot规范</code></li>
<li>但现在没几个网站是遵守<code>robot规范</code>的</li>
<li>也就是说如果框架遵守了规范,那么没有几个网站是可以爬取的</li>
<li>所以改成<code>False</code></li>
</ul>
<hr>
<h2 id="scrapy随便爬一个紫可可主页视频页面地址">scrapy随便爬一个紫可可主页视频页面地址</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">scrapy</span>

<span class="k">class</span> <span class="nc">XiushibaikeSpiderSpider</span><span class="p">(</span><span class="n">scrapy</span><span class="o">.</span><span class="n">Spider</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;xiushibaike_spider&#39;</span>
    <span class="c1"># allowed_domains = [&#39;www.xxx.com&#39;]</span>
    <span class="n">start_urls</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;http://zikeke.net/&#39;</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">parse</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">response</span><span class="p">):</span>
        <span class="c1"># response.xpath用法和etree.xpath几乎一样</span>
        <span class="n">page_list</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s1">&#39;//div[@class=&#34;index-list-l&#34;]/ul/li&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">page_a</span> <span class="ow">in</span> <span class="n">page_list</span><span class="p">:</span>
            <span class="c1"># 即使在xpath中使用了text(),返回的仍然是Selector对象,使用extract可以取Selector对象中的字符串</span>
            <span class="n">page_url</span> <span class="o">=</span> <span class="s1">&#39;http://zikeke.net/&#39;</span> <span class="o">+</span> <span class="n">page_a</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s1">&#39;./a/@href&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">extract</span><span class="p">();</span>
            <span class="k">print</span><span class="p">(</span><span class="n">page_url</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><p><code>结果</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">http://zikeke.net/acg/65072/
http://zikeke.net/acg/3736/
http://zikeke.net/acg/68544/
http://zikeke.net/acg/68190/
http://zikeke.net/acg/67207/
http://zikeke.net/acg/69829/
http://zikeke.net/acg/64807/
http://zikeke.net/acg/59089/
http://zikeke.net/acg/25455/
http://zikeke.net/tv/70231/
http://zikeke.net/tv/64884/
http://zikeke.net/tv/70094/
http://zikeke.net/tv/70230/
http://zikeke.net/tv/69966/
http://zikeke.net/tv/69982/
http://zikeke.net/tv/70250/
http://zikeke.net/tv/70013/
http://zikeke.net/tv/69943/
http://zikeke.net/mov/64499/
http://zikeke.net/mov/5849/
http://zikeke.net/mov/20095/
http://zikeke.net/mov/60266/
http://zikeke.net/mov/54880/
http://zikeke.net/mov/63776/
http://zikeke.net/mov/59743/
http://zikeke.net/mov/6548/
http://zikeke.net/mov/26677/
http://zikeke.net/zongyi/7708/
http://zikeke.net/zongyi/44915/
http://zikeke.net/zongyi/45028/
http://zikeke.net/zongyi/45451/
http://zikeke.net/zongyi/56423/
http://zikeke.net/zongyi/45824/
http://zikeke.net/zongyi/46909/
http://zikeke.net/zongyi/23388/
http://zikeke.net/zongyi/7716/
</code></pre></td></tr></table>
</div>
</div><hr>
<h2 id="持久化存储">持久化存储</h2>
<h3 id="基于终端的持久化存储">基于终端的持久化存储</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">scrapy</span>

<span class="k">class</span> <span class="nc">XiushibaikeSpiderSpider</span><span class="p">(</span><span class="n">scrapy</span><span class="o">.</span><span class="n">Spider</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;xiushibaike_spider&#39;</span>
    <span class="c1"># allowed_domains = [&#39;www.xxx.com&#39;]</span>
    <span class="n">start_urls</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;http://zikeke.net/&#39;</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">parse</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">response</span><span class="p">):</span>
        <span class="c1"># 用来存储爬取数据</span>
        <span class="n">pageToFile</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># response.xpath用法和etree.xpath几乎一样</span>
        <span class="n">page_list</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s1">&#39;//div[@class=&#34;index-list-l&#34;]/ul/li&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">page_a</span> <span class="ow">in</span> <span class="n">page_list</span><span class="p">:</span>
            <span class="c1"># 即使在xpath中使用了text(),返回的仍然是Selector对象,使用extract可以取Selector对象中的字符串</span>
            <span class="n">page_url</span> <span class="o">=</span> <span class="s1">&#39;http://zikeke.net/&#39;</span> <span class="o">+</span> <span class="n">page_a</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s1">&#39;./a/@href&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">extract</span><span class="p">();</span>
            <span class="c1"># print(page_url)</span>

            <span class="c1"># 列表参数必须是json格式,不然指令会报错</span>
            <span class="n">dic</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s1">&#39;url&#39;</span><span class="p">:</span> <span class="n">page_url</span>
            <span class="p">}</span>
            <span class="n">pageToFile</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dic</span><span class="p">)</span>
        
        <span class="c1"># 返回信息集合,在终端运行 scrapy crawl 源文件名 -o 持久化存储文件名称(文件格式仅限于&#39;json&#39;, &#39;jsonlines&#39;, &#39;jl&#39;, &#39;csv&#39;, &#39;xml&#39;, &#39;marshal&#39;, &#39;pickle&#39;)</span>
        <span class="k">return</span> <span class="n">pageToFile</span>
</code></pre></td></tr></table>
</div>
</div><p><img src="https://img-blog.csdnimg.cn/60b0192d50484b6b856886421e8bc084.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA5a2k5ZCNQA==,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"></p>
<h3 id="基于管道的持久化存储">基于管道的持久化存储</h3>
<h4 id="存储到本地文件">存储到本地文件</h4>
<ul>
<li>
<p>正常来说在爬虫源文件中爬取到了数据</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">scrapy</span>
  
<span class="k">class</span> <span class="nc">PipelineStorageSpider</span><span class="p">(</span><span class="n">scrapy</span><span class="o">.</span><span class="n">Spider</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;pipeline_storage&#39;</span>
    <span class="c1"># allowed_domains = [&#39;www.xxx.com&#39;]</span>
    <span class="n">start_urls</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;http://zikeke.net/&#39;</span><span class="p">]</span>
  
    <span class="k">def</span> <span class="nf">parse</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">response</span><span class="p">):</span>
        <span class="c1"># response.xpath用法和etree.xpath几乎一样</span>
        <span class="n">page_list</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s1">&#39;//div[@class=&#34;index-list-l&#34;]/ul/li&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">page_a</span> <span class="ow">in</span> <span class="n">page_list</span><span class="p">:</span>
            <span class="c1"># 即使在xpath中使用了text(),返回的仍然是Selector对象,使用extract可以取Selector对象中的字符串</span>
            <span class="n">page_name</span> <span class="o">=</span> <span class="n">page_a</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s1">&#39;./a/@title&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">extract</span><span class="p">();</span>
            <span class="n">page_url</span> <span class="o">=</span> <span class="s1">&#39;http://zikeke.net/&#39;</span> <span class="o">+</span> <span class="n">page_a</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s1">&#39;./a/@href&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">extract</span><span class="p">();</span>
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>现在通过scrapy的items管道进行持久化存储</p>
</li>
</ul>
<p><strong>总体流程</strong></p>
<ol>
<li>写items接口,接口内容要和你要存储的数据一一对应</li>
<li>在爬虫源文件中实现接口(其实就是将爬取到的数据赋值给接口中的变量,所谓实现)</li>
<li>pipelines.py文件接收<code>爬虫源文件运行时交给管道托管的items对象(yield items)</code>,然后对其进行处理(通过集合方式将items对象中的值取出来然后写入文件)</li>
</ol>
<h5 id="编写itemspy代码相当于写了个items管道接口">编写items.py代码,相当于写了个<code>items管道接口</code></h5>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="c1"># Define here the models for your scraped items</span>
<span class="c1">#</span>
<span class="c1"># See documentation in:</span>
<span class="c1"># https://docs.scrapy.org/en/latest/topics/items.html</span>

<span class="kn">import</span> <span class="nn">scrapy</span>


<span class="k">class</span> <span class="nc">ZikekePipelineItem</span><span class="p">(</span><span class="n">scrapy</span><span class="o">.</span><span class="n">Item</span><span class="p">):</span>
    <span class="c1"># define the fields for your item here like:</span>
    <span class="c1"># 写接口变量必须使用scrapy.Field()方法</span>
    <span class="n">page_name</span> <span class="o">=</span> <span class="n">scrapy</span><span class="o">.</span><span class="n">Field</span><span class="p">()</span>
    <span class="n">page_url</span> <span class="o">=</span> <span class="n">scrapy</span><span class="o">.</span><span class="n">Field</span><span class="p">()</span>
    <span class="c1"># pass</span>
</code></pre></td></tr></table>
</div>
</div><h5 id="在爬虫源头文件下实现接口">在爬虫源头文件下实现接口</h5>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">scrapy</span>
<span class="kn">from</span> <span class="nn">zikeke_pipeline.items</span> <span class="kn">import</span> <span class="n">ZikekePipelineItem</span>

<span class="k">class</span> <span class="nc">PipelineStorageSpider</span><span class="p">(</span><span class="n">scrapy</span><span class="o">.</span><span class="n">Spider</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;pipeline_storage&#39;</span>
    <span class="c1"># allowed_domains = [&#39;www.xxx.com&#39;]</span>
    <span class="n">start_urls</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;http://zikeke.net/&#39;</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">parse</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">response</span><span class="p">):</span>
        <span class="c1"># response.xpath用法和etree.xpath几乎一样</span>
        <span class="n">page_list</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s1">&#39;//div[@class=&#34;index-list-l&#34;]/ul/li&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">page_a</span> <span class="ow">in</span> <span class="n">page_list</span><span class="p">:</span>
            <span class="c1"># 即使在xpath中使用了text(),返回的仍然是Selector对象,使用extract可以取Selector对象中的字符串</span>
            <span class="n">page_name</span> <span class="o">=</span> <span class="n">page_a</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s1">&#39;./a/@title&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">extract</span><span class="p">();</span>
            <span class="n">page_url</span> <span class="o">=</span> <span class="s1">&#39;http://zikeke.net/&#39;</span> <span class="o">+</span> <span class="n">page_a</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s1">&#39;./a/@href&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">extract</span><span class="p">();</span>
            <span class="c1"># print(page_name + &#39;---&gt;&#39; + page_url)</span>

            <span class="c1"># --------------------------实现items管道接口------------------------------------</span>
            <span class="c1"># new一个管道类</span>
            <span class="n">item</span> <span class="o">=</span> <span class="n">ZikekePipelineItem</span><span class="p">()</span>
            <span class="c1"># 通过集合形式去赋值</span>
            <span class="n">item</span><span class="p">[</span><span class="s1">&#39;page_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">page_name</span>
            <span class="n">item</span><span class="p">[</span><span class="s1">&#39;page_url&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">page_url</span>

            <span class="c1"># 将item提交给了管道</span>
            <span class="k">yield</span> <span class="n">item</span>
</code></pre></td></tr></table>
</div>
</div><h5 id="pipelinespy就是对items对象进行处理的文件管道">pipelines.py,就是对items对象进行处理的文件(管道)</h5>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="c1"># Define your item pipelines here</span>
<span class="c1">#</span>
<span class="c1"># Don&#39;t forget to add your pipeline to the ITEM_PIPELINES setting</span>
<span class="c1"># See: https://docs.scrapy.org/en/latest/topics/item-pipeline.html</span>


<span class="c1"># useful for handling different item types with a single interface</span>
<span class="kn">from</span> <span class="nn">itemadapter</span> <span class="kn">import</span> <span class="n">ItemAdapter</span>


<span class="k">class</span> <span class="nc">ZikekePipelinePipeline</span><span class="p">:</span>
    <span class="n">fp</span> <span class="o">=</span> <span class="bp">None</span>

    <span class="k">def</span> <span class="nf">open_spider</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">spider</span><span class="p">):</span>
        <span class="k">print</span><span class="p">(</span><span class="s1">&#39;--------------------开始爬取-------------------&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fp</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;./zikeke_list.txt&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">encoding</span> <span class="o">=</span> <span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">process_item</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">,</span> <span class="n">spider</span><span class="p">):</span>
        <span class="n">page_name</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;page_name&#39;</span><span class="p">]</span>
        <span class="n">page_url</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;page_url&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fp</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">page_name</span> <span class="o">+</span> <span class="s1">&#39;---&gt;&#39;</span> <span class="o">+</span> <span class="n">page_url</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">item</span>

    <span class="k">def</span> <span class="nf">close_spider</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">spider</span><span class="p">):</span>
        <span class="k">print</span><span class="p">(</span><span class="s1">&#39;--------------------爬取结束--------------------&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fp</span><span class="o">.</span><span class="n">close</span><span class="p">()</span> 
</code></pre></td></tr></table>
</div>
</div><h5 id="在settingspy中开启scrapy管道">在settings.py中开启scrapy管道</h5>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="n">ITEM_PIPELINES</span> <span class="o">=</span> <span class="p">{</span>
   <span class="s1">&#39;zikeke_pipeline.pipelines.ZikekePipelinePipeline&#39;</span><span class="p">:</span> <span class="mi">300</span><span class="p">,</span> <span class="c1"># 数字代表优先级,数字越小代表优先级越高,管道中的类月鲜卑</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p><code>结果</code></p>
<p><code>zikeke_list.txt</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-txt" data-lang="txt">海贼王---&gt;http://zikeke.net/acg/3736/

进击的巨人 最终季 Part.2---&gt;http://zikeke.net/acg/69488/

鬼灭之刃2 游郭篇---&gt;http://zikeke.net/acg/63949/

半妖的夜叉姬第二季---&gt;http://zikeke.net/acg/25455/

勇者斗恶龙第一季 达伊的大冒险---&gt;http://zikeke.net/acg/59089/

境界触发者第三季---&gt;http://zikeke.net/acg/65072/

现实主义勇者的王国再建记第二季---&gt;http://zikeke.net/acg/68190/

失格纹的最强贤者第一季---&gt;http://zikeke.net/acg/67207/

恋上换装娃娃第一季---&gt;http://zikeke.net/acg/68544/

特战行动---&gt;http://zikeke.net/tv/70230/

舌尖上的心跳---&gt;http://zikeke.net/tv/64884/

超越2022---&gt;http://zikeke.net/tv/70094/

热血神探---&gt;http://zikeke.net/tv/69943/

赖猫的狮子倒影---&gt;http://zikeke.net/tv/69982/

啼笑书香---&gt;http://zikeke.net/tv/70013/

今生有你---&gt;http://zikeke.net/tv/70231/

勇敢的心第二部---&gt;http://zikeke.net/tv/69966/

流光之城---&gt;http://zikeke.net/tv/70250/

七原罪剧场版 被光诅咒的人们---&gt;http://zikeke.net/mov/64499/

鬼吹灯之云南虫谷电影版---&gt;http://zikeke.net/mov/5849/

心理测量者SS1-3剧场版合集---&gt;http://zikeke.net/mov/20095/

金刚川---&gt;http://zikeke.net/mov/60266/

妄想学生会2 剧场版---&gt;http://zikeke.net/mov/54880/

怒火·重案---&gt;http://zikeke.net/mov/63776/

银魂剧场版：THE FINAL---&gt;http://zikeke.net/mov/59743/

新福音战士剧场版：终---&gt;http://zikeke.net/mov/6548/

鬼灭之刃剧场版：无限列车篇---&gt;http://zikeke.net/mov/26677/

非诚勿扰---&gt;http://zikeke.net/zongyi/7708/

横冲直撞20岁第一季---&gt;http://zikeke.net/zongyi/44915/

王牌对王牌第四季---&gt;http://zikeke.net/zongyi/45028/

妻子的旅行日记---&gt;http://zikeke.net/zongyi/45451/

青春环游记第二季---&gt;http://zikeke.net/zongyi/56423/

密室大逃脱---&gt;http://zikeke.net/zongyi/45824/

明日之子第三季---&gt;http://zikeke.net/zongyi/46909/

奔跑吧第二季---&gt;http://zikeke.net/zongyi/23388/

快乐大本营---&gt;http://zikeke.net/zongyi/7716/

</code></pre></td></tr></table>
</div>
</div><h4 id="存储到mongodb">存储到MongoDB</h4>
<ul>
<li>
<p>使用python连接MongoDB,需要下载pymongo库</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">pip3 install pymongo -i https://pypi.douban.com/simple/
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>基于上面的</p>
<p><code>piplines.py</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="c1"># Define your item pipelines here</span>
<span class="c1">#</span>
<span class="c1"># Don&#39;t forget to add your pipeline to the ITEM_PIPELINES setting</span>
<span class="c1"># See: https://docs.scrapy.org/en/latest/topics/item-pipeline.html</span>
  
  
<span class="c1"># useful for handling different item types with a single interface</span>
<span class="kn">import</span> <span class="nn">pymongo</span>
<span class="kn">from</span> <span class="nn">zikeke_pipeline</span> <span class="kn">import</span> <span class="n">settings</span>
  
  
<span class="k">class</span> <span class="nc">ZikekePipelinePipeline</span><span class="p">:</span>
    <span class="n">fp</span> <span class="o">=</span> <span class="bp">None</span>
  
    <span class="k">def</span> <span class="nf">open_spider</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">spider</span><span class="p">):</span>
        <span class="k">print</span><span class="p">(</span><span class="s1">&#39;--------------------开始爬取-------------------&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fp</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;./zikeke_list.txt&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
  
    <span class="k">def</span> <span class="nf">process_item</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">,</span> <span class="n">spider</span><span class="p">):</span>
        <span class="n">page_name</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;page_name&#39;</span><span class="p">]</span>
        <span class="n">page_url</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;page_url&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fp</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">page_name</span> <span class="o">+</span> <span class="s1">&#39;---&gt;&#39;</span> <span class="o">+</span> <span class="n">page_url</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n\n</span><span class="s1">&#39;</span><span class="p">)</span>
  
        <span class="c1"># 可以不返回,因为这里是框架运行的终点了</span>
        <span class="c1"># 如果管道中有多个实体类,那么上一个优先级高的类返回的item将作为它下一个优先级比较低的实体类中的item</span>
        <span class="k">return</span> <span class="n">item</span>
  
    <span class="k">def</span> <span class="nf">close_spider</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">spider</span><span class="p">):</span>
        <span class="k">print</span><span class="p">(</span><span class="s1">&#39;--------------------爬取结束--------------------&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fp</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
  
  
<span class="k">class</span> <span class="nc">mongoPipeline</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">open_spider</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">spider</span><span class="p">):</span>
        <span class="c1"># pymongo.MongoClient方法只需要端口和ip</span>
        <span class="n">host</span> <span class="o">=</span> <span class="n">spider</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;MONGO_HOST&#39;</span><span class="p">,</span> <span class="s1">&#39;127.0.0.1&#39;</span><span class="p">)</span>
        <span class="n">port</span> <span class="o">=</span> <span class="n">spider</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;MONGO_PORT&#39;</span><span class="p">,</span> <span class="s1">&#39;27017&#39;</span><span class="p">)</span>
        <span class="n">db</span> <span class="o">=</span> <span class="n">spider</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;MONGO_DB&#39;</span><span class="p">,</span> <span class="s1">&#39;zhangyuhangDb&#39;</span><span class="p">)</span>
        <span class="n">collection</span> <span class="o">=</span> <span class="n">spider</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;MONGO_COLL&#39;</span><span class="p">,</span> <span class="s1">&#39;students&#39;</span><span class="p">)</span>
  
        <span class="c1"># 通过ip和端口获取一个mongodb的连接对象</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span> <span class="o">=</span> <span class="n">pymongo</span><span class="o">.</span><span class="n">MongoClient</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="n">host</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="n">port</span><span class="p">)</span>
        <span class="c1"># 通过连接对象访问指定名称的数据库,返回一个数据库对象</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">db</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="p">[</span><span class="n">db</span><span class="p">]</span>
        <span class="c1"># 通过数据库对象访问当前数据库下指定名称的collection,返回一个collection对象</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">collection</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="p">[</span><span class="n">collection</span><span class="p">]</span>
  
    <span class="k">def</span> <span class="nf">process_item</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">,</span> <span class="n">spider</span><span class="p">):</span>
        <span class="c1"># 将上一个优先级较高的类返回的item转换成字典格式(mongodb就是经典的JSON和字典嘛)</span>
        <span class="n">item_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
        <span class="c1"># 通过collection对象向数据库插入数据</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">collection</span><span class="o">.</span><span class="n">insert_one</span><span class="p">(</span><span class="n">item_dict</span><span class="p">)</span>
        <span class="c1"># 返回item,虽然下面没有管道类了,但是好习惯</span>
        <span class="k">return</span> <span class="n">item</span>
  
    <span class="k">def</span> <span class="nf">close_spider</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">spider</span><span class="p">):</span>
        <span class="c1"># 关闭连接</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
  
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>在settings.py中</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="n">ITEM_PIPELINES</span> <span class="o">=</span> <span class="p">{</span>
   <span class="s1">&#39;zikeke_pipeline.pipelines.ZikekePipelinePipeline&#39;</span><span class="p">:</span> <span class="mi">300</span><span class="p">,</span>
   <span class="s1">&#39;zikeke_pipeline.pipelines.mongoPipeline&#39;</span><span class="p">:</span> <span class="mi">301</span><span class="p">,</span> <span class="c1"># 将pipeline中用于连接MongoDB的实体类在管道中注册</span>
<span class="p">}</span>
  
<span class="c1"># MongoDB</span>
<span class="n">MONGO_HOST</span> <span class="o">=</span> <span class="s2">&#34;127.0.0.1&#34;</span>  <span class="c1"># 主机IP</span>
<span class="n">MONGO_PORT</span> <span class="o">=</span> <span class="mi">27017</span>  <span class="c1"># 端口号</span>
<span class="n">MONGO_DB</span> <span class="o">=</span> <span class="s2">&#34;zhangyuhangDb&#34;</span>  <span class="c1"># 库名</span>
<span class="n">MONGO_COLL</span> <span class="o">=</span> <span class="s2">&#34;students&#34;</span>  <span class="c1"># collection名</span>
<span class="n">MONGO_USER</span> <span class="o">=</span> <span class="s2">&#34;rooot&#34;</span> <span class="c1">#用户名</span>
<span class="n">MONGO_PSW</span> <span class="o">=</span> <span class="s2">&#34;123456&#34;</span> <span class="c1">#用户密码</span>
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>最后别忘了开启MongoDB服务</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">sudo service start mongod
</code></pre></td></tr></table>
</div>
</div><p><img src="https://img-blog.csdnimg.cn/371155dd3a734b2dba9a8339ff570779.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA5a2k5ZCNQA==,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"></p>
</li>
</ul>
<h2 id="全站爬取彼岸图网的4k壁纸图片">全站爬取(彼岸图网的4K壁纸图片)</h2>
<ul>
<li>
<p>爬全站数据需要请求多个url,通过回调函数可以实现</p>
</li>
<li>
<p>这里还是爬彼岸图网的4K壁纸图片</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">scrapy</span>
<span class="kn">from</span> <span class="nn">lxml</span> <span class="kn">import</span> <span class="n">etree</span>
<span class="kn">import</span> <span class="nn">requests</span>
  
  
<span class="k">class</span> <span class="nc">BiantuwangSpider</span><span class="p">(</span><span class="n">scrapy</span><span class="o">.</span><span class="n">Spider</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;biantuwang&#39;</span>
    <span class="n">allowed_domains</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;www.xxx.com&#39;</span><span class="p">]</span>
    <span class="n">start_urls</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;https://pic.netbian.com/4kdongman/&#39;</span><span class="p">]</span>
  
    <span class="n">url</span> <span class="o">=</span> <span class="s1">&#39;https://pic.netbian.com/4kdongman/index_</span><span class="si">%d</span><span class="s1">.html&#39;</span>
    <span class="n">page_num</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">page</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s1">&#39;请输入想要爬取的页数:&#39;</span><span class="p">)</span>
      
  
    <span class="k">def</span> <span class="nf">parse</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">response</span><span class="p">):</span>
        <span class="n">li_list</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s1">&#39;//div[@class=&#34;slist&#34;]/ul/li&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">li_list</span><span class="p">:</span>
            <span class="n">page_url</span> <span class="o">=</span> <span class="s1">&#39;https://pic.netbian.com&#39;</span> <span class="o">+</span> <span class="n">a</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s1">&#39;./a/@href&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">extract</span><span class="p">()</span>
            <span class="n">img_name</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s1">&#39;./a/img/@alt&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">extract</span><span class="p">()</span>
            <span class="c1"># print(page_url + &#39;---&gt;&#39; + img_name)</span>
            <span class="c1"># self.fp.write(&#39;[&#39; + img_name + &#39;]&#39; + &#39;(&#39; + page_url + &#39;)&#39; + &#39;\n&#39;)</span>
  
            <span class="c1"># 这里无法进行二次回调,那就重新写一个基于xpath的函数</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">downloadImage</span><span class="p">(</span><span class="n">page_url</span><span class="p">,</span> <span class="n">img_name</span><span class="p">)</span>
          
        <span class="c1"># 进行后几页的爬取,通过回调函数重新请求新的url</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">page_num</span> <span class="o">&lt;=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">page</span><span class="p">):</span>
            <span class="n">new_url</span> <span class="o">=</span> <span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">url</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">page_num</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">page_num</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">page_num</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="c1"># 参数:</span>
                <span class="c1">#   要请求的url</span>
                <span class="c1">#   回调函数</span>
                <span class="c1">#   过滤器(没有这个会无法使用回调函数)</span>
            <span class="k">yield</span> <span class="n">scrapy</span><span class="o">.</span><span class="n">Request</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">new_url</span><span class="p">,</span><span class="n">callback</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">parse</span><span class="p">,</span><span class="n">dont_filter</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
          
    <span class="k">def</span> <span class="nf">downloadImage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">page_url</span><span class="p">,</span> <span class="n">img_name</span><span class="p">):</span>
        <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;User-Agent&#39;</span><span class="p">:</span><span class="s1">&#39;Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/94.0.4606.71 Safari/537.36&#39;</span>
        <span class="p">}</span>
        <span class="n">tree</span> <span class="o">=</span> <span class="n">etree</span><span class="o">.</span><span class="n">HTML</span><span class="p">(</span><span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">page_url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
        <span class="n">img_src</span> <span class="o">=</span> <span class="s1">&#39;https://pic.netbian.com&#39;</span> <span class="o">+</span> <span class="n">tree</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s1">&#39;//div[@class=&#34;photo-pic&#34;]/a/img/@src&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">img_response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">img_src</span><span class="p">,</span><span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span><span class="o">.</span><span class="n">content</span>
        <span class="n">img_name</span> <span class="o">=</span> <span class="n">img_name</span> <span class="o">+</span> <span class="s1">&#39;.jpg&#39;</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">img_name</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
            <span class="n">fp</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">img_response</span><span class="p">)</span>
            <span class="k">print</span><span class="p">(</span><span class="n">img_name</span> <span class="o">+</span> <span class="s1">&#39;下载成功&#39;</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div></li>
</ul>
<hr>
<h2 id="scrapy框架设计模式">scrapy框架设计模式</h2>
<p><img src="https://img-blog.csdnimg.cn/ae66440586f740f8b13feb917a91bbf7.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA5a2k5ZCNQA==,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"></p>
<p><img src="https://img-blog.csdnimg.cn/c4ef426b83f244c59181f63857ea0b50.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA5a2k5ZCNQA==,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"></p>
<h2 id="请求传参">请求传参</h2>
<ul>
<li>
<p>这里爬boss职聘的岗位信息</p>
</li>
<li>
<p>发现空的,你这不扯犊子呢马</p>
</li>
<li>
<p>只能用selenium了</p>
</li>
<li>
<p>还是爬豆瓣吧</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">scrapy</span>
<span class="kn">from</span> <span class="nn">bosszhipin.items</span> <span class="kn">import</span> <span class="n">BosszhipinItem</span>
<span class="kn">import</span> <span class="nn">json</span>
  
  
<span class="k">class</span> <span class="nc">BossZhipinSpider</span><span class="p">(</span><span class="n">scrapy</span><span class="o">.</span><span class="n">Spider</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;boss_zhipin&#39;</span>
    <span class="c1"># allowed_domains = [&#39;www.xxx.com&#39;]</span>
    <span class="n">start_urls</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;https://movie.douban.com/j/new_search_subjects?sort=U&amp;range=0,10&amp;tags=&amp;start=10&amp;genres=喜剧&#39;</span><span class="p">]</span>
  
    <span class="c1"># 回调函数</span>
    <span class="k">def</span> <span class="nf">parse_yield</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">response</span><span class="p">):</span>
        <span class="c1"># 在这里将parse中回调时传递的meta中的item取出来</span>
        <span class="n">item</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">meta</span><span class="p">[</span><span class="s1">&#39;item&#39;</span><span class="p">]</span>
  
        <span class="n">video_info</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s1">&#39;//span[@property=&#34;v:summary&#34;]/text()&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">extract</span><span class="p">()</span>
        <span class="n">video_info</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">video_info</span><span class="p">)</span>
  
        <span class="n">item</span><span class="p">[</span><span class="s1">&#39;video_info&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">video_info</span>
        <span class="c1"># 爬虫结束,走管道</span>
        <span class="k">yield</span> <span class="n">item</span>
  
  
    <span class="c1"># 默认调用parse函数,将starturls中的url 请求后的响应体response 作为函数参数</span>
    <span class="k">def</span> <span class="nf">parse</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">response</span><span class="p">):</span>
        <span class="c1"># 当response是json时,可以使用这种方法解析</span>
        <span class="n">page_list</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">)[</span><span class="s1">&#39;data&#39;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">page_a</span> <span class="ow">in</span> <span class="n">page_list</span><span class="p">:</span>
            <span class="n">page_url</span> <span class="o">=</span> <span class="n">page_a</span><span class="p">[</span><span class="s1">&#39;url&#39;</span><span class="p">]</span>
            <span class="n">video_name</span> <span class="o">=</span> <span class="n">page_a</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]</span>
  
  
            <span class="c1"># print(page_url + &#39;\t---&gt;\t&#39; + video_name + &#39;\n&#39;)</span>
            <span class="n">item</span> <span class="o">=</span> <span class="n">BosszhipinItem</span><span class="p">()</span>
            <span class="n">item</span><span class="p">[</span><span class="s1">&#39;page_url&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">page_url</span>
            <span class="n">item</span><span class="p">[</span><span class="s1">&#39;video_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">video_name</span>
  
            <span class="c1"># 当需要再次请求url时,需要独立编写回调函数,并将回调函数名作为parse函数的参数,实现调用</span>
            <span class="c1"># 参数:想要请求的url, 回调函数, 传递item(将item封装成json格式,参数名为meta)</span>
            <span class="k">yield</span> <span class="n">scrapy</span><span class="o">.</span><span class="n">Request</span><span class="p">(</span><span class="n">page_url</span><span class="p">,</span> <span class="n">callback</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">parse_yield</span><span class="p">,</span> <span class="n">meta</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;item&#39;</span><span class="p">:</span> <span class="n">item</span><span class="p">})</span>
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>爬次数多了还要求登录&hellip;</p>
</li>
</ul>
<h2 id="中间件">中间件</h2>
<ul>
<li>
<p>爬虫中间件</p>
<blockquote>
<p>位于spider和引擎之间</p>
</blockquote>
</li>
<li>
<p>下载中间件</p>
<blockquote>
<p>位于引擎和下载器之间</p>
</blockquote>
<p><code>作用</code></p>
<blockquote>
<p>批量拦截整个工程中所有请求和响应(因为整个工程中所有request和response都是通过下载中间件从引擎到下载器的)</p>
<ul>
<li>
<p>拦截请求</p>
<blockquote>
<p>UA伪装(UserAgent)</p>
<p>代理IP(当访问次数过多,IP被服务器ban掉时)</p>
</blockquote>
</li>
<li>
<p>拦截响应</p>
<blockquote>
<p>篡改响应数据,响应对象</p>
</blockquote>
</li>
</ul>
</blockquote>
</li>
</ul>
<hr>
<h1 id="反爬机制">反爬机制</h1>
<h2 id="css反爬">css反爬</h2>
<ul>
<li>
<p>原理</p>
<blockquote>
<p>利用css将需要防爬的数据,不直接写入到标签中</p>
<p>而是使用after标签,通过content显示数据</p>
<p>这样再爬取到页面的时候,就无法轻易爬取到数据</p>
</blockquote>
<blockquote>
<p>而且还可以加上一些干扰标签</p>
<p>里面写上一些骂人的信息</p>
<p>将它们的margin设置为负值</p>
<p>宽度或高度设置为小于0</p>
<p>以脱离页面</p>
</blockquote>
</li>
<li>
<p>主页面</p>
</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html"><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="p">&lt;</span><span class="nt">html</span> <span class="na">lang</span><span class="o">=</span><span class="s">&#34;en&#34;</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">charset</span><span class="o">=</span><span class="s">&#34;UTF-8&#34;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">link</span> <span class="na">rel</span><span class="o">=</span><span class="s">&#34;stylesheet&#34;</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;../css/index.css&#34;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>AntiClimb<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>智星科技<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>姓名<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;ABCD&#34;</span><span class="p">&gt;</span>傻逼,操!!!<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;ABCD&#34;</span><span class="p">&gt;</span>别搞我啊!!!<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;ABCD&#34;</span><span class="p">&gt;</span>不要爬了!!!<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;EFG&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</code></pre></td></tr></table>
</div>
</div><ul>
<li>css页面</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-css" data-lang="css"><span class="c">/*
</span><span class="c">    将ABCD脱离页面
</span><span class="c">    高度为0
</span><span class="c">*/</span>
<span class="p">.</span><span class="nc">ABCD</span><span class="p">{</span>
    <span class="k">margin-left</span><span class="p">:</span> <span class="mi">-10</span><span class="kt">em</span><span class="p">;</span>
    <span class="k">height</span><span class="p">:</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="c">/*
</span><span class="c">    实际信息存储在EFG里
</span><span class="c">*/</span>
<span class="p">.</span><span class="nc">EFG</span><span class="p">{</span>

<span class="p">}</span>

<span class="p">.</span><span class="nc">EFG</span><span class="p">::</span><span class="nd">after</span><span class="p">{</span>
    <span class="k">content</span><span class="p">:</span> <span class="s1">&#39;智星&#39;</span><span class="p">;</span>
<span class="p">}</span>

<span class="c">/*
</span><span class="c">    当最简单的爬虫爬到网页时
</span><span class="c">    由于页面中的EFG中是没有数据的,是通过after赋值
</span><span class="c">    所以爬虫只能爬到ABCD,其他的爬不到
</span><span class="c">*/</span>
</code></pre></td></tr></table>
</div>
</div><hr>
<h2 id="数字加密反爬">数字加密反爬</h2>
<ul>
<li>
<p>导入字体,通过使用字体显示数字而不是直接将数字写入到标签</p>
</li>
<li>
<p>这样爬虫获取到的都是字体内容而不是直接的数字</p>
</li>
<li>
<p>下载苹果字体(其实其他字体都一样)</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">https://github.com/zongren/font/raw/master/PingFang-SC-Regular.ttf
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>使用fonttools提取数字</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">pip install fonttools
</code></pre></td></tr></table>
</div>
</div><ul>
<li>
<p>使用如下命令提取数字</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">pyftsubset /home/shuaib/Desktop/PingFang-SC-Regular.ttf --text<span class="o">=</span><span class="s2">&#34;1234567890&#34;</span> --output-file<span class="o">=</span><span class="s2">&#34;PingFang-Num.tty&#34;</span>
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>这里的/home/shuaib/Desktop/PingFang-SC-Regular.ttf是你下载的字体文件路径</p>
<p>&ndash;text=&quot;1234567890&quot;是你要提取的内容</p>
<p>&ndash;output-file=&quot;PingFang-Num.tty&quot;定义你提取后的字体文件</p>
</li>
<li>
<p>运行之后你在该路径下,就会生成一个新的字体文件了</p>
</li>
</ul>
</li>
<li>
<p>以下这个网站可以对字体加密</p>
<p><a href="http://fontello.com/">http://fontello.com/</a></p>
</li>
<li>
<p>不过这个网站仅支持 svg 格式的</p>
</li>
<li>
<p>所以我们可以把 ttf 转化成 svg 格式</p>
<p><a href="https://convertio.co/zh/ttf-svg/">ttf转svg网站</a></p>
</li>
<li>
<p>下载下来之后,再回到 fontello,把 svg 拖进去</p>
</li>
<li>
<p>点击Custom Icons中要加密的数字</p>
</li>
<li>
<p>然后点击,Customize Codes</p>
</li>
<li>
<p>这时候就可以对字加密啦,接着点击右上角,下载加密后的字体文件</p>
</li>
<li>
<p>将下载好的字体文件全部拖入项目</p>
</li>
<li>
<p>在你的css文件中创建字体</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-css" data-lang="css"><span class="c">/* 创建字体 */</span>
<span class="p">@</span><span class="k">font-face</span><span class="p">{</span>
    <span class="nt">font-family</span><span class="o">:</span><span class="s1">&#39;zhixing&#39;</span><span class="o">;</span>
    <span class="c">/* 将解压后的目录中font下的文件全部引入 */</span>
    <span class="nt">src</span><span class="o">:</span> <span class="nt">url</span><span class="o">(</span><span class="s2">&#34;../font/zhixing/font/fontello.eot?50581157&#34;</span><span class="o">);</span>
    <span class="nt">src</span><span class="o">:</span> <span class="nt">url</span><span class="o">(</span><span class="s2">&#34;../font/zhixing/font/fontello.eot?50581157#iefix&#34;</span><span class="o">)</span> <span class="nt">format</span><span class="o">(</span><span class="s1">&#39;embedded-opentype&#39;</span><span class="o">),</span>
    <span class="nt">url</span><span class="o">(</span><span class="s2">&#34;../font/zhixing/font/fontello.woff?50581157&#34;</span><span class="o">)</span> <span class="nt">format</span><span class="o">(</span><span class="s1">&#39;woff&#39;</span><span class="o">),</span>
    <span class="nt">url</span><span class="o">(</span><span class="s2">&#34;../font/zhixing/font/fontello.ttf?50581157&#34;</span><span class="o">)</span> <span class="nt">format</span><span class="o">(</span><span class="s1">&#39;truetype&#39;</span><span class="o">),</span>
    <span class="nt">url</span><span class="o">(</span><span class="s2">&#34;../font/zhixing/font/fontello.svg?50581157#fontello&#34;</span><span class="o">)</span> <span class="nt">format</span><span class="o">(</span><span class="s1">&#39;svg&#39;</span><span class="o">);</span>
    <span class="nt">font-weight</span><span class="p">:</span><span class="nd">normal</span><span class="o">;</span>
    <span class="nt">font-style</span><span class="o">:</span> <span class="nt">normal</span><span class="o">;</span>
<span class="p">}</span>
  
<span class="c">/* 使用字体 */</span>
<span class="p">.</span><span class="nc">zhixing</span><span class="p">{</span>
    <span class="k">font-family</span><span class="p">:</span> <span class="s2">&#34;zhixing&#34;</span><span class="p">,</span> <span class="kc">serif</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>demo中给出了示例</p>
</li>
<li>
<p>按照demo.html中使用html的方法使用数字</p>
<p><code>index.html</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html"><span class="cp">&lt;!doctype html&gt;</span>
<span class="p">&lt;</span><span class="nt">html</span> <span class="na">lang</span><span class="o">=</span><span class="s">&#34;en&#34;</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">charset</span><span class="o">=</span><span class="s">&#34;UTF-8&#34;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">name</span><span class="o">=</span><span class="s">&#34;viewport&#34;</span>
          <span class="na">content</span><span class="o">=</span><span class="s">&#34;width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0&#34;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">http-equiv</span><span class="o">=</span><span class="s">&#34;X-UA-Compatible&#34;</span> <span class="na">content</span><span class="o">=</span><span class="s">&#34;ie=edge&#34;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">link</span> <span class="na">rel</span><span class="o">=</span><span class="s">&#34;stylesheet&#34;</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;../css/index.css&#34;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>digitalEncryption<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;zhixing&#34;</span><span class="p">&gt;</span><span class="ni">&amp;#xe801;</span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</code></pre></td></tr></table>
</div>
</div></li>
</ul>
<h2 id="动态生成静态页面">动态生成静态页面</h2>
<ul>
<li>就是说只需要一个接口</li>
<li>不使用vue react等方式实现动态加载页面资源</li>
<li>而是当前台请求后台时,后台直接使用类似jsp的方式生成静态html文件</li>
<li>虽然这样还是可以获取到图片等资源</li>
<li>但是相比vue这种,可以直接获取到json数据集的全部数据这种方式,似乎要好很多</li>
</ul>
<hr>
<h1 id="代理ip">代理IP</h1>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">requests</span>

<span class="n">url</span> <span class="o">=</span> <span class="s1">&#39;https://www.jd.com/&#39;</span>

<span class="n">proxies</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">{</span>
        <span class="s1">&#39;http&#39;</span><span class="p">:</span> <span class="s1">&#39;http://121.232.148.167:9000&#39;</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="s1">&#39;http&#39;</span><span class="p">:</span> <span class="s1">&#39;http://39.105.28.28:8118&#39;</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="s1">&#39;http&#39;</span><span class="p">:</span> <span class="s1">&#39;http://113.195.18.133:9999&#39;</span>
    <span class="p">}</span>
<span class="p">]</span>

<span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">proxies</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span> <span class="n">proxies</span><span class="o">=</span><span class="n">item</span><span class="p">)</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s1">&#39;代理失败!!!&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s1">&#39;代理成功!!!&#39;</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><h1 id="综合项目">综合项目</h1>
<h2 id="使用ajax--selenium爬取战恋雪小说">使用ajax + selenium爬取<code>战恋雪</code>小说</h2>
<ul>
<li>
<p>问题</p>
<blockquote>
<p>使用xpath爬结果为空 &mdash;&gt; 动态selenium</p>
<p>分页总url不变 &mdash;&gt; ajax</p>
</blockquote>
</li>
<li>
<p>果不其然,查看ajax</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">https://xifan.org/e/extend/bookpage/pages.php
  
id: <span class="m">1231</span>
pageNum: <span class="m">0</span>
dz: asc
</code></pre></td></tr></table>
</div>
</div></li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="c1"># -*- encoding:UTF-8 -*-</span>

<span class="s2">&#34;&#34;&#34;
</span><span class="s2">@File     :   request_test.py
</span><span class="s2">@Time     :   2022/1/13 17:20
</span><span class="s2">@Author   :   张宇航
</span><span class="s2">@Contact  :   zhangzyh666@163.com
</span><span class="s2">@MyWeb    :   https://zhang666zyh.github.io
</span><span class="s2">&#34;&#34;&#34;</span>
<span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">from</span> <span class="nn">selenium</span> <span class="kn">import</span> <span class="n">webdriver</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.common.by</span> <span class="kn">import</span> <span class="n">By</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">url</span> <span class="o">=</span> <span class="s2">&#34;https://xifan.org/e/extend/bookpage/pages.php?id=1231&amp;pageNum=0&amp;dz=asc&#34;</span>

    <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;User-Agent&#39;</span><span class="p">:</span> <span class="s1">&#39;Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/96.0.4664.45 Safari/537.36&#39;</span>
    <span class="p">}</span>

    <span class="n">browser</span> <span class="o">=</span> <span class="n">webdriver</span><span class="o">.</span><span class="n">Chrome</span><span class="p">(</span><span class="n">executable_path</span><span class="o">=</span><span class="s1">&#39;F:</span><span class="se">\\</span><span class="s1">Code</span><span class="se">\\</span><span class="s1">WriteCodes</span><span class="se">\\</span><span class="s1">Python</span><span class="se">\\</span><span class="s1">PythonProject</span><span class="se">\\</span><span class="s1">WebClower</span><span class="se">\\</span><span class="s1">selenium_windows</span><span class="se">\\</span><span class="s1">chromedriver.exe&#39;</span><span class="p">)</span>

    <span class="n">page_title</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">page_url</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">9</span><span class="p">):</span>
        <span class="n">url</span> <span class="o">=</span> <span class="s1">&#39;https://xifan.org/e/extend/bookpage/pages.php?id=1231&amp;pageNum=&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;&amp;dz=asc&#39;</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">response</span><span class="p">[</span><span class="s1">&#39;list&#39;</span><span class="p">])):</span>
            <span class="c1"># print((response[&#39;list&#39;][j])[&#39;pic&#39;])</span>
            <span class="n">page_title</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">response</span><span class="p">[</span><span class="s1">&#39;list&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="s1">&#39;title&#39;</span><span class="p">]))</span>
            <span class="n">page_url</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">response</span><span class="p">[</span><span class="s1">&#39;list&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">])[</span><span class="s1">&#39;pic&#39;</span><span class="p">])</span>

    <span class="n">fp</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;./战恋雪.txt&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
    <span class="n">page</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">url</span> <span class="ow">in</span> <span class="n">page_url</span><span class="p">:</span>
        <span class="n">browser</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
        <span class="n">p_list</span> <span class="o">=</span> <span class="n">browser</span><span class="o">.</span><span class="n">find_elements</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="s1">&#39;//div[@class=&#34;read_page_con&#34;]&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">p_list</span><span class="p">:</span>
            <span class="n">fp</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">page_title</span><span class="p">[</span><span class="n">page</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="n">p</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
        <span class="n">fp</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">page</span> <span class="o">=</span> <span class="n">page</span> <span class="o">+</span> <span class="mi">1</span>
</code></pre></td></tr></table>
</div>
</div><hr>
<h1 id="api汇总">API汇总</h1>
<h2 id="网易云">网易云</h2>
<p><a href="https://neteasecloudmusicapi.vercel.app/#/">网易云API接口</a></p>
<h1 id="爬虫工具">爬虫工具</h1>
<h2 id="fiddler">Fiddler</h2>
<p><a href="https://www.telerik.com/download/fiddler">Fiddler官网</a></p>
<ul>
<li>
<p>安装后,按下F12,浏览器网络请求就会被自动拦截</p>
</li>
<li>
<p>默认无法拦截<code>https</code>请求</p>
</li>
<li>
<p><code>Tools-&gt;Options</code></p>
</li>
<li>
<p><code>HTTPS</code></p>
<blockquote>
<p>勾选</p>
<p>Decrypt HTTPS traffic</p>
<p>Ignore server certificate errors(unsafe)</p>
</blockquote>
</li>
<li>
<p>勾选完之后,点击<code>actions</code>按钮</p>
</li>
<li>
<p>选择<code>Reset All Certificates</code></p>
</li>
<li>
<p>就会弹出一系列提示框,让你<code>下载安全证书</code></p>
</li>
<li>
<p>一路确定就好了</p>
</li>
<li>
<p>然后现在就可以拦截https请求了</p>
</li>
</ul>
<hr>
<h1 id="验证码识别库">验证码识别库</h1>
<ul>
<li>
<p>ddddocr</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">ddddocr</span>
  
<span class="n">ocr</span> <span class="o">=</span> <span class="n">ddddocr</span><span class="o">.</span><span class="n">DdddOcr</span><span class="p">()</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&#34;img.png&#34;</span><span class="p">,</span> <span class="s2">&#34;rb&#34;</span><span class="p">)</span> <span class="k">as</span> <span class="n">rs</span><span class="p">:</span>
    <span class="n">img_bytes</span> <span class="o">=</span> <span class="n">rs</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
<span class="n">res</span> <span class="o">=</span> <span class="n">ocr</span><span class="o">.</span><span class="n">classification</span><span class="p">(</span><span class="n">img_bytes</span><span class="p">)</span>
  
<span class="k">print</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div></li>
</ul>
<hr>
<h1 id="项目">项目</h1>
<h2 id="哔哩哔哩视频下载">哔哩哔哩视频下载</h2>
<h3 id="代码实现">代码实现</h3>
<ul>
<li>
<p>写标头</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="n">url</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s1">&#39;请输入视频地址: =&gt; </span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
  
<span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;accept&#39;</span><span class="p">:</span> <span class="s1">&#39;text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9&#39;</span><span class="p">,</span>
    <span class="s1">&#39;accept-encoding&#39;</span><span class="p">:</span> <span class="s1">&#39;gzip, deflate, br&#39;</span><span class="p">,</span>
    <span class="s1">&#39;accept-language&#39;</span><span class="p">:</span> <span class="s1">&#39;zh-CN,zh;q=0.9,en;q=0.8,en-GB;q=0.7,en-US;q=0.6&#39;</span><span class="p">,</span>
    <span class="s1">&#39;cache-control&#39;</span><span class="p">:</span> <span class="s1">&#39;max-age=0&#39;</span><span class="p">,</span>
    <span class="s1">&#39;cookie&#39;</span><span class="p">:</span> <span class="s1">&#39;buvid3=9DE01BA9-E87B-1194-C85F-F241149734BF58511infoc; i-wanna-go-back=-1; _uuid=DF7C4B52-36C5-FC26-EBE8-910647E103D31B61545infoc; buvid4=A78768E2-797C-1AC4-DF23-C5E1DC71571365124-022020319-2vCYpzLJWV1kBzTjXwl+sA%3D%3D; sid=iujoueek; buvid_fp_plain=undefined; DedeUserID=110923378; DedeUserID__ckMd5=041e9a4465d6d178; b_ut=5; LIVE_BUVID=AUTO5716438896840626; blackside_state=0; rpdid=|(RllR|)Yku0J</span><span class="se">\&#39;</span><span class="s1">uYRR|)k)~u; CURRENT_QUALITY=80; fingerprint=e3e751e162ccb4825a12770366b981cd; buvid_fp=e3e751e162ccb4825a12770366b981cd; SESSDATA=34cb81b1%2C1660309139%2C5738f*21; bili_jct=a62ae579874253a08533c05f09a45ef1; bp_t_offset_110923378=632657362903105577; PVID=1; b_lsid=E2B1EEF4_17F4BAA4EF1; bsource=search_bing; innersign=1; bp_video_offset_110923378=633066931003326500; CURRENT_FNVAL=80; CURRENT_BLACKGAP=0&#39;</span><span class="p">,</span>
    <span class="s1">&#39;referer&#39;</span><span class="p">:</span> <span class="s1">&#39;https://www.bilibili.com/movie/?spm_id_from=333.1007.0.0&#39;</span><span class="p">,</span>
    <span class="s1">&#39;sec-ch-ua&#39;</span><span class="p">:</span> <span class="s1">&#39;&#34; Not A;Brand&#34;;v=&#34;99&#34;, &#34;Chromium&#34;;v=&#34;98&#34;, &#34;Microsoft Edge&#34;;v=&#34;98&#34;&#39;</span><span class="p">,</span>
    <span class="s1">&#39;sec-ch-ua-mobile&#39;</span><span class="p">:</span> <span class="s1">&#39;?0&#39;</span><span class="p">,</span>
    <span class="s1">&#39;sec-ch-ua-platform&#39;</span><span class="p">:</span> <span class="s1">&#39;&#34;Windows&#34;&#39;</span><span class="p">,</span>
    <span class="s1">&#39;sec-fetch-dest&#39;</span><span class="p">:</span> <span class="s1">&#39;document&#39;</span><span class="p">,</span>
    <span class="s1">&#39;sec-fetch-mode&#39;</span><span class="p">:</span> <span class="s1">&#39;navigate&#39;</span><span class="p">,</span>
    <span class="s1">&#39;sec-fetch-site&#39;</span><span class="p">:</span> <span class="s1">&#39;same-origin&#39;</span><span class="p">,</span>
    <span class="s1">&#39;sec-fetch-user&#39;</span><span class="p">:</span> <span class="s1">&#39;?1&#39;</span><span class="p">,</span>
    <span class="s1">&#39;upgrade-insecure-requests&#39;</span><span class="p">:</span> <span class="s1">&#39;1&#39;</span><span class="p">,</span>
    <span class="s1">&#39;user-agent&#39;</span><span class="p">:</span> <span class="s1">&#39;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/98.0.4758.102 Safari/537.36 Edg/98.0.1108.62&#39;</span><span class="p">,</span>
  
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>网站源代码中,<code>head</code>其中一个<code>script</code>中,就是视频信息的json,其中包括音频、视频资源等</p>
</li>
<li>
<p>获取这段源代码,并转为json</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">)</span>
<span class="n">html_data</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">text</span>
  
<span class="n">play_info</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s2">&#34;&lt;script&gt;window.__playinfo__=(.*?)&lt;/script&gt;&#34;</span><span class="p">,</span> <span class="n">html_data</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">S</span><span class="p">)</span>
<span class="n">json_data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">play_info</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>获取到视频信息的json后</p>
</li>
<li>
<p>json中的video中的baseUrl,就是视频资源</p>
</li>
<li>
<p>json中的audio中的baseUrl,就是音频资源</p>
</li>
<li>
<p>将这两个资源下载下来</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="k">def</span> <span class="nf">getVideo</span><span class="p">():</span>
    <span class="n">Video_Url</span> <span class="o">=</span> <span class="n">json_data</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;dash&#39;</span><span class="p">][</span><span class="s1">&#39;video&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;baseUrl&#39;</span><span class="p">]</span>
  
    <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">Video_Url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;./bilibili.mp4&#39;</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
  
  
<span class="k">def</span> <span class="nf">getAudio</span><span class="p">():</span>
    <span class="n">Video_Url</span> <span class="o">=</span> <span class="n">json_data</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;dash&#39;</span><span class="p">][</span><span class="s1">&#39;audio&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;baseUrl&#39;</span><span class="p">]</span>
  
    <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">Video_Url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;./bilibili.mp3&#39;</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>使用ffmpeg将下载的视频和音频合并(ffmpeg配置在下面)</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="k">def</span> <span class="nf">res</span><span class="p">(</span><span class="n">video_path</span><span class="p">,</span> <span class="n">audio_path</span><span class="p">,</span> <span class="n">outfile_name</span><span class="p">):</span>
    <span class="n">cmd</span> <span class="o">=</span> <span class="n">f</span><span class="s1">&#39;D:\CodePath</span><span class="se">\\</span><span class="s1">ffmpeg</span><span class="se">\\</span><span class="s1">bin</span><span class="se">\\</span><span class="s1">ffmpeg -i {video_path} -i {audio_path} -acodec copy -vcodec copy {outfile_name} -loglevel quiet&#39;</span>
    <span class="n">subprocess</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="n">shell</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><blockquote>
<p>其中,<code>-loglevel quiet</code>是取消控制台打印ffmpeg消息</p>
</blockquote>
</li>
<li>
<p>合并后,将单独的视频和音频删掉</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="k">def</span> <span class="nf">delCache</span><span class="p">(</span><span class="n">video_path</span><span class="p">,</span> <span class="n">audio_path</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">video_path</span><span class="p">):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">video_path</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">audio_path</span><span class="p">):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">audio_path</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>完整代码</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span><span class="lnt">78
</span><span class="lnt">79
</span><span class="lnt">80
</span><span class="lnt">81
</span><span class="lnt">82
</span><span class="lnt">83
</span><span class="lnt">84
</span><span class="lnt">85
</span><span class="lnt">86
</span><span class="lnt">87
</span><span class="lnt">88
</span><span class="lnt">89
</span><span class="lnt">90
</span><span class="lnt">91
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">subprocess</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">from</span> <span class="nn">lxml</span> <span class="kn">import</span> <span class="n">etree</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">time</span>
  
<span class="n">url</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s1">&#39;请输入视频地址: =&gt; </span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
  
<span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;accept&#39;</span><span class="p">:</span> <span class="s1">&#39;text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9&#39;</span><span class="p">,</span>
    <span class="s1">&#39;accept-encoding&#39;</span><span class="p">:</span> <span class="s1">&#39;gzip, deflate, br&#39;</span><span class="p">,</span>
    <span class="s1">&#39;accept-language&#39;</span><span class="p">:</span> <span class="s1">&#39;zh-CN,zh;q=0.9,en;q=0.8,en-GB;q=0.7,en-US;q=0.6&#39;</span><span class="p">,</span>
    <span class="s1">&#39;cache-control&#39;</span><span class="p">:</span> <span class="s1">&#39;max-age=0&#39;</span><span class="p">,</span>
    <span class="s1">&#39;cookie&#39;</span><span class="p">:</span> <span class="s1">&#39;buvid3=9DE01BA9-E87B-1194-C85F-F241149734BF58511infoc; i-wanna-go-back=-1; _uuid=DF7C4B52-36C5-FC26-EBE8-910647E103D31B61545infoc; buvid4=A78768E2-797C-1AC4-DF23-C5E1DC71571365124-022020319-2vCYpzLJWV1kBzTjXwl+sA%3D%3D; sid=iujoueek; buvid_fp_plain=undefined; DedeUserID=110923378; DedeUserID__ckMd5=041e9a4465d6d178; b_ut=5; LIVE_BUVID=AUTO5716438896840626; blackside_state=0; rpdid=|(RllR|)Yku0J</span><span class="se">\&#39;</span><span class="s1">uYRR|)k)~u; CURRENT_QUALITY=80; fingerprint=e3e751e162ccb4825a12770366b981cd; buvid_fp=e3e751e162ccb4825a12770366b981cd; SESSDATA=34cb81b1%2C1660309139%2C5738f*21; bili_jct=a62ae579874253a08533c05f09a45ef1; bp_t_offset_110923378=632657362903105577; PVID=1; b_lsid=E2B1EEF4_17F4BAA4EF1; bsource=search_bing; innersign=1; bp_video_offset_110923378=633066931003326500; CURRENT_FNVAL=80; CURRENT_BLACKGAP=0&#39;</span><span class="p">,</span>
    <span class="s1">&#39;referer&#39;</span><span class="p">:</span> <span class="s1">&#39;https://www.bilibili.com/movie/?spm_id_from=333.1007.0.0&#39;</span><span class="p">,</span>
    <span class="s1">&#39;sec-ch-ua&#39;</span><span class="p">:</span> <span class="s1">&#39;&#34; Not A;Brand&#34;;v=&#34;99&#34;, &#34;Chromium&#34;;v=&#34;98&#34;, &#34;Microsoft Edge&#34;;v=&#34;98&#34;&#39;</span><span class="p">,</span>
    <span class="s1">&#39;sec-ch-ua-mobile&#39;</span><span class="p">:</span> <span class="s1">&#39;?0&#39;</span><span class="p">,</span>
    <span class="s1">&#39;sec-ch-ua-platform&#39;</span><span class="p">:</span> <span class="s1">&#39;&#34;Windows&#34;&#39;</span><span class="p">,</span>
    <span class="s1">&#39;sec-fetch-dest&#39;</span><span class="p">:</span> <span class="s1">&#39;document&#39;</span><span class="p">,</span>
    <span class="s1">&#39;sec-fetch-mode&#39;</span><span class="p">:</span> <span class="s1">&#39;navigate&#39;</span><span class="p">,</span>
    <span class="s1">&#39;sec-fetch-site&#39;</span><span class="p">:</span> <span class="s1">&#39;same-origin&#39;</span><span class="p">,</span>
    <span class="s1">&#39;sec-fetch-user&#39;</span><span class="p">:</span> <span class="s1">&#39;?1&#39;</span><span class="p">,</span>
    <span class="s1">&#39;upgrade-insecure-requests&#39;</span><span class="p">:</span> <span class="s1">&#39;1&#39;</span><span class="p">,</span>
    <span class="s1">&#39;user-agent&#39;</span><span class="p">:</span> <span class="s1">&#39;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/98.0.4758.102 Safari/537.36 Edg/98.0.1108.62&#39;</span><span class="p">,</span>
  
<span class="p">}</span>
  
<span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">)</span>
<span class="n">html_data</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">text</span>
  
<span class="c1"># 视频信息的json</span>
<span class="n">play_info</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s2">&#34;&lt;script&gt;window.__playinfo__=(.*?)&lt;/script&gt;&#34;</span><span class="p">,</span> <span class="n">html_data</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">S</span><span class="p">)</span>
<span class="n">json_data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">play_info</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
  
  
<span class="c1"># 下载视频</span>
<span class="k">def</span> <span class="nf">getVideo</span><span class="p">():</span>
    <span class="n">Video_Url</span> <span class="o">=</span> <span class="n">json_data</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;dash&#39;</span><span class="p">][</span><span class="s1">&#39;video&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;baseUrl&#39;</span><span class="p">]</span>
  
    <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">Video_Url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;./bilibili.mp4&#39;</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
  
<span class="c1"># 下载音频</span>
<span class="k">def</span> <span class="nf">getAudio</span><span class="p">():</span>
    <span class="n">Video_Url</span> <span class="o">=</span> <span class="n">json_data</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;dash&#39;</span><span class="p">][</span><span class="s1">&#39;audio&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;baseUrl&#39;</span><span class="p">]</span>
  
    <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">Video_Url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;./bilibili.mp3&#39;</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
  
<span class="c1"># 获取视频标题</span>
<span class="k">def</span> <span class="nf">getTitle</span><span class="p">():</span>
    <span class="n">outfile_name</span> <span class="o">=</span> <span class="p">((</span><span class="n">etree</span><span class="o">.</span><span class="n">HTML</span><span class="p">(</span><span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">))</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s1">&#39;//*[@id=&#34;viewbox_report&#34;]/h1/@title&#39;</span><span class="p">))[</span>
            <span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;.mp4&#39;</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">outfile_name</span><span class="p">):</span>
        <span class="k">print</span><span class="p">(</span><span class="s1">&#39;文件已存在!!!&#39;</span><span class="p">)</span>
        <span class="nb">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">outfile_name</span>
  
<span class="c1"># 合并视频和音频</span>
<span class="k">def</span> <span class="nf">res</span><span class="p">(</span><span class="n">video_path</span><span class="p">,</span> <span class="n">audio_path</span><span class="p">,</span> <span class="n">outfile_name</span><span class="p">):</span>
    <span class="n">cmd</span> <span class="o">=</span> <span class="n">f</span><span class="s1">&#39;D:\CodePath</span><span class="se">\\</span><span class="s1">ffmpeg</span><span class="se">\\</span><span class="s1">bin</span><span class="se">\\</span><span class="s1">ffmpeg -i {video_path} -i {audio_path} -acodec copy -vcodec copy {outfile_name} -loglevel quiet&#39;</span>
    <span class="n">subprocess</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="n">shell</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
  
<span class="c1"># 合并后将单独的视频和音频删除</span>
<span class="k">def</span> <span class="nf">delCache</span><span class="p">(</span><span class="n">video_path</span><span class="p">,</span> <span class="n">audio_path</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">video_path</span><span class="p">):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">video_path</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">audio_path</span><span class="p">):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">audio_path</span><span class="p">)</span>
  
  
<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;开始下载!!!&#39;</span><span class="p">)</span>
    <span class="n">outfile_name</span> <span class="o">=</span> <span class="n">getTitle</span><span class="p">()</span>  <span class="c1"># 先获取视频标题,并判断下载目录是否存在这个视频,如果存在直接退出程序</span>
    <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
  
    <span class="n">video_path</span> <span class="o">=</span> <span class="s1">&#39;./bilibili.mp4&#39;</span>
    <span class="n">audio_path</span> <span class="o">=</span> <span class="s1">&#39;./bilibili.mp3&#39;</span>
    <span class="n">getVideo</span><span class="p">()</span>  <span class="c1"># 下载视频</span>
    <span class="n">getAudio</span><span class="p">()</span>  <span class="c1"># 下载音频</span>
    <span class="n">res</span><span class="p">(</span><span class="n">video_path</span><span class="p">,</span> <span class="n">audio_path</span><span class="p">,</span> <span class="n">outfile_name</span><span class="p">)</span>  <span class="c1"># 合并视频音频</span>
    <span class="n">delCache</span><span class="p">(</span><span class="n">video_path</span><span class="p">,</span> <span class="n">audio_path</span><span class="p">)</span>  <span class="c1"># 删除下载的单独的视频和音频</span>
  
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;下载完成!!!&#39;</span><span class="p">)</span>
    <span class="n">end_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;用时{}秒&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">end_time</span> <span class="o">-</span> <span class="n">start_time</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]))</span>
    <span class="nb">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div></li>
</ul>
<h3 id="ffmpeg环境配置">ffmpeg环境配置</h3>
<h4 id="环境配置">环境配置</h4>
<ul>
<li>
<p>下载ffmpeg</p>
</li>
<li>
<p><a href="https://github.com/BtbN/FFmpeg-Builds/releases?page=3">GitHub地址</a></p>
</li>
<li>
<p>下载<code>win64-gpl-shared-vulkan.zip</code>的</p>
</li>
<li>
<p>解压</p>
</li>
<li>
<p>配置环境变量</p>
<ul>
<li>
<p>添加系统变量</p>
<table>
<thead>
<tr>
<th align="center">变量名</th>
<th align="center">值</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center">FFMPEG_HOME</td>
<td align="center">解压包的bin目录</td>
</tr>
</tbody>
</table>
</li>
<li>
<p>再将%FFMPEG_HOME%以及%FFMPEG_HOME%\bin写入系统变量的Path中</p>
</li>
</ul>
</li>
<li>
<p>查看ffmpeg版本</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">ffmpeg -version
</code></pre></td></tr></table>
</div>
</div></li>
</ul>
<h4 id="python中使用ffmpeg合并视频和音频">Python中使用ffmpeg合并视频和音频</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">subprocess</span>
<span class="n">cmd</span> <span class="o">=</span> <span class="n">f</span><span class="s1">&#39;D:\CodePath</span><span class="se">\\</span><span class="s1">ffmpeg</span><span class="se">\\</span><span class="s1">bin</span><span class="se">\\</span><span class="s1">ffmpeg -i {video_path} -i {audio_path} -acodec copy -vcodec copy {outfile_name} -loglevel quiet&#39;</span>
<span class="n">subprocess</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="n">shell</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="付费视频">付费视频</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">subprocess</span>

<span class="n">bilibili_url</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s1">&#39;请输入视频地址: =&gt; </span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="c1"># 代理网址</span>
<span class="n">proxy_url</span> <span class="o">=</span> <span class="s1">&#39;https://a1.m1907.cn/api/v/?z=3ce9fd29ae903eedd5c05c128a206681&amp;jx=&#39;</span> <span class="o">+</span> <span class="n">bilibili_url</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;search&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;&amp;s1ig=11399&amp;g=&#39;</span>

<span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;User-Agent&#39;</span><span class="p">:</span> <span class="s1">&#39;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/101.0.4951.7 Safari/537.36&#39;</span><span class="p">,</span>

<span class="p">}</span>


<span class="k">def</span> <span class="nf">download</span><span class="p">(</span><span class="n">ts_url</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">ts_url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">code</span><span class="p">:</span>
        <span class="n">code</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>


<span class="c1"># 请求第一个m3u8,获取有ts路径的m3u8文件路径</span>
<span class="n">response_text</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">proxy_url</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
<span class="n">json_data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">response_text</span><span class="p">)</span>
<span class="n">url_url</span> <span class="o">=</span> <span class="n">json_data</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;source&#39;</span><span class="p">][</span><span class="s1">&#39;eps&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;url&#39;</span><span class="p">]</span>

<span class="c1"># 拼接上面(有ts路径的m3u8文件路径)的路径,获取到最终的m3u8文件路径</span>
<span class="n">url</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;https://ukzy.ukubf4.com/&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">url_url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">1</span><span class="p">]))</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>  <span class="c1"># replace是不知道哪个傻逼函数给我在url中拼接了一个\n</span>
<span class="k">print</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>

<span class="n">cmd</span> <span class="o">=</span> <span class="s1">&#39;D:\CodePath</span><span class="se">\\</span><span class="s1">ffmpeg</span><span class="se">\\</span><span class="s1">bin</span><span class="se">\\</span><span class="s1">ffmpeg -i {} -acodec copy -vcodec copy -absf aac_adtstoasc video.mp4&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
<span class="n">subprocess</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="n">shell</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="s1">&#39;下载完成&#39;</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><hr>
<h2 id="古诗词网登录---超级鹰识别验证码">古诗词网登录 - 超级鹰识别验证码</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="c1"># 模拟浏览器</span>
<span class="kn">from</span> <span class="nn">selenium</span> <span class="kn">import</span> <span class="n">webdriver</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.common.by</span> <span class="kn">import</span> <span class="n">By</span>

<span class="c1"># 延时</span>
<span class="kn">import</span> <span class="nn">time</span>

<span class="c1"># 截图</span>
<span class="kn">import</span> <span class="nn">pyautogui</span>
<span class="kn">import</span> <span class="nn">cv2</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>

<span class="c1"># 超级鹰</span>
<span class="kn">from</span> <span class="nn">chaojiying</span> <span class="kn">import</span> <span class="n">Chaojiying_Client</span>

<span class="c1"># 伪装头</span>
<span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&#34;user-agent&#34;</span><span class="p">:</span> <span class="s2">&#34;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/102.0.5005.63 Safari/537.36&#34;</span>
<span class="p">}</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">browser</span> <span class="o">=</span> <span class="n">webdriver</span><span class="o">.</span><span class="n">Chrome</span><span class="p">(</span><span class="n">executable_path</span><span class="o">=</span><span class="s1">&#39;chromedriver.exe&#39;</span><span class="p">)</span>

    <span class="n">browser</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;https://so.gushiwen.cn/user/login.aspx?from=http://so.gushiwen.cn/user/collect.aspx&#39;</span><span class="p">)</span>

    <span class="n">username</span> <span class="o">=</span> <span class="n">browser</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="s1">&#39;//input[@id=&#34;email&#34;]&#39;</span><span class="p">)</span>
    <span class="n">username</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="s2">&#34;18746539365&#34;</span><span class="p">)</span>

    <span class="n">password</span> <span class="o">=</span> <span class="n">browser</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="s1">&#39;//input[@id=&#34;pwd&#34;]&#39;</span><span class="p">)</span>
    <span class="n">password</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="s2">&#34;1234567890&#34;</span><span class="p">)</span>

    <span class="n">code</span> <span class="o">=</span> <span class="n">browser</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="s1">&#39;//input[@id=&#34;code&#34;]&#39;</span><span class="p">)</span>

    <span class="c1"># 截图</span>
    <span class="n">img</span> <span class="o">=</span> <span class="n">pyautogui</span><span class="o">.</span><span class="n">screenshot</span><span class="p">(</span><span class="n">region</span><span class="o">=</span><span class="p">[</span><span class="mi">505</span><span class="p">,</span> <span class="mi">427</span><span class="p">,</span> <span class="mi">77</span><span class="p">,</span> <span class="mi">35</span><span class="p">])</span>
    <span class="n">img</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">img</span><span class="p">),</span> <span class="n">cv2</span><span class="o">.</span><span class="n">COLOR_RGB2BGR</span><span class="p">)</span>
    <span class="n">cv2</span><span class="o">.</span><span class="n">imwrite</span><span class="p">(</span><span class="s2">&#34;code.jpg&#34;</span><span class="p">,</span> <span class="n">img</span><span class="p">)</span>
    <span class="n">cv2</span><span class="o">.</span><span class="n">waitKey</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>

    <span class="c1"># 超级鹰识别图片</span>
    <span class="n">chaojiying</span> <span class="o">=</span> <span class="n">Chaojiying_Client</span><span class="p">(</span><span class="s1">&#39;xxx&#39;</span><span class="p">,</span> <span class="s1">&#39;xxx&#39;</span><span class="p">,</span> <span class="s1">&#39;xxx&#39;</span><span class="p">)</span>  <span class="c1"># (用户名,验证码,用户中心&gt;&gt;软件ID 生成一个替换 96001)</span>
    <span class="n">im</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;code.jpg&#39;</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>  <span class="c1"># 本地图片文件路径 来替换 a.jpg 有时WIN系统须要//</span>

    <span class="c1"># 将识别的验证码填入输入框</span>
    <span class="n">code</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="n">chaojiying</span><span class="o">.</span><span class="n">PostPic</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="mi">1902</span><span class="p">)[</span><span class="s2">&#34;pic_str&#34;</span><span class="p">])</span>

    <span class="c1"># 点击登录</span>
    <span class="n">res_button</span> <span class="o">=</span> <span class="n">browser</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="s1">&#39;//input[@id=&#34;denglu&#34;]&#39;</span><span class="p">)</span>
    <span class="n">res_button</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>
</code></pre></td></tr></table>
</div>
</div>
    </div>

    <div class="post-copyright">
  <p class="copyright-item">
    <span class="item-title">Author</span>
    <span class="item-content">Zhang's Blog</span>
  </p>
  <p class="copyright-item">
    <span class="item-title">LastMod</span>
    <span class="item-content">
        2022-01-06
        
    </span>
  </p>
  
  
</div>
<footer class="post-footer">
      <div class="post-tags">
          <a href="/tags/python/">python</a>
          </div>
      <nav class="post-nav">
        <a class="prev" href="/post/mongodb/">
            <i class="iconfont icon-left"></i>
            <span class="prev-text nav-default">MongoDB</span>
            <span class="prev-text nav-mobile">Prev</span>
          </a>
        <a class="next" href="/post/opencv/">
            <span class="next-text nav-default">opencv</span>
            <span class="next-text nav-mobile">Next</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>
        </div>
        

  

  

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
      <a href="mailto:your@email.com" class="iconfont icon-email" title="email"></a>
      <a href="https://stackoverflow.com/" class="iconfont icon-stack-overflow" title="stack-overflow"></a>
      <a href="https://twitter.com/" class="iconfont icon-twitter" title="twitter"></a>
      <a href="https://www.facebook.com/" class="iconfont icon-facebook" title="facebook"></a>
      <a href="https://www.linkedin.com/" class="iconfont icon-linkedin" title="linkedin"></a>
      <a href="https://www.google.com/" class="iconfont icon-google" title="google"></a>
      <a href="https://github.com/" class="iconfont icon-github" title="github"></a>
      <a href="https://weibo.com/" class="iconfont icon-weibo" title="weibo"></a>
      <a href="https://www.zhihu.com/" class="iconfont icon-zhihu" title="zhihu"></a>
      <a href="https://www.douban.com/" class="iconfont icon-douban" title="douban"></a>
      <a href="https://getpocket.com/" class="iconfont icon-pocket" title="pocket"></a>
      <a href="https://www.tumblr.com/" class="iconfont icon-tumblr" title="tumblr"></a>
      <a href="https://www.instagram.com/" class="iconfont icon-instagram" title="instagram"></a>
      <a href="https://about.gitlab.com/" class="iconfont icon-gitlab" title="gitlab"></a>
      <a href="https://www.bilibili.com/" class="iconfont icon-bilibili" title="bilibili"></a>
  <a href="http://localhost:1313/index.xml" type="application/rss+xml" class="iconfont icon-rss" title="rss"></a>
</div>

<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://golang.org/">GoLang</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Author - 
    <a class="theme-link" href="https://space.bilibili.com/628950169/">Mr'zhang</a>
  </span>

  

  <span class="copyright-year">
    &copy; 
    2017 - 
    2022<span class="heart"><i class="iconfont icon-heart"></i></span><span>Zhang's Blog</span>
  </span>
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/slideout@1.0.1/dist/slideout.min.js" integrity="sha256-t+zJ/g8/KXIJMjSVQdnibt4dlaDxc9zXr/9oNPeWqdg=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.js" integrity="sha256-XVLffZaxoWfGUEbdzuLi7pwaUJv1cecsQJQqGLe7axY=" crossorigin="anonymous"></script>



<script type="text/javascript" src="/js/main.min.c12618f9a600c40bd024996677e951e64d3487006775aeb22e200c990006c5c7.js"></script>








</body>
</html>
