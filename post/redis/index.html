<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>Redis - Zhang&#39;s Blog的博客</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<meta name="author" content="Zhang&#39;s Blog" /><meta name="description" content="Step1. 安装 Step2. 基础命令 Step3. String Step4. List Step5. Set Step6.Hash Step7.zset有序集合 Step8.Geospatial Step9.HypperLogLog Step10.Redis的事务 执行事务 错误与异常 Step11.使用Jedis操" /><meta name="keywords" content="Hugo, theme, even" />






<meta name="generator" content="Hugo 0.67.1 with theme even" />


<link rel="canonical" href="http://localhost:1313/post/redis/" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">



<link href="/sass/main.min.b5a744db6de49a86cadafb3b70f555ab443f83c307a483402259e94726b045ff.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.css" integrity="sha256-7TyXnr2YU040zfSP+rEcz29ggW4j56/ujTPwjMzyqFY=" crossorigin="anonymous">


<meta property="og:title" content="Redis" />
<meta property="og:description" content="Step1. 安装 Step2. 基础命令 Step3. String Step4. List Step5. Set Step6.Hash Step7.zset有序集合 Step8.Geospatial Step9.HypperLogLog Step10.Redis的事务 执行事务 错误与异常 Step11.使用Jedis操" />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://localhost:1313/post/redis/" />
<meta property="article:published_time" content="2021-09-24T00:00:00+00:00" />
<meta property="article:modified_time" content="2021-09-24T00:00:00+00:00" />
<meta itemprop="name" content="Redis">
<meta itemprop="description" content="Step1. 安装 Step2. 基础命令 Step3. String Step4. List Step5. Set Step6.Hash Step7.zset有序集合 Step8.Geospatial Step9.HypperLogLog Step10.Redis的事务 执行事务 错误与异常 Step11.使用Jedis操">
<meta itemprop="datePublished" content="2021-09-24T00:00:00&#43;00:00" />
<meta itemprop="dateModified" content="2021-09-24T00:00:00&#43;00:00" />
<meta itemprop="wordCount" content="15249">



<meta itemprop="keywords" content="DataBase," /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Redis"/>
<meta name="twitter:description" content="Step1. 安装 Step2. 基础命令 Step3. String Step4. List Step5. Set Step6.Hash Step7.zset有序集合 Step8.Geospatial Step9.HypperLogLog Step10.Redis的事务 执行事务 错误与异常 Step11.使用Jedis操"/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">Zhang&#39;s Blog</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/home/">
        <li class="mobile-menu-item">Home</li>
      </a><a href="/post/">
        <li class="mobile-menu-item">MyBlog</li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">Tags</li>
      </a><a href="/categories/">
        <li class="mobile-menu-item">Categories</li>
      </a><a href="/about/">
        <li class="mobile-menu-item">About</li>
      </a>
  </ul>

  


</nav>

  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/" class="logo">Zhang&#39;s Blog</a>
</div>





<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="/home/">Home</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/post/">MyBlog</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/tags/">Tags</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/categories/">Categories</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/about/">About</a>
      </li>
  </ul>
</nav>

    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">Redis</h1>

      <div class="post-meta">
        <span class="post-time"> 2021-09-24 </span>
        
        
      </div>
    </header>

    <div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">Contents</h2>
  <div class="post-toc-content always-active">
    <nav id="TableOfContents">
  <ul>
    <li><a href="#step1-安装">Step1. 安装</a>
      <ul>
        <li><a href="#ubuntu">Ubuntu</a></li>
        <li><a href="#centos">CentOS</a></li>
      </ul>
    </li>
    <li><a href="#step2-基础命令">Step2. 基础命令</a></li>
    <li><a href="#step3-string">Step3. String</a></li>
    <li><a href="#step4-list">Step4. List</a></li>
    <li><a href="#step5-set">Step5. Set</a></li>
    <li><a href="#step6hash">Step6.Hash</a></li>
    <li><a href="#step7zset有序集合">Step7.zset(有序集合)</a></li>
    <li><a href="#step8geospatial">Step8.Geospatial</a></li>
    <li><a href="#step9hypperloglog">Step9.HypperLogLog</a></li>
    <li><a href="#step10redis的事务">Step10.Redis的事务</a>
      <ul>
        <li><a href="#执行事务">执行事务</a></li>
        <li><a href="#错误与异常">错误与异常</a></li>
      </ul>
    </li>
    <li><a href="#step11使用jedis操作redis">Step11.使用Jedis操作Redis</a></li>
    <li><a href="#step12jedis操作redis理解redis中的事务">Step12.Jedis操作Redis理解Redis中的事务</a></li>
    <li><a href="#step13springboot整合redis">Step13.SpringBoot整合Redis</a></li>
    <li><a href="#step14redis配置文件详解">Step14.Redis配置文件详解</a>
      <ul>
        <li><a href="#ubuntu下打开配置文件">Ubuntu下打开配置文件</a></li>
        <li><a href="#读配置文件">读配置文件</a></li>
      </ul>
    </li>
    <li><a href="#step15rdb操作">Step15.RDB操作</a>
      <ul>
        <li><a href="#rdb介绍">RDB介绍</a></li>
        <li><a href="#获取rdb文件路径的命令">获取rdb文件路径的命令</a></li>
        <li><a href="#触发rdb机制的方法">触发RDB机制的方法</a></li>
      </ul>
    </li>
    <li><a href="#step16aof操作">Step16.AOF操作</a></li>
    <li><a href="#step17redis订阅发布">Step17.Redis订阅发布</a></li>
    <li><a href="#step18redis主从复制">Step18.Redis主从复制</a>
      <ul>
        <li><a href="#如何启动多个server和cli">如何启动多个server和cli</a></li>
        <li><a href="#主从机配置">主从机配置</a>
          <ul>
            <li><a href="#一主二从">一主二从</a></li>
            <li><a href="#层层链路">```层层链路</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#step19哨兵模式">Step19.哨兵模式</a>
      <ul>
        <li><a href="#概念">概念</a></li>
        <li><a href="#测试">测试</a></li>
      </ul>
    </li>
    <li><a href="#step20redis缓存穿透缓存击穿与雪崩">Step20.Redis缓存穿透、缓存击穿与雪崩</a>
      <ul>
        <li><a href="#缓存穿透">缓存穿透</a></li>
        <li><a href="#缓存击穿">缓存击穿</a></li>
        <li><a href="#缓存雪崩">缓存雪崩</a></li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
</div>
    <div class="post-content">
      <!-- TOC -->
<ul>
<li><a href="#step1-%E5%AE%89%E8%A3%85">Step1. 安装</a></li>
<li><a href="#step2-%E5%9F%BA%E7%A1%80%E5%91%BD%E4%BB%A4">Step2. 基础命令</a></li>
<li><a href="#step3-string">Step3. String</a></li>
<li><a href="#step4-list">Step4. List</a></li>
<li><a href="#step5-set">Step5. Set</a></li>
<li><a href="#step6hash">Step6.Hash</a></li>
<li><a href="#step7zset%E6%9C%89%E5%BA%8F%E9%9B%86%E5%90%88">Step7.zset有序集合</a></li>
<li><a href="#step8geospatial">Step8.Geospatial</a></li>
<li><a href="#step9hypperloglog">Step9.HypperLogLog</a></li>
<li><a href="#step10redis%E7%9A%84%E4%BA%8B%E5%8A%A1">Step10.Redis的事务</a>
<ul>
<li><a href="#%E6%89%A7%E8%A1%8C%E4%BA%8B%E5%8A%A1">执行事务</a></li>
<li><a href="#%E9%94%99%E8%AF%AF%E4%B8%8E%E5%BC%82%E5%B8%B8">错误与异常</a></li>
</ul>
</li>
<li><a href="#step11%E4%BD%BF%E7%94%A8jedis%E6%93%8D%E4%BD%9Credis">Step11.使用Jedis操作Redis</a></li>
<li><a href="#step12jedis%E6%93%8D%E4%BD%9Credis%E7%90%86%E8%A7%A3redis%E4%B8%AD%E7%9A%84%E4%BA%8B%E5%8A%A1">Step12.Jedis操作Redis理解Redis中的事务</a></li>
<li><a href="#step13springboot%E6%95%B4%E5%90%88redis">Step13.SpringBoot整合Redis</a></li>
<li><a href="#step14redis%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E8%AF%A6%E8%A7%A3">Step14.Redis配置文件详解</a>
<ul>
<li><a href="#ubuntu%E4%B8%8B%E6%89%93%E5%BC%80%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6">Ubuntu下打开配置文件</a></li>
<li><a href="#%E8%AF%BB%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6">读配置文件</a></li>
</ul>
</li>
<li><a href="#step15rdb%E6%93%8D%E4%BD%9C">Step15.RDB操作</a>
<ul>
<li><a href="#rdb%E4%BB%8B%E7%BB%8D">RDB介绍</a></li>
<li><a href="#%E8%8E%B7%E5%8F%96rdb%E6%96%87%E4%BB%B6%E8%B7%AF%E5%BE%84%E7%9A%84%E5%91%BD%E4%BB%A4">获取rdb文件路径的命令</a></li>
<li><a href="#%E8%A7%A6%E5%8F%91rdb%E6%9C%BA%E5%88%B6%E7%9A%84%E6%96%B9%E6%B3%95">触发RDB机制的方法</a></li>
</ul>
</li>
<li><a href="#step16aof%E6%93%8D%E4%BD%9C">Step16.AOF操作</a></li>
</ul>
<!-- /TOC -->
<h1 id="step1-安装">Step1. 安装</h1>
<h2 id="ubuntu">Ubuntu</h2>
<blockquote>
<p>sudo apt-get update</p>
</blockquote>
<blockquote>
<p>sudo apt-get install redis-server</p>
</blockquote>
<h2 id="centos">CentOS</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">wget http://download.redis.io/releases/redis-4.0.6.tar.gz
tar -zxvf redis-4.0.6.tar.gz

# 跳转到redis解压目录下
cd redis-4.0.6

# 编译安装
make MALLOC=libc

#将/usr/local/redis-4.0.6/src目录下的文件加到/usr/local/bin目录
cd src &amp;&amp; make install

#先切换到redis src目录下(或者redis-server文件所在目录)
cd  /src
 
#直接启动redis
./redis-server
</code></pre></td></tr></table>
</div>
</div><ul>
<li>但是直接启动却无法使用</li>
<li>需要像启动redis-server那样启动redis-cli(Redis客户端)</li>
</ul>
<h1 id="step2-基础命令">Step2. 基础命令</h1>
<ul>
<li>
<p>启动Redis服务</p>
<blockquote>
<p>redis-server</p>
</blockquote>
<blockquote>
<p>redis-cli</p>
</blockquote>
</li>
<li>
<p>判断redis是否连接</p>
<blockquote>
<p>PING</p>
</blockquote>
</li>
<li>
<p>设置字段</p>
<blockquote>
<p>set username zhangyuhang</p>
</blockquote>
<blockquote>
<p>set str 111</p>
</blockquote>
</li>
<li>
<p>获取字段</p>
<blockquote>
<p>get username</p>
</blockquote>
<p>如果你获取一个不存在的字段,它会返回一个nui</p>
</li>
<li>
<p>Linux中查看所有redis进程</p>
<blockquote>
<p>ps -ef|grep redis</p>
</blockquote>
<p>ps -ef用于查看所有进程,grep用于过滤出指定进程</p>
</li>
<li>
<p>退出redis服务</p>
<blockquote>
<p>shutdown</p>
</blockquote>
<blockquote>
<p>exit</p>
</blockquote>
</li>
<li>
<p>切换数据库命令</p>
<blockquote>
<p>redis默认有16个数据库,默认是0</p>
</blockquote>
<blockquote>
<p>我们可以通过select 7这样的命令进行切换</p>
</blockquote>
</li>
<li>
<p>查看当前数据库所有的key</p>
<blockquote>
<p>keys *</p>
</blockquote>
</li>
<li>
<p>清除当前数据库所有信息</p>
<blockquote>
<p>flushdb</p>
</blockquote>
</li>
<li>
<p>清除当前所有数据库所有信息</p>
<blockquote>
<p>flushall</p>
</blockquote>
</li>
<li>
<p>查看当前数据库中数据量</p>
<blockquote>
<p>dbsize</p>
</blockquote>
</li>
<li>
<p>判断key是否在当前数据库中</p>
<blockquote>
<p>exists name</p>
</blockquote>
</li>
<li>
<p>移除指定key的值</p>
<blockquote>
<p>move name 1</p>
</blockquote>
<p>1指的是移除数据库1中键为name的值</p>
</li>
</ul>
<h1 id="step3-string">Step3. String</h1>
<ul>
<li>
<p>设置key的有效时间(单位:s)</p>
<blockquote>
<p>EXPIRE username 10</p>
</blockquote>
<p>意思就是username10秒钟后被销毁</p>
<ul>
<li>你可以通过ttl username命令查看指定key的有效时间</li>
</ul>
</li>
<li>
<p>在字符串后面动态追加字符串</p>
<blockquote>
<p>append username &ldquo;s&rdquo;</p>
</blockquote>
<p>如果当前key不存在,就相当于<strong>set key</strong></p>
</li>
<li>
<p>获取字符串的长度</p>
<blockquote>
<p>strlen username</p>
</blockquote>
</li>
<li>
<p>对数字进行加减操作</p>
<ul>
<li>
<p>逐一加减</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">set val 0
incr val
incr val
decr val
decr val
decr val
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>按照指定步长进行加减</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">incrby val 10
decrby val 5
</code></pre></td></tr></table>
</div>
</div></li>
</ul>
</li>
<li>
<p>按照索引截取字符串</p>
<blockquote>
<p>getrange username 0 3</p>
</blockquote>
<p>截取key为username字符串中0-3的字符</p>
</li>
<li>
<p>从一个索引开始向后设置字符串的每个字符</p>
<blockquote>
<p>setrange username 1 88</p>
</blockquote>
<p>意思就是username是zhangyuhang,现在从索引为1的位置开始向后使用88这个字符串向后替换,直至88的内容完全被插入字符串为止</p>
</li>
<li>
<p>设置字符串有效时间(单位:s)</p>
<blockquote>
<p>setex username 30 zhang</p>
</blockquote>
</li>
<li>
<p>创建字符串,如果存在则创建,否则则创建失败(返回值为0)</p>
<blockquote>
<p>setnx username zhang</p>
</blockquote>
</li>
<li>
<p>一次性设置多个key-value</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">mset k1 v1 k2 v2 k3 v3
keys *
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>一次性获取多个key的value</p>
<blockquote>
<p>mget k1 k2 k3</p>
</blockquote>
</li>
<li>
<p>同理也可以通过nx操作,在创建的同时进行是否存在的判断</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">msetnx k1 v1 k4 v4
keys *
</code></pre></td></tr></table>
</div>
</div><p>nx是一种原子操作,要么一起成功,要么一起失败</p>
</li>
<li>
<p>创建对象</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">mset user🧑username zhangyuhang user🧑age 19
mget user🧑username user🧑age
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>getset操作</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">getset yyds Me
get yyds
getset yyds wife
</code></pre></td></tr></table>
</div>
</div><p>getset的操作就是:如果设置的key的值存在,就获取到原来的值,并将这个key设置为新值;如果不存在,就返回nui,并为key的value赋予这个值</p>
</li>
</ul>
<h1 id="step4-list">Step4. List</h1>
<ul>
<li>
<p>List中所有命令都是大写的L开头</p>
</li>
<li>
<p>List可以玩成栈、队列、阻塞队列</p>
</li>
<li>
<p>向列表中插入元素</p>
<blockquote>
<p>LPUSH list one</p>
</blockquote>
<blockquote>
<p>LPUSH list two</p>
</blockquote>
<blockquote>
<p>LPUSH list three</p>
</blockquote>
</li>
<li>
<p>获取列表中所有元素</p>
<blockquote>
<p>LRANGE list 0 -1</p>
</blockquote>
</li>
<li>
<p>获取列表中指定索引范围的元素</p>
<blockquote>
<p>LRANGE list 0 1</p>
</blockquote>
</li>
<li>
<p>将一个值插入到列表尾部</p>
<blockquote>
<p>Rpush list righter</p>
</blockquote>
<p>Rpush区分大小写</p>
</li>
<li>
<p>移除列表中的第一个元素(左弹栈)</p>
<blockquote>
<p>Lpop list</p>
</blockquote>
</li>
<li>
<p>移除列表的最后一个元素(右弹栈)</p>
<blockquote>
<p>Rpop list</p>
</blockquote>
</li>
<li>
<p>根据索引查找元素的值(不存在返回nui)</p>
<blockquote>
<p>Lindex list 0</p>
</blockquote>
</li>
<li>
<p>查看列表长度</p>
<blockquote>
<p>Llen list</p>
</blockquote>
</li>
<li>
<p>移除指定的值</p>
<ul>
<li>
<p>移除一个值</p>
<blockquote>
<p>Lrem list 1 two</p>
</blockquote>
</li>
<li>
<p>移除多个值</p>
<blockquote>
<p>Lrem list 2 three</p>
</blockquote>
</li>
</ul>
</li>
<li>
<p>将list裁减为指定索引范围的内容</p>
<blockquote>
<p>Ltrim list 1 3</p>
</blockquote>
</li>
<li>
<p>将一个列表中的顶元素移动到另外一个列表中</p>
<blockquote>
<p>RpopLrange list list2</p>
</blockquote>
<p>将list中右弹栈的数据push到list2中</p>
</li>
<li>
<p>设置列表指定索引位置元素的值</p>
<blockquote>
<p>Lset list 0 item</p>
</blockquote>
<p>如果索引位置存在值,则进行替换;如果不存在则报错</p>
</li>
<li>
<p>将一个值插入到另一个值的前面</p>
<blockquote>
<p>LINSERT list before &ldquo;two&rdquo; &ldquo;111&rdquo;</p>
</blockquote>
</li>
<li>
<p>将一个值插入到另一个值的后面</p>
<blockquote>
<p>LINSERT list after &ldquo;two&rdquo; &ldquo;111&rdquo;</p>
</blockquote>
</li>
</ul>
<h1 id="step5-set">Step5. Set</h1>
<ul>
<li>
<p>Set中的所有命令都是s开头</p>
</li>
<li>
<p>Set中没有重复元素</p>
</li>
<li>
<p>向set中添加元素</p>
<blockquote>
<p>sadd myset &ldquo;hello&rdquo;</p>
</blockquote>
<blockquote>
<p>sadd myset &ldquo;world&rdquo;</p>
</blockquote>
<blockquote>
<p>sadd myset &ldquo;others&rdquo;</p>
</blockquote>
</li>
<li>
<p>遍历set元素</p>
<blockquote>
<p>SMEMBERS myset</p>
</blockquote>
</li>
<li>
<p>判断元素是否存在于集合中</p>
<blockquote>
<p>SISMEMBERS myset</p>
</blockquote>
</li>
<li>
<p>获取set集合中元素的个数</p>
<blockquote>
<p>SCARD myset</p>
</blockquote>
</li>
<li>
<p>移除set中的指定元素</p>
<blockquote>
<p>srem myset hello</p>
</blockquote>
</li>
<li>
<p>随机获取set中的某个元素</p>
<blockquote>
<p>SRANDMEMBER myset</p>
</blockquote>
</li>
<li>
<p>随机删除某个元素</p>
<blockquote>
<p>SMEMBERS myset</p>
</blockquote>
</li>
<li>
<p>将一个set中的指定元素移动到另外一个set中</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">sadd set1 hello
sadd set1 world
sadd set1 other
sadd set2 people
SMOVE set1 set2 other
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>求一个集合在另一个集合中不存在的值</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">sadd set1 hello
sadd set1 world
sadd set2 hello
sadd set2 other
SDIFF set1 set2
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>求两个set的交集</p>
<blockquote>
<p>SINTER set1 set2</p>
</blockquote>
</li>
<li>
<p>求两个set的并集</p>
<blockquote>
<p>SUNION set1 set2</p>
</blockquote>
</li>
</ul>
<h1 id="step6hash">Step6.Hash</h1>
<ul>
<li>
<p>Hash是以key-map的形式存储的</p>
</li>
<li>
<p>Hash所有命令都是以h开头</p>
</li>
<li>
<p>向hash中添加一个key-map键值对</p>
<blockquote>
<p>hset myhash field1 id</p>
</blockquote>
</li>
<li>
<p>向hash中添加多个键值对</p>
<blockquote>
<p>hmset myhash field2 name field3 age</p>
</blockquote>
</li>
<li>
<p>获取到hash中指定key的值</p>
<blockquote>
<p>hget myhash field1</p>
</blockquote>
</li>
<li>
<p>获取到hash中多个key的值</p>
<blockquote>
<p>hmget myhash field1 field2</p>
</blockquote>
</li>
<li>
<p>获取到hash中所有值</p>
<blockquote>
<p>hgetall myhash</p>
</blockquote>
</li>
<li>
<p>删除指定键的值</p>
<blockquote>
<p>hdel myhash field1</p>
</blockquote>
</li>
<li>
<p>获取hash的键值对个数</p>
<blockquote>
<p>hlen myhash</p>
</blockquote>
</li>
<li>
<p>判断在hash表中是否存在指定字段的hash键值对</p>
<blockquote>
<p>hexists myhash field1</p>
</blockquote>
</li>
<li>
<p>获取hash中所有的key</p>
<blockquote>
<p>hkeys myhash</p>
</blockquote>
</li>
<li>
<p>获取hash中所有的value</p>
<blockquote>
<p>hvals myhash</p>
</blockquote>
</li>
<li>
<p>对hash中的某个键值对中的值(数字)进行加减</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">flushdb
hset myhash field 1
hincrby myhash field 5
hincrby myhash field -10
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>在hash中设置一个键值对,如果存在,就在hash中新建这个键值对;如果不存在就设置失败</p>
<blockquote>
<p>flushdb</p>
<p>hset myhash field1 1</p>
<p>hset myhash field2 2</p>
<p>hset myhash field1 3</p>
</blockquote>
</li>
<li>
<p>hash中设置对象并获取值</p>
<blockquote>
<p>hset user:root username zhangyuhang</p>
<p>hset user:root password 123456</p>
<p>hget user:root username</p>
</blockquote>
</li>
</ul>
<h1 id="step7zset有序集合">Step7.zset(有序集合)</h1>
<ul>
<li>
<p>zset和set的区别是,zset中的元素是有序的</p>
</li>
<li>
<p>向zset中添加元素</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">zadd myhash 1 one
</code></pre></td></tr></table>
</div>
</div><p>你在添加元素的同时也要指定元素在zset中的编号</p>
</li>
<li>
<p>向zset中添加多个元素</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">zadd myhash 2 two 3 three
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>遍历zset集合</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">zrange myhash 0 -1
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>对zset中的元素进行排序查询(从小到大)</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">flushdb
zadd salary 1000000 zhang
zadd salary 100 wang
zadd salary 10 li
zadd salary 1 zhao
ZRANGEBYSCORE salary -inf +inf
</code></pre></td></tr></table>
</div>
</div><p>inf是无限大的意思</p>
</li>
<li>
<p>查询指定范围的数据</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">zrangebyscore salary -inf 100
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>遍历zset集合</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">zrange salary 0 -1
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>移除zset中的元素</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">zrem salary li
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>获取zset中的元素个数</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">zcard salary
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>查询zset中所有元素(从大到小排序)</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">zrevrange salary 0 -1
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>获取指定区间的成员数量</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">flushdb
zadd myzhash 1 1
zadd myzhash 2 2
zadd myzhash 3 3
zadd myzhash 4 4
zcount myhash 1 3
</code></pre></td></tr></table>
</div>
</div></li>
</ul>
<h1 id="step8geospatial">Step8.Geospatial</h1>
<ul>
<li>
<p>Geo在redis中就是地理位置的意思</p>
</li>
<li>
<p>向redis中添加地理位置信息</p>
</li>
<li>
<p>地理位置信息通过经纬度的方式添加,经纬度可以通过百度中的网站查询到</p>
</li>
<li>
<p>向redis中添加地理位置信息</p>
<blockquote>
<p>geoadd china:city 116.40 39.90 beijing</p>
</blockquote>
</li>
<li>
<p>获取添加到redis中的地理位置</p>
<blockquote>
<p>geopos china:city haerbin</p>
</blockquote>
</li>
<li>
<p>计算两个地理位置之间的距离</p>
<blockquote>
<p>geopos china:city haerbin</p>
</blockquote>
<ul>
<li>
<p>在语句结尾可以指定度量单位</p>
<blockquote>
<p>km,m,ft(英尺),mi(英里)</p>
</blockquote>
</li>
</ul>
</li>
<li>
<p>以一个城市的经纬度为圆心,寻找指定半径内的所有城市</p>
<blockquote>
<p>GEORADIUS china:city 116.40 39.90 1000 km</p>
</blockquote>
<ul>
<li>
<p>附带上直线距离</p>
<blockquote>
<p>GEORADIUS  china:city 116.40 39.90 100000 km withdist</p>
</blockquote>
</li>
<li>
<p>伴随着每个位置的经度纬度</p>
<blockquote>
<p>GEORADIUS  china:city 116.40 39.90 100000 km withdist</p>
</blockquote>
</li>
<li>
<p>指定查询出城市的数量</p>
<blockquote>
<p>GEORADIUS  china:city 116.40 39.90 100000 km withdist withcoord count 2</p>
</blockquote>
<ul>
<li>如果没有则将所有的城市都查询出来</li>
</ul>
</li>
</ul>
</li>
<li>
<p>查询和指定城市距离等于指定距离的所有城市</p>
<blockquote>
<p>georadiusbymember china:city shanghai 400 km</p>
</blockquote>
</li>
<li>
<p>查询代表指定位置的哈希字符串</p>
<blockquote>
<p>geohash china:city shanghai</p>
</blockquote>
</li>
<li>
<p>遍历当前数据库中所有的地理位置</p>
<blockquote>
<p>ZRANGE china:city 0 -1</p>
</blockquote>
</li>
<li>
<p>移除指定地理位置</p>
<blockquote>
<p>zrem china:city shanghai</p>
</blockquote>
</li>
</ul>
<h1 id="step9hypperloglog">Step9.HypperLogLog</h1>
<ul>
<li>
<p>基数统计</p>
</li>
<li>
<p>什么是基数</p>
<blockquote>
<p>A = {1,2,3,4,5}</p>
<p>B = {1,2,3,4,5,6,5}</p>
<p>B的基数就是6,排除重复</p>
</blockquote>
</li>
<li>
<p>优点:占用内存固定,2^64中不同元素的技术,只需要12kb内存</p>
</li>
<li>
<p>网页的UV(一个人访问多次,但还是算做一个人)</p>
<blockquote>
<p>传统方式,使用set储存用户id,就会比较麻烦!我们的目的是为了比较,而不是储存id</p>
<p>0.81%错误率</p>
</blockquote>
</li>
<li>
<p>创建一个HypperLogLog,并向其中添加数据</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">PFadd mykeys a b c d e f g
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>如果有重复,则自动去重</p>
<blockquote>
<p>PFadd mykeys a b c d e f a</p>
</blockquote>
</li>
<li>
<p>获取指定key中基数值</p>
<blockquote>
<p>PFCOUNT mykeys</p>
</blockquote>
</li>
<li>
<p>合并两个HypperLogLog</p>
<blockquote>
<p>PFMERGE mykeys1 mykeys2</p>
</blockquote>
<ul>
<li>合并过程中也会去重</li>
</ul>
</li>
</ul>
<p>Step10.BitMap</p>
<ul>
<li>
<p>通过存储位进行操作</p>
</li>
<li>
<p>案例:统计一周打卡次数</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">setbit daka 0 1
setbit daka 1 1
setbit daka 2 0
setbit daka 3 1
setbit daka 5 0
setbit daka 6 1
</code></pre></td></tr></table>
</div>
</div><ul>
<li>获取指定key指定值的bit值</li>
</ul>
<blockquote>
<p>getbit daka 5</p>
</blockquote>
<ul>
<li>统计指定key中所有值为1的值的个数</li>
</ul>
</li>
</ul>
<h1 id="step10redis的事务">Step10.Redis的事务</h1>
<ul>
<li>
<p>Redis事务本质:一祖命令的集合!一个事务中所有命令<code>都会被序列化,在事务执行的过程中,会按顺序执行!</code>一次性、顺序性、排他性!执行一系列的命令</p>
<blockquote>
<p>&mdash; 队列 set set set 执行 &mdash;</p>
</blockquote>
</li>
<li>
<p>Redis事务中单个命令具有原子性,但是事物不保证原子性</p>
</li>
<li>
<p>Redis事务没有隔离级别的概念</p>
</li>
<li>
<p>所有的命令在事务中,并没有马上执行,只有发起执行命令的时候才会执行!Exec</p>
</li>
<li>
<p>Redis的事务:</p>
<blockquote>
<p>开启事务</p>
</blockquote>
<blockquote>
<p>命令入队</p>
</blockquote>
<blockquote>
<p>执行事务</p>
</blockquote>
</li>
</ul>
<h2 id="执行事务">执行事务</h2>
<ul>
<li>
<p>开启事物</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">multi
</code></pre></td></tr></table>
</div>
</div><ul>
<li>这之后所有的命令都会存储到一个事物中,直到exec执行事务</li>
</ul>
</li>
<li>
<p>命令入队</p>
<blockquote>
<p>set k1 v1</p>
<p>set k2 v2</p>
<p>set k3 v3</p>
</blockquote>
</li>
<li>
<p>执行事务</p>
<blockquote>
<p>exec</p>
</blockquote>
</li>
<li>
<p>在执行事务之前终止事物</p>
<blockquote>
<p>discard</p>
</blockquote>
<ul>
<li>这时候由于事务没有执行,所以使用get等方法获取前面设置的值是空</li>
</ul>
</li>
</ul>
<h2 id="错误与异常">错误与异常</h2>
<ul>
<li>
<p>在java中,分为运行时错误和编译时错误</p>
<ul>
<li>
<p>编译时错误</p>
<blockquote>
<p>在运行之前,语句中存在语法错误,导致连编译都无法通过,所有语句都无法执行(就是说事务中只要存在语法错误整个事务就错误)</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">127.0.0.1:6379&gt; multi
OK
127.0.0.1:6379&gt; set k1 v1
QUEUED
127.0.0.1:6379&gt; set k2 v2
QUEUED
127.0.0.1:6379&gt; set k3 v3
QUEUED
127.0.0.1:6379&gt; getset k1
(error) ERR wrong number of arguments for &#39;getset&#39; command
127.0.0.1:6379&gt; exec
(error) EXECABORT Transaction discarded because of previous errors.
127.0.0.1:6379&gt; 
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>运行时错误</p>
<blockquote>
<p>语句语法没有错误,但是可能存在逻辑中的异常,这种不会影响到其他命令,其他正确的命令可正常执行(因为事务的原子性无法确定)</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">127.0.0.1:6379&gt; multi
OK
127.0.0.1:6379&gt; set k1 &#34;v1&#34;
QUEUED
127.0.0.1:6379&gt; incr k1
QUEUED
127.0.0.1:6379&gt; set k2 v2
QUEUED
127.0.0.1:6379&gt; set k3 v3
QUEUED
127.0.0.1:6379&gt; exec
1) OK
2) (error) ERR value is not an integer or out of range
3) OK
4) OK
</code></pre></td></tr></table>
</div>
</div></li>
</ul>
</li>
</ul>
<h1 id="step11使用jedis操作redis">Step11.使用Jedis操作Redis</h1>
<ul>
<li>
<p>Jedis是redis的java版本的客户端实现</p>
</li>
<li>
<p>使用jedis</p>
</li>
<li>
<p>创建一个普通的maven项目</p>
</li>
<li>
<p>导入依赖</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-xml" data-lang="xml"><span class="nt">&lt;dependencies&gt;</span>
    <span class="nt">&lt;dependency&gt;</span>
        <span class="nt">&lt;groupId&gt;</span>redis.clients<span class="nt">&lt;/groupId&gt;</span>
        <span class="nt">&lt;artifactId&gt;</span>jedis<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;version&gt;</span>3.2.0<span class="nt">&lt;/version&gt;</span>
    <span class="nt">&lt;/dependency&gt;</span>
    <span class="nt">&lt;dependency&gt;</span>
        <span class="nt">&lt;groupId&gt;</span>com.alibaba<span class="nt">&lt;/groupId&gt;</span>
        <span class="nt">&lt;artifactId&gt;</span>fastjson<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;version&gt;</span>1.2.62<span class="nt">&lt;/version&gt;</span>
    <span class="nt">&lt;/dependency&gt;</span>
<span class="nt">&lt;/dependencies&gt;</span>
</code></pre></td></tr></table>
</div>
</div><blockquote>
<p>fastjson我也不知道是干什么的,说是存数据(json对象)</p>
</blockquote>
</li>
<li>
<p>编写测试类</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">com.zhang.code</span><span class="o">;</span>
  
  
<span class="kn">import</span> <span class="nn">redis.clients.jedis.Jedis</span><span class="o">;</span>
  
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">JedisTest</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Jedis</span> <span class="n">jedis</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Jedis</span><span class="o">(</span><span class="s">&#34;127.0.0.1&#34;</span><span class="o">,</span><span class="n">6379</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">jedis</span><span class="o">.</span><span class="na">ping</span><span class="o">());</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div></li>
</ul>
<hr>
<ul>
<li>
<p>其他方法都直接读API就好了</p>
<blockquote>
<p>很多方法都学过,命名的关键字和方法名绝大多数都是一样的</p>
</blockquote>
</li>
</ul>
<h1 id="step12jedis操作redis理解redis中的事务">Step12.Jedis操作Redis理解Redis中的事务</h1>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">com.zhang.code</span><span class="o">;</span>


<span class="kn">import</span> <span class="nn">com.alibaba.fastjson.JSONObject</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">redis.clients.jedis.Jedis</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">redis.clients.jedis.Transaction</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">JedisTest</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Jedis</span> <span class="n">jedis</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Jedis</span><span class="o">(</span><span class="s">&#34;127.0.0.1&#34;</span><span class="o">,</span><span class="n">6379</span><span class="o">);</span>
        
        <span class="c1">//为了不让上次set的结果影响下次的操作结果,所以每次启动前先将当前数据库flushDB一下
</span><span class="c1"></span>        <span class="n">jedis</span><span class="o">.</span><span class="na">flushDB</span><span class="o">();</span>
<span class="c1">//        System.ut.println(jedis.ping());
</span><span class="c1"></span>        
        <span class="c1">//开启事务
</span><span class="c1"></span>        <span class="n">Transaction</span> <span class="n">multi</span> <span class="o">=</span> <span class="n">jedis</span><span class="o">.</span><span class="na">multi</span><span class="o">();</span>
        
        <span class="c1">//封装一个JSON对象
</span><span class="c1"></span>        <span class="n">JSONObject</span> <span class="n">jsonObject</span> <span class="o">=</span> <span class="k">new</span> <span class="n">JSONObject</span><span class="o">();</span>
        <span class="n">jsonObject</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">&#34;username&#34;</span><span class="o">,</span><span class="s">&#34;zhangyuhang&#34;</span><span class="o">);</span>
        <span class="n">jsonObject</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">&#34;password&#34;</span><span class="o">,</span><span class="s">&#34;123456&#34;</span><span class="o">);</span>
        <span class="c1">//将JSON对象转成JSON类型字符串
</span><span class="c1"></span>        <span class="n">String</span> <span class="n">result</span> <span class="o">=</span> <span class="n">jsonObject</span><span class="o">.</span><span class="na">toJSONString</span><span class="o">();</span>

        <span class="k">try</span><span class="o">{</span>
            <span class="n">multi</span><span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="s">&#34;username&#34;</span><span class="o">,</span><span class="n">result</span><span class="o">);</span>
            <span class="n">multi</span><span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="s">&#34;password&#34;</span><span class="o">,</span><span class="n">result</span><span class="o">);</span>
            <span class="n">multi</span><span class="o">.</span><span class="na">exec</span><span class="o">();</span>
        <span class="o">}</span> <span class="k">catch</span><span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">){</span>
            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
        <span class="o">}</span> <span class="k">finally</span><span class="o">{</span>
            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">jedis</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">&#34;username&#34;</span><span class="o">));</span>
            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">jedis</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">&#34;password&#34;</span><span class="o">));</span>
            <span class="n">jedis</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><hr>
<ul>
<li>当事务中出现异常时候,这和纯Redis不同,Java中存在异常是直接不往下运行,直接退出的,不管你什么事务提没提交</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">com.zhang.code</span><span class="o">;</span>


<span class="kn">import</span> <span class="nn">com.alibaba.fastjson.JSONObject</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">redis.clients.jedis.Jedis</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">redis.clients.jedis.Transaction</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">JedisTest</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Jedis</span> <span class="n">jedis</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Jedis</span><span class="o">(</span><span class="s">&#34;127.0.0.1&#34;</span><span class="o">,</span><span class="n">6379</span><span class="o">);</span>
        <span class="n">jedis</span><span class="o">.</span><span class="na">flushDB</span><span class="o">();</span>
<span class="c1">//        System.ut.println(jedis.ping());
</span><span class="c1"></span>        <span class="n">Transaction</span> <span class="n">multi</span> <span class="o">=</span> <span class="n">jedis</span><span class="o">.</span><span class="na">multi</span><span class="o">();</span>
        <span class="n">JSONObject</span> <span class="n">jsonObject</span> <span class="o">=</span> <span class="k">new</span> <span class="n">JSONObject</span><span class="o">();</span>
        <span class="n">jsonObject</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">&#34;username&#34;</span><span class="o">,</span><span class="s">&#34;zhangyuhang&#34;</span><span class="o">);</span>
        <span class="n">jsonObject</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">&#34;password&#34;</span><span class="o">,</span><span class="s">&#34;123456&#34;</span><span class="o">);</span>

        <span class="n">String</span> <span class="n">result</span> <span class="o">=</span> <span class="n">jsonObject</span><span class="o">.</span><span class="na">toJSONString</span><span class="o">();</span>

        <span class="k">try</span><span class="o">{</span>
            <span class="n">multi</span><span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="s">&#34;username&#34;</span><span class="o">,</span><span class="n">result</span><span class="o">);</span>
            <span class="n">multi</span><span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="s">&#34;password&#34;</span><span class="o">,</span><span class="n">result</span><span class="o">);</span>
            <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">1</span><span class="o">/</span><span class="n">0</span><span class="o">;</span>
            <span class="n">multi</span><span class="o">.</span><span class="na">exec</span><span class="o">();</span>
        <span class="o">}</span> <span class="k">catch</span><span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">){</span>
            <span class="c1">//multi.discard();
</span><span class="c1"></span>            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
        <span class="o">}</span> <span class="k">finally</span><span class="o">{</span>
            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">jedis</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">&#34;username&#34;</span><span class="o">));</span>
            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">jedis</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">&#34;password&#34;</span><span class="o">));</span>
            <span class="n">jedis</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><blockquote>
<p>这里如果有multi.discard();运行结果就是null</p>
<p>如果没有,就什么都没有</p>
<p>因为发生异常如果不取消事务,java中没执行jedis.exec();,你就算get了,这个jedis还是在事务中的,获取也不会给你结果</p>
<p>在事务中,get也算事务,在事务中get它不会给你结果的,直到你执行事务,它才会将所有你get的结果一起给你</p>
<p>所以在这个代码中,前提是int i = 1 / 0;这种异常直接从这行代码跳出try,永远不会执行multi.exec();</p>
<p>如果没有discard,就是还在事务中,你在finally中(任何地方)get是没有结果的</p>
<p>如果有discard,它没有执行事务,但是它退出事务了,所以它不是在当前事务中查找,而是在当前整个数据库中查找.之前flushDB过,而且事务又没有提交,当然是null了(不存在像事务中get有没有结果的情况)</p>
</blockquote>
<hr>
<h1 id="step13springboot整合redis">Step13.SpringBoot整合Redis</h1>
<ul>
<li>
<p>新建SpringBoot项目</p>
<p><img src="https://img-blog.csdnimg.cn/8a13149ae3c644319c09529e5d351ad7.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5a2k5ZCNQA==,size_20,color_FFFFFF,t_70,g_se,x_16" alt="Photo"></p>
<blockquote>
<p>依赖勾选上Redis(右边从上往下数第一个)</p>
</blockquote>
</li>
</ul>
<p><code>application.properties</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback"># 配置ip和端口号
spring.redis.host=127.0.0.1
spring.redis.port=6379
</code></pre></td></tr></table>
</div>
</div><ul>
<li>JDBC使用JDBCTemplate,Redis相似,Redis使用RedisTemplate</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">com.zhang.code</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.junit.jupiter.api.Test</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.beans.factory.annotation.Autowired</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.boot.test.context.SpringBootTest</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.data.redis.core.RedisTemplate</span><span class="o">;</span>

<span class="nd">@SpringBootTest</span>
<span class="kd">class</span> <span class="nc">SpringBootRedisApplicationTests</span> <span class="o">{</span>

    <span class="nd">@Autowired</span>
    <span class="kd">private</span> <span class="n">RedisTemplate</span> <span class="n">redisTemplate</span><span class="o">;</span>

    <span class="nd">@Test</span>
    <span class="kt">void</span> <span class="nf">contextLoads</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">redisTemplate</span><span class="o">.</span><span class="na">opsForValue</span><span class="o">().</span><span class="na">set</span><span class="o">(</span><span class="s">&#34;username&#34;</span><span class="o">,</span><span class="s">&#34;zhangyuhang&#34;</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">redisTemplate</span><span class="o">.</span><span class="na">opsForValue</span><span class="o">().</span><span class="na">get</span><span class="o">(</span><span class="s">&#34;username&#34;</span><span class="o">));</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><ul>
<li>
<p>结果是正确的,但是这时候问题就来了,在Ubuntu终端中查看keys *</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">127.0.0.1:6379&gt; keys *
1) &#34;\xac\xed\x00\x05t\x00\busername&#34;
127.0.0.1:6379&gt; 
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>显然结果是乱码的</p>
</li>
<li>
<p>SpringBoot集成Redis,无论是基本类型还是对象数据,都是需要将数据序列化的</p>
</li>
<li>
<p>现在set一个对象</p>
</li>
</ul>
<p><code>User.java</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">com.zhang.pojo</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">lombok.AllArgsConstructor</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">lombok.Data</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">lombok.NoArgsConstructor</span><span class="o">;</span>

<span class="nd">@AllArgsConstructor</span>
<span class="nd">@NoArgsConstructor</span>
<span class="nd">@Data</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">User</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">username</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">password</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p><code>SpringBootRedisApplicationTest.java</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">com.zhang</span><span class="o">;</span>


<span class="kn">import</span> <span class="nn">com.fasterxml.jackson.core.JsonProcessingException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.fasterxml.jackson.databind.ObjectMapper</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.zhang.pojo.User</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.junit.jupiter.api.Test</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.beans.factory.annotation.Autowired</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.boot.test.context.SpringBootTest</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.data.redis.core.RedisTemplate</span><span class="o">;</span>

<span class="nd">@SpringBootTest</span>
<span class="kd">class</span> <span class="nc">SpringBootRedisApplicationTests</span> <span class="o">{</span>

    <span class="nd">@Autowired</span>
    <span class="kd">private</span> <span class="n">RedisTemplate</span> <span class="n">redisTemplate</span><span class="o">;</span>

    <span class="nd">@Test</span>
    <span class="kt">void</span> <span class="nf">contextLoads</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">JsonProcessingException</span> <span class="o">{</span>
        <span class="n">User</span> <span class="n">user</span> <span class="o">=</span> <span class="k">new</span> <span class="n">User</span><span class="o">(</span><span class="s">&#34;zhangyuhang&#34;</span><span class="o">,</span><span class="s">&#34;!23456&#34;</span><span class="o">);</span>
        <span class="n">String</span> <span class="n">jsonUser</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ObjectMapper</span><span class="o">().</span><span class="na">writeValueAsString</span><span class="o">(</span><span class="n">user</span><span class="o">);</span>
        <span class="n">redisTemplate</span><span class="o">.</span><span class="na">opsForValue</span><span class="o">().</span><span class="na">set</span><span class="o">(</span><span class="s">&#34;user&#34;</span><span class="o">,</span><span class="n">jsonUser</span><span class="o">);</span>
    <span class="o">}</span>

<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><ul>
<li>我在这里ObjectMapper类型根本无法加载,好像是没导入什么依赖</li>
<li>对比了之前成功的项目,两个pom.xml好像并没有什么区别</li>
<li>不管那么多,直接把成功的依赖全拿过来</li>
</ul>
<p><code>pom.xml</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span><span class="lnt">128
</span><span class="lnt">129
</span><span class="lnt">130
</span><span class="lnt">131
</span><span class="lnt">132
</span><span class="lnt">133
</span><span class="lnt">134
</span><span class="lnt">135
</span><span class="lnt">136
</span><span class="lnt">137
</span><span class="lnt">138
</span><span class="lnt">139
</span><span class="lnt">140
</span><span class="lnt">141
</span><span class="lnt">142
</span><span class="lnt">143
</span><span class="lnt">144
</span><span class="lnt">145
</span><span class="lnt">146
</span><span class="lnt">147
</span><span class="lnt">148
</span><span class="lnt">149
</span><span class="lnt">150
</span><span class="lnt">151
</span><span class="lnt">152
</span><span class="lnt">153
</span><span class="lnt">154
</span><span class="lnt">155
</span><span class="lnt">156
</span><span class="lnt">157
</span><span class="lnt">158
</span><span class="lnt">159
</span><span class="lnt">160
</span><span class="lnt">161
</span><span class="lnt">162
</span><span class="lnt">163
</span><span class="lnt">164
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-xml" data-lang="xml"><span class="cp">&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;</span>
<span class="nt">&lt;project</span> <span class="na">xmlns=</span><span class="s">&#34;http://maven.apache.org/POM/4.0.0&#34;</span> <span class="na">xmlns:xsi=</span><span class="s">&#34;http://www.w3.org/2001/XMLSchema-instance&#34;</span>
         <span class="na">xsi:schemaLocation=</span><span class="s">&#34;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&#34;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;modelVersion&gt;</span>4.0.0<span class="nt">&lt;/modelVersion&gt;</span>
    <span class="nt">&lt;parent&gt;</span>
        <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
        <span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-parent<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;version&gt;</span>2.5.6<span class="nt">&lt;/version&gt;</span>
        <span class="nt">&lt;relativePath/&gt;</span> <span class="c">&lt;!-- lookup parent from repository --&gt;</span>
    <span class="nt">&lt;/parent&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>com.zhang<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>redis-test<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;version&gt;</span>0.0.1-SNAPSHOT<span class="nt">&lt;/version&gt;</span>
    <span class="nt">&lt;name&gt;</span>redis-test<span class="nt">&lt;/name&gt;</span>
    <span class="nt">&lt;description&gt;</span>Demo project for Spring Boot<span class="nt">&lt;/description&gt;</span>
    <span class="nt">&lt;properties&gt;</span>
        <span class="nt">&lt;java.version&gt;</span>1.8<span class="nt">&lt;/java.version&gt;</span>
        <span class="nt">&lt;repackage.classifier/&gt;</span>
        <span class="nt">&lt;spring-native.version&gt;</span>0.10.4<span class="nt">&lt;/spring-native.version&gt;</span>
    <span class="nt">&lt;/properties&gt;</span>
    <span class="nt">&lt;dependencies&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-data-redis<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-web<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.springframework.experimental<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>spring-native<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;version&gt;</span>${spring-native.version}<span class="nt">&lt;/version&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>

        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>spring-boot-devtools<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;scope&gt;</span>runtime<span class="nt">&lt;/scope&gt;</span>
            <span class="nt">&lt;optional&gt;</span>true<span class="nt">&lt;/optional&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>spring-boot-configuration-processor<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;optional&gt;</span>true<span class="nt">&lt;/optional&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.projectlombok<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>lombok<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;optional&gt;</span>true<span class="nt">&lt;/optional&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-test<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;scope&gt;</span>test<span class="nt">&lt;/scope&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>
    <span class="nt">&lt;/dependencies&gt;</span>

    <span class="nt">&lt;build&gt;</span>
        <span class="nt">&lt;plugins&gt;</span>
            <span class="nt">&lt;plugin&gt;</span>
                <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
                <span class="nt">&lt;artifactId&gt;</span>spring-boot-maven-plugin<span class="nt">&lt;/artifactId&gt;</span>
                <span class="nt">&lt;configuration&gt;</span>
                    <span class="nt">&lt;excludes&gt;</span>
                        <span class="nt">&lt;exclude&gt;</span>
                            <span class="nt">&lt;groupId&gt;</span>org.projectlombok<span class="nt">&lt;/groupId&gt;</span>
                            <span class="nt">&lt;artifactId&gt;</span>lombok<span class="nt">&lt;/artifactId&gt;</span>
                        <span class="nt">&lt;/exclude&gt;</span>
                    <span class="nt">&lt;/excludes&gt;</span>
                    <span class="nt">&lt;classifier&gt;</span>${repackage.classifier}<span class="nt">&lt;/classifier&gt;</span>
                    <span class="nt">&lt;image&gt;</span>
                        <span class="nt">&lt;builder&gt;</span>paketobuildpacks/builder:tiny<span class="nt">&lt;/builder&gt;</span>
                        <span class="nt">&lt;env&gt;</span>
                            <span class="nt">&lt;BP_NATIVE_IMAGE&gt;</span>true<span class="nt">&lt;/BP_NATIVE_IMAGE&gt;</span>
                        <span class="nt">&lt;/env&gt;</span>
                    <span class="nt">&lt;/image&gt;</span>
                <span class="nt">&lt;/configuration&gt;</span>
            <span class="nt">&lt;/plugin&gt;</span>
            <span class="nt">&lt;plugin&gt;</span>
                <span class="nt">&lt;groupId&gt;</span>org.springframework.experimental<span class="nt">&lt;/groupId&gt;</span>
                <span class="nt">&lt;artifactId&gt;</span>spring-aot-maven-plugin<span class="nt">&lt;/artifactId&gt;</span>
                <span class="nt">&lt;version&gt;</span>${spring-native.version}<span class="nt">&lt;/version&gt;</span>
                <span class="nt">&lt;executions&gt;</span>
                    <span class="nt">&lt;execution&gt;</span>
                        <span class="nt">&lt;id&gt;</span>test-generate<span class="nt">&lt;/id&gt;</span>
                        <span class="nt">&lt;goals&gt;</span>
                            <span class="nt">&lt;goal&gt;</span>test-generate<span class="nt">&lt;/goal&gt;</span>
                        <span class="nt">&lt;/goals&gt;</span>
                    <span class="nt">&lt;/execution&gt;</span>
                    <span class="nt">&lt;execution&gt;</span>
                        <span class="nt">&lt;id&gt;</span>generate<span class="nt">&lt;/id&gt;</span>
                        <span class="nt">&lt;goals&gt;</span>
                            <span class="nt">&lt;goal&gt;</span>generate<span class="nt">&lt;/goal&gt;</span>
                        <span class="nt">&lt;/goals&gt;</span>
                    <span class="nt">&lt;/execution&gt;</span>
                <span class="nt">&lt;/executions&gt;</span>
            <span class="nt">&lt;/plugin&gt;</span>
        <span class="nt">&lt;/plugins&gt;</span>
    <span class="nt">&lt;/build&gt;</span>
    <span class="nt">&lt;repositories&gt;</span>
        <span class="nt">&lt;repository&gt;</span>
            <span class="nt">&lt;id&gt;</span>spring-releases<span class="nt">&lt;/id&gt;</span>
            <span class="nt">&lt;name&gt;</span>Spring Releases<span class="nt">&lt;/name&gt;</span>
            <span class="nt">&lt;url&gt;</span>https://repo.spring.io/release<span class="nt">&lt;/url&gt;</span>
            <span class="nt">&lt;snapshots&gt;</span>
                <span class="nt">&lt;enabled&gt;</span>false<span class="nt">&lt;/enabled&gt;</span>
            <span class="nt">&lt;/snapshots&gt;</span>
        <span class="nt">&lt;/repository&gt;</span>
    <span class="nt">&lt;/repositories&gt;</span>
    <span class="nt">&lt;pluginRepositories&gt;</span>
        <span class="nt">&lt;pluginRepository&gt;</span>
            <span class="nt">&lt;id&gt;</span>spring-releases<span class="nt">&lt;/id&gt;</span>
            <span class="nt">&lt;name&gt;</span>Spring Releases<span class="nt">&lt;/name&gt;</span>
            <span class="nt">&lt;url&gt;</span>https://repo.spring.io/release<span class="nt">&lt;/url&gt;</span>
            <span class="nt">&lt;snapshots&gt;</span>
                <span class="nt">&lt;enabled&gt;</span>false<span class="nt">&lt;/enabled&gt;</span>
            <span class="nt">&lt;/snapshots&gt;</span>
        <span class="nt">&lt;/pluginRepository&gt;</span>
    <span class="nt">&lt;/pluginRepositories&gt;</span>

    <span class="nt">&lt;profiles&gt;</span>
        <span class="nt">&lt;profile&gt;</span>
            <span class="nt">&lt;id&gt;</span>native<span class="nt">&lt;/id&gt;</span>
            <span class="nt">&lt;properties&gt;</span>
                <span class="nt">&lt;repackage.classifier&gt;</span>exec<span class="nt">&lt;/repackage.classifier&gt;</span>
                <span class="nt">&lt;native-buildtools.version&gt;</span>0.9.3<span class="nt">&lt;/native-buildtools.version&gt;</span>
            <span class="nt">&lt;/properties&gt;</span>
            <span class="nt">&lt;dependencies&gt;</span>
                <span class="nt">&lt;dependency&gt;</span>
                    <span class="nt">&lt;groupId&gt;</span>org.graalvm.buildtools<span class="nt">&lt;/groupId&gt;</span>
                    <span class="nt">&lt;artifactId&gt;</span>junit-platform-native<span class="nt">&lt;/artifactId&gt;</span>
                    <span class="nt">&lt;version&gt;</span>${native-buildtools.version}<span class="nt">&lt;/version&gt;</span>
                    <span class="nt">&lt;scope&gt;</span>test<span class="nt">&lt;/scope&gt;</span>
                <span class="nt">&lt;/dependency&gt;</span>
            <span class="nt">&lt;/dependencies&gt;</span>
            <span class="nt">&lt;build&gt;</span>
                <span class="nt">&lt;plugins&gt;</span>
                    <span class="nt">&lt;plugin&gt;</span>
                        <span class="nt">&lt;groupId&gt;</span>org.graalvm.buildtools<span class="nt">&lt;/groupId&gt;</span>
                        <span class="nt">&lt;artifactId&gt;</span>native-maven-plugin<span class="nt">&lt;/artifactId&gt;</span>
                        <span class="nt">&lt;version&gt;</span>${native-buildtools.version}<span class="nt">&lt;/version&gt;</span>
                        <span class="nt">&lt;executions&gt;</span>
                            <span class="nt">&lt;execution&gt;</span>
                                <span class="nt">&lt;id&gt;</span>test-native<span class="nt">&lt;/id&gt;</span>
                                <span class="nt">&lt;phase&gt;</span>test<span class="nt">&lt;/phase&gt;</span>
                                <span class="nt">&lt;goals&gt;</span>
                                    <span class="nt">&lt;goal&gt;</span>test<span class="nt">&lt;/goal&gt;</span>
                                <span class="nt">&lt;/goals&gt;</span>
                            <span class="nt">&lt;/execution&gt;</span>
                            <span class="nt">&lt;execution&gt;</span>
                                <span class="nt">&lt;id&gt;</span>build-native<span class="nt">&lt;/id&gt;</span>
                                <span class="nt">&lt;phase&gt;</span>package<span class="nt">&lt;/phase&gt;</span>
                                <span class="nt">&lt;goals&gt;</span>
                                    <span class="nt">&lt;goal&gt;</span>build<span class="nt">&lt;/goal&gt;</span>
                                <span class="nt">&lt;/goals&gt;</span>
                            <span class="nt">&lt;/execution&gt;</span>
                        <span class="nt">&lt;/executions&gt;</span>
                    <span class="nt">&lt;/plugin&gt;</span>
                <span class="nt">&lt;/plugins&gt;</span>
            <span class="nt">&lt;/build&gt;</span>
        <span class="nt">&lt;/profile&gt;</span>
    <span class="nt">&lt;/profiles&gt;</span>
<span class="nt">&lt;/project&gt;</span>
</code></pre></td></tr></table>
</div>
</div><ul>
<li>上面说set对象需要序列化,使用RedisTemplate</li>
<li>但是据狂神说在工作开发中经常要使用到自己封装的RedisTemplate</li>
<li>在RedisConfig.java中将自己编写的redisTemplate方法注册到@Bean中,这个方法返回一个自定义的RedisTemplate对象</li>
</ul>
<p><code>RedisConfig.java</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">com.zhang.config</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.fasterxml.jackson.annotation.JsonAutoDetect</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.fasterxml.jackson.annotation.PropertyAccessor</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.fasterxml.jackson.databind.ObjectMapper</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.Bean</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.Configuration</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.data.redis.connection.RedisConnectionFactory</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.data.redis.core.RedisTemplate</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.data.redis.serializer.Jackson2JsonRedisSerializer</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.data.redis.serializer.StringRedisSerializer</span><span class="o">;</span>

<span class="nd">@Configuration</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">RedisConfig</span> <span class="o">{</span>

    <span class="nd">@Bean</span>
    <span class="kd">public</span> <span class="n">RedisTemplate</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span><span class="n">Object</span><span class="o">&gt;</span> <span class="nf">redisTemplate</span><span class="o">(</span><span class="n">RedisConnectionFactory</span> <span class="n">redisConnectionFactory</span><span class="o">){</span>
        <span class="c1">//new一个RedisTemplate,并设置连接工
</span><span class="c1"></span>        <span class="n">RedisTemplate</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span><span class="n">Object</span><span class="o">&gt;</span> <span class="n">template</span> <span class="o">=</span> <span class="k">new</span> <span class="n">RedisTemplate</span><span class="o">&lt;&gt;();</span>
        <span class="n">template</span><span class="o">.</span><span class="na">setConnectionFactory</span><span class="o">(</span><span class="n">redisConnectionFactory</span><span class="o">);</span>

        <span class="c1">//RedisTemplate的key使用String序列化方式,value使用json序列化方式
</span><span class="c1"></span>
        <span class="c1">//创造两者
</span><span class="c1"></span>
        <span class="c1">//设置json序列化
</span><span class="c1"></span>        <span class="c1">//------------------------------------------------------------------------------------------------&gt;
</span><span class="c1"></span>        <span class="c1">//json就是将对象序列化,所以需要一个Object.class
</span><span class="c1"></span>        <span class="n">Jackson2JsonRedisSerializer</span> <span class="n">jackson2JsonRedisSerializer</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Jackson2JsonRedisSerializer</span><span class="o">(</span><span class="n">Object</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

        <span class="c1">//将对象序列化就是使用json的ObjectMapper将对象封装
</span><span class="c1"></span>        <span class="n">ObjectMapper</span> <span class="n">objectMapper</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ObjectMapper</span><span class="o">();</span>
        <span class="n">objectMapper</span><span class="o">.</span><span class="na">setVisibility</span><span class="o">(</span><span class="n">PropertyAccessor</span><span class="o">.</span><span class="na">ALL</span><span class="o">,</span> <span class="n">JsonAutoDetect</span><span class="o">.</span><span class="na">Visibility</span><span class="o">.</span><span class="na">ANY</span><span class="o">);</span>
        <span class="n">objectMapper</span><span class="o">.</span><span class="na">enableDefaultTyping</span><span class="o">(</span><span class="n">ObjectMapper</span><span class="o">.</span><span class="na">DefaultTyping</span><span class="o">.</span><span class="na">NON_FINAL</span><span class="o">);</span>

        <span class="c1">//将设置好的ObjectMapper放置到Jackson2JsonRedisSerializer中
</span><span class="c1"></span>        <span class="n">jackson2JsonRedisSerializer</span><span class="o">.</span><span class="na">setObjectMapper</span><span class="o">(</span><span class="n">objectMapper</span><span class="o">);</span>
        <span class="c1">//-------------------------------------------------------------------------------------------------&gt;
</span><span class="c1"></span>

        <span class="c1">//设置String序列化
</span><span class="c1"></span>        <span class="c1">//-------------------------------------------------------------------------------------------------&gt;
</span><span class="c1"></span>        <span class="n">StringRedisSerializer</span> <span class="n">stringRedisSerializer</span> <span class="o">=</span> <span class="k">new</span> <span class="n">StringRedisSerializer</span><span class="o">();</span>
        <span class="c1">//-------------------------------------------------------------------------------------------------&gt;
</span><span class="c1"></span>

        <span class="c1">//设置String的key的序列化为StringRedisSerializer
</span><span class="c1"></span>        <span class="n">template</span><span class="o">.</span><span class="na">setKeySerializer</span><span class="o">(</span><span class="n">stringRedisSerializer</span><span class="o">);</span>

        <span class="c1">//设置String的value的序列化为json
</span><span class="c1"></span>        <span class="n">template</span><span class="o">.</span><span class="na">setValueSerializer</span><span class="o">(</span><span class="n">jackson2JsonRedisSerializer</span><span class="o">);</span>

        <span class="c1">//设置String的value的序列化为StringRedisSerializer
</span><span class="c1"></span>        <span class="n">template</span><span class="o">.</span><span class="na">setHashKeySerializer</span><span class="o">(</span><span class="n">stringRedisSerializer</span><span class="o">);</span>

        <span class="c1">//设置hash的value的序列化为json
</span><span class="c1"></span>        <span class="n">template</span><span class="o">.</span><span class="na">setHashValueSerializer</span><span class="o">(</span><span class="n">jackson2JsonRedisSerializer</span><span class="o">);</span>

        <span class="c1">//将设置好的template所有属性设置进去
</span><span class="c1"></span>        <span class="n">template</span><span class="o">.</span><span class="na">afterPropertiesSet</span><span class="o">();</span>

        <span class="k">return</span> <span class="n">template</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><blockquote>
<p>这是工具类,直接拿过来用就好</p>
</blockquote>
<ul>
<li>但是通常不会这样直接搞,而是会进一步封装,封装成Utils类工具类,自定义RedisTemplate中自定义的所有数据库操作方法</li>
</ul>
<p><code>RedisUtil.java</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span><span class="lnt">128
</span><span class="lnt">129
</span><span class="lnt">130
</span><span class="lnt">131
</span><span class="lnt">132
</span><span class="lnt">133
</span><span class="lnt">134
</span><span class="lnt">135
</span><span class="lnt">136
</span><span class="lnt">137
</span><span class="lnt">138
</span><span class="lnt">139
</span><span class="lnt">140
</span><span class="lnt">141
</span><span class="lnt">142
</span><span class="lnt">143
</span><span class="lnt">144
</span><span class="lnt">145
</span><span class="lnt">146
</span><span class="lnt">147
</span><span class="lnt">148
</span><span class="lnt">149
</span><span class="lnt">150
</span><span class="lnt">151
</span><span class="lnt">152
</span><span class="lnt">153
</span><span class="lnt">154
</span><span class="lnt">155
</span><span class="lnt">156
</span><span class="lnt">157
</span><span class="lnt">158
</span><span class="lnt">159
</span><span class="lnt">160
</span><span class="lnt">161
</span><span class="lnt">162
</span><span class="lnt">163
</span><span class="lnt">164
</span><span class="lnt">165
</span><span class="lnt">166
</span><span class="lnt">167
</span><span class="lnt">168
</span><span class="lnt">169
</span><span class="lnt">170
</span><span class="lnt">171
</span><span class="lnt">172
</span><span class="lnt">173
</span><span class="lnt">174
</span><span class="lnt">175
</span><span class="lnt">176
</span><span class="lnt">177
</span><span class="lnt">178
</span><span class="lnt">179
</span><span class="lnt">180
</span><span class="lnt">181
</span><span class="lnt">182
</span><span class="lnt">183
</span><span class="lnt">184
</span><span class="lnt">185
</span><span class="lnt">186
</span><span class="lnt">187
</span><span class="lnt">188
</span><span class="lnt">189
</span><span class="lnt">190
</span><span class="lnt">191
</span><span class="lnt">192
</span><span class="lnt">193
</span><span class="lnt">194
</span><span class="lnt">195
</span><span class="lnt">196
</span><span class="lnt">197
</span><span class="lnt">198
</span><span class="lnt">199
</span><span class="lnt">200
</span><span class="lnt">201
</span><span class="lnt">202
</span><span class="lnt">203
</span><span class="lnt">204
</span><span class="lnt">205
</span><span class="lnt">206
</span><span class="lnt">207
</span><span class="lnt">208
</span><span class="lnt">209
</span><span class="lnt">210
</span><span class="lnt">211
</span><span class="lnt">212
</span><span class="lnt">213
</span><span class="lnt">214
</span><span class="lnt">215
</span><span class="lnt">216
</span><span class="lnt">217
</span><span class="lnt">218
</span><span class="lnt">219
</span><span class="lnt">220
</span><span class="lnt">221
</span><span class="lnt">222
</span><span class="lnt">223
</span><span class="lnt">224
</span><span class="lnt">225
</span><span class="lnt">226
</span><span class="lnt">227
</span><span class="lnt">228
</span><span class="lnt">229
</span><span class="lnt">230
</span><span class="lnt">231
</span><span class="lnt">232
</span><span class="lnt">233
</span><span class="lnt">234
</span><span class="lnt">235
</span><span class="lnt">236
</span><span class="lnt">237
</span><span class="lnt">238
</span><span class="lnt">239
</span><span class="lnt">240
</span><span class="lnt">241
</span><span class="lnt">242
</span><span class="lnt">243
</span><span class="lnt">244
</span><span class="lnt">245
</span><span class="lnt">246
</span><span class="lnt">247
</span><span class="lnt">248
</span><span class="lnt">249
</span><span class="lnt">250
</span><span class="lnt">251
</span><span class="lnt">252
</span><span class="lnt">253
</span><span class="lnt">254
</span><span class="lnt">255
</span><span class="lnt">256
</span><span class="lnt">257
</span><span class="lnt">258
</span><span class="lnt">259
</span><span class="lnt">260
</span><span class="lnt">261
</span><span class="lnt">262
</span><span class="lnt">263
</span><span class="lnt">264
</span><span class="lnt">265
</span><span class="lnt">266
</span><span class="lnt">267
</span><span class="lnt">268
</span><span class="lnt">269
</span><span class="lnt">270
</span><span class="lnt">271
</span><span class="lnt">272
</span><span class="lnt">273
</span><span class="lnt">274
</span><span class="lnt">275
</span><span class="lnt">276
</span><span class="lnt">277
</span><span class="lnt">278
</span><span class="lnt">279
</span><span class="lnt">280
</span><span class="lnt">281
</span><span class="lnt">282
</span><span class="lnt">283
</span><span class="lnt">284
</span><span class="lnt">285
</span><span class="lnt">286
</span><span class="lnt">287
</span><span class="lnt">288
</span><span class="lnt">289
</span><span class="lnt">290
</span><span class="lnt">291
</span><span class="lnt">292
</span><span class="lnt">293
</span><span class="lnt">294
</span><span class="lnt">295
</span><span class="lnt">296
</span><span class="lnt">297
</span><span class="lnt">298
</span><span class="lnt">299
</span><span class="lnt">300
</span><span class="lnt">301
</span><span class="lnt">302
</span><span class="lnt">303
</span><span class="lnt">304
</span><span class="lnt">305
</span><span class="lnt">306
</span><span class="lnt">307
</span><span class="lnt">308
</span><span class="lnt">309
</span><span class="lnt">310
</span><span class="lnt">311
</span><span class="lnt">312
</span><span class="lnt">313
</span><span class="lnt">314
</span><span class="lnt">315
</span><span class="lnt">316
</span><span class="lnt">317
</span><span class="lnt">318
</span><span class="lnt">319
</span><span class="lnt">320
</span><span class="lnt">321
</span><span class="lnt">322
</span><span class="lnt">323
</span><span class="lnt">324
</span><span class="lnt">325
</span><span class="lnt">326
</span><span class="lnt">327
</span><span class="lnt">328
</span><span class="lnt">329
</span><span class="lnt">330
</span><span class="lnt">331
</span><span class="lnt">332
</span><span class="lnt">333
</span><span class="lnt">334
</span><span class="lnt">335
</span><span class="lnt">336
</span><span class="lnt">337
</span><span class="lnt">338
</span><span class="lnt">339
</span><span class="lnt">340
</span><span class="lnt">341
</span><span class="lnt">342
</span><span class="lnt">343
</span><span class="lnt">344
</span><span class="lnt">345
</span><span class="lnt">346
</span><span class="lnt">347
</span><span class="lnt">348
</span><span class="lnt">349
</span><span class="lnt">350
</span><span class="lnt">351
</span><span class="lnt">352
</span><span class="lnt">353
</span><span class="lnt">354
</span><span class="lnt">355
</span><span class="lnt">356
</span><span class="lnt">357
</span><span class="lnt">358
</span><span class="lnt">359
</span><span class="lnt">360
</span><span class="lnt">361
</span><span class="lnt">362
</span><span class="lnt">363
</span><span class="lnt">364
</span><span class="lnt">365
</span><span class="lnt">366
</span><span class="lnt">367
</span><span class="lnt">368
</span><span class="lnt">369
</span><span class="lnt">370
</span><span class="lnt">371
</span><span class="lnt">372
</span><span class="lnt">373
</span><span class="lnt">374
</span><span class="lnt">375
</span><span class="lnt">376
</span><span class="lnt">377
</span><span class="lnt">378
</span><span class="lnt">379
</span><span class="lnt">380
</span><span class="lnt">381
</span><span class="lnt">382
</span><span class="lnt">383
</span><span class="lnt">384
</span><span class="lnt">385
</span><span class="lnt">386
</span><span class="lnt">387
</span><span class="lnt">388
</span><span class="lnt">389
</span><span class="lnt">390
</span><span class="lnt">391
</span><span class="lnt">392
</span><span class="lnt">393
</span><span class="lnt">394
</span><span class="lnt">395
</span><span class="lnt">396
</span><span class="lnt">397
</span><span class="lnt">398
</span><span class="lnt">399
</span><span class="lnt">400
</span><span class="lnt">401
</span><span class="lnt">402
</span><span class="lnt">403
</span><span class="lnt">404
</span><span class="lnt">405
</span><span class="lnt">406
</span><span class="lnt">407
</span><span class="lnt">408
</span><span class="lnt">409
</span><span class="lnt">410
</span><span class="lnt">411
</span><span class="lnt">412
</span><span class="lnt">413
</span><span class="lnt">414
</span><span class="lnt">415
</span><span class="lnt">416
</span><span class="lnt">417
</span><span class="lnt">418
</span><span class="lnt">419
</span><span class="lnt">420
</span><span class="lnt">421
</span><span class="lnt">422
</span><span class="lnt">423
</span><span class="lnt">424
</span><span class="lnt">425
</span><span class="lnt">426
</span><span class="lnt">427
</span><span class="lnt">428
</span><span class="lnt">429
</span><span class="lnt">430
</span><span class="lnt">431
</span><span class="lnt">432
</span><span class="lnt">433
</span><span class="lnt">434
</span><span class="lnt">435
</span><span class="lnt">436
</span><span class="lnt">437
</span><span class="lnt">438
</span><span class="lnt">439
</span><span class="lnt">440
</span><span class="lnt">441
</span><span class="lnt">442
</span><span class="lnt">443
</span><span class="lnt">444
</span><span class="lnt">445
</span><span class="lnt">446
</span><span class="lnt">447
</span><span class="lnt">448
</span><span class="lnt">449
</span><span class="lnt">450
</span><span class="lnt">451
</span><span class="lnt">452
</span><span class="lnt">453
</span><span class="lnt">454
</span><span class="lnt">455
</span><span class="lnt">456
</span><span class="lnt">457
</span><span class="lnt">458
</span><span class="lnt">459
</span><span class="lnt">460
</span><span class="lnt">461
</span><span class="lnt">462
</span><span class="lnt">463
</span><span class="lnt">464
</span><span class="lnt">465
</span><span class="lnt">466
</span><span class="lnt">467
</span><span class="lnt">468
</span><span class="lnt">469
</span><span class="lnt">470
</span><span class="lnt">471
</span><span class="lnt">472
</span><span class="lnt">473
</span><span class="lnt">474
</span><span class="lnt">475
</span><span class="lnt">476
</span><span class="lnt">477
</span><span class="lnt">478
</span><span class="lnt">479
</span><span class="lnt">480
</span><span class="lnt">481
</span><span class="lnt">482
</span><span class="lnt">483
</span><span class="lnt">484
</span><span class="lnt">485
</span><span class="lnt">486
</span><span class="lnt">487
</span><span class="lnt">488
</span><span class="lnt">489
</span><span class="lnt">490
</span><span class="lnt">491
</span><span class="lnt">492
</span><span class="lnt">493
</span><span class="lnt">494
</span><span class="lnt">495
</span><span class="lnt">496
</span><span class="lnt">497
</span><span class="lnt">498
</span><span class="lnt">499
</span><span class="lnt">500
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">com.zhang.utils</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.beans.factory.annotation.Autowired</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.data.redis.core.RedisTemplate</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Component</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.util.CollectionUtils</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Collection</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Map</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Set</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.concurrent.TimeUnit</span><span class="o">;</span>

<span class="nd">@Component</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">RedisUtil</span> <span class="o">{</span>
    <span class="nd">@Autowired</span>
    <span class="kd">private</span> <span class="n">RedisTemplate</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;</span> <span class="n">redisTemplate</span><span class="o">;</span>
    <span class="c1">// =============================common============================
</span><span class="c1"></span>    <span class="cm">/**
</span><span class="cm">     * 指定缓存失效时间
</span><span class="cm">     * @param key 键
</span><span class="cm">     * @param time 时间(秒)
</span><span class="cm">     */</span>
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">expire</span><span class="o">(</span><span class="n">String</span> <span class="n">key</span><span class="o">,</span> <span class="kt">long</span> <span class="n">time</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">try</span><span class="o">{</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">time</span> <span class="o">&gt;</span> <span class="n">0</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">redisTemplate</span><span class="o">.</span><span class="na">expire</span><span class="o">(</span><span class="n">key</span><span class="o">,</span> <span class="n">time</span><span class="o">,</span> <span class="n">TimeUnit</span><span class="o">.</span><span class="na">SECONDS</span><span class="o">);</span>
            <span class="o">}</span>
            <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
            <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
        <span class="o">}</span>
    <span class="o">}</span>
    <span class="cm">/**
</span><span class="cm">     * 根据key 获取过期时间
</span><span class="cm">     * @param key 键 不能为null
</span><span class="cm">     * @return 时间(秒) 返回0代表为永久有效
</span><span class="cm">     */</span>
    <span class="kd">public</span> <span class="kt">long</span> <span class="nf">getExpire</span><span class="o">(</span><span class="n">String</span> <span class="n">key</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">redisTemplate</span><span class="o">.</span><span class="na">getExpire</span><span class="o">(</span><span class="n">key</span><span class="o">,</span> <span class="n">TimeUnit</span><span class="o">.</span><span class="na">SECONDS</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="cm">/**
</span><span class="cm">     * 判断key是否存在
</span><span class="cm">     * @param key 键
</span><span class="cm">     * @return true 存在 false不存在
</span><span class="cm">     */</span>
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">hasKey</span><span class="o">(</span><span class="n">String</span> <span class="n">key</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="k">return</span> <span class="n">redisTemplate</span><span class="o">.</span><span class="na">hasKey</span><span class="o">(</span><span class="n">key</span><span class="o">);</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
            <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
        <span class="o">}</span>
    <span class="o">}</span>
    <span class="cm">/**
</span><span class="cm">     * 删除缓存
</span><span class="cm">     * @param key 可以传一个值 或多个
</span><span class="cm">     */</span>
    <span class="nd">@SuppressWarnings</span><span class="o">(</span><span class="s">&#34;unchecked&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">del</span><span class="o">(</span><span class="n">String</span><span class="o">...</span> <span class="n">key</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">key</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="n">key</span><span class="o">.</span><span class="na">length</span> <span class="o">&gt;</span> <span class="n">0</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">key</span><span class="o">.</span><span class="na">length</span> <span class="o">==</span> <span class="n">1</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">redisTemplate</span><span class="o">.</span><span class="na">delete</span><span class="o">(</span><span class="n">key</span><span class="o">[</span><span class="n">0</span><span class="o">]);</span>
            <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
                <span class="n">redisTemplate</span><span class="o">.</span><span class="na">delete</span><span class="o">((</span><span class="n">Collection</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;)</span> <span class="n">CollectionUtils</span><span class="o">.</span><span class="na">arrayToList</span><span class="o">(</span><span class="n">key</span><span class="o">));</span>
            <span class="o">}</span>
        <span class="o">}</span>
    <span class="o">}</span>
    <span class="c1">// ============================String=============================
</span><span class="c1"></span>    <span class="cm">/**
</span><span class="cm">     * 普通缓存获取
</span><span class="cm">     * @param key 键
</span><span class="cm">     * @return 值
</span><span class="cm">     */</span>
    <span class="kd">public</span> <span class="n">Object</span> <span class="nf">get</span><span class="o">(</span><span class="n">String</span> <span class="n">key</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">key</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">?</span> <span class="kc">null</span> <span class="o">:</span> <span class="n">redisTemplate</span><span class="o">.</span><span class="na">opsForValue</span><span class="o">().</span><span class="na">get</span><span class="o">(</span><span class="n">key</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="cm">/**
</span><span class="cm">     * 普通缓存放入
</span><span class="cm">     * @param key  键
</span><span class="cm">     * @param value 值
</span><span class="cm">     * @return true成功 false失败
</span><span class="cm">     */</span>
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">set</span><span class="o">(</span><span class="n">String</span> <span class="n">key</span><span class="o">,</span> <span class="n">Object</span> <span class="n">value</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="n">redisTemplate</span><span class="o">.</span><span class="na">opsForValue</span><span class="o">().</span><span class="na">set</span><span class="o">(</span><span class="n">key</span><span class="o">,</span> <span class="n">value</span><span class="o">);</span>
            <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
            <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
        <span class="o">}</span>
    <span class="o">}</span>
    <span class="cm">/**
</span><span class="cm">     * 普通缓存放入并设置时间
</span><span class="cm">     * @param key  键
</span><span class="cm">     * @param value 值
</span><span class="cm">     * @param time 时间(秒) time要大于0 如果time小于等于0 将设置无限期
</span><span class="cm">     * @return true成功 false 失败
</span><span class="cm">     */</span>
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">set</span><span class="o">(</span><span class="n">String</span> <span class="n">key</span><span class="o">,</span> <span class="n">Object</span> <span class="n">value</span><span class="o">,</span> <span class="kt">long</span> <span class="n">time</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">time</span> <span class="o">&gt;</span> <span class="n">0</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">redisTemplate</span><span class="o">.</span><span class="na">opsForValue</span><span class="o">().</span><span class="na">set</span><span class="o">(</span><span class="n">key</span><span class="o">,</span> <span class="n">value</span><span class="o">,</span> <span class="n">time</span><span class="o">,</span>
                        <span class="n">TimeUnit</span><span class="o">.</span><span class="na">SECONDS</span><span class="o">);</span>
            <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
                <span class="n">set</span><span class="o">(</span><span class="n">key</span><span class="o">,</span> <span class="n">value</span><span class="o">);</span>
            <span class="o">}</span>
            <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
            <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
        <span class="o">}</span>
    <span class="o">}</span>
    <span class="cm">/**
</span><span class="cm">     * 递增
</span><span class="cm">     * @param key  键
</span><span class="cm">     * @param delta 要增加几(大于0)
</span><span class="cm">     */</span>
    <span class="kd">public</span> <span class="kt">long</span> <span class="nf">incr</span><span class="o">(</span><span class="n">String</span> <span class="n">key</span><span class="o">,</span> <span class="kt">long</span> <span class="n">delta</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">delta</span> <span class="o">&lt;</span> <span class="n">0</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="n">RuntimeException</span><span class="o">(</span><span class="s">&#34;递增因子必须大于0&#34;</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="n">redisTemplate</span><span class="o">.</span><span class="na">opsForValue</span><span class="o">().</span><span class="na">increment</span><span class="o">(</span><span class="n">key</span><span class="o">,</span> <span class="n">delta</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="cm">/**
</span><span class="cm">     * 递减
</span><span class="cm">     * @param key  键
</span><span class="cm">     * @param delta 要减少几(小于0)
</span><span class="cm">     */</span>
    <span class="kd">public</span> <span class="kt">long</span> <span class="nf">decr</span><span class="o">(</span><span class="n">String</span> <span class="n">key</span><span class="o">,</span> <span class="kt">long</span> <span class="n">delta</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">delta</span> <span class="o">&lt;</span> <span class="n">0</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="n">RuntimeException</span><span class="o">(</span><span class="s">&#34;递减因子必须大于0&#34;</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="n">redisTemplate</span><span class="o">.</span><span class="na">opsForValue</span><span class="o">().</span><span class="na">increment</span><span class="o">(</span><span class="n">key</span><span class="o">,</span> <span class="o">-</span><span class="n">delta</span><span class="o">);</span>
    <span class="o">}</span>
<span class="c1">// ================================Map=================================
</span><span class="c1"></span>    <span class="cm">/**
</span><span class="cm">     * HashGet
</span><span class="cm">     * @param key 键 不能为null
</span><span class="cm">     * @param item 项 不能为null
</span><span class="cm">     */</span>
    <span class="kd">public</span> <span class="n">Object</span> <span class="nf">hget</span><span class="o">(</span><span class="n">String</span> <span class="n">key</span><span class="o">,</span> <span class="n">String</span> <span class="n">item</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">redisTemplate</span><span class="o">.</span><span class="na">opsForHash</span><span class="o">().</span><span class="na">get</span><span class="o">(</span><span class="n">key</span><span class="o">,</span> <span class="n">item</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="cm">/**
</span><span class="cm">     * 获取hashKey对应的所有键值
</span><span class="cm">     * @param key 键
</span><span class="cm">     * @return 对应的多个键值
</span><span class="cm">     */</span>
    <span class="kd">public</span> <span class="n">Map</span><span class="o">&lt;</span><span class="n">Object</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;</span> <span class="nf">hmget</span><span class="o">(</span><span class="n">String</span> <span class="n">key</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">redisTemplate</span><span class="o">.</span><span class="na">opsForHash</span><span class="o">().</span><span class="na">entries</span><span class="o">(</span><span class="n">key</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="cm">/**
</span><span class="cm">     * HashSet
</span><span class="cm">     * @param key 键
</span><span class="cm">     * @param map 对应多个键值
</span><span class="cm">     */</span>
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">hmset</span><span class="o">(</span><span class="n">String</span> <span class="n">key</span><span class="o">,</span> <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;</span> <span class="n">map</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="n">redisTemplate</span><span class="o">.</span><span class="na">opsForHash</span><span class="o">().</span><span class="na">putAll</span><span class="o">(</span><span class="n">key</span><span class="o">,</span> <span class="n">map</span><span class="o">);</span>
            <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
            <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
        <span class="o">}</span>
    <span class="o">}</span>
    <span class="cm">/**
</span><span class="cm">     * HashSet 并设置时间
</span><span class="cm">     * @param key 键
</span><span class="cm">     * @param map 对应多个键值
</span><span class="cm">     * @param time 时间(秒)
</span><span class="cm">     * @return true成功 false失败
</span><span class="cm">     */</span>
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">hmset</span><span class="o">(</span><span class="n">String</span> <span class="n">key</span><span class="o">,</span> <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;</span> <span class="n">map</span><span class="o">,</span> <span class="kt">long</span> <span class="n">time</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="n">redisTemplate</span><span class="o">.</span><span class="na">opsForHash</span><span class="o">().</span><span class="na">putAll</span><span class="o">(</span><span class="n">key</span><span class="o">,</span> <span class="n">map</span><span class="o">);</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">time</span> <span class="o">&gt;</span> <span class="n">0</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">expire</span><span class="o">(</span><span class="n">key</span><span class="o">,</span> <span class="n">time</span><span class="o">);</span>
            <span class="o">}</span>
            <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
            <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
        <span class="o">}</span>
    <span class="o">}</span>
    <span class="cm">/**
</span><span class="cm">     * 向一张hash表中放入数据,如果不存在将创建
</span><span class="cm">     *
</span><span class="cm">     * @param key  键
</span><span class="cm">     * @param item 项
</span><span class="cm">     * @param value 值
</span><span class="cm">     * @return true 成功 false失败
</span><span class="cm">     */</span>
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">hset</span><span class="o">(</span><span class="n">String</span> <span class="n">key</span><span class="o">,</span> <span class="n">String</span> <span class="n">item</span><span class="o">,</span> <span class="n">Object</span> <span class="n">value</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="n">redisTemplate</span><span class="o">.</span><span class="na">opsForHash</span><span class="o">().</span><span class="na">put</span><span class="o">(</span><span class="n">key</span><span class="o">,</span> <span class="n">item</span><span class="o">,</span> <span class="n">value</span><span class="o">);</span>
            <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
            <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
        <span class="o">}</span>
    <span class="o">}</span>
    <span class="cm">/**
</span><span class="cm">     * 向一张hash表中放入数据,如果不存在将创建
</span><span class="cm">     *
</span><span class="cm">     * @param key  键
</span><span class="cm">     * @param item 项
</span><span class="cm">     * @param value 值
</span><span class="cm">     * @param time 时间(秒) 注意:如果已存在的hash表有时间,这里将会替换原有的时间
</span><span class="cm">     * @return true 成功 false失败
</span><span class="cm">     */</span>
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">hset</span><span class="o">(</span><span class="n">String</span> <span class="n">key</span><span class="o">,</span> <span class="n">String</span> <span class="n">item</span><span class="o">,</span> <span class="n">Object</span> <span class="n">value</span><span class="o">,</span> <span class="kt">long</span> <span class="n">time</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="n">redisTemplate</span><span class="o">.</span><span class="na">opsForHash</span><span class="o">().</span><span class="na">put</span><span class="o">(</span><span class="n">key</span><span class="o">,</span> <span class="n">item</span><span class="o">,</span> <span class="n">value</span><span class="o">);</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">time</span> <span class="o">&gt;</span> <span class="n">0</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">expire</span><span class="o">(</span><span class="n">key</span><span class="o">,</span> <span class="n">time</span><span class="o">);</span>
            <span class="o">}</span>
            <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
            <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
        <span class="o">}</span>
    <span class="o">}</span>
    <span class="cm">/**
</span><span class="cm">     * 删除hash表中的值
</span><span class="cm">     *
</span><span class="cm">     * @param key 键 不能为null
</span><span class="cm">     * @param item 项 可以使多个 不能为null
</span><span class="cm">     */</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">hdel</span><span class="o">(</span><span class="n">String</span> <span class="n">key</span><span class="o">,</span> <span class="n">Object</span><span class="o">...</span> <span class="n">item</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">redisTemplate</span><span class="o">.</span><span class="na">opsForHash</span><span class="o">().</span><span class="na">delete</span><span class="o">(</span><span class="n">key</span><span class="o">,</span> <span class="n">item</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="cm">/**
</span><span class="cm">     * 判断hash表中是否有该项的值
</span><span class="cm">     *
</span><span class="cm">     * @param key 键 不能为null
</span><span class="cm">     * @param item 项 不能为null
</span><span class="cm">     * @return true 存在 false不存在
</span><span class="cm">     */</span>
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">hHasKey</span><span class="o">(</span><span class="n">String</span> <span class="n">key</span><span class="o">,</span> <span class="n">String</span> <span class="n">item</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">redisTemplate</span><span class="o">.</span><span class="na">opsForHash</span><span class="o">().</span><span class="na">hasKey</span><span class="o">(</span><span class="n">key</span><span class="o">,</span> <span class="n">item</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="cm">/**
</span><span class="cm">     * hash递增 如果不存在,就会创建一个 并把新增后的值返回
</span><span class="cm">     *
</span><span class="cm">     * @param key 键
</span><span class="cm">     * @param item 项
</span><span class="cm">     * @param by  要增加几(大于0)
</span><span class="cm">     */</span>
    <span class="kd">public</span> <span class="kt">double</span> <span class="nf">hincr</span><span class="o">(</span><span class="n">String</span> <span class="n">key</span><span class="o">,</span> <span class="n">String</span> <span class="n">item</span><span class="o">,</span> <span class="kt">double</span> <span class="n">by</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">redisTemplate</span><span class="o">.</span><span class="na">opsForHash</span><span class="o">().</span><span class="na">increment</span><span class="o">(</span><span class="n">key</span><span class="o">,</span> <span class="n">item</span><span class="o">,</span> <span class="n">by</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="cm">/**
</span><span class="cm">     * hash递减
</span><span class="cm">     *
</span><span class="cm">     * @param key 键
</span><span class="cm">     * @param item 项
</span><span class="cm">     * @param by  要减少记(小于0)
</span><span class="cm">     */</span>
    <span class="kd">public</span> <span class="kt">double</span> <span class="nf">hdecr</span><span class="o">(</span><span class="n">String</span> <span class="n">key</span><span class="o">,</span> <span class="n">String</span> <span class="n">item</span><span class="o">,</span> <span class="kt">double</span> <span class="n">by</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">redisTemplate</span><span class="o">.</span><span class="na">opsForHash</span><span class="o">().</span><span class="na">increment</span><span class="o">(</span><span class="n">key</span><span class="o">,</span> <span class="n">item</span><span class="o">,</span> <span class="o">-</span><span class="n">by</span><span class="o">);</span>
    <span class="o">}</span>
<span class="c1">// ============================set=============================
</span><span class="c1"></span>    <span class="cm">/**
</span><span class="cm">     * 根据key获取Set中的所有值
</span><span class="cm">     * @param key 键
</span><span class="cm">     */</span>
    <span class="kd">public</span> <span class="n">Set</span><span class="o">&lt;</span><span class="n">Object</span><span class="o">&gt;</span> <span class="nf">sGet</span><span class="o">(</span><span class="n">String</span> <span class="n">key</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="k">return</span> <span class="n">redisTemplate</span><span class="o">.</span><span class="na">opsForSet</span><span class="o">().</span><span class="na">members</span><span class="o">(</span><span class="n">key</span><span class="o">);</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
            <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
        <span class="o">}</span>
    <span class="o">}</span>
    <span class="cm">/**
</span><span class="cm">     * 根据value从一个set中查询,是否存在
</span><span class="cm">     *
</span><span class="cm">     * @param key  键
</span><span class="cm">     * @param value 值
</span><span class="cm">     * @return true 存在 false不存在
</span><span class="cm">     */</span>
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">sHasKey</span><span class="o">(</span><span class="n">String</span> <span class="n">key</span><span class="o">,</span> <span class="n">Object</span> <span class="n">value</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="k">return</span> <span class="n">redisTemplate</span><span class="o">.</span><span class="na">opsForSet</span><span class="o">().</span><span class="na">isMember</span><span class="o">(</span><span class="n">key</span><span class="o">,</span> <span class="n">value</span><span class="o">);</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
            <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
        <span class="o">}</span>
    <span class="o">}</span>
    <span class="cm">/**
</span><span class="cm">     * 将数据放入set缓存
</span><span class="cm">     *
</span><span class="cm">     * @param key  键
</span><span class="cm">     * @param values 值 可以是多个
</span><span class="cm">     * @return 成功个数
</span><span class="cm">     */</span>
    <span class="kd">public</span> <span class="kt">long</span> <span class="nf">sSet</span><span class="o">(</span><span class="n">String</span> <span class="n">key</span><span class="o">,</span> <span class="n">Object</span><span class="o">...</span> <span class="n">values</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="k">return</span> <span class="n">redisTemplate</span><span class="o">.</span><span class="na">opsForSet</span><span class="o">().</span><span class="na">add</span><span class="o">(</span><span class="n">key</span><span class="o">,</span> <span class="n">values</span><span class="o">);</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
            <span class="k">return</span> <span class="n">0</span><span class="o">;</span>
        <span class="o">}</span>
    <span class="o">}</span>
    <span class="cm">/**
</span><span class="cm">     * 将set数据放入缓存
</span><span class="cm">     *
</span><span class="cm">     * @param key  键
</span><span class="cm">     * @param time  时间(秒)
</span><span class="cm">     * @param values 值 可以是多个
</span><span class="cm">     * @return 成功个数
</span><span class="cm">     */</span>
    <span class="kd">public</span> <span class="kt">long</span> <span class="nf">sSetAndTime</span><span class="o">(</span><span class="n">String</span> <span class="n">key</span><span class="o">,</span> <span class="kt">long</span> <span class="n">time</span><span class="o">,</span> <span class="n">Object</span><span class="o">...</span> <span class="n">values</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="n">Long</span> <span class="n">count</span> <span class="o">=</span> <span class="n">redisTemplate</span><span class="o">.</span><span class="na">opsForSet</span><span class="o">().</span><span class="na">add</span><span class="o">(</span><span class="n">key</span><span class="o">,</span> <span class="n">values</span><span class="o">);</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">time</span> <span class="o">&gt;</span> <span class="n">0</span><span class="o">)</span>
                <span class="n">expire</span><span class="o">(</span><span class="n">key</span><span class="o">,</span> <span class="n">time</span><span class="o">);</span>
            <span class="k">return</span> <span class="n">count</span><span class="o">;</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
            <span class="k">return</span> <span class="n">0</span><span class="o">;</span>
        <span class="o">}</span>
    <span class="o">}</span>
    <span class="cm">/**
</span><span class="cm">     * 获取set缓存的长度
</span><span class="cm">     *
</span><span class="cm">     * @param key 键
</span><span class="cm">     */</span>
    <span class="kd">public</span> <span class="kt">long</span> <span class="nf">sGetSetSize</span><span class="o">(</span><span class="n">String</span> <span class="n">key</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="k">return</span> <span class="n">redisTemplate</span><span class="o">.</span><span class="na">opsForSet</span><span class="o">().</span><span class="na">size</span><span class="o">(</span><span class="n">key</span><span class="o">);</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
            <span class="k">return</span> <span class="n">0</span><span class="o">;</span>
        <span class="o">}</span>
    <span class="o">}</span>
    <span class="cm">/**
</span><span class="cm">     * 移除值为value的
</span><span class="cm">     *
</span><span class="cm">     * @param key  键
</span><span class="cm">     * @param values 值 可以是多个
</span><span class="cm">     * @return 移除的个数
</span><span class="cm">     */</span>
    <span class="kd">public</span> <span class="kt">long</span> <span class="nf">setRemove</span><span class="o">(</span><span class="n">String</span> <span class="n">key</span><span class="o">,</span> <span class="n">Object</span><span class="o">...</span> <span class="n">values</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="n">Long</span> <span class="n">count</span> <span class="o">=</span> <span class="n">redisTemplate</span><span class="o">.</span><span class="na">opsForSet</span><span class="o">().</span><span class="na">remove</span><span class="o">(</span><span class="n">key</span><span class="o">,</span> <span class="n">values</span><span class="o">);</span>
            <span class="k">return</span> <span class="n">count</span><span class="o">;</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
            <span class="k">return</span> <span class="n">0</span><span class="o">;</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="c1">// ===============================list=================================
</span><span class="c1"></span>    <span class="cm">/**
</span><span class="cm">     * 获取list缓存的内容
</span><span class="cm">     *
</span><span class="cm">     * @param key  键
</span><span class="cm">     * @param start 开始
</span><span class="cm">     * @param end  结束 0 到 -1代表所有值
</span><span class="cm">     */</span>
    <span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Object</span><span class="o">&gt;</span> <span class="nf">lGet</span><span class="o">(</span><span class="n">String</span> <span class="n">key</span><span class="o">,</span> <span class="kt">long</span> <span class="n">start</span><span class="o">,</span> <span class="kt">long</span> <span class="n">end</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="k">return</span> <span class="n">redisTemplate</span><span class="o">.</span><span class="na">opsForList</span><span class="o">().</span><span class="na">range</span><span class="o">(</span><span class="n">key</span><span class="o">,</span> <span class="n">start</span><span class="o">,</span> <span class="n">end</span><span class="o">);</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
            <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
        <span class="o">}</span>
    <span class="o">}</span>
    <span class="cm">/**
</span><span class="cm">     * 获取list缓存的长度
</span><span class="cm">     *
</span><span class="cm">     * @param key 键
</span><span class="cm">     */</span>
    <span class="kd">public</span> <span class="kt">long</span> <span class="nf">lGetListSize</span><span class="o">(</span><span class="n">String</span> <span class="n">key</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="k">return</span> <span class="n">redisTemplate</span><span class="o">.</span><span class="na">opsForList</span><span class="o">().</span><span class="na">size</span><span class="o">(</span><span class="n">key</span><span class="o">);</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
            <span class="k">return</span> <span class="n">0</span><span class="o">;</span>
        <span class="o">}</span>
    <span class="o">}</span>
    <span class="cm">/**
</span><span class="cm">     * 通过索引 获取list中的值
</span><span class="cm">     *
</span><span class="cm">     * @param key  键
</span><span class="cm">     * @param index 索引 index&gt;=0时， 0 表头，1 第二个元素，依次类推；index&lt;0
</span><span class="cm">    时，-1，表尾，-2倒数第二个元素，依次类推
</span><span class="cm">     */</span>
    <span class="kd">public</span> <span class="n">Object</span> <span class="nf">lGetIndex</span><span class="o">(</span><span class="n">String</span> <span class="n">key</span><span class="o">,</span> <span class="kt">long</span> <span class="n">index</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="k">return</span> <span class="n">redisTemplate</span><span class="o">.</span><span class="na">opsForList</span><span class="o">().</span><span class="na">index</span><span class="o">(</span><span class="n">key</span><span class="o">,</span> <span class="n">index</span><span class="o">);</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
            <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
        <span class="o">}</span>
    <span class="o">}</span>
    <span class="cm">/**
</span><span class="cm">     * 将list放入缓存
</span><span class="cm">     *
</span><span class="cm">     * @param key  键
</span><span class="cm">     * @param value 值
</span><span class="cm">     */</span>
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">lSet</span><span class="o">(</span><span class="n">String</span> <span class="n">key</span><span class="o">,</span> <span class="n">Object</span> <span class="n">value</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="n">redisTemplate</span><span class="o">.</span><span class="na">opsForList</span><span class="o">().</span><span class="na">rightPush</span><span class="o">(</span><span class="n">key</span><span class="o">,</span> <span class="n">value</span><span class="o">);</span>
            <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
            <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
        <span class="o">}</span>
    <span class="o">}</span>
    <span class="cm">/**
</span><span class="cm">     * 将list放入缓存
</span><span class="cm">     * @param key  键
</span><span class="cm">     * @param value 值
</span><span class="cm">     * @param time 时间(秒)
</span><span class="cm">     */</span>
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">lSet</span><span class="o">(</span><span class="n">String</span> <span class="n">key</span><span class="o">,</span> <span class="n">Object</span> <span class="n">value</span><span class="o">,</span> <span class="kt">long</span> <span class="n">time</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="n">redisTemplate</span><span class="o">.</span><span class="na">opsForList</span><span class="o">().</span><span class="na">rightPush</span><span class="o">(</span><span class="n">key</span><span class="o">,</span> <span class="n">value</span><span class="o">);</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">time</span> <span class="o">&gt;</span> <span class="n">0</span><span class="o">)</span>
                <span class="n">expire</span><span class="o">(</span><span class="n">key</span><span class="o">,</span> <span class="n">time</span><span class="o">);</span>
            <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
            <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
        <span class="o">}</span>
    <span class="o">}</span>
    <span class="cm">/**
</span><span class="cm">     * 将list放入缓存
</span><span class="cm">     *
</span><span class="cm">     * @param key  键
</span><span class="cm">     * @param value 值
</span><span class="cm">     * @return
</span><span class="cm">     */</span>
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">lSet</span><span class="o">(</span><span class="n">String</span> <span class="n">key</span><span class="o">,</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Object</span><span class="o">&gt;</span> <span class="n">value</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="n">redisTemplate</span><span class="o">.</span><span class="na">opsForList</span><span class="o">().</span><span class="na">rightPushAll</span><span class="o">(</span><span class="n">key</span><span class="o">,</span> <span class="n">value</span><span class="o">);</span>
            <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
            <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
        <span class="o">}</span>
    <span class="o">}</span>
    <span class="cm">/**
</span><span class="cm">     * 将list放入缓存
</span><span class="cm">     *
</span><span class="cm">     * @param key  键
</span><span class="cm">     * @param value 值
</span><span class="cm">     * @param time 时间(秒)
</span><span class="cm">     * @return
</span><span class="cm">     */</span>
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">lSet</span><span class="o">(</span><span class="n">String</span> <span class="n">key</span><span class="o">,</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Object</span><span class="o">&gt;</span> <span class="n">value</span><span class="o">,</span> <span class="kt">long</span> <span class="n">time</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="n">redisTemplate</span><span class="o">.</span><span class="na">opsForList</span><span class="o">().</span><span class="na">rightPushAll</span><span class="o">(</span><span class="n">key</span><span class="o">,</span> <span class="n">value</span><span class="o">);</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">time</span> <span class="o">&gt;</span> <span class="n">0</span><span class="o">)</span>
                <span class="n">expire</span><span class="o">(</span><span class="n">key</span><span class="o">,</span> <span class="n">time</span><span class="o">);</span>
            <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
            <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
        <span class="o">}</span>
    <span class="o">}</span>
    <span class="cm">/**
</span><span class="cm">     * 根据索引修改list中的某条数据
</span><span class="cm">     *
</span><span class="cm">     * @param key  键
</span><span class="cm">     * @param index 索引
</span><span class="cm">     * @param value 值
</span><span class="cm">     * @return
</span><span class="cm">     */</span>
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">lUpdateIndex</span><span class="o">(</span><span class="n">String</span> <span class="n">key</span><span class="o">,</span> <span class="kt">long</span> <span class="n">index</span><span class="o">,</span> <span class="n">Object</span> <span class="n">value</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="n">redisTemplate</span><span class="o">.</span><span class="na">opsForList</span><span class="o">().</span><span class="na">set</span><span class="o">(</span><span class="n">key</span><span class="o">,</span> <span class="n">index</span><span class="o">,</span> <span class="n">value</span><span class="o">);</span>
            <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
            <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
        <span class="o">}</span>
    <span class="o">}</span>
    <span class="cm">/**
</span><span class="cm">     * 移除N个值为value
</span><span class="cm">     *
</span><span class="cm">     * @param key  键
</span><span class="cm">     * @param count 移除多少个
</span><span class="cm">     * @param value 值
</span><span class="cm">     * @return 移除的个数
</span><span class="cm">     */</span>
    <span class="kd">public</span> <span class="kt">long</span> <span class="nf">lRemove</span><span class="o">(</span><span class="n">String</span> <span class="n">key</span><span class="o">,</span> <span class="kt">long</span> <span class="n">count</span><span class="o">,</span> <span class="n">Object</span> <span class="n">value</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="n">Long</span> <span class="n">remove</span> <span class="o">=</span> <span class="n">redisTemplate</span><span class="o">.</span><span class="na">opsForList</span><span class="o">().</span><span class="na">remove</span><span class="o">(</span><span class="n">key</span><span class="o">,</span> <span class="n">count</span><span class="o">,</span>
                    <span class="n">value</span><span class="o">);</span>
            <span class="k">return</span> <span class="n">remove</span><span class="o">;</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
            <span class="k">return</span> <span class="n">0</span><span class="o">;</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><blockquote>
<p>在这个方法中将刚才自定义的RedisTemplate中的所有方法封装一下</p>
</blockquote>
<hr>
<p><code>测试</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">com.zhang</span><span class="o">;</span>


<span class="kn">import</span> <span class="nn">com.fasterxml.jackson.core.JsonProcessingException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.fasterxml.jackson.databind.ObjectMapper</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.zhang.pojo.User</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.zhang.utils.RedisUtil</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.junit.jupiter.api.Test</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.beans.factory.annotation.Autowired</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.beans.factory.annotation.Qualifier</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.boot.test.context.SpringBootTest</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.data.redis.core.RedisTemplate</span><span class="o">;</span>

<span class="nd">@SpringBootTest</span>
<span class="kd">class</span> <span class="nc">SpringBootRedisApplicationTests</span> <span class="o">{</span>

    <span class="nd">@Autowired</span>
    <span class="nd">@Qualifier</span><span class="o">(</span><span class="s">&#34;redisTemplate&#34;</span><span class="o">)</span>
    <span class="kd">private</span> <span class="n">RedisTemplate</span> <span class="n">redisTemplate</span><span class="o">;</span>

    <span class="nd">@Autowired</span>
    <span class="kd">private</span> <span class="n">RedisUtil</span> <span class="n">redisUtil</span><span class="o">;</span>

    <span class="nd">@Test</span>
    <span class="kt">void</span> <span class="nf">contextLoads</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">JsonProcessingException</span> <span class="o">{</span>
<span class="c1">//        User user = new User(&#34;zhangyuhang&#34;,&#34;!23456&#34;);
</span><span class="c1">//        String jsonUser = new ObjectMapper().writeValueAsString(user);
</span><span class="c1">//        redisTemplate.opsForValue().set(&#34;user&#34;,jsonUser);
</span><span class="c1"></span>        <span class="n">redisUtil</span><span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="s">&#34;username&#34;</span><span class="o">,</span><span class="s">&#34;zhangyuhang&#34;</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">redisUtil</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">&#34;username&#34;</span><span class="o">));</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><hr>
<h1 id="step14redis配置文件详解">Step14.Redis配置文件详解</h1>
<h2 id="ubuntu下打开配置文件">Ubuntu下打开配置文件</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">&gt; cd /etc/redis
&gt; sudo su root 
&gt; vim redis.conf
</code></pre></td></tr></table>
</div>
</div><h2 id="读配置文件">读配置文件</h2>
<ul>
<li>unit默认单位</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback"># Redis configuration file example.
#
# Note that in order to read the configuration file, Redis must be
# started with the file path as first argument:
#
# ./redis-server /path/to/redis.conf

# Note on units: when memory size is needed, it is possible to specify
# it in the usual form of 1k 5GB 4M and so forth:
#
# 1k =&gt; 1000 bytes
# 1kb =&gt; 1024 bytes
# 1m =&gt; 1000000 bytes
# 1mb =&gt; 1024*1024 bytes
# 1g =&gt; 1000000000 bytes
# 1gb =&gt; 1024*1024*1024 bytes
#
# units are case insensitive so 1GB 1Gb 1gB are all the same.
</code></pre></td></tr></table>
</div>
</div><hr>
<ul>
<li>可配置配置文件</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">################################## INCLUDES ###################################

# Include one or more other config files here.  This is useful if you
# have a standard template that goes to all Redis servers but also need
# to customize a few per-server settings.  Include files can include
# other files, so use this wisely.
#
# Notice option &#34;include&#34; won&#39;t be rewritten by command &#34;CONFIG REWRITE&#34;
# from admin or Redis Sentinel. Since Redis always uses the last processed
# line as value of a configuration directive, you&#39;d better put includes
# at the beginning of this file to avoid overwriting config change at runtime.
#
# If instead you are interested in using includes to override configuration
# options, it is better to use include as the last line.
#
# include /path/to/local.conf
# include /path/to/other.conf
</code></pre></td></tr></table>
</div>
</div><blockquote>
<p>这个就是说redis默认的配置文件是/etc/redis/redis.conf,也可以自定义配置文件,例如local.conf、other.conf等</p>
</blockquote>
<hr>
<ul>
<li>网络</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span><span class="lnt">78
</span><span class="lnt">79
</span><span class="lnt">80
</span><span class="lnt">81
</span><span class="lnt">82
</span><span class="lnt">83
</span><span class="lnt">84
</span><span class="lnt">85
</span><span class="lnt">86
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">################################## NETWORK #####################################

# By default, if no &#34;bind&#34; configuration directive is specified, Redis listens
# for connections from all the network interfaces available on the server.
# It is possible to listen to just one or multiple selected interfaces using
# the &#34;bind&#34; configuration directive, followed by one or more IP addresses.
#
# Examples:
#
# bind 192.168.1.100 10.0.0.1
# bind 127.0.0.1 ::1
#
# ~~~ WARNING ~~~ If the computer running Redis is directly exposed to the
# internet, binding to all the interfaces is dangerous and will expose the
# instance to everybody on the internet. So by default we uncomment the
# following bind directive, that will force Redis to listen only into
# the IPv4 loopback interface address (this means Redis will be able to
# accept connections only from clients running into the same computer it
# is running).
#
# IF YOU ARE SURE YOU WANT YOUR INSTANCE TO LISTEN TO ALL THE INTERFACES
# JUST COMMENT THE FOLLOWING LINE.
# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
bind 127.0.0.1 ::1

# Protected mode is a layer of security protection, in order to avoid that
# Redis instances left open on the internet are accessed and exploited.
#
# When protected mode is on and if:
#
# 1) The server is not binding explicitly to a set of addresses using the
#    &#34;bind&#34; directive.
# 2) No password is configured.
#
# The server only accepts connections from clients connecting from the
# IPv4 and IPv6 loopback addresses 127.0.0.1 and ::1, and from Unix domain
# sockets.
#
# By default protected mode is enabled. You should disable it only if
# you are sure you want clients from other hosts to connect to Redis
# even if no authentication is configured, nor a specific set of interfaces
# are explicitly listed using the &#34;bind&#34; directive.
protected-mode yes

# Accept connections on the specified port, default is 6379 (IANA #815344).
# If port 0 is specified Redis will not listen on a TCP socket.
port 6379

# TCP listen() backlog.
#
# In high requests-per-second environments you need an high backlog in order
# to avoid slow clients connections issues. Note that the Linux kernel
# will silently truncate it to the value of /proc/sys/net/core/somaxconn so
# make sure to raise both the value of somaxconn and tcp_max_syn_backlog
# in order to get the desired effect.
tcp-backlog 511

# Unix socket.
#
# Specify the path for the Unix socket that will be used to listen for
# incoming connections. There is no default, so Redis will not listen
# on a unix socket when not specified.
#
# unixsocket /var/run/redis/redis-server.sock
# unixsocketperm 700

# Close the connection after a client is idle for N seconds (0 to disable)
timeout 0

# TCP keepalive.
#
# If non-zero, use SO_KEEPALIVE to send TCP ACKs to clients in absence
# of communication. This is useful for two reasons:
#
# 1) Detect dead peers.
# 2) Take the connection alive from the point of view of network
#    equipment in the middle.
#
# On Linux, the specified value (in seconds) is the period used to send ACKs.
# Note that to close the connection the double of the time is needed.
# On other kernels the period depends on the kernel configuration.
#
# A reasonable value for this option is 300 seconds, which is the new
# Redis default starting with Redis 3.2.1.
tcp-keepalive 300

</code></pre></td></tr></table>
</div>
</div><blockquote>
<p>bind 127.0.0.1 ::1 (绑定一个ip为本机ip)</p>
</blockquote>
<blockquote>
<p>protected-mode yes (保护模式)</p>
</blockquote>
<blockquote>
<p>port 6379 (指定端口号)</p>
</blockquote>
<blockquote>
<p>下面还有一些TCP的连接、以及超时处理等</p>
</blockquote>
<hr>
<h1 id="step15rdb操作">Step15.RDB操作</h1>
<h2 id="rdb介绍">RDB介绍</h2>
<blockquote>
<p>Redis是内存数据库,如果不将数据保存在外存中,一旦断电,数据就会全部消失</p>
</blockquote>
<blockquote>
<p>服务器中的数据也会消失</p>
</blockquote>
<blockquote>
<p>所以我们给Redis提供了持久化功能</p>
</blockquote>
<p><img src="https://img-blog.csdnimg.cn/ded61f556349489b831af3fba2327be1.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5a2k5ZCNQA==,size_20,color_FFFFFF,t_70,g_se,x_16" alt="Photo"></p>
<p><img src="https://img-blog.csdnimg.cn/2f8a59e76d4b494abd39cde46b452310.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5a2k5ZCNQA==,size_20,color_FFFFFF,t_70,g_se,x_16" alt="Photo"></p>
<blockquote>
<p>在指定的时间间隔内指的是save操作</p>
</blockquote>
<blockquote>
<p>save 指定时间间隔 触发set操作几次</p>
</blockquote>
<h2 id="获取rdb文件路径的命令">获取rdb文件路径的命令</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">CONFIG GET dir
</code></pre></td></tr></table>
</div>
</div><h2 id="触发rdb机制的方法">触发RDB机制的方法</h2>
<ul>
<li>
<p>1.更改save的设置</p>
<p><img src="https://img-blog.csdnimg.cn/6acfb386727449d4a39305486248141d.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5a2k5ZCNQA==,size_20,color_FFFFFF,t_70,g_se,x_16" alt="Photo"></p>
<blockquote>
<p>设置为在60秒内更改key6次数或者设置key6次,就会触发RDB机制</p>
</blockquote>
</li>
<li>
<p>执行flushall操作</p>
<blockquote>
<p>开两个终端,一个执行redis,一个查看dump.rdb是否存在</p>
</blockquote>
<p><img src="https://img-blog.csdnimg.cn/bfeb7d9a4ab544cdb40c20949ce896ac.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5a2k5ZCNQA==,size_20,color_FFFFFF,t_70,g_se,x_16" alt="Photo"></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-txt" data-lang="txt">左边先flushall,右边rm -rf dump.rdb
</code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-txt" data-lang="txt">将所有的都清空
</code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-txt" data-lang="txt">然后左边
</code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">127.0.0.1:6379&gt; set k1 v1
OK
127.0.0.1:6379&gt; set k2 v2
OK
127.0.0.1:6379&gt; set k3 v3
OK
127.0.0.1:6379&gt; set k4 v4
OK
127.0.0.1:6379&gt; set k5 v5
OK
</code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-txt" data-lang="txt">右边再次查看dump.rdb,就会发现有结果
</code></pre></td></tr></table>
</div>
</div><ul>
<li>
<p>针对CentOS</p>
<blockquote>
<p>dump.rdb文件和redis-server放在一起</p>
<p>开两个窗口,一个运行redis-server,一个进入/usr/local/bin查看dump.rdb文件的存在情况</p>
</blockquote>
</li>
</ul>
</li>
</ul>
<hr>
<h1 id="step16aof操作">Step16.AOF操作</h1>
<ul>
<li>
<p>AOF操作和RDB类似,RDB是存储key-value文件,AOF是存储set、get这种指令的文件,再次启动时读取文件,将文件中的命令再执行一次</p>
<p><img src="https://img-blog.csdnimg.cn/1fd29f6e19734599ab1bf5fcb13af087.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5a2k5ZCNQA==,size_20,color_FFFFFF,t_70,g_se,x_16" alt="Photo"></p>
</li>
<li>
<p>AOF默认是关闭的</p>
</li>
<li>
<p>需要在配置文件中手动开启</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-txt" data-lang="txt">############################## APPEND ONLY MODE ###############################
  
# By default Redis asynchronously dumps the dataset on disk. This mode is
# good enough in many applications, but an issue with the Redis process or
# a power outage may result into a few minutes of writes lost (depending on
# the configured save points).
#
# The Append Only File is an alternative persistence mode that provides
# much better durability. For instance using the default data fsync policy
# (see later in the config file) Redis can lose just one second of writes in a
# dramatic event like a server power outage, or a single write if something
# wrong with the Redis process itself happens, but the operating system is
# still running correctly.
#
# AOF and RDB persistence can be enabled at the same time without problems.
# If the AOF is enabled on startup Redis will load the AOF, that is the file
# with the better durability guarantees.
#
# Please check http://redis.io/topics/persistence for more information.
  
appendonly yes
  
# The name of the append only file (default: &#34;appendonly.aof&#34;)
  
appendfilename &#34;appendonly.aof&#34;
  
# The fsync() call tells the Operating System to actually write data on disk
# instead of waiting for more data in the output buffer. Some OS will really flush
# data on disk, some other OS will just try to do it ASAP.
#
# Redis supports three different modes:
#
# no: don&#39;t fsync, just let the OS flush the data when it wants. Faster.
# always: fsync after every write to the append only log. Slow, Safest.
# everysec: fsync only one time every second. Compromise.
#
# The default is &#34;everysec&#34;, as that&#39;s usually the right compromise between
# speed and data safety. It&#39;s up to you to understand if you can relax this to
# &#34;no&#34; that will let the operating system flush the output buffer when
# it wants, for better performances (but if you can live with the idea of
# some data loss consider the default persistence mode that&#39;s snapshotting),
# or on the contrary, use &#34;always&#34; that&#39;s very slow but a bit safer than
# everysec.
#
# More details please check the following article:
# http://antirez.com/post/redis-persistence-demystified.html
#
# If unsure, use &#34;everysec&#34;.
  
# appendfsync always
appendfsync everysec
# appendfsync no
</code></pre></td></tr></table>
</div>
</div><blockquote>
<p>设置appendonly no改为yes</p>
</blockquote>
</li>
<li>
<p>然后测试</p>
</li>
<li>
<p>但是通过vim设置appendonly no好像并不奏效</p>
</li>
<li>
<p>CentOS进入/usr/local/bin</p>
<blockquote>
<p>redis-cli config set appendonly yes</p>
</blockquote>
</li>
<li>
<p>然后在对应修改的配置文件的server下执行Redis语句,在/usr/local/bin下就会自动生成appendonly.aof文件</p>
<p><img src="https://img-blog.csdnimg.cn/f828d30bb109486a80d607634203e0b9.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5a2k5ZCNQA==,size_20,color_FFFFFF,t_70,g_se,x_16" alt="Photo"></p>
<p><img src="https://img-blog.csdnimg.cn/ab1cf034c6974b46b5e58adc676fddd0.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5a2k5ZCNQA==,size_20,color_FFFFFF,t_70,g_se,x_16" alt="Photo"></p>
</li>
<li>
<p>配置</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash">appendonly no <span class="c1"># Redis默认是不开启appendonly的,需要手动开启,我整理了两种开启方式,在我的Ubuntu中第二种方式更奏效</span>
appendfilename <span class="s2">&#34;appendonly.aof&#34;</span> <span class="c1"># 持久化的名字</span>
  
<span class="c1"># appendfsync always # 每次修改都会sync,消耗性能</span>
appendfsync everysec <span class="c1"># 每秒执行一次sync,可能丢失这一秒的数据</span>
<span class="c1"># appendfsync no # 不执行sync,操作系统自己同步数据,速度最快</span>
</code></pre></td></tr></table>
</div>
</div><p><img src="https://img-blog.csdnimg.cn/7d0531f923854f34954df38fe661bc86.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5a2k5ZCNQA==,size_20,color_FFFFFF,t_70,g_se,x_16" alt="Photo"></p>
</li>
</ul>
<h1 id="step17redis订阅发布">Step17.Redis订阅发布</h1>
<ul>
<li>
<p>Redis订阅发布(PUBLISH/SUBSCRIBE)是一种消息通信模式:发送者发送消息,订阅者接受消息.微博、微信、关注系统</p>
</li>
<li>
<p>Redis客户端可以订阅任意数量的频道</p>
<p><img src="https://img-blog.csdnimg.cn/9ee9925706f3442b9d1653d9e597b89d.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5a2k5ZCNQA==,size_20,color_FFFFFF,t_70,g_se,x_16" alt="Photo"></p>
<p><img src="https://img-blog.csdnimg.cn/b8c2beb489664db3be645baadf27fe4a.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5a2k5ZCNQA==,size_20,color_FFFFFF,t_70,g_se,x_16" alt="Photo"></p>
</li>
<li>
<p>操作</p>
<p><img src="https://img-blog.csdnimg.cn/cef96ba040ea45d58c4e8ba8ebf7b9e1.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5a2k5ZCNQA==,size_20,color_FFFFFF,t_70,g_se,x_16" alt="Photo"></p>
<ul>
<li>
<p>开两个termial,都开启Redis-Server,一个作为SUB,一个作为PUB</p>
</li>
<li>
<p>SUB</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">SUBSCRIBE zhangyuhang
</code></pre></td></tr></table>
</div>
</div><blockquote>
<p>意思就是订阅了名叫zhangyuhang的频道</p>
</blockquote>
</li>
<li>
<p>PUB</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">PUBLISH zhangyuhang &#34;HelloRedis&#34;
</code></pre></td></tr></table>
</div>
</div><blockquote>
<p>意思就是向所有订阅zhangyuhang频道的client发送&quot;HelloRedis&quot;消息</p>
</blockquote>
</li>
</ul>
</li>
<li>
<p>当PUBLISH发送成功,SUB端会自动接收到消息</p>
</li>
</ul>
<hr>
<h1 id="step18redis主从复制">Step18.Redis主从复制</h1>
<p><img src="https://img-blog.csdnimg.cn/522c4c76991f4863a9726c322bf2984a.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5a2k5ZCNQA==,size_20,color_FFFFFF,t_70,g_se,x_16" alt="Photo"></p>
<ul>
<li>搞一个主机,多个从机,由于我们面向服务器80%的操作都是读操作,只有不到20%的操作时写操作</li>
<li>主机负责写,多个从机负责读,极大的减缓了主机的负载</li>
</ul>
<p><img src="https://img-blog.csdnimg.cn/0eb5efeafef144d4afb811da395fd992.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5a2k5ZCNQA==,size_20,color_FFFFFF,t_70,g_se,x_16" alt="Photo"></p>
<ul>
<li>
<p>最低配是一个主机两个从机,因为如果有一个主机一个从机,主机kill了从机还可以顶一下.但这样明显不够</p>
</li>
<li>
<p>从机它有个哨兵模式,当主机死了,从机中可以选举</p>
</li>
<li>
<p>redis.conf储存在CentOS下的/etc目录中</p>
</li>
<li>
<p>redis-server和redis-cli都放在/usr/local/bin目录下</p>
</li>
<li>
<p>将redis.conf更改配置</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">daemonize yes
</code></pre></td></tr></table>
</div>
</div><blockquote>
<p>这是非常关键的配置,如果不开启它,即使配置好了也没用</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-txt" data-lang="txt">Redis daemonize介绍
  1、daemonize介绍
      A、redis.conf配置文件中daemonize守护线程，默认是NO。
      B、daemonize是用来指定redis是否要用守护线程的方式启动。
  2、daemonize 设置yes或者no区别
      daemonize:yes:
          redis采用的是单进程多线程的模式。当redis.conf中选项daemonize设		                   置成yes时，代表开启守护进程模式。在该模式下，redis会在后台运行，并将进                   程pid号写入至redis.conf选项pidfile设置的文件中，此时redis将一直运                     行，除非手动kill该进程。
      daemonize:no:
          当daemonize选项设置成no时，当前界面将进入redis的命令行界面，exit强制退出或				者关闭连接工具(putty,xshell等)都会导致redis进程退出。
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>单机集群多配置文件,一个server加载一个配置文件,这里用于测试复制三个</p>
</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">cd /etc
cp redis.conf redis80.conf
cp redis.conf redis81.conf
cp redis.conf redis82.conf
</code></pre></td></tr></table>
</div>
</div><ul>
<li>
<p>更改复制出来的这几个config的以下配置</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">port 6382
pidfile /var/run/redis_6382.pid
logfile /var/log/redis/redis82.log
dbfilename dump82.rdb
</code></pre></td></tr></table>
</div>
</div><blockquote>
<p>端口改成自己想要的,然后下面的那些配置文件后面都加上端口号或者端口号后两位</p>
</blockquote>
</li>
<li>
<p>更改完成后</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">cd /usr/local/bin
./redis-server /etc/redis80.conf
./redis-server /etc/redis81.conf
./redis-server /etc/redis82.conf
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>就可以同时启动三个server了</p>
</li>
</ul>
<h2 id="如何启动多个server和cli">如何启动多个server和cli</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash"><span class="nb">cd</span> /usr/local/bin
./redis-server /etc/redis80.conf
./redis-client -p <span class="m">6381</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="主从机配置">主从机配置</h2>
<ul>
<li>前面只是进行主从复制的准备工作</li>
<li>下面才是真正的主从复制操作</li>
<li>回顾一下,主从复制就是一个主机多个从机,主机可读可写,从机只能读不能写</li>
<li>这样做的目的是,因为我们平时80%的操作都是读取,只有不到20%的操作是写</li>
<li>为了降低主机的负荷,将所有读取操作放置在多个从机上,并由可读可写的主机操作多个从机</li>
</ul>
<p><code>主从配置操作</code></p>
<h3 id="一主二从">一主二从</h3>
<ul>
<li>终端1(主机)</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash"><span class="nb">cd</span> /usr/local/bin
./redis-server /etc/redis.conf
./redis-cli
</code></pre></td></tr></table>
</div>
</div><ul>
<li>终端2(从机1)</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash"><span class="nb">cd</span> /usr/local/bin
./redis-server /etc/redis80.conf
./redis-cli -p <span class="m">6380</span>
</code></pre></td></tr></table>
</div>
</div><ul>
<li>终端3(从机2)</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash"><span class="nb">cd</span> /usr/local/bin
./redis-server /etc/redis81.conf
./redis-cli -p <span class="m">6381</span>
</code></pre></td></tr></table>
</div>
</div><hr>
<ul>
<li>将6380和6381设置成6379server的从机</li>
</ul>
<p><code>从机1中</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash">SLAVEOF 127.0.0.1 <span class="m">6379</span> <span class="c1"># 将当前server设置成指定ip server的从机</span>
</code></pre></td></tr></table>
</div>
</div><p><code>从机2中</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash">SLAVEOF 127.0.0.1 <span class="m">6379</span>
</code></pre></td></tr></table>
</div>
</div><hr>
<p><code>查看当前主从状态的命令</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash">info replication
</code></pre></td></tr></table>
</div>
</div><p><code>主机中</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash">127.0.0.1:6379&gt; info replication
<span class="c1"># Replication</span>
role:master <span class="c1"># 角色:管理者</span>
connected_slaves:2 <span class="c1"># 从机数量:2</span>
slave0:ip<span class="o">=</span>127.0.0.1,port<span class="o">=</span>6380,state<span class="o">=</span>online,offset<span class="o">=</span>364,lag<span class="o">=</span><span class="m">0</span> <span class="c1"># 从机的信息</span>
slave1:ip<span class="o">=</span>127.0.0.1,port<span class="o">=</span>6381,state<span class="o">=</span>online,offset<span class="o">=</span>364,lag<span class="o">=</span><span class="m">1</span>
master_replid:488d71c6bb84408bb2a6f625e52d478c9d67318e
master_replid2:0000000000000000000000000000000000000000
master_repl_offset:364
second_repl_offset:-1
repl_backlog_active:1
repl_backlog_size:1048576
repl_backlog_first_byte_offset:1
repl_backlog_histlen:364
</code></pre></td></tr></table>
</div>
</div><p><code>从机1中</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash">127.0.0.1:6380&gt; info replication
<span class="c1"># Replication</span>
role:slave <span class="c1"># 角色是从机</span>
master_host:127.0.0.1 <span class="c1"># 从属主机ip地址</span>
master_port:6379 <span class="c1"># 从属主机端口号</span>
master_link_status:up
master_last_io_seconds_ago:8
master_sync_in_progress:0
slave_repl_offset:14
slave_priority:100
slave_read_only:1
connected_slaves:0
master_replid:488d71c6bb84408bb2a6f625e52d478c9d67318e
master_replid2:0000000000000000000000000000000000000000
master_repl_offset:14
second_repl_offset:-1
repl_backlog_active:1
repl_backlog_size:1048576
repl_backlog_first_byte_offset:1
repl_backlog_histlen:14
</code></pre></td></tr></table>
</div>
</div><p><code>从机2中</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash">127.0.0.1:6381&gt; info replication
<span class="c1"># Replication</span>
role:slave
master_host:127.0.0.1
master_port:6379
master_link_status:up
master_last_io_seconds_ago:6
master_sync_in_progress:0
slave_repl_offset:154
slave_priority:100
slave_read_only:1
connected_slaves:0
master_replid:776a04f12fb1f5cd718d8ad2f4820981051bea79
master_replid2:0000000000000000000000000000000000000000
master_repl_offset:154
second_repl_offset:-1
repl_backlog_active:1
repl_backlog_size:1048576
repl_backlog_first_byte_offset:29
repl_backlog_histlen:126
</code></pre></td></tr></table>
</div>
</div><blockquote>
<p>可以看到,主机6379中的role(角色)是master,而其他两个从机的role是slave(奴隶)</p>
</blockquote>
<hr>
<p><code>在主机中set一个值</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash">127.0.0.1:6379&gt; <span class="nb">set</span> k1 v1
OK
127.0.0.1:6379&gt; 
</code></pre></td></tr></table>
</div>
</div><p><code>从机中可以读取主机信息(核心本来就是主机,从机读主机的数据,而主机对自己的数据进行写操作)</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash">127.0.0.1:6380&gt; get k1
<span class="s2">&#34;v1&#34;</span>
</code></pre></td></tr></table>
</div>
</div><p><code>但是从机中只能读不能写,所以在从机中进行写操作会报错</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash">127.0.0.1:6380&gt; <span class="nb">set</span> k1
<span class="o">(</span>error<span class="o">)</span> ERR wrong number of arguments <span class="k">for</span> <span class="s1">&#39;set&#39;</span> <span class="nb">command</span>
</code></pre></td></tr></table>
</div>
</div><hr>
<p><code>当主机断开,从机依然可以获取到主机的数据</code></p>
<ul>
<li>
<p>主机</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash">127.0.0.1:6379&gt; shutdown
not connected&gt; <span class="nb">exit</span>
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>从机</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash">127.0.0.1:6380&gt; get k1
<span class="s2">&#34;v1&#34;</span>
</code></pre></td></tr></table>
</div>
</div></li>
</ul>
<p><code>当从机断开,然后重新连接,就又可以重新获取到主机的数据</code></p>
<ul>
<li>
<p>从机</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash">127.0.0.1:6380&gt; shutdown
not connected&gt; <span class="nb">exit</span>
<span class="o">[</span>root@iz2ze6kbye84nif83w2g4az bin<span class="o">]</span><span class="c1"># ./redis-server /etc/redis80.conf</span>
<span class="o">[</span>root@iz2ze6kbye84nif83w2g4az bin<span class="o">]</span><span class="c1"># ./redis-cli -p 6380</span>
127.0.0.1:6380&gt; get k1
<span class="s2">&#34;v1&#34;</span>
</code></pre></td></tr></table>
</div>
</div></li>
</ul>
<p><img src="https://img-blog.csdnimg.cn/c1ae7059310c449096e20a0380ccc6d6.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5a2k5ZCNQA==,size_20,color_FFFFFF,t_70,g_se,x_16" alt="Photo"></p>
<hr>
<h3 id="层层链路">```层层链路</h3>
<blockquote>
<p>命令和一主二从一样</p>
</blockquote>
<p><img src="https://img-blog.csdnimg.cn/c3052aaf37714b7d8952514a221f85ef.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5a2k5ZCNQA==,size_20,color_FFFFFF,t_70,g_se,x_16" alt="Photo"></p>
<ul>
<li>
<p>6380</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash"><span class="o">[</span>root@iz2ze6kbye84nif83w2g4az ~<span class="o">]</span><span class="c1"># cd /usr/local/bin</span>
<span class="o">[</span>root@iz2ze6kbye84nif83w2g4az bin<span class="o">]</span><span class="c1"># ./redis-server /etc/redis80.conf</span>
<span class="o">[</span>root@iz2ze6kbye84nif83w2g4az bin<span class="o">]</span><span class="c1"># ./redis-cli</span>
127.0.0.1:6379&gt; shutdown 
not connected&gt; <span class="nb">exit</span>
<span class="o">[</span>root@iz2ze6kbye84nif83w2g4az bin<span class="o">]</span><span class="c1"># ./redis-cli -p 6380</span>
127.0.0.1:6380&gt; SLAVEOF 127.0.0.1 <span class="m">6379</span>
OK
127.0.0.1:6380&gt; info replication
<span class="c1"># Replication</span>
role:slave
master_host:127.0.0.1
master_port:6379
master_link_status:up
master_last_io_seconds_ago:3
master_sync_in_progress:0
slave_repl_offset:42
slave_priority:100
slave_read_only:1
connected_slaves:1
slave0:ip<span class="o">=</span>127.0.0.1,port<span class="o">=</span>6381,state<span class="o">=</span>online,offset<span class="o">=</span>42,lag<span class="o">=</span><span class="m">0</span>
master_replid:d247663bb55d515898816cd8317aa3f164e6616d
master_replid2:0000000000000000000000000000000000000000
master_repl_offset:42
second_repl_offset:-1
repl_backlog_active:1
repl_backlog_size:1048576
repl_backlog_first_byte_offset:1
repl_backlog_histlen:42
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>6381</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash"><span class="o">[</span>root@iz2ze6kbye84nif83w2g4az ~<span class="o">]</span><span class="c1"># cd /usr/local/bin</span>
<span class="o">[</span>root@iz2ze6kbye84nif83w2g4az bin<span class="o">]</span><span class="c1"># ./redis-server /etc/redis81.conf</span>
<span class="o">[</span>root@iz2ze6kbye84nif83w2g4az bin<span class="o">]</span><span class="c1"># ./redis-cli -p 6381</span>
127.0.0.1:6381&gt; SLAVEOF 127.0.0.1 <span class="m">6380</span>
OK
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>6379</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash">127.0.0.1:6379&gt; info replication
<span class="c1"># Replication</span>
role:master
connected_slaves:1
slave0:ip<span class="o">=</span>127.0.0.1,port<span class="o">=</span>6380,state<span class="o">=</span>online,offset<span class="o">=</span>28,lag<span class="o">=</span><span class="m">0</span>
master_replid:d247663bb55d515898816cd8317aa3f164e6616d
master_replid2:0000000000000000000000000000000000000000
master_repl_offset:28
second_repl_offset:-1
repl_backlog_active:1
repl_backlog_size:1048576
repl_backlog_first_byte_offset:1
repl_backlog_histlen:28
</code></pre></td></tr></table>
</div>
</div></li>
</ul>
<blockquote>
<p>可以看到,6381是6380的主机,而6379是6380的主机</p>
<p>虽然6380是6381的主机,但它还是个slave</p>
</blockquote>
<ul>
<li>
<p>然后在6379中</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash"><span class="nb">set</span> k1 v1
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>在6380和6381中都可以获取到k1的值</p>
</li>
<li>
<p>这是因为它本来就是主从复制机制,主机会实时的将自己的数据复制给从机,这样6380中就有6379的数据了,然后6380是6381的主机</p>
</li>
<li>
<p>但现在如果让6379主机宕机,那6380和6381还能否获取到k1的值呢?</p>
<ul>
<li>
<p>6379</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash">127.0.0.1:6379&gt; flushall
OK
127.0.0.1:6379&gt; <span class="nb">set</span> k1 v1
OK
127.0.0.1:6379&gt; shutdown
not connected&gt; <span class="nb">exit</span>
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>6380</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash">127.0.0.1:6380&gt; get k1
<span class="s2">&#34;v1&#34;</span>
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>6381</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash">127.0.0.1:6381&gt; get k1
<span class="s2">&#34;v1&#34;</span>
</code></pre></td></tr></table>
</div>
</div></li>
</ul>
</li>
<li>
<p>明显,是可以获取到的</p>
</li>
<li>
<p>现在6379宕机了,现在6381是6380的从机,刚才看6381虽然是6380的主机,但是6380还是一个slave</p>
</li>
<li>
<p>就是说主机挂了,现在就没有主机了</p>
</li>
<li>
<p>而且现在也没配置哨兵模式,没法自动选举</p>
</li>
<li>
<p>没有真正意义上的主机,就无法进行写操作</p>
</li>
<li>
<p>手动将6380设置为主机</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash">SLAVEOF no one
</code></pre></td></tr></table>
</div>
</div><blockquote>
<p>将当前server设置成主机,它的slave也保持不变</p>
</blockquote>
</li>
</ul>
<hr>
<ul>
<li>
<p>那现在将宕机的6379重新启动,6380会不会自动变成6379的slave呢?</p>
<blockquote>
<p>肯定是不会</p>
</blockquote>
</li>
<li>
<p>开启6379后,需要在6380中重新手动将6380设置成6379的主机</p>
<p><code>6379</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash"><span class="o">[</span>root@iz2ze6kbye84nif83w2g4az bin<span class="o">]</span><span class="c1"># ./redis-server /etc/redis.conf</span>
<span class="o">[</span>root@iz2ze6kbye84nif83w2g4az bin<span class="o">]</span><span class="c1"># ./redis-cli -p 6379</span>
</code></pre></td></tr></table>
</div>
</div><p><code>6380</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash">127.0.0.1:6380&gt; SLAVEOF 127.0.0.1 <span class="m">6379</span>
OK
127.0.0.1:6380&gt; info replication
<span class="c1"># Replication</span>
role:slave
master_host:127.0.0.1
master_port:6379
master_link_status:up
master_last_io_seconds_ago:9
master_sync_in_progress:0
slave_repl_offset:42
slave_priority:100
slave_read_only:1
connected_slaves:1
slave0:ip<span class="o">=</span>127.0.0.1,port<span class="o">=</span>6381,state<span class="o">=</span>online,offset<span class="o">=</span>42,lag<span class="o">=</span><span class="m">1</span>
master_replid:4772364c1009b8e6ae1a1c3af4972d33ab071a65
master_replid2:0000000000000000000000000000000000000000
master_repl_offset:42
second_repl_offset:-1
repl_backlog_active:1
repl_backlog_size:1048576
repl_backlog_first_byte_offset:1
repl_backlog_histlen:42
</code></pre></td></tr></table>
</div>
</div></li>
</ul>
<hr>
<h1 id="step19哨兵模式">Step19.哨兵模式</h1>
<h2 id="概念">概念</h2>
<p><img src="https://img-blog.csdnimg.cn/121f66d4061a4803b5991ac7246427bf.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5a2k5ZCNQA==,size_20,color_FFFFFF,t_70,g_se,x_16" alt="Photo"></p>
<p><img src="https://img-blog.csdnimg.cn/4dac85a97d804d3f87964a9184ccfc9f.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5a2k5ZCNQA==,size_20,color_FFFFFF,t_70,g_se,x_16" alt="Photo"></p>
<p><img src="https://img-blog.csdnimg.cn/5ab3d916a86649448175375663765638.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5a2k5ZCNQA==,size_20,color_FFFFFF,t_70,g_se,x_16" alt="Photo"></p>
<p><img src="https://img-blog.csdnimg.cn/84ed122e69e4413d914861c6aff25e0a.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5a2k5ZCNQA==,size_20,color_FFFFFF,t_70,g_se,x_16" alt="Photo"></p>
<h2 id="测试">测试</h2>
<ul>
<li>
<p>开启四个终端,分别用于6379、6380、6381和哨兵</p>
</li>
<li>
<p>6380和6381都是6379的从机</p>
<p><code>6379</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash"><span class="o">[</span>root@iz2ze6kbye84nif83w2g4az ~<span class="o">]</span><span class="c1"># cd /usr/local/bin</span>
<span class="o">[</span>root@iz2ze6kbye84nif83w2g4az bin<span class="o">]</span><span class="c1"># ll</span>
total <span class="m">20136</span>
-rw-r--r-- <span class="m">1</span> root root     <span class="m">237</span> Nov  <span class="m">3</span> 23:28 appendonly.aof
-rwxr-xr-x <span class="m">1</span> root root <span class="m">8855632</span> May  <span class="m">7</span>  <span class="m">2018</span> docker-compose
-rw-r--r-- <span class="m">1</span> root root     <span class="m">188</span> Nov  <span class="m">4</span> 21:38 dump.rdb
-rwxr-xr-x <span class="m">1</span> root root  <span class="m">353424</span> Nov  <span class="m">3</span> 09:52 redis-benchmark
-rwxr-xr-x <span class="m">1</span> root root <span class="m">3623072</span> Nov  <span class="m">3</span> 09:52 redis-check-aof
-rwxr-xr-x <span class="m">1</span> root root <span class="m">3623072</span> Nov  <span class="m">3</span> 09:52 redis-check-rdb
-rwxr-xr-x <span class="m">1</span> root root  <span class="m">518736</span> Nov  <span class="m">3</span> 09:52 redis-cli
lrwxrwxrwx <span class="m">1</span> root root      <span class="m">12</span> Nov  <span class="m">3</span> 09:52 redis-sentinel -&gt; redis-server
-rwxr-xr-x <span class="m">1</span> root root <span class="m">3623072</span> Nov  <span class="m">3</span> 09:52 redis-server
<span class="o">[</span>root@iz2ze6kbye84nif83w2g4az bin<span class="o">]</span><span class="c1"># ./redis-server /etc/redis.conf</span>
<span class="o">[</span>root@iz2ze6kbye84nif83w2g4az bin<span class="o">]</span><span class="c1"># ./redis-cli</span>
</code></pre></td></tr></table>
</div>
</div><p><code>6380</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash"><span class="o">[</span>root@iz2ze6kbye84nif83w2g4az ~<span class="o">]</span><span class="c1"># cd /usr/local/bin</span>
<span class="o">[</span>root@iz2ze6kbye84nif83w2g4az bin<span class="o">]</span><span class="c1"># ll</span>
total <span class="m">20136</span>
-rw-r--r-- <span class="m">1</span> root root     <span class="m">237</span> Nov  <span class="m">3</span> 23:28 appendonly.aof
-rwxr-xr-x <span class="m">1</span> root root <span class="m">8855632</span> May  <span class="m">7</span>  <span class="m">2018</span> docker-compose
-rw-r--r-- <span class="m">1</span> root root     <span class="m">188</span> Nov  <span class="m">4</span> 21:38 dump.rdb
-rwxr-xr-x <span class="m">1</span> root root  <span class="m">353424</span> Nov  <span class="m">3</span> 09:52 redis-benchmark
-rwxr-xr-x <span class="m">1</span> root root <span class="m">3623072</span> Nov  <span class="m">3</span> 09:52 redis-check-aof
-rwxr-xr-x <span class="m">1</span> root root <span class="m">3623072</span> Nov  <span class="m">3</span> 09:52 redis-check-rdb
-rwxr-xr-x <span class="m">1</span> root root  <span class="m">518736</span> Nov  <span class="m">3</span> 09:52 redis-cli
lrwxrwxrwx <span class="m">1</span> root root      <span class="m">12</span> Nov  <span class="m">3</span> 09:52 redis-sentinel -&gt; redis-server
-rwxr-xr-x <span class="m">1</span> root root <span class="m">3623072</span> Nov  <span class="m">3</span> 09:52 redis-server
<span class="o">[</span>root@iz2ze6kbye84nif83w2g4az bin<span class="o">]</span><span class="c1"># ./redis-server /etc/redis80.conf</span>
<span class="o">[</span>root@iz2ze6kbye84nif83w2g4az bin<span class="o">]</span><span class="c1"># ./redis-cli -p 6380</span>
127.0.0.1:6380&gt; clear
127.0.0.1:6380&gt; SLAVEOF 127.0.0.1 <span class="m">6379</span>
OK
</code></pre></td></tr></table>
</div>
</div><p><code>6381</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash"><span class="o">[</span>root@iz2ze6kbye84nif83w2g4az ~<span class="o">]</span><span class="c1"># cd /usr/local/bin</span>
<span class="o">[</span>root@iz2ze6kbye84nif83w2g4az bin<span class="o">]</span><span class="c1"># ll</span>
total <span class="m">20136</span>
-rw-r--r-- <span class="m">1</span> root root     <span class="m">237</span> Nov  <span class="m">3</span> 23:28 appendonly.aof
-rwxr-xr-x <span class="m">1</span> root root <span class="m">8855632</span> May  <span class="m">7</span>  <span class="m">2018</span> docker-compose
-rw-r--r-- <span class="m">1</span> root root     <span class="m">188</span> Nov  <span class="m">4</span> 21:38 dump.rdb
-rwxr-xr-x <span class="m">1</span> root root  <span class="m">353424</span> Nov  <span class="m">3</span> 09:52 redis-benchmark
-rwxr-xr-x <span class="m">1</span> root root <span class="m">3623072</span> Nov  <span class="m">3</span> 09:52 redis-check-aof
-rwxr-xr-x <span class="m">1</span> root root <span class="m">3623072</span> Nov  <span class="m">3</span> 09:52 redis-check-rdb
-rwxr-xr-x <span class="m">1</span> root root  <span class="m">518736</span> Nov  <span class="m">3</span> 09:52 redis-cli
lrwxrwxrwx <span class="m">1</span> root root      <span class="m">12</span> Nov  <span class="m">3</span> 09:52 redis-sentinel -&gt; redis-server
-rwxr-xr-x <span class="m">1</span> root root <span class="m">3623072</span> Nov  <span class="m">3</span> 09:52 redis-server
<span class="o">[</span>root@iz2ze6kbye84nif83w2g4az bin<span class="o">]</span><span class="c1"># ./redis-server /etc/redis81.conf</span>
<span class="o">[</span>root@iz2ze6kbye84nif83w2g4az bin<span class="o">]</span><span class="c1"># ./redis-cli -p 6381</span>
127.0.0.1:6381&gt; clear
127.0.0.1:6381&gt; SLAVEOF 127.0.0.1 <span class="m">6379</span>
OK
</code></pre></td></tr></table>
</div>
</div><p><code>sentinel</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash"><span class="o">[</span>root@iz2ze6kbye84nif83w2g4az /<span class="o">]</span><span class="c1"># cd etc</span>
<span class="o">[</span>root@iz2ze6kbye84nif83w2g4az etc<span class="o">]</span><span class="c1"># vim sentinel.conf</span>
<span class="o">[</span>root@iz2ze6kbye84nif83w2g4az /<span class="o">]</span><span class="c1"># cd /usr/local/bin</span>
<span class="o">[</span>root@iz2ze6kbye84nif83w2g4az bin<span class="o">]</span><span class="c1"># ./redis-sentinel /etc/sentinel.conf</span>
</code></pre></td></tr></table>
</div>
</div><ul>
<li>
<p>哨兵配置文件<code>sentinel.conf</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-v" data-lang="v"><span class="n">sentinel</span> <span class="n">monitor</span> <span class="n">firstSentinel</span> <span class="mf">127.0.0.1</span> <span class="mh">6379</span> <span class="mh">1</span>
</code></pre></td></tr></table>
</div>
</div><blockquote>
<p>sentinel是哨兵的意思,monitor是监控器的意思,firstSentinel是当前哨兵的名称,最后面就是你这个哨兵要监视的主机和端口号</p>
</blockquote>
</li>
<li>
<p>启动哨兵的命令和启动server的方式是一样的,都是在/usr/local/bin下面通过加载/etc下的配置文件</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash">./redis-sentinel /etc/sentinel.conf
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>启动后,这里试验过一次,然后第二次为了记笔记就将三个server和sentinel都关闭了,然后又重启了一下,这时候发现三个都TM是slave</p>
</li>
<li>
<p>我是这样解决的</p>
<p><code>6381</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash">SLAVEOF 127.0.0.1 <span class="m">6379</span>
</code></pre></td></tr></table>
</div>
</div><p><code>6380</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash">SLAVEOF 127.0.0.1 <span class="m">6379</span>
</code></pre></td></tr></table>
</div>
</div><p><code>6379</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash">SLAVEOF NO ONE
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>这样6379就重新变回6380和6381的主机了</p>
</li>
<li>
<p>但是我发现,6379却不是主机,而是6379和6380都变成了6379的主机</p>
</li>
<li>
<p>也行吧,那就让6381宕机</p>
<p><code>6381</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash">127.0.0.1:6381&gt; shutdown
not connected&gt; <span class="nb">exit</span>
</code></pre></td></tr></table>
</div>
</div><p><code>6379</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash">127.0.0.1:6379&gt; info replication
<span class="c1"># Replication</span>
role:slave
master_host:127.0.0.1
master_port:6380
master_link_status:up
master_last_io_seconds_ago:1
master_sync_in_progress:0
slave_repl_offset:35112
slave_priority:100
slave_read_only:1
connected_slaves:0
master_replid:60ed7908ca63d41aa1d3bfe924cd3c5cecdfd8b6
master_replid2:3c6e43cb2e69ddf24ae629cebfa714f4cc144941
master_repl_offset:35112
second_repl_offset:29030
repl_backlog_active:1
repl_backlog_size:1048576
repl_backlog_first_byte_offset:9971
repl_backlog_histlen:25142
</code></pre></td></tr></table>
</div>
</div><p><code>6380</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash">127.0.0.1:6380&gt; info replication
<span class="c1"># Replication</span>
role:master
connected_slaves:1
slave0:ip<span class="o">=</span>127.0.0.1,port<span class="o">=</span>6379,state<span class="o">=</span>online,offset<span class="o">=</span>29480,lag<span class="o">=</span><span class="m">0</span>
master_replid:60ed7908ca63d41aa1d3bfe924cd3c5cecdfd8b6
master_replid2:3c6e43cb2e69ddf24ae629cebfa714f4cc144941
master_repl_offset:29480
second_repl_offset:29030
repl_backlog_active:1
repl_backlog_size:1048576
repl_backlog_first_byte_offset:9971
repl_backlog_histlen:19510
</code></pre></td></tr></table>
</div>
</div><p><code>sentinel</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash"><span class="o">[</span>root@iz2ze6kbye84nif83w2g4az bin<span class="o">]</span><span class="c1"># ./redis-sentinel /etc/sentinel.conf</span>
16967:X <span class="m">06</span> Nov 12:45:34.191 <span class="c1"># oO0OoO0OoO0Oo Redis is starting oO0OoO0OoO0Oo</span>
16967:X <span class="m">06</span> Nov 12:45:34.192 <span class="c1"># Redis version=4.0.6, bits=64, commit=00000000, modified=0, pid=16967, just started</span>
16967:X <span class="m">06</span> Nov 12:45:34.192 <span class="c1"># Configuration loaded</span>
                _._                                                  
           _.-<span class="sb">``</span>__ <span class="s1">&#39;&#39;</span>-._                                             
      _.-<span class="sb">``</span>    <span class="sb">`</span>.  <span class="sb">`</span>_.  <span class="s1">&#39;&#39;</span>-._           Redis 4.0.6 <span class="o">(</span>00000000/0<span class="o">)</span> <span class="m">64</span> bit
  .-<span class="sb">``</span> .-<span class="sb">```</span>.  <span class="sb">```</span><span class="se">\/</span>    _.,_ <span class="s1">&#39;&#39;</span>-._                                   
 <span class="o">(</span>    <span class="s1">&#39;      ,       .-`  | `,    )     Running in sentinel mode
</span><span class="s1"> |`-._`-...-` __...-.``-._|&#39;</span><span class="sb">`</span> _.-<span class="s1">&#39;|     Port: 26379
</span><span class="s1"> |    `-._   `._    /     _.-&#39;</span>    <span class="p">|</span>     PID: <span class="m">16967</span>
  <span class="sb">`</span>-._    <span class="sb">`</span>-._  <span class="sb">`</span>-./  _.-<span class="s1">&#39;    _.-&#39;</span>                                   
 <span class="p">|</span><span class="sb">`</span>-._<span class="sb">`</span>-._    <span class="sb">`</span>-.__.-<span class="s1">&#39;    _.-&#39;</span>_.-<span class="s1">&#39;|                                  
</span><span class="s1"> |    `-._`-._        _.-&#39;</span>_.-<span class="s1">&#39;    |           http://redis.io        
</span><span class="s1">  `-._    `-._`-.__.-&#39;</span>_.-<span class="s1">&#39;    _.-&#39;</span>                                   
 <span class="p">|</span><span class="sb">`</span>-._<span class="sb">`</span>-._    <span class="sb">`</span>-.__.-<span class="s1">&#39;    _.-&#39;</span>_.-<span class="s1">&#39;|                                  
</span><span class="s1"> |    `-._`-._        _.-&#39;</span>_.-<span class="s1">&#39;    |                                  
</span><span class="s1">  `-._    `-._`-.__.-&#39;</span>_.-<span class="s1">&#39;    _.-&#39;</span>                                   
      <span class="sb">`</span>-._    <span class="sb">`</span>-.__.-<span class="s1">&#39;    _.-&#39;</span>                                       
          <span class="sb">`</span>-._        _.-<span class="s1">&#39;                                           
</span><span class="s1">              `-.__.-&#39;</span>                                               
    
16967:X <span class="m">06</span> Nov 12:45:34.194 <span class="c1"># WARNING: The TCP backlog setting of 511 cannot be enforced because /proc/sys/net/core/somaxconn is set to the lower value of 128.</span>
16967:X <span class="m">06</span> Nov 12:45:34.194 <span class="c1"># Sentinel ID is 1a3ef702ea2efa419a5a0d97a488043c0946b750</span>
16967:X <span class="m">06</span> Nov 12:45:34.194 <span class="c1"># +monitor master firstSentinel 127.0.0.1 6381 quorum 1</span>
16967:X <span class="m">06</span> Nov 12:47:39.398 <span class="c1"># +sdown master firstSentinel 127.0.0.1 6381</span>
16967:X <span class="m">06</span> Nov 12:47:39.398 <span class="c1"># +odown master firstSentinel 127.0.0.1 6381 #quorum 1/1</span>
16967:X <span class="m">06</span> Nov 12:47:39.398 <span class="c1"># +new-epoch 4</span>
16967:X <span class="m">06</span> Nov 12:47:39.398 <span class="c1"># +try-failover master firstSentinel 127.0.0.1 6381</span>
16967:X <span class="m">06</span> Nov 12:47:39.400 <span class="c1"># +vote-for-leader 1a3ef702ea2efa419a5a0d97a488043c0946b750 4</span>
16967:X <span class="m">06</span> Nov 12:47:39.400 <span class="c1"># +elected-leader master firstSentinel 127.0.0.1 6381</span>
16967:X <span class="m">06</span> Nov 12:47:39.400 <span class="c1"># +failover-state-select-slave master firstSentinel 127.0.0.1 6381</span>
16967:X <span class="m">06</span> Nov 12:47:39.467 <span class="c1"># +selected-slave slave 127.0.0.1:6380 127.0.0.1 6380 @ firstSentinel 127.0.0.1 6381</span>
16967:X <span class="m">06</span> Nov 12:47:39.467 * +failover-state-send-slaveof-noone slave 127.0.0.1:6380 127.0.0.1 <span class="m">6380</span> @ firstSentinel 127.0.0.1 <span class="m">6381</span>
16967:X <span class="m">06</span> Nov 12:47:39.533 * +failover-state-wait-promotion slave 127.0.0.1:6380 127.0.0.1 <span class="m">6380</span> @ firstSentinel 127.0.0.1 <span class="m">6381</span>
16967:X <span class="m">06</span> Nov 12:47:40.477 <span class="c1"># +promoted-slave slave 127.0.0.1:6380 127.0.0.1 6380 @ firstSentinel 127.0.0.1 6381</span>
16967:X <span class="m">06</span> Nov 12:47:40.477 <span class="c1"># +failover-state-reconf-slaves master firstSentinel 127.0.0.1 6381</span>
16967:X <span class="m">06</span> Nov 12:47:40.540 * +slave-reconf-sent slave 127.0.0.1:6379 127.0.0.1 <span class="m">6379</span> @ firstSentinel 127.0.0.1 <span class="m">6381</span>
16967:X <span class="m">06</span> Nov 12:47:41.552 * +slave-reconf-inprog slave 127.0.0.1:6379 127.0.0.1 <span class="m">6379</span> @ firstSentinel 127.0.0.1 <span class="m">6381</span>
16967:X <span class="m">06</span> Nov 12:47:41.552 * +slave-reconf-done slave 127.0.0.1:6379 127.0.0.1 <span class="m">6379</span> @ firstSentinel 127.0.0.1 <span class="m">6381</span>
16967:X <span class="m">06</span> Nov 12:47:41.604 <span class="c1"># +failover-end master firstSentinel 127.0.0.1 6381</span>
16967:X <span class="m">06</span> Nov 12:47:41.604 <span class="c1"># +switch-master firstSentinel 127.0.0.1 6381 127.0.0.1 6380</span>
16967:X <span class="m">06</span> Nov 12:47:41.604 * +slave slave 127.0.0.1:6379 127.0.0.1 <span class="m">6379</span> @ firstSentinel 127.0.0.1 <span class="m">6380</span>
16967:X <span class="m">06</span> Nov 12:47:41.604 * +slave slave 127.0.0.1:6381 127.0.0.1 <span class="m">6381</span> @ firstSentinel 127.0.0.1 <span class="m">6380</span>
<span class="m">1696</span>
</code></pre></td></tr></table>
</div>
</div><ul>
<li>
<p>读sentinel的命令</p>
<p><img src="https://img-blog.csdnimg.cn/cc0f6392f3f8439aa68a84278aaf56df.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5a2k5ZCNQA==,size_20,color_FFFFFF,t_70,g_se,x_16" alt="Photo"></p>
</li>
<li>
<p>就是原来开启了三个server和一个哨兵,6379和6380都是6381的slave,然后让master6381崩了,哨兵就自动选举出6380为master,同时将已经崩了的端口也设置成选举出来的这个master的slave,再次启动生效,不会说再次启动原来崩了的master它还会变为master,它只能是现在master的slave</p>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<hr>
<h1 id="step20redis缓存穿透缓存击穿与雪崩">Step20.Redis缓存穿透、缓存击穿与雪崩</h1>
<h2 id="缓存穿透">缓存穿透</h2>
<p><img src="https://img-blog.csdnimg.cn/efa3101d759e4d98ab930b231c16fb33.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5a2k5ZCNQA==,size_20,color_FFFFFF,t_70,g_se,x_16" alt="Photo"></p>
<p><img src="https://img-blog.csdnimg.cn/4c2513c6901c4c84b23304a860882e1f.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5a2k5ZCNQA==,size_20,color_FFFFFF,t_70,g_se,x_16" alt="Photo"></p>
<p><img src="https://img-blog.csdnimg.cn/092ebce226cb4bfb96f0e4810b44a323.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5a2k5ZCNQA==,size_20,color_FFFFFF,t_70,g_se,x_16" alt="Photo"></p>
<p><img src="https://img-blog.csdnimg.cn/470781a0cbd842e09208944bb36d896c.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5a2k5ZCNQA==,size_20,color_FFFFFF,t_70,g_se,x_16" alt="Photo"></p>
<p><img src="https://img-blog.csdnimg.cn/899ff88d36274489841a2ee732074782.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5a2k5ZCNQA==,size_20,color_FFFFFF,t_70,g_se,x_16" alt="Photo"></p>
<hr>
<h2 id="缓存击穿">缓存击穿</h2>
<p><img src="https://img-blog.csdnimg.cn/2835647ddbd441779ed0bf4f410f3de5.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5a2k5ZCNQA==,size_20,color_FFFFFF,t_70,g_se,x_16" alt="Photo"></p>
<p><img src="https://img-blog.csdnimg.cn/45f2619fa0ec49da824517d717ab32e7.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5a2k5ZCNQA==,size_20,color_FFFFFF,t_70,g_se,x_16" alt="Photo"></p>
<hr>
<h2 id="缓存雪崩">缓存雪崩</h2>
<p><img src="https://img-blog.csdnimg.cn/27a7d6214e0044ffadb92bd3ee67ec9e.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5a2k5ZCNQA==,size_20,color_FFFFFF,t_70,g_se,x_16" alt="Photo"></p>
<p><img src="https://img-blog.csdnimg.cn/bb23de6d634e407a962141851b0c60d5.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5a2k5ZCNQA==,size_20,color_FFFFFF,t_70,g_se,x_16" alt="Photo"></p>
<hr>
<p>狂神Redis网课完结&hellip;</p>

    </div>

    <div class="post-copyright">
  <p class="copyright-item">
    <span class="item-title">Author</span>
    <span class="item-content">Zhang's Blog</span>
  </p>
  <p class="copyright-item">
    <span class="item-title">LastMod</span>
    <span class="item-content">
        2021-09-24
        
    </span>
  </p>
  
  
</div>
<footer class="post-footer">
      <div class="post-tags">
          <a href="/tags/database/">DataBase</a>
          </div>
      <nav class="post-nav">
        <a class="prev" href="/post/react/">
            <i class="iconfont icon-left"></i>
            <span class="prev-text nav-default">React</span>
            <span class="prev-text nav-mobile">Prev</span>
          </a>
        <a class="next" href="/post/leetcode/">
            <span class="next-text nav-default">LeetCode</span>
            <span class="next-text nav-mobile">Next</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>
        </div>
        

  

  

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
      <a href="mailto:your@email.com" class="iconfont icon-email" title="email"></a>
      <a href="https://stackoverflow.com/" class="iconfont icon-stack-overflow" title="stack-overflow"></a>
      <a href="https://twitter.com/" class="iconfont icon-twitter" title="twitter"></a>
      <a href="https://www.facebook.com/" class="iconfont icon-facebook" title="facebook"></a>
      <a href="https://www.linkedin.com/" class="iconfont icon-linkedin" title="linkedin"></a>
      <a href="https://www.google.com/" class="iconfont icon-google" title="google"></a>
      <a href="https://github.com/" class="iconfont icon-github" title="github"></a>
      <a href="https://weibo.com/" class="iconfont icon-weibo" title="weibo"></a>
      <a href="https://www.zhihu.com/" class="iconfont icon-zhihu" title="zhihu"></a>
      <a href="https://www.douban.com/" class="iconfont icon-douban" title="douban"></a>
      <a href="https://getpocket.com/" class="iconfont icon-pocket" title="pocket"></a>
      <a href="https://www.tumblr.com/" class="iconfont icon-tumblr" title="tumblr"></a>
      <a href="https://www.instagram.com/" class="iconfont icon-instagram" title="instagram"></a>
      <a href="https://about.gitlab.com/" class="iconfont icon-gitlab" title="gitlab"></a>
      <a href="https://www.bilibili.com/" class="iconfont icon-bilibili" title="bilibili"></a>
  <a href="http://localhost:1313/index.xml" type="application/rss+xml" class="iconfont icon-rss" title="rss"></a>
</div>

<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://golang.org/">GoLang</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Author - 
    <a class="theme-link" href="https://space.bilibili.com/628950169/">Mr'zhang</a>
  </span>

  

  <span class="copyright-year">
    &copy; 
    2017 - 
    2022<span class="heart"><i class="iconfont icon-heart"></i></span><span>Zhang's Blog</span>
  </span>
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/slideout@1.0.1/dist/slideout.min.js" integrity="sha256-t+zJ/g8/KXIJMjSVQdnibt4dlaDxc9zXr/9oNPeWqdg=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.js" integrity="sha256-XVLffZaxoWfGUEbdzuLi7pwaUJv1cecsQJQqGLe7axY=" crossorigin="anonymous"></script>



<script type="text/javascript" src="/js/main.min.c12618f9a600c40bd024996677e951e64d3487006775aeb22e200c990006c5c7.js"></script>








</body>
</html>
