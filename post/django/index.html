<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>Django - Zhang&#39;s Blog的博客</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<meta name="author" content="Zhang&#39;s Blog" /><meta name="description" content="Step01.django基础 1.安装django环境 1 pip3 install django==2.2 -i https://pypi.douban.com/simple 注: django更高版本在某些语法配置上可能会报错 2.创建django项目" /><meta name="keywords" content="Hugo, theme, even" />






<meta name="generator" content="Hugo 0.67.1 with theme even" />


<link rel="canonical" href="http://localhost:1313/post/django/" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">



<link href="/sass/main.min.b5a744db6de49a86cadafb3b70f555ab443f83c307a483402259e94726b045ff.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.css" integrity="sha256-7TyXnr2YU040zfSP+rEcz29ggW4j56/ujTPwjMzyqFY=" crossorigin="anonymous">


<meta property="og:title" content="Django" />
<meta property="og:description" content="Step01.django基础 1.安装django环境 1 pip3 install django==2.2 -i https://pypi.douban.com/simple 注: django更高版本在某些语法配置上可能会报错 2.创建django项目" />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://localhost:1313/post/django/" />
<meta property="article:published_time" content="2022-03-10T00:00:00+00:00" />
<meta property="article:modified_time" content="2022-03-10T00:00:00+00:00" />
<meta itemprop="name" content="Django">
<meta itemprop="description" content="Step01.django基础 1.安装django环境 1 pip3 install django==2.2 -i https://pypi.douban.com/simple 注: django更高版本在某些语法配置上可能会报错 2.创建django项目">
<meta itemprop="datePublished" content="2022-03-10T00:00:00&#43;00:00" />
<meta itemprop="dateModified" content="2022-03-10T00:00:00&#43;00:00" />
<meta itemprop="wordCount" content="50323">



<meta itemprop="keywords" content="Python," /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Django"/>
<meta name="twitter:description" content="Step01.django基础 1.安装django环境 1 pip3 install django==2.2 -i https://pypi.douban.com/simple 注: django更高版本在某些语法配置上可能会报错 2.创建django项目"/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">Zhang&#39;s Blog</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/home/">
        <li class="mobile-menu-item">Home</li>
      </a><a href="/post/">
        <li class="mobile-menu-item">MyBlog</li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">Tags</li>
      </a><a href="/categories/">
        <li class="mobile-menu-item">Categories</li>
      </a><a href="/about/">
        <li class="mobile-menu-item">About</li>
      </a>
  </ul>

  


</nav>

  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/" class="logo">Zhang&#39;s Blog</a>
</div>





<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="/home/">Home</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/post/">MyBlog</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/tags/">Tags</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/categories/">Categories</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/about/">About</a>
      </li>
  </ul>
</nav>

    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">Django</h1>

      <div class="post-meta">
        <span class="post-time"> 2022-03-10 </span>
        
        
      </div>
    </header>

    <div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">Contents</h2>
  <div class="post-toc-content always-active">
    <nav id="TableOfContents">
  <ul>
    <li><a href="#step01django基础">Step01.django基础</a>
      <ul>
        <li><a href="#1安装django环境">1.安装django环境</a></li>
        <li><a href="#2创建django项目">2.创建django项目</a></li>
        <li><a href="#3运行django项目">3.运行django项目</a></li>
        <li><a href="#4在项目中创建子应用">4.在项目中创建子应用</a></li>
        <li><a href="#5创建helloworld请求">5.创建HelloWorld请求</a></li>
        <li><a href="#6子路由">6.子路由</a>
          <ul>
            <li><a href="#创建子路由文件">创建子路由文件</a></li>
            <li><a href="#传参">传参</a></li>
          </ul>
        </li>
        <li><a href="#7访问html文件">7.访问html文件</a></li>
        <li><a href="#8向静态模板文件传参">8.向<code>静态模板文件</code>传参</a></li>
        <li><a href="#9不同于子路由传参的方式-get接收参数">9.不同于子路由传参的方式-GET接收参数</a></li>
        <li><a href="#10配置static目录">10.配置static目录</a></li>
        <li><a href="#11templates内置标签">11.templates内置标签</a></li>
        <li><a href="#12过滤器">12.过滤器</a>
          <ul>
            <li><a href="#内置过滤器">内置过滤器</a></li>
            <li><a href="#自定义过滤器">自定义过滤器</a></li>
          </ul>
        </li>
        <li><a href="#13小项目之敏感词过滤">13.小项目之敏感词过滤</a></li>
        <li><a href="#14django操作数据库">14.django操作数据库</a>
          <ul>
            <li><a href="#mysql">MySQL</a></li>
            <li><a href="#mongodb">MongoDB</a></li>
          </ul>
        </li>
        <li><a href="#15django中的form表单">15.django中的form表单</a>
          <ul>
            <li><a href="#自定义">自定义</a></li>
            <li><a href="#使用django自带的form表单验证">使用django自带的form表单验证</a></li>
            <li><a href="#表单的错误处理">表单的错误处理</a></li>
            <li><a href="#模型表单">模型表单</a></li>
          </ul>
        </li>
        <li><a href="#16admin">16.admin</a>
          <ul>
            <li><a href="#环境配置">环境配置</a></li>
            <li><a href="#管理系统">管理系统</a></li>
            <li><a href="#registerlogin-and-logout">register、login and logout</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#step02构建个人博客">Step02.构建个人博客</a>
      <ul>
        <li><a href="#创建数据库和数据表">创建数据库和数据表</a></li>
        <li><a href="#博客简单逻辑">博客简单逻辑</a>
          <ul>
            <li><a href="#全部代码">全部代码</a></li>
          </ul>
        </li>
        <li><a href="#公用html模板">公用html模板</a>
          <ul>
            <li><a href="#全部代码-1">全部代码</a></li>
          </ul>
        </li>
        <li><a href="#重新布置结构首页列表页的导航栏">重新布置结构,首页、列表页的导航栏</a>
          <ul>
            <li><a href="#全部代码-2">全部代码</a></li>
          </ul>
        </li>
        <li><a href="#使用css美化首页">使用css美化首页</a></li>
        <li><a href="#使用bootstrap进行页面布局">使用bootstrap进行页面布局</a>
          <ul>
            <li><a href="#全部代码-3">全部代码</a></li>
          </ul>
        </li>
        <li><a href="#使用bootstrap美化页面--响应式布局">使用bootstrap美化页面 + 响应式布局</a>
          <ul>
            <li><a href="#全部代码-4">全部代码</a></li>
          </ul>
        </li>
        <li><a href="#博客列表页面分页">博客列表页面分页</a>
          <ul>
            <li><a href="#全部代码-5">全部代码</a></li>
          </ul>
        </li>
        <li><a href="#分页优化">分页优化</a>
          <ul>
            <li><a href="#当前页点击图标高亮">当前页点击图标高亮</a></li>
            <li><a href="#页码太多隐藏中间的页码部分只显示两头的几页">页码太多,隐藏中间的页码部分,只显示两头的几页</a></li>
          </ul>
        </li>
        <li><a href="#前一篇博客和后一篇博客">前一篇博客和后一篇博客</a></li>
        <li><a href="#在列表页的右边---博客分类底下加上一个社区就是那些破图标">在列表页的右边 - 博客分类底下,加上一个<code>社区</code>,就是那些破图标</a></li>
        <li><a href="#博客列表页的分类区块---每个分类后面加上对应的博客数量">博客列表页的分类区块 - 每个分类后面加上对应的博客数量</a></li>
        <li><a href="#django后台美化">django后台美化</a></li>
        <li><a href="#富文本编辑器">富文本编辑器</a></li>
        <li><a href="#浏览次数">浏览次数</a></li>
        <li><a href="#浏览次数优化">浏览次数优化</a>
          <ul>
            <li><a href="#手写">手写</a></li>
            <li><a href="#使用官方组件---任意类型对象的浏览次数增加">使用官方组件 - 任意类型对象的浏览次数增加</a></li>
            <li><a href="#代码优化">代码优化</a></li>
          </ul>
        </li>
        <li><a href="#制作一个首页图表统计7天内浏览次数">制作一个首页图表,统计7天内浏览次数</a></li>
        <li><a href="#首页获取指定日期的热门博客">首页获取指定日期的热门博客</a>
          <ul>
            <li><a href="#当天热门博客">当天热门博客</a></li>
            <li><a href="#昨天热门博客">昨天热门博客</a></li>
            <li><a href="#全部代码-7">全部代码</a></li>
          </ul>
        </li>
        <li><a href="#django的cache---缓存提速">django的cache - 缓存提速</a></li>
        <li><a href="#首页重新布局一下">首页重新布局一下</a></li>
        <li><a href="#博客评论系统">博客评论系统</a>
          <ul>
            <li><a href="#模型创建">模型创建</a></li>
            <li><a href="#评论功能实现">评论功能实现</a></li>
          </ul>
        </li>
        <li><a href="#使用django的form">使用django的form</a></li>
        <li><a href="#登录页美化--登录或注册">登录页美化 + 登录或注册</a></li>
      </ul>
    </li>
    <li><a href="#step03服务器部署django项目">Step03.服务器部署django项目</a>
      <ul>
        <li><a href="#卸载服务器上原有的python">卸载服务器上原有的python</a></li>
        <li><a href="#更新服务器上python版本">更新服务器上python版本</a></li>
        <li><a href="#服务器更新python导致yum不能用">服务器更新python导致yum不能用</a></li>
      </ul>
    </li>
    <li><a href="#django常见报错">django常见报错</a>
      <ul>
        <li><a href="#文件编码错误">文件编码错误</a></li>
        <li><a href="#更改数据表字段后无法makemigrations和migrate">更改数据表字段后,无法<code>makemigrations</code>和<code>migrate</code></a></li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
</div>
    <div class="post-content">
      <h1 id="step01django基础">Step01.django基础</h1>
<hr>
<h2 id="1安装django环境">1.安装django环境</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">pip3 install <span class="nv">django</span><span class="o">==</span>2.2 -i https://pypi.douban.com/simple
</code></pre></td></tr></table>
</div>
</div><ul>
<li>
<p>注:</p>
<blockquote>
<p>django更高版本在某些语法配置上可能会报错</p>
</blockquote>
</li>
</ul>
<h2 id="2创建django项目">2.创建django项目</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">django-admin startproject 项目名
</code></pre></td></tr></table>
</div>
</div><h2 id="3运行django项目">3.运行django项目</h2>
<ul>
<li>
<p>进入刚创建好的django项目根目录</p>
</li>
<li>
<p>ll</p>
</li>
<li>
<p>有个manage.py</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">python3 manage.py runserver
</code></pre></td></tr></table>
</div>
</div></li>
</ul>
<hr>
<h2 id="4在项目中创建子应用">4.在项目中创建子应用</h2>
<ul>
<li>
<p>项目根目录下有一个和项目名同名的目录</p>
</li>
<li>
<p>这个就是项目的主应用</p>
</li>
<li>
<p>所有业务都写在同一个文件或同一个模块下</p>
</li>
<li>
<p>代码会变得臃肿不好维护</p>
</li>
<li>
<p>django支持在项目中创建多个子应用</p>
</li>
<li>
<p>这样,当一个项目足够庞大时</p>
</li>
<li>
<p>例如微信支付功能,就可以单独创建一个实现微信支付的子应用</p>
</li>
<li>
<p>支付宝支付、登录注册功能同理</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">python3 manage.py startapp 应用名
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>创建完成后,项目根目录下就会生成<code>应用名</code>为名称的文件夹</p>
</li>
</ul>
<hr>
<h2 id="5创建helloworld请求">5.创建HelloWorld请求</h2>
<ul>
<li>
<p>在项目根目录的<code>settings.py</code>中的</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell"><span class="c1"># Application definition</span>
<span class="c1"># 项目中的所有应用,要想在项目中生效,必须在这里注册</span>
<span class="nv">INSTALLED_APPS</span> <span class="o">=</span> <span class="o">[</span>
    <span class="s1">&#39;django.contrib.admin&#39;</span>,
    <span class="s1">&#39;django.contrib.auth&#39;</span>,
    <span class="s1">&#39;django.contrib.contenttypes&#39;</span>,
    <span class="s1">&#39;django.contrib.sessions&#39;</span>,
    <span class="s1">&#39;django.contrib.messages&#39;</span>,
    <span class="s1">&#39;django.contrib.staticfiles&#39;</span>,
    <span class="s1">&#39;index&#39;</span>
<span class="o">]</span>	
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>将<code>应用名</code>注册</p>
</li>
<li>
<p>然后在<code>应用</code>的<code>views.py</code>中</p>
<p><code>views.py</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">django.shortcuts</span> <span class="kn">import</span> <span class="n">render</span>
<span class="kn">from</span> <span class="nn">django.http</span> <span class="kn">import</span> <span class="n">HttpResponse</span> <span class="c1"># 视图的请求响应</span>
  
<span class="c1"># Create your views here.</span>
<span class="k">def</span> <span class="nf">index</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="s2">&#34;Hello Django&#34;</span><span class="p">)</span> <span class="c1"># 返回响应数据,return http可以返回网络请求数据,请求端直接显示</span>
</code></pre></td></tr></table>
</div>
</div><blockquote>
<p>导入了<code>django.http.HttpResponse</code></p>
<p>可以用于将数据包装成<code>网络响应数据</code>,并允许函数直接返回,django引擎就会将数据解析并渲染到前端页面</p>
</blockquote>
</li>
<li>
<p>views.py是视图文件</p>
</li>
<li>
<p>只是有视图是不够的</p>
</li>
<li>
<p>之前在<code>settings.py</code>中注册了应用</p>
</li>
<li>
<p>这和单独的视图无太大关联</p>
</li>
<li>
<p><strong>想要视图可访问,还需要在<code>项目根目录下的urls.py</code>中将视图注册成指定的<code>路由</code></strong></p>
<p><code>urls.py</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">django.contrib</span> <span class="kn">import</span> <span class="n">admin</span>
<span class="kn">from</span> <span class="nn">django.urls</span> <span class="kn">import</span> <span class="n">path</span>
<span class="kn">from</span> <span class="nn">index.views</span> <span class="kn">import</span> <span class="n">index</span> <span class="c1"># 导入视图中需要注册路由的函数</span>
  
<span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;admin/&#39;</span><span class="p">,</span> <span class="n">admin</span><span class="o">.</span><span class="n">site</span><span class="o">.</span><span class="n">urls</span><span class="p">),</span>
    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="n">index</span><span class="p">)</span> <span class="c1"># 注册视图</span>
<span class="p">]</span>
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>运行项目</p>
</li>
</ul>
<p><strong>总结</strong></p>
<p><strong>创建应用</strong></p>
<p><strong>应用注册到settings.py</strong></p>
<p><strong>创建视图</strong></p>
<p><strong>视图注册到urls.py</strong></p>
<p><strong>settings.py和urls.py都是全局的</strong></p>
<hr>
<p><strong>注意:一切路由都是配置,我们最终想获取的是网页,所以就需要</strong></p>
<p><strong>通过路由请求视图</strong></p>
<hr>
<h2 id="6子路由">6.子路由</h2>
<ul>
<li>
<p>不可能将所有应用的所有路由都写在项目根路由文件中</p>
</li>
<li>
<p>django支持在应用中创建<code>urls.py</code>,作为该应用的路由配置文件</p>
</li>
<li>
<p>只需要将该应用的路由文件在项目根路由文件中注册即可</p>
</li>
</ul>
<h3 id="创建子路由文件">创建子路由文件</h3>
<ul>
<li>
<p>在应用下创建<code>urls.py</code>,作为该应用的子路由</p>
<p><code>urls.py</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">django.urls</span> <span class="kn">import</span> <span class="n">path</span>
<span class="kn">from</span> <span class="nn">.views</span> <span class="kn">import</span> <span class="n">index</span> <span class="c1"># 导入视图</span>
  
<span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;index/&#39;</span><span class="p">,</span> <span class="n">index</span><span class="p">)</span>
<span class="p">]</span>
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>将<code>子路由</code>在<code>根路由</code>中注册</p>
<p><code>urls.py</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">django.contrib</span> <span class="kn">import</span> <span class="n">admin</span>
<span class="kn">from</span> <span class="nn">django.urls</span> <span class="kn">import</span> <span class="n">path</span><span class="p">,</span> <span class="n">include</span>
  
<span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;admin/&#39;</span><span class="p">,</span> <span class="n">admin</span><span class="o">.</span><span class="n">site</span><span class="o">.</span><span class="n">urls</span><span class="p">),</span>
    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;a/&#39;</span><span class="p">,</span> <span class="n">include</span><span class="p">(</span><span class="s1">&#39;index.urls&#39;</span><span class="p">))</span> <span class="c1"># include用于将子路由注册到根路由中</span>
<span class="p">]</span>
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>假设子路由中有3个路由,分别是</p>
<blockquote>
<p>path(&lsquo;index1/', index1),</p>
<p>path(&lsquo;index2/', index2),</p>
<p>path(&lsquo;index3/', index3),</p>
</blockquote>
</li>
<li>
<p>该子路由文件的根路由是<code>a/</code></p>
</li>
<li>
<p>则需要访问</p>
<blockquote>
<p>http://localhost:8080/a/index1</p>
<p>http://localhost:8080/a/index2</p>
<p>http://localhost:8080/a/index3</p>
</blockquote>
</li>
<li>
<p>最终的结果就是</p>
</li>
</ul>
<p><strong><code>a/index</code>,到达子路由终端,请求<code>该子路由</code>对应绑定的<code>视图函数</code></strong></p>
<hr>
<h3 id="传参">传参</h3>
<h4 id="子路由传参">子路由传参</h4>
<ul>
<li>
<p>根路由照常注册子路由</p>
<p><code>urls.py</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">django.contrib</span> <span class="kn">import</span> <span class="n">admin</span>
<span class="kn">from</span> <span class="nn">django.urls</span> <span class="kn">import</span> <span class="n">path</span><span class="p">,</span> <span class="n">include</span>
  
<span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;admin/&#39;</span><span class="p">,</span> <span class="n">admin</span><span class="o">.</span><span class="n">site</span><span class="o">.</span><span class="n">urls</span><span class="p">),</span>
    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;a/&#39;</span><span class="p">,</span> <span class="n">include</span><span class="p">(</span><span class="s1">&#39;index.urls&#39;</span><span class="p">))</span>
<span class="p">]</span>
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>子路由可以通过<code>Restful</code>风格传参</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">django.urls</span> <span class="kn">import</span> <span class="n">path</span>
<span class="kn">from</span> <span class="nn">.views</span> <span class="kn">import</span> <span class="n">index</span>
  
<span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;index/&lt;str:name&gt;/&lt;int:age&gt;&#39;</span><span class="p">,</span> <span class="n">index</span><span class="p">)</span>
<span class="p">]</span>
</code></pre></td></tr></table>
</div>
</div><blockquote>
<p>参数</p>
<p>&lt;参数类型:参数名&gt;</p>
<p><code>注意</code>:这个参数名对应的是请求的视图函数的参数</p>
</blockquote>
</li>
<li>
<p><code>子路由</code>-&gt;<code>视图</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">django.shortcuts</span> <span class="kn">import</span> <span class="n">render</span>
<span class="kn">from</span> <span class="nn">django.http</span> <span class="kn">import</span> <span class="n">HttpResponse</span>
  
<span class="c1"># Create your views here.</span>
  
<span class="k">def</span> <span class="nf">index</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">age</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">age</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="s2">&#34;Hello Django!!!&#34;</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div></li>
</ul>
<p><strong>看,子路由的url的参数都在子路由中,和根路由无关</strong></p>
<hr>
<h4 id="通用视图-使用类的方式">通用视图-使用类的方式</h4>
<ul>
<li>
<p>根路由正常不变</p>
</li>
<li>
<p>更改视图文件</p>
<ul>
<li>
<p>导入通用视图库</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">django.http</span> <span class="kn">import</span> <span class="n">HttpResponse</span>
<span class="kn">from</span> <span class="nn">django.views.generic</span> <span class="kn">import</span> <span class="n">View</span>
</code></pre></td></tr></table>
</div>
</div></li>
</ul>
<p><code>views.py</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">django.http</span> <span class="kn">import</span> <span class="n">HttpResponse</span>
<span class="kn">from</span> <span class="nn">django.views.generic</span> <span class="kn">import</span> <span class="n">View</span>
  
  
<span class="c1"># Create your views here.</span>
<span class="k">class</span> <span class="nc">Message</span><span class="p">(</span><span class="n">View</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">age</span><span class="p">):</span> <span class="c1"># 方法名必须为get</span>
        <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="s2">&#34;My name is {}, age is {}&#34;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">age</span><span class="p">))</span>
</code></pre></td></tr></table>
</div>
</div><blockquote>
<p>就是将原本的函数</p>
<p>放在类里</p>
<p>然后继承View类</p>
<p>将该类变成通用视图</p>
</blockquote>
</li>
<li>
<p>子路由</p>
<p><code>urls.py</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">django.urls</span> <span class="kn">import</span> <span class="n">path</span>
<span class="kn">from</span> <span class="nn">.views</span> <span class="kn">import</span> <span class="n">Message</span>
  
<span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;index/&lt;str:name&gt;/&lt;int:age&gt;&#39;</span><span class="p">,</span> <span class="n">Message</span><span class="o">.</span><span class="n">as_view</span><span class="p">())</span>
<span class="p">]</span>
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>之前是从视图文件中导入函数</p>
</li>
<li>
<p>现在是导入类</p>
</li>
<li>
<p>调用<code>继承了View类的类</code>的as_view()方法</p>
</li>
<li>
<p>查看<code>as_view()</code>方法</p>
</li>
<li>
<p>发现它是调用通用视图类的<code>get</code>方法</p>
</li>
<li>
<p>本质上和上面的<code>子路由传参</code>是一样的</p>
</li>
</ul>
<hr>
<h2 id="7访问html文件">7.访问html文件</h2>
<ul>
<li>
<p>在项目根目录下创建名为<code>templates</code>的文件夹</p>
</li>
<li>
<p>其实叫什么都无所谓,到时候在<code>settings.py</code>中注册</p>
</li>
<li>
<p>在templates下创建index.html</p>
</li>
<li>
<p>在<code>settings.py</code>中注册静态模板目录</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">os</span>
  
<span class="c1"># 项目静态资源(页面模板)</span>
<span class="n">TEMPLATES</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">{</span>
        <span class="s1">&#39;BACKEND&#39;</span><span class="p">:</span> <span class="s1">&#39;django.template.backends.django.DjangoTemplates&#39;</span><span class="p">,</span>
        <span class="s1">&#39;DIRS&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">BASE_DIR</span><span class="p">,</span> <span class="s1">&#39;templates&#39;</span><span class="p">)],</span>
        <span class="s1">&#39;APP_DIRS&#39;</span><span class="p">:</span> <span class="bp">True</span><span class="p">,</span>
        <span class="s1">&#39;OPTIONS&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;context_processors&#39;</span><span class="p">:</span> <span class="p">[</span>
                <span class="s1">&#39;django.template.context_processors.debug&#39;</span><span class="p">,</span>
                <span class="s1">&#39;django.template.context_processors.request&#39;</span><span class="p">,</span>
                <span class="s1">&#39;django.contrib.auth.context_processors.auth&#39;</span><span class="p">,</span>
                <span class="s1">&#39;django.contrib.messages.context_processors.messages&#39;</span><span class="p">,</span>
            <span class="p">],</span>
        <span class="p">},</span>
    <span class="p">},</span>
<span class="p">]</span>
</code></pre></td></tr></table>
</div>
</div><blockquote>
<p>在<code>DIRS</code>的数组中添加</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">BASE_DIR</span><span class="p">,</span> <span class="s1">&#39;templates&#39;</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><p>第二个参数是<code>静态模板目录名</code></p>
</blockquote>
</li>
<li>
<p><code>根路由</code>和<code>子路由</code>的<code>传参方式</code>和<code>第二个参数注册的跳转</code>不变</p>
</li>
<li>
<p>视图的请求方式改变</p>
</li>
<li>
<p>之前是请求简单的文本数据</p>
</li>
<li>
<p>现在需要渲染</p>
</li>
<li>
<p>这就需要用到<strong><code>render</code></strong></p>
</li>
<li>
<p><strong>渲染函数</strong></p>
</li>
<li>
<p>之前在<code>templates</code>下创建了<code>index.html</code></p>
<p><code>urls.py</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="c1"># from django.http import HttpResponse</span>
<span class="kn">from</span> <span class="nn">django.views.generic</span> <span class="kn">import</span> <span class="n">View</span>
<span class="kn">from</span> <span class="nn">django.shortcuts</span> <span class="kn">import</span> <span class="n">render</span>
  
  
<span class="c1"># Create your views here.</span>
<span class="k">class</span> <span class="nc">Message</span><span class="p">(</span><span class="n">View</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">age</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">&#39;index.html&#39;</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>最后一行,请求<code>index.html</code>,并通过<code>render函数</code>渲染到浏览器</p>
</li>
<li>
<p>这里直接写<code>index.html</code>是该文件在模板目录内的相对路径</p>
</li>
<li>
<p>而django之所以可以找到这个文件</p>
</li>
<li>
<p>是因为刚才在<code>settings.py</code>中已经将<code>templates</code>目录注册为了静态模板目录</p>
</li>
</ul>
<hr>
<h2 id="8向静态模板文件传参">8.向<code>静态模板文件</code>传参</h2>
<p><code>views.py</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="c1"># from django.http import HttpResponse</span>
<span class="kn">from</span> <span class="nn">django.views.generic</span> <span class="kn">import</span> <span class="n">View</span>
<span class="kn">from</span> <span class="nn">django.shortcuts</span> <span class="kn">import</span> <span class="n">render</span>


<span class="c1"># Create your views here.</span>
<span class="k">class</span> <span class="nc">Message</span><span class="p">(</span><span class="n">View</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
		<span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">&#39;index.html&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="n">name</span><span class="p">})</span>
</code></pre></td></tr></table>
</div>
</div><blockquote>
<p>第三个参数,字典形式,key-value</p>
<p>render渲染函数会将这个值传到指定的模板文件<code>index.html</code>中</p>
</blockquote>
<ul>
<li>
<p>在模板文件<code>index.html</code>中可通过<code>el表达式</code>通过key取出对应的value</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html"><span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;container&#34;</span><span class="p">&gt;</span>
  {{ name }}
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>根路由和子路由传参的方式照常</p>
</li>
</ul>
<hr>
<h2 id="9不同于子路由传参的方式-get接收参数">9.不同于子路由传参的方式-GET接收参数</h2>
<p><code>views.py</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="c1"># from django.http import HttpResponse</span>
<span class="kn">from</span> <span class="nn">django.views.generic</span> <span class="kn">import</span> <span class="n">View</span>
<span class="kn">from</span> <span class="nn">django.shortcuts</span> <span class="kn">import</span> <span class="n">render</span>


<span class="c1"># Create your views here.</span>
<span class="k">class</span> <span class="nc">Message</span><span class="p">(</span><span class="n">View</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">GET</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">&#39;index.html&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="n">name</span><span class="p">})</span>
</code></pre></td></tr></table>
</div>
</div><ul>
<li>
<p>request.GET.get(key,default_value)方法就会将整个路由设置为</p>
<blockquote>
<p>http://localhost:8080?name=xxx</p>
</blockquote>
</li>
<li>
<p>而不用在子路由传参</p>
</li>
<li>
<p>但前者是restful风格,这种是传统风格</p>
</li>
</ul>
<hr>
<h2 id="10配置static目录">10.配置static目录</h2>
<ul>
<li>
<p>templates目录是放置html模板文件的</p>
</li>
<li>
<p>static是存放<code>css</code>、<code>js</code>、<code>images</code>等静态资源文件</p>
</li>
<li>
<p>在templates同级目录创建static目录</p>
</li>
<li>
<p>在settings.py中设置</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="n">STATIC_URL</span> <span class="o">=</span> <span class="s1">&#39;/static/&#39;</span>
  
<span class="n">STATICFILES_DIRS</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">BASE_DIR</span><span class="p">,</span> <span class="s1">&#39;static&#39;</span><span class="p">),</span>
<span class="p">]</span>
</code></pre></td></tr></table>
</div>
</div></li>
</ul>
<p><strong>正常来讲,static目录是无法被网络请求的。在settings.py中进行设置后,static下的静态资源就可以被作为网络资源使用并访问</strong></p>
<ul>
<li>
<p>在static下创建css目录</p>
</li>
<li>
<p>在css目录下创建index.css</p>
<p><code>index.css</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-css" data-lang="css"><span class="o">*</span><span class="p">{</span>
    <span class="k">margin</span><span class="p">:</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">padding</span><span class="p">:</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
  
<span class="p">.</span><span class="nc">container</span><span class="p">{</span>
    <span class="k">width</span><span class="p">:</span> <span class="mi">100</span><span class="kt">vw</span><span class="p">;</span>
    <span class="k">height</span><span class="p">:</span> <span class="mi">100</span><span class="kt">vh</span><span class="p">;</span>
    <span class="k">background-color</span><span class="p">:</span> <span class="kc">skyblue</span><span class="p">;</span>
  
    <span class="k">display</span><span class="p">:</span> <span class="kc">flex</span><span class="p">;</span>
    <span class="k">justify-content</span><span class="p">:</span> <span class="kc">center</span><span class="p">;</span>
    <span class="k">align-content</span><span class="p">:</span> <span class="kc">center</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>然后在index.html中引入</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html"><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="p">&lt;</span><span class="nt">html</span> <span class="na">lang</span><span class="o">=</span><span class="s">&#34;en&#34;</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">charset</span><span class="o">=</span><span class="s">&#34;UTF-8&#34;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">link</span> <span class="na">rel</span><span class="o">=</span><span class="s">&#34;stylesheet&#34;</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;../static/css/index.css&#34;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>主页<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;container&#34;</span><span class="p">&gt;</span>
        {{ name }}
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</code></pre></td></tr></table>
</div>
</div></li>
</ul>
<hr>
<h2 id="11templates内置标签">11.templates内置标签</h2>
<ul>
<li>
<p>前端传数据</p>
<p><code>views.py</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="c1"># from django.http import HttpResponse</span>
<span class="kn">from</span> <span class="nn">django.views.generic</span> <span class="kn">import</span> <span class="n">View</span>
<span class="kn">from</span> <span class="nn">django.shortcuts</span> <span class="kn">import</span> <span class="n">render</span>
  
  
<span class="c1"># Create your views here.</span>
<span class="k">class</span> <span class="nc">Message</span><span class="p">(</span><span class="n">View</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">GET</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="n">list_data</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">&#39;index.html&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="n">name</span><span class="p">,</span> <span class="s1">&#39;list_data&#39;</span><span class="p">:</span> <span class="n">list_data</span><span class="p">})</span>
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>其他不变</p>
</li>
<li>
<p>和<code>{{ name }}</code>的el表达式一样</p>
</li>
<li>
<p>for循环</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html"><span class="c">&lt;!-- for循环 --&gt;</span>
    {% for item in list_data %}
        <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;</span>{{ item }} - {{ forloop.counter }} - {{ forloop.counter0 }} - {{ forloop.revcounter }} - {{ forloop.revcounter0 }} - {{ forloop.first }} - {{ forloop.last }} - {{ empty }}<span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
    {% endfor %}
</code></pre></td></tr></table>
</div>
</div><blockquote>
<ul>
<li>
<p>forloop.counter</p>
<blockquote>
<p>从1开始计算获取当前索引</p>
</blockquote>
</li>
<li>
<p>forloop.counter0</p>
<blockquote>
<p>从0开始计算获取当前索引</p>
</blockquote>
</li>
<li>
<p>forloop.revcounter</p>
<blockquote>
<p>索引从最大值递减到1</p>
</blockquote>
</li>
<li>
<p>forloop.revcounter0</p>
<blockquote>
<p>索引从最大值递减到0</p>
</blockquote>
</li>
<li>
<p>forloop.first</p>
<blockquote>
<p>当前元素是否为第一个</p>
</blockquote>
</li>
<li>
<p>forloop.last</p>
<blockquote>
<p>当前元素是否为最后一个</p>
</blockquote>
</li>
<li>
<p>empty</p>
<blockquote>
<p>当前元素是否为空</p>
</blockquote>
</li>
</ul>
</blockquote>
</li>
<li>
<p>if条件判断语句</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html"><span class="c">&lt;!-- if条件判断语句 --&gt;</span>
    {% if name == &#39;zhangyuhang&#39; %}
        <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>{{ name }}<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
    {% elif name == &#39;zhangsan&#39; %}
        <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>zhangsan<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
    {% endif %}
</code></pre></td></tr></table>
</div>
</div></li>
</ul>
<hr>
<h2 id="12过滤器">12.过滤器</h2>
<h3 id="内置过滤器">内置过滤器</h3>
<p><code>views.py</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="c1"># from django.http import HttpResponse</span>
<span class="kn">from</span> <span class="nn">django.views.generic</span> <span class="kn">import</span> <span class="n">View</span>
<span class="kn">from</span> <span class="nn">django.shortcuts</span> <span class="kn">import</span> <span class="n">render</span>
<span class="kn">import</span> <span class="nn">datetime</span>


<span class="c1"># Create your views here.</span>
<span class="k">class</span> <span class="nc">Message</span><span class="p">(</span><span class="n">View</span><span class="p">):</span>
    <span class="c1"># def get(self, request, name):</span>
    <span class="c1">#     return render(request, &#39;index.html&#39;, {&#39;name&#39;: name})</span>
    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">GET</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;a&#39;</span><span class="p">,</span>
            <span class="s1">&#39;list_data&#39;</span><span class="p">:</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span>
            <span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
            <span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
            <span class="s1">&#39;age&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span>
            <span class="s1">&#39;float_num&#39;</span><span class="p">:</span> <span class="mf">3.1415926</span><span class="p">,</span>
            <span class="s1">&#39;div_block&#39;</span><span class="p">:</span> <span class="s2">&#34;&lt;div style=&#39;background-color:skyblue;width:50px;height:50px&#39;&gt;&lt;/div&gt;&#34;</span><span class="p">,</span>
            <span class="s1">&#39;date_time&#39;</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(),</span>
            <span class="s1">&#39;cur_str&#39;</span><span class="p">:</span> <span class="s1">&#39;a_b_c&#39;</span><span class="p">,</span>
            <span class="s1">&#39;big_first&#39;</span><span class="p">:</span> <span class="s1">&#39;big_first&#39;</span><span class="p">,</span>
            <span class="s1">&#39;default&#39;</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span>
            <span class="s1">&#39;list_sort&#39;</span><span class="p">:</span> <span class="p">[</span>
                <span class="p">{</span>
                    <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;yu&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;age&#39;</span><span class="p">:</span> <span class="mi">2</span>
                <span class="p">},</span>
                <span class="p">{</span>
                    <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;zhang&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;age&#39;</span><span class="p">:</span> <span class="mi">1</span>
                <span class="p">},</span>
                <span class="p">{</span>
                    <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;hang&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;age&#39;</span><span class="p">:</span> <span class="mi">3</span>
                <span class="p">}</span>
            <span class="p">],</span>
            <span class="s1">&#39;array&#39;</span><span class="p">:</span> <span class="p">[</span>
                <span class="s1">&#39;1&#39;</span><span class="p">,</span>
                <span class="s1">&#39;2&#39;</span><span class="p">,</span>
                <span class="s1">&#39;3&#39;</span><span class="p">,</span>
                <span class="s1">&#39;4&#39;</span>
            <span class="p">],</span>
            <span class="s1">&#39;random_num&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">],</span>
            <span class="s1">&#39;slice_str&#39;</span><span class="p">:</span> <span class="s1">&#39;hellodjango&#39;</span><span class="p">,</span>
            <span class="s1">&#39;url_str&#39;</span><span class="p">:</span> <span class="s1">&#39;测试 http://zhang666zyh.github.io&#39;</span><span class="p">,</span>
            <span class="s1">&#39;big_all&#39;</span><span class="p">:</span> <span class="s1">&#39;hellodjango&#39;</span><span class="p">,</span>
            <span class="s1">&#39;date_until&#39;</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span> <span class="o">+</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">&#39;index.html&#39;</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><p><code>index.html</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span><span class="lnt">78
</span><span class="lnt">79
</span><span class="lnt">80
</span><span class="lnt">81
</span><span class="lnt">82
</span><span class="lnt">83
</span><span class="lnt">84
</span><span class="lnt">85
</span><span class="lnt">86
</span><span class="lnt">87
</span><span class="lnt">88
</span><span class="lnt">89
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html">{% load %}
{% load static %}
<span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="p">&lt;</span><span class="nt">html</span> <span class="na">lang</span><span class="o">=</span><span class="s">&#34;en&#34;</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">charset</span><span class="o">=</span><span class="s">&#34;UTF-8&#34;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">link</span> <span class="na">rel</span><span class="o">=</span><span class="s">&#34;stylesheet&#34;</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;../static/css/index.css&#34;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>a<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>

    <span class="p">&lt;</span><span class="nt">br</span><span class="p">&gt;</span>

    name : {{ name }} <span class="c">&lt;!-- 取值 --&gt;</span>

    <span class="p">&lt;</span><span class="nt">br</span><span class="p">&gt;</span>

    html_str : {{ div_block | safe}} <span class="c">&lt;!-- 将HTML字符串转义为HTML文本 --&gt;</span>

    <span class="p">&lt;</span><span class="nt">br</span><span class="p">&gt;</span>

    date_time : {{ date_time | date:&#34;Y-m-d H:i:s&#34; }} <span class="c">&lt;!-- 日期格式化 --&gt;</span>

    <span class="p">&lt;</span><span class="nt">br</span><span class="p">&gt;</span>
    default : {{ default | default:&#39;default_value&#39; }} <span class="c">&lt;!-- 当变量值为False时,使用默认值赋值 --&gt;</span>


    <span class="c">&lt;!------------------------------------------------------------- 列表操作 ---------------------------------------------------------&gt;</span>
    <span class="p">&lt;</span><span class="nt">br</span><span class="p">&gt;</span>
    list_sort : {{ list_sort | dictsort:&#39;age&#39; }} <span class="c">&lt;!-- 对列表中的对象按照某个字段进行正序排序 --&gt;</span>

    <span class="p">&lt;</span><span class="nt">br</span><span class="p">&gt;</span>
    list_sort_reversed : {{ list_sort | dictsortreversed:&#39;age&#39; }} <span class="c">&lt;!-- 对列表中的对象按照某个字段进行倒序排序 --&gt;</span>

    <span class="p">&lt;</span><span class="nt">br</span><span class="p">&gt;</span>
    list_first_item : {{ list_sort | first }} <span class="c">&lt;!-- 获取列表的第一个元素 --&gt;</span>

    <span class="p">&lt;</span><span class="nt">br</span><span class="p">&gt;</span>
    list_last_item : {{ list_sort | last }} <span class="c">&lt;!-- 获取列表的最后一个元素 --&gt;</span>

    <span class="p">&lt;</span><span class="nt">br</span><span class="p">&gt;</span>
    list_length : {{ list_sort | length }} <span class="c">&lt;!-- 获取列表的长度 --&gt;</span>

    <span class="p">&lt;</span><span class="nt">br</span><span class="p">&gt;</span>
    array : {{ array | join:&#39;*&#39; }} <span class="c">&lt;!-- 使用指定字符将列表中所有元素连接成一个字符串 --&gt;</span>

    <span class="p">&lt;</span><span class="nt">br</span><span class="p">&gt;</span>
    length_is : {{ list_sort | length_is:3 }} <span class="c">&lt;!-- 判断列表长度是否等于某个值,返回值为boolean类型 --&gt;</span>

    <span class="p">&lt;</span><span class="nt">br</span><span class="p">&gt;</span>
    divisibleby : {{ age | divisibleby:2 }} <span class="c">&lt;!-- 判断数字是否可以被某个值整除,返回boolean类型 --&gt;</span>

    <span class="c">&lt;!--------------------------------------------------------------数字操作----------------------------------------------------------&gt;</span>

    <span class="p">&lt;</span><span class="nt">br</span><span class="p">&gt;</span>

    float_num : {{ float_num | floatformat:2}} <span class="c">&lt;!-- 小数:精确到小数点后2位 --&gt;</span>

    <span class="p">&lt;</span><span class="nt">br</span><span class="p">&gt;</span>
    add : {{ age | add:10 }} <span class="c">&lt;!-- 将数字增加10 --&gt;</span>

    <span class="p">&lt;</span><span class="nt">br</span><span class="p">&gt;</span>
    random_num : {{ random_num | random }} <span class="c">&lt;!-- 从列表中随机取值 --&gt;</span>

    <span class="c">&lt;!-------------------------------------------------------------字符串操作-----------------------------------------------------------&gt;</span>

    <span class="p">&lt;</span><span class="nt">br</span><span class="p">&gt;</span>
    slice : {{ slice_str | slice:&#39;:3&#39; }} <span class="c">&lt;!-- 按照指定长度切片 --&gt;</span>

    <span class="p">&lt;</span><span class="nt">br</span><span class="p">&gt;</span>
    url_str : {{ url_str | urlize }} <span class="c">&lt;!-- 使得字符串中的url可点击 --&gt;</span>

    <span class="p">&lt;</span><span class="nt">br</span><span class="p">&gt;</span>
    word_count : {{ url_str | wordcount }} <span class="c">&lt;!-- 根据空格判断字符串中有多少单词 --&gt;</span>

    <span class="p">&lt;</span><span class="nt">br</span><span class="p">&gt;</span>
    cur_str : {{ cur_str | cut:&#39;_&#39; }} <span class="c">&lt;!-- 按照指定字符切割字符串并重新拼接成一个新的字符串 --&gt;</span>

    <span class="p">&lt;</span><span class="nt">br</span><span class="p">&gt;</span>
    big_first : {{ big_first | capfirst }} <span class="c">&lt;!-- 将字符串第一个字母大写 --&gt;</span>

    <span class="p">&lt;</span><span class="nt">br</span><span class="p">&gt;</span>
    big_all : {{ big_all | upper }} <span class="c">&lt;!-- 字符串中所有字母大写 --&gt;</span>

    <span class="p">&lt;</span><span class="nt">br</span><span class="p">&gt;</span>
    date_until : {{ date_until | timeuntil }} <span class="c">&lt;!-- 计算某一时间距离当前时间有多久 --&gt;</span>

<span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</code></pre></td></tr></table>
</div>
</div><hr>
<h3 id="自定义过滤器">自定义过滤器</h3>
<h4 id="django的自定义过滤器方法">django的自定义过滤器方法</h4>
<ul>
<li>
<p>在项目根目录创建<code>templatetags</code>目录</p>
</li>
<li>
<p>在templatetags下创建<code>myfilter.py</code></p>
<p><code>myfilter.py</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">django</span> <span class="kn">import</span> <span class="n">template</span>
  
<span class="n">register</span> <span class="o">=</span> <span class="n">template</span><span class="o">.</span><span class="n">Library</span><span class="p">()</span>
  
  
<span class="nd">@register.filter</span>
<span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">a</span> <span class="o">*</span> <span class="n">b</span>
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>这就是自定义过滤器</p>
</li>
<li>
<p>在<code>settings.py</code>中将这个包注册为app</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python">    <span class="s1">&#39;django.contrib.admin&#39;</span><span class="p">,</span>
    <span class="s1">&#39;django.contrib.auth&#39;</span><span class="p">,</span>
    <span class="s1">&#39;django.contrib.contenttypes&#39;</span><span class="p">,</span>
    <span class="s1">&#39;django.contrib.sessions&#39;</span><span class="p">,</span>
    <span class="s1">&#39;django.contrib.messages&#39;</span><span class="p">,</span>
    <span class="s1">&#39;django.contrib.staticfiles&#39;</span><span class="p">,</span>
    <span class="s1">&#39;index&#39;</span><span class="p">,</span>
    <span class="s1">&#39;templatetags&#39;</span><span class="p">,</span>
<span class="p">]</span>
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>视图文件中传一个数值</p>
<p><code>views.py</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">django.shortcuts</span> <span class="kn">import</span> <span class="n">render</span>
<span class="kn">from</span> <span class="nn">django.views.generic</span> <span class="kn">import</span> <span class="n">View</span>
  
  
<span class="c1"># Create your views here.</span>
<span class="k">class</span> <span class="nc">Message</span><span class="p">(</span><span class="n">View</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">GET</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">&#39;index.html&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="n">name</span><span class="p">,</span> <span class="s1">&#39;age&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">})</span>
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>在模板文件中使用</p>
<p><code>index.html</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html">{% load static %}
<span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="p">&lt;</span><span class="nt">html</span> <span class="na">lang</span><span class="o">=</span><span class="s">&#34;en&#34;</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">charset</span><span class="o">=</span><span class="s">&#34;UTF-8&#34;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>首页<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
    {{ name }}
  
    <span class="p">&lt;</span><span class="nt">br</span><span class="p">&gt;</span>
    age : {{ age | add:100 }}
<span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</code></pre></td></tr></table>
</div>
</div></li>
</ul>
<h4 id="使用jinja2设置自定义过滤器">使用jinja2设置自定义过滤器</h4>
<ul>
<li>
<p>安装jinja2</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">pip install jinja2
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>手动创建的项目子应用中,创建<code>myfilter.py</code></p>
<p><code>myfilter.py</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="k">def</span> <span class="nf">jinja2_01</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">args</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">value</span> <span class="o">*</span> <span class="n">args</span>
</code></pre></td></tr></table>
</div>
</div><blockquote>
<p>用于值过滤</p>
</blockquote>
</li>
<li>
<p>在手动创建的项目子应用中,创建<code>jinja2_01.py</code></p>
<p><code>jinja2_01.py</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">jinja2</span> <span class="kn">import</span> <span class="n">Environment</span>
<span class="kn">from</span> <span class="nn">django.contrib.staticfiles.storage</span> <span class="kn">import</span> <span class="n">staticfiles_storage</span>
<span class="kn">from</span> <span class="nn">django.urls</span> <span class="kn">import</span> <span class="n">reverse</span>
<span class="kn">from</span> <span class="nn">.myfilter</span> <span class="kn">import</span> <span class="n">jinja2_01</span>
  
  
<span class="k">def</span> <span class="nf">environment</span><span class="p">(</span><span class="o">**</span><span class="n">options</span><span class="p">):</span>
    <span class="n">env</span> <span class="o">=</span> <span class="n">Environment</span><span class="p">(</span><span class="o">**</span><span class="n">options</span><span class="p">)</span>
    <span class="n">env</span><span class="o">.</span><span class="n">globals</span><span class="o">.</span><span class="n">update</span><span class="p">({</span>
        <span class="s1">&#39;static&#39;</span><span class="p">:</span> <span class="n">staticfiles_storage</span><span class="o">.</span><span class="n">url</span><span class="p">,</span>
        <span class="s1">&#39;url&#39;</span><span class="p">:</span> <span class="n">reverse</span>
    <span class="p">})</span>
  
    <span class="n">env</span><span class="o">.</span><span class="n">filters</span><span class="p">[</span><span class="s1">&#39;jinja2_01&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">jinja2_01</span> 
  
    <span class="k">return</span> <span class="n">env</span>
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>在settings.py中配置jinja2过滤器</p>
<p><code>settings.py</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="n">TEMPLATES</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">{</span>
        <span class="c1"># Custom filter</span>
        <span class="s1">&#39;BACKEND&#39;</span><span class="p">:</span> <span class="s1">&#39;django.template.backends.jinja2.Jinja2&#39;</span><span class="p">,</span>
        <span class="s1">&#39;DIRS&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">BASE_DIR</span><span class="p">,</span> <span class="s1">&#39;templates&#39;</span><span class="p">)],</span>
        <span class="s1">&#39;APP_DIRS&#39;</span><span class="p">:</span> <span class="bp">True</span><span class="p">,</span>
        <span class="s1">&#39;OPTIONS&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;context_processors&#39;</span><span class="p">:</span> <span class="p">[</span>
                <span class="s1">&#39;django.template.context_processors.debug&#39;</span><span class="p">,</span>
                <span class="s1">&#39;django.template.context_processors.request&#39;</span><span class="p">,</span>
                <span class="s1">&#39;django.contrib.auth.context_processors.auth&#39;</span><span class="p">,</span>
                <span class="s1">&#39;django.contrib.messages.context_processors.messages&#39;</span><span class="p">,</span>
            <span class="p">],</span>
  
            <span class="c1"># 刚才写的jinja2_01.py中的environment函数</span>
            <span class="s1">&#39;environment&#39;</span><span class="p">:</span> <span class="s1">&#39;index.jinja2_01.environment&#39;</span><span class="p">,</span>
        <span class="p">},</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="c1"># Default filter</span>
        <span class="s1">&#39;BACKEND&#39;</span><span class="p">:</span> <span class="s1">&#39;django.template.backends.django.DjangoTemplates&#39;</span><span class="p">,</span>
        <span class="s1">&#39;DIRS&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">BASE_DIR</span><span class="p">,</span> <span class="s1">&#39;templates&#39;</span><span class="p">)],</span>
        <span class="s1">&#39;APP_DIRS&#39;</span><span class="p">:</span> <span class="bp">True</span><span class="p">,</span>
        <span class="s1">&#39;OPTIONS&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;context_processors&#39;</span><span class="p">:</span> <span class="p">[</span>
                <span class="s1">&#39;django.template.context_processors.debug&#39;</span><span class="p">,</span>
                <span class="s1">&#39;django.template.context_processors.request&#39;</span><span class="p">,</span>
                <span class="s1">&#39;django.contrib.auth.context_processors.auth&#39;</span><span class="p">,</span>
                <span class="s1">&#39;django.contrib.messages.context_processors.messages&#39;</span><span class="p">,</span>
            <span class="p">],</span>
        <span class="p">},</span>
    <span class="p">},</span>
<span class="p">]</span>
</code></pre></td></tr></table>
</div>
</div><ul>
<li>
<p>原本TEMPLATES数组中只有一个json对象</p>
<blockquote>
<p>&lsquo;BACKEND&rsquo;: &lsquo;django.template.backends.django.DjangoTemplates&rsquo;,</p>
</blockquote>
</li>
<li>
<p>默认的模板</p>
</li>
<li>
<p>将这个json对象复制添加到TEMPLATES中</p>
</li>
<li>
<p>然后更改</p>
<p><code>BACKEND</code></p>
<blockquote>
<p>&lsquo;BACKEND&rsquo;: &lsquo;django.template.backends.django.DjangoTemplates&rsquo;,</p>
</blockquote>
</li>
<li>
<p>在<code>OPTIONS</code>json对象中添加</p>
<blockquote>
<p>&lsquo;environment&rsquo;: &lsquo;index.jinja2_01.environment&rsquo;,</p>
</blockquote>
<ul>
<li>这是刚才创建的<code>jinja2_01.py</code>中的environment函数(返回env的函数)</li>
</ul>
</li>
</ul>
</li>
<li>
<p>在模板文件中使用</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="o">&lt;</span><span class="err">!</span><span class="n">DOCTYPE</span> <span class="n">html</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="n">html</span> <span class="n">lang</span><span class="o">=</span><span class="s2">&#34;en&#34;</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="n">head</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">meta</span> <span class="n">charset</span><span class="o">=</span><span class="s2">&#34;UTF-8&#34;</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">link</span> <span class="n">rel</span><span class="o">=</span><span class="s2">&#34;stylesheet&#34;</span> <span class="n">href</span><span class="o">=</span><span class="s2">&#34;../static/index.css&#34;</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">title</span><span class="o">&gt;</span><span class="err">首页</span><span class="o">&lt;/</span><span class="n">title</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">head</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="n">body</span><span class="o">&gt;</span>
    <span class="p">{{</span> <span class="n">name</span> <span class="p">}}</span>
  
    <span class="o">&lt;</span><span class="n">br</span><span class="o">&gt;</span>
    <span class="n">title</span> <span class="p">:</span> <span class="p">{{</span> <span class="n">name</span> <span class="o">|</span> <span class="n">title</span> <span class="p">}}</span>
  
    <span class="o">&lt;</span><span class="n">br</span><span class="o">&gt;</span>
    <span class="n">age</span> <span class="p">:</span> <span class="p">{{</span> <span class="n">age</span> <span class="o">|</span> <span class="n">jinja2_01</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="p">}}</span>
  
    <span class="o">&lt;</span><span class="n">br</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">div</span> <span class="n">class</span><span class="o">=</span><span class="s2">&#34;container&#34;</span><span class="o">&gt;</span>
    <span class="o">&lt;/</span><span class="n">div</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">body</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">html</span><span class="o">&gt;</span>
</code></pre></td></tr></table>
</div>
</div></li>
</ul>
<hr>
<h2 id="13小项目之敏感词过滤">13.小项目之敏感词过滤</h2>
<ul>
<li>
<p>在项目子应用下创建枚举类,并为枚举类每个元素设置两个属性<code>label</code>和<code>color</code></p>
<p><code>const.py</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">enum</span> <span class="kn">import</span> <span class="n">Enum</span>
  
  
<span class="k">class</span> <span class="nc">MessageType</span><span class="p">(</span><span class="n">Enum</span><span class="p">):</span>
    <span class="n">info</span> <span class="o">=</span> <span class="s1">&#39;info&#39;</span>
    <span class="n">warning</span> <span class="o">=</span> <span class="s1">&#39;warning&#39;</span>
    <span class="n">error</span> <span class="o">=</span> <span class="s1">&#39;error&#39;</span>
    <span class="n">danger</span> <span class="o">=</span> <span class="s1">&#39;danger&#39;</span>
  
  
<span class="n">MessageType</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;信息&#39;</span>
<span class="n">MessageType</span><span class="o">.</span><span class="n">warning</span><span class="o">.</span><span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;警告&#39;</span>
<span class="n">MessageType</span><span class="o">.</span><span class="n">error</span><span class="o">.</span><span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;错误&#39;</span>
<span class="n">MessageType</span><span class="o">.</span><span class="n">danger</span><span class="o">.</span><span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;危险&#39;</span>
  
<span class="n">MessageType</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;blue&#39;</span>
<span class="n">MessageType</span><span class="o">.</span><span class="n">warning</span><span class="o">.</span><span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;yellow&#39;</span>
<span class="n">MessageType</span><span class="o">.</span><span class="n">error</span><span class="o">.</span><span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;orange&#39;</span>
<span class="n">MessageType</span><span class="o">.</span><span class="n">danger</span><span class="o">.</span><span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;red&#39;</span>
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>配置子路由</p>
<p><code>urls.py</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">django.urls</span> <span class="kn">import</span> <span class="n">path</span>
<span class="kn">from</span> <span class="nn">.views</span> <span class="kn">import</span> <span class="n">Message</span>
  
<span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;message/&lt;str:message_type&gt;&#39;</span><span class="p">,</span> <span class="n">Message</span><span class="o">.</span><span class="n">as_view</span><span class="p">())</span>
<span class="p">]</span>	
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>编写视图文件</p>
<p><code>views.py</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">django.shortcuts</span> <span class="kn">import</span> <span class="n">render</span>
<span class="kn">from</span> <span class="nn">django.views.generic</span> <span class="kn">import</span> <span class="n">View</span>
<span class="kn">from</span> <span class="nn">.const</span> <span class="kn">import</span> <span class="n">MessageType</span>
  
  
<span class="c1"># Create your views here.</span>
<span class="k">class</span> <span class="nc">Message</span><span class="p">(</span><span class="n">View</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">message_type</span><span class="p">):</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">{}</span>
  
        <span class="c1"># 子路由传递的参数,是信息类型,也就是label</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">message_type_obj</span> <span class="o">=</span> <span class="n">MessageType</span><span class="p">[</span><span class="n">message_type</span><span class="p">]</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">data</span><span class="p">[</span><span class="s1">&#39;error&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;没有这个消息类型&#39;</span>
  
        <span class="c1"># 键值对形式接收信息值</span>
        <span class="n">message</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">GET</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="c1"># 空值处理</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">message</span><span class="p">:</span>
            <span class="n">data</span><span class="p">[</span><span class="s1">&#39;error&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;消息不能为空&#39;</span>
            <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">&#39;message.html&#39;</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
  
        <span class="c1"># 给data对象赋值,内容为信息类型,信息内容</span>
        <span class="n">data</span><span class="p">[</span><span class="s1">&#39;message&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">message</span>
        <span class="n">data</span><span class="p">[</span><span class="s1">&#39;message_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">message_type_obj</span>
          
        <span class="c1"># 返回给前端</span>
        <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">&#39;message.html&#39;</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>在templates下创建<code>message.html</code></p>
<p><code>message.html</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html"><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="p">&lt;</span><span class="nt">html</span> <span class="na">lang</span><span class="o">=</span><span class="s">&#34;en&#34;</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">charset</span><span class="o">=</span><span class="s">&#34;UTF-8&#34;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>message<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
    {% if error %}
        <span class="p">&lt;</span><span class="nt">h3</span><span class="p">&gt;</span>error : {{ error }}<span class="p">&lt;/</span><span class="nt">h3</span><span class="p">&gt;</span>
    {% else %}
        <span class="p">&lt;</span><span class="nt">p</span> <span class="na">style</span><span class="o">=</span><span class="s">&#34;color:{{ message_type.color }}&#34;</span><span class="p">&gt;</span>{{ message }}<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
    {% endif %}
<span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>访问</p>
<blockquote>
<p><code>http://localhost:8080/message/info?message=信息</code></p>
<p><code>http://localhost:8080/message/warning?message=警告</code></p>
<p><code>http://localhost:8080/message/error?message=错误</code></p>
<p><code>http://localhost:8080/message/danger?message=危险</code></p>
</blockquote>
</li>
<li>
<p>使用jieba进行敏感词过滤</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">pip3 install jieba
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>清除掉上面所有的过滤器,以及settings.py中的设置</p>
</li>
<li>
<p>在<code>const.py</code>中添加敏感词数组</p>
<p><code>const.py</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">enum</span> <span class="kn">import</span> <span class="n">Enum</span>
  
  
<span class="k">class</span> <span class="nc">MessageType</span><span class="p">(</span><span class="n">Enum</span><span class="p">):</span>
    <span class="n">info</span> <span class="o">=</span> <span class="s1">&#39;info&#39;</span>
    <span class="n">warning</span> <span class="o">=</span> <span class="s1">&#39;warning&#39;</span>
    <span class="n">error</span> <span class="o">=</span> <span class="s1">&#39;error&#39;</span>
    <span class="n">danger</span> <span class="o">=</span> <span class="s1">&#39;danger&#39;</span>
  
  
<span class="n">MessageType</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;信息&#39;</span>
<span class="n">MessageType</span><span class="o">.</span><span class="n">warning</span><span class="o">.</span><span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;警告&#39;</span>
<span class="n">MessageType</span><span class="o">.</span><span class="n">error</span><span class="o">.</span><span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;错误&#39;</span>
<span class="n">MessageType</span><span class="o">.</span><span class="n">danger</span><span class="o">.</span><span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;危险&#39;</span>
  
<span class="n">MessageType</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;blue&#39;</span>
<span class="n">MessageType</span><span class="o">.</span><span class="n">warning</span><span class="o">.</span><span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;yellow&#39;</span>
<span class="n">MessageType</span><span class="o">.</span><span class="n">error</span><span class="o">.</span><span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;orange&#39;</span>
<span class="n">MessageType</span><span class="o">.</span><span class="n">danger</span><span class="o">.</span><span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;red&#39;</span>
  
<span class="n">SensitiveWord</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;色情&#39;</span><span class="p">,</span> <span class="s1">&#39;毒品&#39;</span><span class="p">,</span> <span class="s1">&#39;赌博&#39;</span><span class="p">,</span> <span class="s1">&#39;黄色&#39;</span><span class="p">,</span> <span class="s1">&#39;赌&#39;</span><span class="p">,</span> <span class="s1">&#39;毒&#39;</span><span class="p">,</span> <span class="s1">&#39;枪&#39;</span><span class="p">]</span>
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>在<code>项目子应用</code>下创建<code>templatetags</code>的<code>python包</code></p>
</li>
<li>
<p>在templatetags下创建<code>myfilter.py</code>,编写过滤器</p>
<p><code>myfilter.py</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">django</span> <span class="kn">import</span> <span class="n">template</span>
<span class="kn">import</span> <span class="nn">jieba</span>
<span class="kn">from</span> <span class="nn">index.const</span> <span class="kn">import</span> <span class="n">SensitiveWord</span>
  
<span class="n">register</span> <span class="o">=</span> <span class="n">template</span><span class="o">.</span><span class="n">Library</span><span class="p">()</span>
  
  
<span class="nd">@register.filter</span>
<span class="k">def</span> <span class="nf">myfilter</span><span class="p">(</span><span class="n">message</span><span class="p">):</span>
    <span class="n">cut_message</span> <span class="o">=</span> <span class="n">jieba</span><span class="o">.</span><span class="n">lcut</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
  
    <span class="n">check</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">cut_message</span><span class="p">)</span> <span class="o">&amp;</span> <span class="nb">set</span><span class="p">(</span><span class="n">SensitiveWord</span><span class="p">))</span>
  
    <span class="k">if</span> <span class="n">check</span><span class="p">:</span>
        <span class="k">return</span> <span class="s1">&#39;该消息存在敏感信息,已被屏蔽&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">message</span>
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>在<code>message.html</code>中使用过滤器</p>
<p><code>message.html</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="p">{</span><span class="o">%</span> <span class="n">load</span> <span class="n">myfilter</span> <span class="o">%</span><span class="p">}</span>
<span class="o">&lt;</span><span class="err">!</span><span class="n">DOCTYPE</span> <span class="n">html</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="n">html</span> <span class="n">lang</span><span class="o">=</span><span class="s2">&#34;en&#34;</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="n">head</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">meta</span> <span class="n">charset</span><span class="o">=</span><span class="s2">&#34;UTF-8&#34;</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">title</span><span class="o">&gt;</span><span class="n">message</span><span class="o">&lt;/</span><span class="n">title</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">head</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="n">body</span><span class="o">&gt;</span>
    <span class="p">{</span><span class="o">%</span> <span class="k">if</span> <span class="n">error</span> <span class="o">%</span><span class="p">}</span>
        <span class="o">&lt;</span><span class="n">h3</span><span class="o">&gt;</span><span class="n">error</span> <span class="p">:</span> <span class="p">{{</span> <span class="n">error</span> <span class="p">}}</span><span class="o">&lt;/</span><span class="n">h3</span><span class="o">&gt;</span>
    <span class="p">{</span><span class="o">%</span> <span class="k">else</span> <span class="o">%</span><span class="p">}</span>
      <span class="o">&lt;</span><span class="err">!</span><span class="o">--</span> <span class="err">过滤器名是过滤器文件中的方法名</span> <span class="o">--&gt;</span>
        <span class="o">&lt;</span><span class="n">p</span> <span class="n">style</span><span class="o">=</span><span class="s2">&#34;color:{{ message_type.color }}&#34;</span><span class="o">&gt;</span><span class="p">{{</span> <span class="n">message</span><span class="o">|</span><span class="n">myfilter</span> <span class="p">}}</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
    <span class="p">{</span><span class="o">%</span> <span class="n">endif</span> <span class="o">%</span><span class="p">}</span>
<span class="o">&lt;/</span><span class="n">body</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">html</span><span class="o">&gt;</span>
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>敏感词替换</p>
<p><code>myfilter.py</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="nd">@register.filter</span>
<span class="k">def</span> <span class="nf">changeWord</span><span class="p">(</span><span class="n">message</span><span class="p">):</span>
    <span class="n">cut_message</span> <span class="o">=</span> <span class="n">jieba</span><span class="o">.</span><span class="n">lcut</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
    <span class="n">new_message</span> <span class="o">=</span> <span class="p">[]</span>
  
    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">cut_message</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">SensitiveWord</span><span class="p">:</span>
            <span class="n">new_message</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;*&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">new_message</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
  
    <span class="k">if</span> <span class="n">new_message</span><span class="p">:</span>
        <span class="k">return</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">new_message</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div></li>
</ul>
<hr>
<h2 id="14django操作数据库">14.django操作数据库</h2>
<h3 id="mysql">MySQL</h3>
<h4 id="ubuntu安装mysql">Ubuntu安装mysql</h4>
<ul>
<li>
<p>在官网下载社区版</p>
</li>
<li>
<p>找到<code>MySQL APT Repository</code></p>
</li>
<li>
<p>下载deb包</p>
</li>
<li>
<p>在命令行中安装包</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">sudo dpkg -i 安装包名
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>更新软件源</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">sudo apt-get update
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>下载mysql</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">sudo apt-get install mysql-server
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>中途跳出设置密码和再次输入密码</p>
</li>
<li>
<p>设置<code>123456</code></p>
</li>
<li>
<p>下个选项选择<code>Use Strong Password Encryption (RECOMMEND)</code></p>
</li>
<li>
<p>查看mysql状态</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">systemctl status mysql
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>连接mysql</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">mysql -u root -p
</code></pre></td></tr></table>
</div>
</div></li>
</ul>
<h4 id="django中使用mysql">django中使用mysql</h4>
<ul>
<li>
<p>创建一个新项目</p>
</li>
<li>
<p>在settings.py中对<code>DATABASES</code>进行配置</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="n">DATABASES</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;default&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;ENGINE&#39;</span><span class="p">:</span> <span class="s1">&#39;django.db.backends.mysql&#39;</span><span class="p">,</span>
        <span class="s1">&#39;NAME&#39;</span><span class="p">:</span> <span class="s1">&#39;djangoDB&#39;</span><span class="p">,</span>
        <span class="s1">&#39;USER&#39;</span><span class="p">:</span> <span class="s1">&#39;root&#39;</span><span class="p">,</span> 
        <span class="s1">&#39;PASSWORD&#39;</span><span class="p">:</span> <span class="s1">&#39;123456&#39;</span><span class="p">,</span>
        <span class="s1">&#39;HOST&#39;</span><span class="p">:</span> <span class="s1">&#39;localhost&#39;</span><span class="p">,</span>
        <span class="s1">&#39;PORT&#39;</span><span class="p">:</span> <span class="mi">3306</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>在根应用的<code>__init__.py</code>中导入pymysql驱动</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">pymysql</span>
<span class="n">pymysql</span><span class="o">.</span><span class="n">install_as_MySQLdb</span><span class="p">()</span>
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>在子应用的<code>models.py</code>中创建实体类</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>
  
  
<span class="c1"># Create your models here.</span>
<span class="k">class</span> <span class="nc">Test</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
    <span class="n">age</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">IntegerField</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><ul>
<li>这就是一个实体类,每个对象都是数据表中的一条字段</li>
</ul>
</li>
<li>
<p>安装pymysql</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">pip install pymysql
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>pycharm-&gt;Tools-&gt;Run manage.py Task</p>
</li>
<li>
<p>打开一个终端窗口</p>
</li>
<li>
<p>输入</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">makemigrations
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>报错</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">AttributeError: <span class="s1">&#39;str&#39;</span> object has no attribute <span class="s1">&#39;decode&#39;</span>
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>解决方法：把decode改为encode即可</p>
</li>
<li>
<p>就在子应用中的<code>migrations</code>目录下生成了一个<code>0001_initial.py</code>脚本</p>
</li>
<li>
<p>打开脚本</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="c1"># Generated by Django 2.2 on 2022-04-19 02:15</span>
  
<span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">migrations</span><span class="p">,</span> <span class="n">models</span>
  
  
<span class="k">class</span> <span class="nc">Migration</span><span class="p">(</span><span class="n">migrations</span><span class="o">.</span><span class="n">Migration</span><span class="p">):</span>
  
    <span class="n">initial</span> <span class="o">=</span> <span class="bp">True</span>
  
    <span class="n">dependencies</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">]</span>
  
    <span class="n">operations</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">migrations</span><span class="o">.</span><span class="n">CreateModel</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Test&#39;</span><span class="p">,</span>
            <span class="n">fields</span><span class="o">=</span><span class="p">[</span>
                <span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="n">models</span><span class="o">.</span><span class="n">AutoField</span><span class="p">(</span><span class="n">auto_created</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">serialize</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">verbose_name</span><span class="o">=</span><span class="s1">&#39;ID&#39;</span><span class="p">)),</span>
                <span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">20</span><span class="p">)),</span>
                <span class="p">(</span><span class="s1">&#39;age&#39;</span><span class="p">,</span> <span class="n">models</span><span class="o">.</span><span class="n">IntegerField</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mi">0</span><span class="p">)),</span>
            <span class="p">],</span>
        <span class="p">),</span>
    <span class="p">]</span>
</code></pre></td></tr></table>
</div>
</div><ul>
<li>它创建了一个名为<code>Test</code>的数据表(因为子应用中的manage.py中的实体类名为Test)</li>
<li>在数据表下的字段分别是<code>id</code>、<code>name</code>、<code>age</code></li>
</ul>
</li>
<li>
<p>但是数据库中并没有Test表</p>
</li>
<li>
<p>在pycharm-&gt;Tools-&gt;Run manage.py Task的终端中输入</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">migrate
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>数据库中就同步了数据</p>
</li>
<li>
<p>如果想更改数据表的数据,那就直接更改实体类,然后重复前面的操作</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">makemigrations
migrate
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>如果执行这两步,无用</p>
</li>
<li>
<p>使用终端命令,可以快速定位配置错误</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">python manage.py makemigrations <span class="s2">&#34;appName&#34;</span>
python manage.py migrate
</code></pre></td></tr></table>
</div>
</div></li>
</ul>
<hr>
<h5 id="增删改查">增删改查</h5>
<ul>
<li>
<p>配置好mysql设置</p>
</li>
<li>
<p>在子应用的manage.py中创建表</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>
  
<span class="c1"># Create your models here.</span>
<span class="k">class</span> <span class="nc">User</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">username</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">unique</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">max_length</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
    <span class="n">age</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">SmallIntegerField</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">makemigrations
migrate
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>代码</p>
<p><code>views.py</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">django.shortcuts</span> <span class="kn">import</span> <span class="n">HttpResponse</span>
<span class="kn">from</span> <span class="nn">django.views</span> <span class="kn">import</span> <span class="n">View</span>
<span class="kn">from</span> <span class="nn">.models</span> <span class="kn">import</span> <span class="n">User</span>
  
<span class="c1"># Create your views here.</span>
<span class="k">class</span> <span class="nc">UserInfo</span><span class="p">(</span><span class="n">View</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
        <span class="c1"># User.objects.create(username=&#39;zhang&#39;, age=20)</span>
  
        <span class="c1"># user = User(username=&#39;yu&#39;, age=10)</span>
        <span class="c1"># user.save()</span>
  
        <span class="c1"># user = User()</span>
        <span class="c1"># user.username = &#39;li&#39;</span>
        <span class="c1"># user.age = 11</span>
        <span class="c1"># user.save()</span>
  
        <span class="c1"># print(User.objects.get(id=1).username)</span>
        <span class="c1"># print(User.objects.all())</span>
  
        <span class="c1"># print(User.objects.get_or_create(username=&#39;xxx&#39;))</span>
        <span class="c1"># User.objects.filter(id=3).update(username=&#39;hang&#39;)</span>
  
        <span class="c1"># User.objects.get(id=3).delete()</span>
        <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="s1">&#39;HelloDjango!!!&#39;</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div></li>
</ul>
<h5 id="一对一一对多多对多">一对一、一对多、多对多</h5>
<ul>
<li>
<p>configure the mysql environment</p>
</li>
<li>
<p>write scripts</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>
  
  
<span class="c1"># Create your models here.</span>
<span class="k">class</span> <span class="nc">User</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="nb">id</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">IntegerField</span><span class="p">(</span><span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">username</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">unique</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">max_length</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">age</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">SmallIntegerField</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">phone</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">SmallIntegerField</span><span class="p">(</span><span class="n">db_index</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">email</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">EmailField</span><span class="p">(</span><span class="n">blank</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
    <span class="n">info</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">()</span>
    <span class="n">create_time</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">(</span><span class="n">auto_now_add</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>  <span class="c1"># This value is generated once during initialization and cannot be changed</span>
    <span class="n">update_time</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">(</span><span class="n">auto_now</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
  
<span class="c1"># one-on-one</span>
<span class="k">class</span> <span class="nc">Userprofile</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="nb">id</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">IntegerField</span><span class="p">(</span><span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">user</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">OneToOneField</span><span class="p">(</span><span class="n">User</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">SET_NULL</span><span class="p">)</span>
  
<span class="c1"># one-to-many</span>
<span class="k">class</span> <span class="nc">Userlog</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="nb">id</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">IntegerField</span><span class="p">(</span><span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">user</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">User</span><span class="p">,</span> <span class="n">related_name</span><span class="o">=</span><span class="s1">&#39;user_log&#39;</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">SET_NULL</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>  <span class="c1"># related_name is an alias</span>
    <span class="n">content</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">()</span>
    <span class="n">create_time</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">()</span>
  
<span class="c1"># many-to-many</span>
<span class="k">class</span> <span class="nc">Group</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="nb">id</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">IntegerField</span><span class="p">(</span><span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">user</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ManyToManyField</span><span class="p">(</span><span class="n">User</span><span class="p">,</span> <span class="n">related_name</span><span class="o">=</span><span class="s1">&#39;group&#39;</span><span class="p">)</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
    <span class="n">create_time</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">IntegerField</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>One-to-one and one-to-many are ordinary table creation, you can put other ids in your own table. Many-to-many is creating a table between two tables that establish a relationship. In this table put the id of these two tables</p>
</li>
<li>
<p>联合索引</p>
<blockquote>
<p>联合索引又叫复合索引。</p>
<p>对于复合索引:Mysql从左到右的使用索引中的字段，一个查询可以只使用索引中的一部份，但只能是最左侧部分。</p>
<p>例如索引是key index (a,b,c). 可以支持a | a,b| a,b,c 3种组合进行查找，但不支持 b,c进行查找</p>
<p>当最左侧字段是常量引用时，索引就十分有效</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>
  
<span class="c1"># Create your models here.</span>
<span class="k">class</span> <span class="nc">User</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="nb">id</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">IntegerField</span><span class="p">(</span><span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">username</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">unique</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">max_length</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">age</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">SmallIntegerField</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">phone</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">SmallIntegerField</span><span class="p">(</span><span class="n">db_index</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">email</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">EmailField</span><span class="p">(</span><span class="n">blank</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
    <span class="n">info</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">()</span>
    <span class="n">create_time</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">(</span><span class="n">auto_now_add</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>  <span class="c1"># This value is generated once during initialization and cannot be changed</span>
    <span class="n">update_time</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">(</span><span class="n">auto_now</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
  
    <span class="c1"># joint index</span>
    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">index_together</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;username&#39;</span><span class="p">,</span> <span class="s1">&#39;phone&#39;</span><span class="p">]</span>  <span class="c1"># index_together is a hard-coded field</span>
  
<span class="c1"># one-on-one</span>
<span class="k">class</span> <span class="nc">Userprofile</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="nb">id</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">IntegerField</span><span class="p">(</span><span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">user</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">OneToOneField</span><span class="p">(</span><span class="n">User</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">SET_NULL</span><span class="p">)</span>
  
<span class="c1"># one-to-many</span>
<span class="k">class</span> <span class="nc">Userlog</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="nb">id</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">IntegerField</span><span class="p">(</span><span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">user</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">User</span><span class="p">,</span> <span class="n">related_name</span><span class="o">=</span><span class="s1">&#39;user_log&#39;</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">SET_NULL</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>  <span class="c1"># related_name is an alias</span>
    <span class="n">content</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">()</span>
    <span class="n">create_time</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">()</span>
  
<span class="c1"># many-to-many</span>
<span class="k">class</span> <span class="nc">Group</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="nb">id</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">IntegerField</span><span class="p">(</span><span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">user</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ManyToManyField</span><span class="p">(</span><span class="n">User</span><span class="p">,</span> <span class="n">related_name</span><span class="o">=</span><span class="s1">&#39;group&#39;</span><span class="p">)</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
    <span class="n">create_time</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">IntegerField</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div></li>
</ul>
<h3 id="mongodb">MongoDB</h3>
<h4 id="普通方式操作">普通方式操作</h4>
<ul>
<li>
<p>安装第三方库</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="n">pip</span> <span class="n">install</span> <span class="n">pymongo</span>
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>在项目的<code>settings.py</code>中设置</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">pymongo</span> <span class="kn">import</span> <span class="n">MongoClient</span>
<span class="n">MONGOCLIENT</span> <span class="o">=</span> <span class="n">MongoClient</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="s1">&#39;localhost&#39;</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="mi">27017</span><span class="p">)</span> <span class="c1"># 主机ip、端口</span>
  
<span class="c1"># database置为None</span>
<span class="n">DATABASES</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;default&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;ENGINE&#39;</span><span class="p">:</span> <span class="bp">None</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>在项目子应用中创建<code>mongo_models.py</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">django.conf</span> <span class="kn">import</span> <span class="n">settings</span>
  
<span class="n">conn</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">MONGOCLIENT</span><span class="p">[</span><span class="s1">&#39;zhangDB&#39;</span><span class="p">]</span>  <span class="c1"># 连接数据库</span>
  
  
<span class="k">class</span> <span class="nc">User</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="n">db</span> <span class="o">=</span> <span class="n">conn</span><span class="p">[</span><span class="s1">&#39;collection01&#39;</span><span class="p">]</span>  <span class="c1"># 连接数据库下的数据表</span>
  
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">insert</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">insert_one</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>在shell中</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">python3 manage.py shell
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>输入以下代码</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">from app.mongo_models import User
  
<span class="nv">data</span> <span class="o">=</span> <span class="o">{</span><span class="s1">&#39;age&#39;</span>:<span class="s1">&#39;1&#39;</span>,<span class="s1">&#39;name&#39;</span>:<span class="s1">&#39;zhang&#39;</span><span class="o">}</span>
<span class="nv">res</span> <span class="o">=</span> User.insert<span class="o">(</span>**data<span class="o">)</span>
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>查看数据表,发现成功插入</p>
</li>
</ul>
<h4 id="使用mongoengine">使用mongoengine</h4>
<ul>
<li>
<p>下载第三方库</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">pip3 install mongoengine
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>在项目子应用中创建<code>mongo_engine.py</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">mongoengine</span> <span class="kn">import</span> <span class="n">connect</span><span class="p">,</span> <span class="n">Document</span><span class="p">,</span> <span class="n">StringField</span><span class="p">,</span> <span class="n">IntField</span>
  
<span class="n">connect</span><span class="p">(</span><span class="s1">&#39;zhang&#39;</span><span class="p">,</span> <span class="n">host</span><span class="o">=</span><span class="s1">&#39;localhost&#39;</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="mi">27017</span><span class="p">)</span>  <span class="c1"># 数据库名,主机,端口(数据库不存在无所谓,mongodb会自己创建)</span>
  
  
<span class="k">class</span> <span class="nc">Users</span><span class="p">(</span><span class="n">Document</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">StringField</span><span class="p">(</span><span class="n">required</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">max_length</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
    <span class="n">age</span> <span class="o">=</span> <span class="n">IntField</span><span class="p">(</span><span class="n">required</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>写视图,插入数据,插入数据的操作和pymongo一样</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">django.shortcuts</span> <span class="kn">import</span> <span class="n">HttpResponse</span>
<span class="kn">from</span> <span class="nn">django.views.generic</span> <span class="kn">import</span> <span class="n">View</span>
<span class="kn">from</span> <span class="nn">.mongo_engine</span> <span class="kn">import</span> <span class="n">Users</span>
  
  
<span class="k">class</span> <span class="nc">Mongo_User</span><span class="p">(</span><span class="n">View</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
        <span class="n">user</span> <span class="o">=</span> <span class="n">Users</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;zhibo&#39;</span><span class="p">,</span> <span class="n">age</span><span class="o">=</span><span class="s1">&#39;20&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="s1">&#39;my name is {},age is {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">user</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">user</span><span class="o">.</span><span class="n">age</span><span class="p">))</span>
</code></pre></td></tr></table>
</div>
</div></li>
</ul>
<hr>
<h4 id="第三方orm---sqlalchemy">第三方ORM - sqlalchemy</h4>
<ul>
<li>
<p>create a python file called sqlalchemy_test</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">create_engine</span><span class="p">,</span> <span class="n">Column</span><span class="p">,</span> <span class="n">Integer</span><span class="p">,</span> <span class="n">String</span>
<span class="kn">from</span> <span class="nn">sqlalchemy.orm</span> <span class="kn">import</span> <span class="n">sessionmaker</span>  <span class="c1"># CRUD</span>
<span class="kn">from</span> <span class="nn">sqlalchemy.ext.declarative</span> <span class="kn">import</span> <span class="n">declarative_base</span>  <span class="c1"># Libraries for initialization operations</span>
  
<span class="c1"># initialization operation</span>
<span class="n">Base</span> <span class="o">=</span> <span class="n">declarative_base</span><span class="p">()</span>  <span class="c1"># This instance maintains the relationship from the class to the data table, all entity classes should inherit this object</span>
<span class="n">engine</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span><span class="s1">&#39;mysql+pymysql://root:123456@localhost:3306/sqlalchemy_test&#39;</span><span class="p">)</span>  <span class="c1"># Returns an engine instance, the engine instance does not actually connect to the database until the database event is actually triggered</span>
<span class="n">db_session</span> <span class="o">=</span> <span class="n">sessionmaker</span><span class="p">(</span><span class="n">engine</span><span class="p">)()</span>  <span class="c1"># Sessionmaker creates a factory class. When creating this class, the configuration parameter binds the engine and assigns it to the Session, so that every time the Session is instantiated, a Session bound to the engine will be created. In this way, the Session will be used when accessing the database. Obtain connection resources through the bound engine</span>
  
  
<span class="c1"># init function</span>
<span class="k">def</span> <span class="nf">init</span><span class="p">():</span>
    <span class="n">Base</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">create_all</span><span class="p">(</span><span class="n">engine</span><span class="p">)</span> <span class="c1"># Base.metadata returns the sqlalchemy.schema.MetaData object, which is a collection of all Table objects. Calling create_all() on this object will trigger the CREATE TABLE statement, if these tables do not already exist in the database.</span>
  
  
<span class="k">def</span> <span class="nf">drop</span><span class="p">():</span>
    <span class="n">Base</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">drop_all</span><span class="p">()</span>
  
  
<span class="k">class</span> <span class="nc">User</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s1">&#39;user&#39;</span>  <span class="c1"># The entity class that inherits Base uses the __tablename__ attribute to define the data table name</span>
  
    <span class="nb">id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">autoincrement</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">String</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span>
  
  
<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">init</span><span class="p">()</span>
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>This file is used to initialize the database environment, such as connecting to the database, creating data table entity classes, etc.</p>
</li>
<li>
<p>Create a file for manipulating the data table</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">sqlalchemy_test</span> <span class="kn">import</span> <span class="n">User</span>
<span class="kn">from</span> <span class="nn">sqlalchemy_test</span> <span class="kn">import</span> <span class="n">db_session</span>
  
<span class="c1"># user = User(name=&#39;zhang&#39;)</span>
<span class="c1">#</span>
<span class="c1"># # insert value</span>
<span class="c1"># db_session.add(user)</span>
<span class="c1"># db_session.commit()</span>
<span class="c1"># db_session.close()</span>
  
<span class="c1"># get value</span>
<span class="n">users</span> <span class="o">=</span> <span class="n">db_session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">User</span><span class="p">)</span><span class="o">.</span><span class="n">filter_by</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;zhang&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">one</span><span class="p">()</span>  <span class="c1"># Get the name of the data table in the User entity class, and operate on this data table (filter out a field with name=zhang)</span>
<span class="k">print</span><span class="p">(</span><span class="n">users</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div></li>
</ul>
<hr>
<h2 id="15django中的form表单">15.django中的form表单</h2>
<h3 id="自定义">自定义</h3>
<ul>
<li>
<p>基础配置搞好</p>
</li>
<li>
<p>子路由,name用于在html页面中,找到这里的路由</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">django.urls</span> <span class="kn">import</span> <span class="n">path</span>
<span class="kn">from</span> <span class="nn">app.views</span> <span class="kn">import</span> <span class="n">Register</span>
  
<span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">Register</span><span class="o">.</span><span class="n">as_view</span><span class="p">(),</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;register&#39;</span><span class="p">)</span>  <span class="c1"># name为namespace</span>
<span class="p">]</span>
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>view视图</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">django.shortcuts</span> <span class="kn">import</span> <span class="n">HttpResponse</span><span class="p">,</span> <span class="n">render</span>
<span class="kn">from</span> <span class="nn">django.views.generic</span> <span class="kn">import</span> <span class="n">View</span>
  
  
<span class="k">class</span> <span class="nc">Register</span><span class="p">(</span><span class="n">View</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">&#39;register.html&#39;</span><span class="p">)</span>
  
    <span class="k">def</span> <span class="nf">post</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
        <span class="n">username</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;username&#39;</span><span class="p">)</span>
        <span class="n">password</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;password&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="s1">&#39;username:{},password:{}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="p">))</span>
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>register.html</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html">{% load myfilter %}
<span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="p">&lt;</span><span class="nt">html</span> <span class="na">lang</span><span class="o">=</span><span class="s">&#34;en&#34;</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">charset</span><span class="o">=</span><span class="s">&#34;UTF-8&#34;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>主页<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">form</span> <span class="na">action</span><span class="o">=</span><span class="s">&#34;{% url &#39;register&#39; %}&#34;</span> <span class="na">method</span><span class="o">=</span><span class="s">&#34;post&#34;</span><span class="p">&gt;</span>
        {% csrf_token %}
        <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;text&#34;</span> <span class="na">name</span><span class="o">=</span><span class="s">&#34;username&#34;</span> <span class="na">placeholder</span><span class="o">=</span><span class="s">&#34;username&#34;</span> <span class="p">/&gt;&lt;</span><span class="nt">br</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;text&#34;</span> <span class="na">name</span><span class="o">=</span><span class="s">&#34;password&#34;</span> <span class="na">placeholder</span><span class="o">=</span><span class="s">&#34;password&#34;</span> <span class="p">/&gt;&lt;</span><span class="nt">br</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;submit&#34;</span> <span class="na">value</span><span class="o">=</span><span class="s">&#34;register&#34;</span> <span class="p">/&gt;&lt;</span><span class="nt">br</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>结果就是,当提交post请求后</p>
</li>
<li>
<p>因为action中的url后面是register,它就会到子路由中找<code>name为register</code>的路由</p>
</li>
<li>
<p>子路由会去找view视图,并对view视图中的post方法发起post请求</p>
</li>
</ul>
<hr>
<h3 id="使用django自带的form表单验证">使用django自带的form表单验证</h3>
<ul>
<li>
<p>在子应用中创建<code>form.py</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">django</span> <span class="kn">import</span> <span class="n">forms</span>
<span class="kn">from</span> <span class="nn">django.forms</span> <span class="kn">import</span> <span class="n">fields</span>
  
  
<span class="k">class</span> <span class="nc">Auth</span><span class="p">(</span><span class="n">forms</span><span class="o">.</span><span class="n">Form</span><span class="p">):</span>  <span class="c1"># 继承django的form表单</span>
    <span class="n">username</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>  <span class="c1"># 最大长度,必填字段</span>
    <span class="n">password</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">widget</span><span class="o">=</span><span class="n">forms</span><span class="o">.</span><span class="n">PasswordInput</span><span class="p">)</span>  <span class="c1"># 密码暗文</span>
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>在views.py中编写get和post方法</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">django.shortcuts</span> <span class="kn">import</span> <span class="n">HttpResponse</span><span class="p">,</span> <span class="n">render</span>
<span class="kn">from</span> <span class="nn">django.views.generic</span> <span class="kn">import</span> <span class="n">View</span>
<span class="kn">from</span> <span class="nn">.forms</span> <span class="kn">import</span> <span class="n">Auth</span>
  
  
<span class="k">class</span> <span class="nc">Register</span><span class="p">(</span><span class="n">View</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">Auth</span><span class="p">()</span>   <span class="c1"># 实例化Form</span>
        <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">&#39;register.html&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;form&#39;</span><span class="p">:</span> <span class="n">form</span><span class="p">})</span>  <span class="c1"># 将实例化的form传给前端页面</span>
  
    <span class="k">def</span> <span class="nf">post</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">Auth</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">)</span>  <span class="c1"># 实例化一个POST请求的Form实例,用于处理当前方法的POST请求</span>
        <span class="k">if</span> <span class="n">form</span><span class="o">.</span><span class="n">is_valid</span><span class="p">():</span>  <span class="c1"># 判断当前form表单的post请求中,请求参数等信息是否正确(对请求进行验证)</span>
            <span class="n">username</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">cleaned_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;username&#39;</span><span class="p">)</span>  <span class="c1"># 通过输入框name属性值作为key,获取前端输入的信息</span>
            <span class="n">password</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">cleaned_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;password&#39;</span><span class="p">)</span>
        <span class="c1"># username = request.POST.get(&#39;username&#39;)</span>
        <span class="c1"># password = request.POST.get(&#39;password&#39;)</span>
            <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="s1">&#39;username:{},password:{}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="s1">&#39;ERROR&#39;</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>register.html</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html">{% load myfilter %}
<span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="p">&lt;</span><span class="nt">html</span> <span class="na">lang</span><span class="o">=</span><span class="s">&#34;en&#34;</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">charset</span><span class="o">=</span><span class="s">&#34;UTF-8&#34;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>主页<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">form</span> <span class="na">action</span><span class="o">=</span><span class="s">&#34;{% url &#39;register&#39; %}&#34;</span> <span class="na">method</span><span class="o">=</span><span class="s">&#34;post&#34;</span><span class="p">&gt;</span>
        {% csrf_token %}
        {{ form.as_table }}   {# 使用后端get方法传递过来的form实例,调用它的as_table方法,就能使用django自带的form表单了 #}
{#        <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;text&#34;</span> <span class="na">name</span><span class="o">=</span><span class="s">&#34;username&#34;</span> <span class="na">placeholder</span><span class="o">=</span><span class="s">&#34;username&#34;</span> <span class="p">/&gt;&lt;</span><span class="nt">br</span><span class="p">&gt;</span>#}
{#        <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;text&#34;</span> <span class="na">name</span><span class="o">=</span><span class="s">&#34;password&#34;</span> <span class="na">placeholder</span><span class="o">=</span><span class="s">&#34;password&#34;</span> <span class="p">/&gt;&lt;</span><span class="nt">br</span><span class="p">&gt;</span>#}
        <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;submit&#34;</span> <span class="na">value</span><span class="o">=</span><span class="s">&#34;register&#34;</span> <span class="p">/&gt;&lt;</span><span class="nt">br</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
  
</code></pre></td></tr></table>
</div>
</div></li>
</ul>
<h3 id="表单的错误处理">表单的错误处理</h3>
<ul>
<li>
<p>forms.py</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">django</span> <span class="kn">import</span> <span class="n">forms</span>
<span class="kn">from</span> <span class="nn">django.forms</span> <span class="kn">import</span> <span class="n">fields</span>
  
  
<span class="k">class</span> <span class="nc">Auth</span><span class="p">(</span><span class="n">forms</span><span class="o">.</span><span class="n">Form</span><span class="p">):</span>
    <span class="n">username</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span>
        <span class="n">max_length</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
        <span class="n">min_length</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
        <span class="n">label</span><span class="o">=</span><span class="s1">&#39;用户名&#39;</span>
    <span class="p">)</span>
    <span class="n">password</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span>
        <span class="n">widget</span><span class="o">=</span><span class="n">forms</span><span class="o">.</span><span class="n">PasswordInput</span><span class="p">,</span>
        <span class="n">label</span><span class="o">=</span><span class="s1">&#39;密码&#39;</span><span class="p">,</span>
        <span class="n">min_length</span><span class="o">=</span><span class="mi">4</span>
    <span class="p">)</span>
  
    <span class="k">def</span> <span class="nf">clean</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>  <span class="c1"># django.form的全局过滤方法,无论怎么操作只要提交表单,只要写了这个方法,就会自动调用</span>
        <span class="n">username</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cleaned_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;username&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>  <span class="c1"># 在全局过滤和单独过滤中,每个变量只能被get一次,所以通常username和password就写两个单独过滤就够了</span>
        <span class="n">password</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cleaned_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;password&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>  <span class="c1"># 添加第二个参数为空字符串,给变量设置个默认值.如果后台没拿到前台数据,则会报错;添加这个默认值,如果没拿到前端数据,就会将这个默认值赋值给变量</span>
  
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">password</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">5</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">forms</span><span class="o">.</span><span class="n">ValidationError</span><span class="p">(</span><span class="s1">&#39;密码不能超过5个字符&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">username</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">5</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">forms</span><span class="o">.</span><span class="n">ValidationError</span><span class="p">(</span><span class="s1">&#39;用户名不能超过5个字符&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">clean_username</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>  <span class="c1"># 单独过滤</span>
        <span class="k">pass</span>
    <span class="k">def</span> <span class="nf">clean_password</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>  <span class="c1"># 单独过滤</span>
        <span class="k">pass</span>
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>views.py</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">django.shortcuts</span> <span class="kn">import</span> <span class="n">HttpResponse</span><span class="p">,</span> <span class="n">render</span>
<span class="kn">from</span> <span class="nn">django.views.generic</span> <span class="kn">import</span> <span class="n">View</span>
<span class="kn">from</span> <span class="nn">.forms</span> <span class="kn">import</span> <span class="n">Auth</span>
  
  
<span class="k">class</span> <span class="nc">Register</span><span class="p">(</span><span class="n">View</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">Auth</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">&#39;register.html&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;form&#39;</span><span class="p">:</span> <span class="n">form</span><span class="p">})</span>
  
    <span class="k">def</span> <span class="nf">post</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">Auth</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">form</span><span class="o">.</span><span class="n">is_valid</span><span class="p">():</span>  <span class="c1"># 成功</span>
            <span class="n">username</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">cleaned_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;username&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
            <span class="n">password</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">cleaned_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;password&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="s1">&#39;username is {}, password is {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="p">))</span>  
        <span class="k">else</span><span class="p">:</span>  <span class="c1"># 失败</span>
            <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">&#39;register.html&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;form&#39;</span><span class="p">:</span> <span class="n">form</span><span class="p">})</span>  <span class="c1"># 重新渲染视图</span>
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>前端代码</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html">{% load myfilter %}
<span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="p">&lt;</span><span class="nt">html</span> <span class="na">lang</span><span class="o">=</span><span class="s">&#34;en&#34;</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">charset</span><span class="o">=</span><span class="s">&#34;UTF-8&#34;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>主页<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">form</span> <span class="na">action</span><span class="o">=</span><span class="s">&#34;{% url &#39;register&#39; %}&#34;</span> <span class="na">method</span><span class="o">=</span><span class="s">&#34;post&#34;</span><span class="p">&gt;</span>
        {% csrf_token %}
        {% for item in form %}  {# 遍历form #}
            <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
                {# 显示标签(输入框组件等名称) #}
                <span class="p">&lt;</span><span class="nt">label</span> <span class="na">for</span><span class="o">=</span><span class="s">&#34;{{ item.id_for_label }}&#34;</span><span class="p">&gt;</span>{{ item.label }}<span class="p">&lt;/</span><span class="nt">label</span><span class="p">&gt;</span>
                {{ item }} {# 输入框 #}
            <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
          {# 提交表单后,经过后端过滤器(django.form)处理后,返回的错误信息 #}
            <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>{{ item.errors.as_text }}<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
        {% endfor %}
            <span class="p">&lt;</span><span class="nt">span</span><span class="p">&gt;</span>{{ form.non_field_errors }}<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
{#        {{ form.as_p }}#}
{#        {{ form.as_table }}#}
{#        <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;text&#34;</span> <span class="na">name</span><span class="o">=</span><span class="s">&#34;username&#34;</span> <span class="na">placeholder</span><span class="o">=</span><span class="s">&#34;username&#34;</span> <span class="p">/&gt;&lt;</span><span class="nt">br</span><span class="p">&gt;</span>#}
{#        <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;text&#34;</span> <span class="na">name</span><span class="o">=</span><span class="s">&#34;password&#34;</span> <span class="na">placeholder</span><span class="o">=</span><span class="s">&#34;password&#34;</span> <span class="p">/&gt;&lt;</span><span class="nt">br</span><span class="p">&gt;</span>#}
        <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;submit&#34;</span> <span class="na">value</span><span class="o">=</span><span class="s">&#34;register&#34;</span> <span class="p">/&gt;&lt;</span><span class="nt">br</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</code></pre></td></tr></table>
</div>
</div></li>
</ul>
<h3 id="模型表单">模型表单</h3>
<ul>
<li>
<p>与普通的 django-form 不同，模型表单可以在定义表单的同时执行数据库操作。</p>
</li>
<li>
<p>配置数据库环境</p>
</li>
<li>
<p>在子应用的 models.py 中创建数据表对象</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>
  
  
<span class="c1"># Create your models here.</span>
<span class="k">class</span> <span class="nc">Auth</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">username</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>
    <span class="n">password</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>创建 forms.py 文件</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">django</span> <span class="kn">import</span> <span class="n">forms</span>
<span class="kn">from</span> <span class="nn">.models</span> <span class="kn">import</span> <span class="n">Auth</span>
  
  
<span class="k">class</span> <span class="nc">AuthModelForm</span><span class="p">(</span><span class="n">forms</span><span class="o">.</span><span class="n">ModelForm</span><span class="p">):</span>
    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="c1"># binding model</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">Auth</span>
  
        <span class="c1"># render the model fields we want to display</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;username&#39;</span><span class="p">,</span> <span class="s1">&#39;password&#39;</span><span class="p">]</span>
        <span class="c1"># fields = &#39;__all__&#39;</span>
        <span class="c1"># define fields that you don&#39;t want to render</span>
        <span class="n">exclude</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span>
  
        <span class="c1"># define field type</span>
        <span class="n">field_classes</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;username&#39;</span><span class="p">:</span> <span class="n">forms</span><span class="o">.</span><span class="n">CharField</span><span class="p">,</span>
            <span class="s1">&#39;password&#39;</span><span class="p">:</span> <span class="n">forms</span><span class="o">.</span><span class="n">CharField</span>
        <span class="p">}</span>
  
        <span class="c1"># Set the chinese name of the label</span>
        <span class="n">labels</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;username&#39;</span><span class="p">:</span> <span class="s1">&#39;用户名&#39;</span><span class="p">,</span>
            <span class="s1">&#39;password&#39;</span><span class="p">:</span> <span class="s1">&#39;密码&#39;</span>
        <span class="p">}</span>
  
        <span class="c1"># Set the characters displayed in the form input box</span>
        <span class="n">widgets</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;username&#39;</span><span class="p">:</span> <span class="n">forms</span><span class="o">.</span><span class="n">TextInput</span><span class="p">(</span>
                <span class="n">attrs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;placeholder&#39;</span><span class="p">:</span> <span class="s1">&#39;请输入用户名&#39;</span><span class="p">}</span>
            <span class="p">),</span>
            <span class="s1">&#39;password&#39;</span><span class="p">:</span> <span class="n">forms</span><span class="o">.</span><span class="n">PasswordInput</span><span class="p">(</span>
                <span class="n">attrs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;placeholder&#39;</span><span class="p">:</span> <span class="s1">&#39;请输入密码&#39;</span><span class="p">}</span>
            <span class="p">)</span>
        <span class="p">}</span>
  
        <span class="c1"># error messages</span>
        <span class="n">error_messages</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;username&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;required&#39;</span><span class="p">:</span> <span class="s1">&#39;用户名不可为空&#39;</span><span class="p">},</span>
            <span class="s1">&#39;password&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;required&#39;</span><span class="p">:</span> <span class="s1">&#39;密码不可为空&#39;</span><span class="p">}</span>
        <span class="p">}</span>
  
    <span class="c1"># single filter</span>
    <span class="k">def</span> <span class="nf">clean_username</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">username</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cleaned_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;username&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>  <span class="c1"># prevents an error when entering an empty string</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">username</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">10</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">forms</span><span class="o">.</span><span class="n">ValidationError</span><span class="p">(</span><span class="s1">&#39;用户名最大不可超过10个字符&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">username</span>
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>编写视图文件</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">django.shortcuts</span> <span class="kn">import</span> <span class="n">render</span><span class="p">,</span> <span class="n">HttpResponse</span>
<span class="kn">from</span> <span class="nn">django.views</span> <span class="kn">import</span> <span class="n">View</span>
<span class="kn">from</span> <span class="nn">.models</span> <span class="kn">import</span> <span class="n">Auth</span>
<span class="kn">from</span> <span class="nn">.forms</span> <span class="kn">import</span> <span class="n">AuthModelForm</span>
  
  
<span class="k">class</span> <span class="nc">Register</span><span class="p">(</span><span class="n">View</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
        <span class="n">user</span> <span class="o">=</span> <span class="n">Auth</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>  <span class="c1"># query the data with id equal to 1 in the data table</span>
        <span class="k">if</span> <span class="n">user</span><span class="p">:</span>
            <span class="n">form</span> <span class="o">=</span> <span class="n">AuthModelForm</span><span class="p">(</span><span class="n">instance</span><span class="o">=</span><span class="n">user</span><span class="p">)</span>  <span class="c1"># instantiate the form object , fill in(填写) the query results into the input box</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">form</span> <span class="o">=</span> <span class="n">AuthModelForm</span><span class="p">()</span>  <span class="c1"># empty value in input box</span>
  
        <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">&#39;index.html&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;form&#39;</span><span class="p">:</span> <span class="n">form</span><span class="p">})</span>
  
    <span class="k">def</span> <span class="nf">post</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">AuthModelForm</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">form</span><span class="o">.</span><span class="n">is_valid</span><span class="p">():</span>
            <span class="n">username</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">cleaned_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;username&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
            <span class="n">password</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">cleaned_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;password&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
            <span class="n">form</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="s1">&#39;username is {}, password is {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">&#39;index.html&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;form&#39;</span><span class="p">:</span> <span class="n">form</span><span class="p">})</span>
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>html页面</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="o">&lt;</span><span class="err">!</span><span class="n">DOCTYPE</span> <span class="n">html</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="n">html</span> <span class="n">lang</span><span class="o">=</span><span class="s2">&#34;en&#34;</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="n">head</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">meta</span> <span class="n">charset</span><span class="o">=</span><span class="s2">&#34;UTF-8&#34;</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">title</span><span class="o">&gt;</span><span class="err">主页</span><span class="o">&lt;/</span><span class="n">title</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">head</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="n">body</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">form</span> <span class="n">action</span><span class="o">=</span><span class="s2">&#34;{</span><span class="si">% u</span><span class="s2">rl &#39;register&#39; %}&#34;</span> <span class="n">method</span><span class="o">=</span><span class="s2">&#34;post&#34;</span><span class="o">&gt;</span>
        <span class="p">{</span><span class="o">%</span> <span class="n">csrf_token</span> <span class="o">%</span><span class="p">}</span>
        <span class="p">{</span><span class="o">%</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">form</span> <span class="o">%</span><span class="p">}</span>  <span class="p">{</span><span class="c1"># 遍历form #}</span>
            <span class="o">&lt;</span><span class="n">div</span><span class="o">&gt;</span>
                <span class="p">{</span><span class="c1"># 显示标签(输入框组件等名称) #}</span>
                <span class="o">&lt;</span><span class="n">label</span> <span class="k">for</span><span class="o">=</span><span class="s2">&#34;{{ item.id_for_label }}&#34;</span><span class="o">&gt;</span><span class="p">{{</span> <span class="n">item</span><span class="o">.</span><span class="n">label</span> <span class="p">}}</span><span class="o">&lt;/</span><span class="n">label</span><span class="o">&gt;</span>
                <span class="p">{{</span> <span class="n">item</span> <span class="p">}}</span> <span class="p">{</span><span class="c1"># 输入框 #}</span>
            <span class="o">&lt;/</span><span class="n">div</span><span class="o">&gt;</span>
          <span class="p">{</span><span class="c1"># 提交表单后,经过后端过滤器(django.form)处理后,返回的错误信息 #}</span>
            <span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="p">{{</span> <span class="n">item</span><span class="o">.</span><span class="n">errors</span><span class="o">.</span><span class="n">as_text</span> <span class="p">}}</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
        <span class="p">{</span><span class="o">%</span> <span class="n">endfor</span> <span class="o">%</span><span class="p">}</span>
            <span class="o">&lt;</span><span class="n">span</span><span class="o">&gt;</span><span class="p">{{</span> <span class="n">form</span><span class="o">.</span><span class="n">non_field_errors</span> <span class="p">}}</span><span class="o">&lt;/</span><span class="n">span</span><span class="o">&gt;</span>
<span class="p">{</span><span class="c1">#        {{ form.as_p }}#}</span>
<span class="p">{</span><span class="c1">#        {{ form.as_table }}#}</span>
<span class="p">{</span><span class="c1">#        &lt;input type=&#34;text&#34; name=&#34;username&#34; placeholder=&#34;username&#34; /&gt;&lt;br&gt;#}</span>
<span class="p">{</span><span class="c1">#        &lt;input type=&#34;text&#34; name=&#34;password&#34; placeholder=&#34;password&#34; /&gt;&lt;br&gt;#}</span>
        <span class="o">&lt;</span><span class="nb">input</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&#34;submit&#34;</span> <span class="n">value</span><span class="o">=</span><span class="s2">&#34;register&#34;</span> <span class="o">/&gt;&lt;</span><span class="n">br</span><span class="o">&gt;</span>
    <span class="o">&lt;/</span><span class="n">form</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">body</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">html</span><span class="o">&gt;</span>
</code></pre></td></tr></table>
</div>
</div></li>
</ul>
<hr>
<h2 id="16admin">16.admin</h2>
<h3 id="环境配置">环境配置</h3>
<ul>
<li>
<p>admin是django自带的后台管理系统</p>
</li>
<li>
<p>配置数据库环境</p>
</li>
<li>
<p>根应用程序下的__init__文件</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">pymysql</span>
  
<span class="n">pymysql</span><span class="o">.</span><span class="n">install_as_MySQLdb</span><span class="p">()</span>
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>Tools-&gt;Run manage.py Task</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">migrate
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>运行项目</p>
</li>
<li>
<p><code>localhost:8000/admin</code>可以直接访问</p>
</li>
<li>
<p>访问后会出现登录页面</p>
</li>
<li>
<p>但是还没有账号可以登录</p>
</li>
<li>
<p>刚才的migrate在数据库中创建了一个数据表</p>
</li>
<li>
<p>打开数据表 auth_user</p>
</li>
<li>
<p>它存储超级管理员帐户</p>
</li>
<li>
<p>创建管理员帐户</p>
</li>
<li>
<p>Tools-&gt;Run manage.py Task</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">createsuperuser
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>输入各种信息</p>
</li>
<li>
<p>查看auth_user数据表，发现账户已经添加到数据表中</p>
</li>
<li>
<p>现在，用这个帐户登录</p>
</li>
</ul>
<h3 id="管理系统">管理系统</h3>
<ul>
<li>
<p>为方便起见，请使用 sqlite3</p>
</li>
<li>
<p>设置中文</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="n">LANGUAGE_CODE</span> <span class="o">=</span> <span class="s1">&#39;zh-hans&#39;</span>
  
<span class="n">TIME_ZONE</span> <span class="o">=</span> <span class="s1">&#39;Asia/Shanghai&#39;</span>
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>在子应用下编写models.py并创建实体类</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>
<span class="kn">import</span> <span class="nn">datetime</span>
  
  
<span class="c1"># Create your models here.</span>
<span class="k">class</span> <span class="nc">User</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">username</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">verbose_name</span><span class="o">=</span><span class="s1">&#39;用户名&#39;</span><span class="p">)</span>  <span class="c1"># verbose_name is the tag name</span>
    <span class="n">age</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">SmallIntegerField</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">verbose_name</span><span class="o">=</span><span class="s1">&#39;年龄&#39;</span><span class="p">)</span>
    <span class="n">info</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">(</span><span class="n">verbose_name</span><span class="o">=</span><span class="s1">&#39;个人信息&#39;</span><span class="p">)</span>
    <span class="n">sex</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">choices</span><span class="o">=</span><span class="p">((</span><span class="s1">&#39;Male&#39;</span><span class="p">,</span> <span class="s1">&#39;男&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;Female&#39;</span><span class="p">,</span> <span class="s1">&#39;女&#39;</span><span class="p">)),</span> <span class="n">max_length</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s1">&#39;男&#39;</span><span class="p">,</span>
                           <span class="n">verbose_name</span><span class="o">=</span><span class="s1">&#39;性别&#39;</span><span class="p">)</span>  <span class="c1"># choices is a drop down selector</span>
    <span class="c1"># create_time = models.DateTimeField(auto_now=True)</span>
    <span class="n">create_time</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">,</span> <span class="n">verbose_name</span><span class="o">=</span><span class="s1">&#39;创建时间&#39;</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>同步数据库，创建超级管理员</p>
</li>
<li>
<p>访问 <code>http://localhost:8000/admin</code> 并登录，只有 Group 和 User</p>
</li>
<li>
<p>需要在子应用下编写admin.py来实现数据管理逻辑</p>
<p><code>admin.py</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">django.contrib</span> <span class="kn">import</span> <span class="n">admin</span>
<span class="kn">from</span> <span class="nn">.models</span> <span class="kn">import</span> <span class="n">User</span>
<span class="kn">from</span> <span class="nn">django.utils.html</span> <span class="kn">import</span> <span class="n">format_html</span>
  
  
<span class="c1"># Register your models here.</span>
<span class="nd">@admin.register</span><span class="p">(</span><span class="n">User</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">UserAdmin</span><span class="p">(</span><span class="n">admin</span><span class="o">.</span><span class="n">ModelAdmin</span><span class="p">):</span>
    <span class="k">pass</span>
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>then , you can see a hyperlink(超链接) <code>with the same name as(和...相同)</code> the model class</p>
</li>
<li>
<p>but this hyperlink is in English, how to set its(它的) text(文本) content(内容)</p>
</li>
<li>
<p>declare a subclass in modules.py</p>
<p><code>models.py</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>
<span class="kn">import</span> <span class="nn">datetime</span>
  
<span class="c1"># Create your models here.</span>
<span class="k">class</span> <span class="nc">User</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">username</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">verbose_name</span><span class="o">=</span><span class="s1">&#39;用户名&#39;</span><span class="p">)</span>
    <span class="n">age</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">SmallIntegerField</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">verbose_name</span><span class="o">=</span><span class="s1">&#39;年龄&#39;</span><span class="p">)</span>
    <span class="n">info</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">(</span><span class="n">verbose_name</span><span class="o">=</span><span class="s1">&#39;个人信息&#39;</span><span class="p">)</span>
    <span class="n">sex</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">choices</span><span class="o">=</span><span class="p">((</span><span class="s1">&#39;Male&#39;</span><span class="p">,</span> <span class="s1">&#39;男&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;Female&#39;</span><span class="p">,</span> <span class="s1">&#39;女&#39;</span><span class="p">)),</span> <span class="n">max_length</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s1">&#39;男&#39;</span><span class="p">,</span> <span class="n">verbose_name</span><span class="o">=</span><span class="s1">&#39;性别&#39;</span><span class="p">)</span>
    <span class="n">create_time</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">,</span> <span class="n">verbose_name</span><span class="o">=</span><span class="s1">&#39;创建时间&#39;</span><span class="p">)</span>
  
    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">verbose_name</span> <span class="o">=</span> <span class="s1">&#39;用户表&#39;</span>
        <span class="n">verbose_name_plural</span> <span class="o">=</span> <span class="n">verbose_name</span>
</code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">makemigrations
migrate
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>verbose_name is the text content</p>
</li>
<li>
<p>but after setting, a s will be spliced(拼接) after the hyperlink</p>
</li>
<li>
<p>set <code>verbose_name_plural = verbose_name</code> can solve this problem</p>
</li>
<li>
<p>Finally,set the database style in the admin.py</p>
<p><code>admin.py</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">django.contrib</span> <span class="kn">import</span> <span class="n">admin</span>
<span class="kn">from</span> <span class="nn">.models</span> <span class="kn">import</span> <span class="n">User</span>
<span class="kn">from</span> <span class="nn">django.utils.html</span> <span class="kn">import</span> <span class="n">format_html</span>
  
  
<span class="c1"># Register your models here.</span>
<span class="nd">@admin.register</span><span class="p">(</span><span class="n">User</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">UserAdmin</span><span class="p">(</span><span class="n">admin</span><span class="o">.</span><span class="n">ModelAdmin</span><span class="p">):</span>
    <span class="c1"># display fields</span>
    <span class="n">list_display</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;username&#39;</span><span class="p">,</span> <span class="s1">&#39;age&#39;</span><span class="p">,</span> <span class="s1">&#39;info&#39;</span><span class="p">,</span> <span class="s1">&#39;sex&#39;</span><span class="p">,</span> <span class="s1">&#39;create_time&#39;</span><span class="p">,</span> <span class="s1">&#39;return_href&#39;</span><span class="p">]</span>
  
    <span class="c1"># only read</span>
    <span class="n">readonly_fields</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;create_time&#39;</span><span class="p">]</span>
  
    <span class="c1"># filter</span>
    <span class="n">list_filter</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;sex&#39;</span><span class="p">,)</span>
  
    <span class="c1"># search</span>
    <span class="n">search_fields</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;username&#39;</span><span class="p">,</span> <span class="s1">&#39;info&#39;</span><span class="p">]</span>
  
    <span class="c1"># sort</span>
    <span class="c1"># ordering = [&#39;-id&#39;] # ascending order</span>
    <span class="n">ordering</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span>  <span class="c1"># desending order</span>
  
    <span class="c1"># divide page</span>
    <span class="n">list_per_page</span> <span class="o">=</span> <span class="mi">2</span>
  
    <span class="c1"># get methods to create and update data</span>
    <span class="k">def</span> <span class="nf">save_model</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">form</span><span class="p">,</span> <span class="n">change</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">change</span><span class="p">:</span>
            <span class="n">obj</span><span class="o">.</span><span class="n">info</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">info</span> <span class="o">+</span> <span class="s1">&#39; - update&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">obj</span><span class="o">.</span><span class="n">info</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">info</span> <span class="o">+</span> <span class="s1">&#39; - create&#39;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">UserAdmin</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">save_model</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">form</span><span class="p">,</span> <span class="n">change</span><span class="p">)</span>
  
    <span class="c1"># add custom fields , then add to fields_display</span>
    <span class="k">def</span> <span class="nf">return_href</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">format_html</span><span class="p">(</span><span class="s1">&#39;&lt;a href=&#34;{}&#34;&gt;go&lt;/a&gt;&#39;</span><span class="p">,</span> <span class="s1">&#39;https://www.baidu.com&#39;</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div></li>
</ul>
<hr>
<h3 id="registerlogin-and-logout">register、login and logout</h3>
<ul>
<li>
<p>create new database</p>
</li>
<li>
<p>configure database</p>
</li>
<li>
<p>configure template</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="c1"># 项目静态资源(页面模板)</span>
<span class="n">TEMPLATES</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">{</span>
        <span class="s1">&#39;BACKEND&#39;</span><span class="p">:</span> <span class="s1">&#39;django.template.backends.django.DjangoTemplates&#39;</span><span class="p">,</span>
        <span class="s1">&#39;DIRS&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">BASE_DIR</span><span class="p">,</span> <span class="s1">&#39;templates&#39;</span><span class="p">)],</span>
        <span class="s1">&#39;APP_DIRS&#39;</span><span class="p">:</span> <span class="bp">True</span><span class="p">,</span>
        <span class="s1">&#39;OPTIONS&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;context_processors&#39;</span><span class="p">:</span> <span class="p">[</span>
                <span class="s1">&#39;django.template.context_processors.debug&#39;</span><span class="p">,</span>
                <span class="s1">&#39;django.template.context_processors.request&#39;</span><span class="p">,</span>
                <span class="s1">&#39;django.contrib.auth.context_processors.auth&#39;</span><span class="p">,</span>
                <span class="s1">&#39;django.contrib.messages.context_processors.messages&#39;</span><span class="p">,</span>
            <span class="p">],</span>
        <span class="p">},</span>
    <span class="p">},</span>
<span class="p">]</span>
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>create three pages index.html、login.html and register.html in the template directory(目录)</p>
</li>
<li>
<p>entity classes that <code>come with</code>(自带) django</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">django.shortcuts</span> <span class="kn">import</span> <span class="n">render</span><span class="p">,</span> <span class="n">HttpResponse</span><span class="p">,</span> <span class="n">reverse</span><span class="p">,</span> <span class="n">redirect</span>  <span class="c1"># used for(被用于) page jump</span>
<span class="kn">from</span> <span class="nn">django.views.generic</span> <span class="kn">import</span> <span class="n">View</span>
<span class="kn">from</span> <span class="nn">django.contrib.auth.models</span> <span class="kn">import</span> <span class="n">User</span>  <span class="c1"># entity class that come with django</span>
<span class="kn">from</span> <span class="nn">django.contrib.auth</span> <span class="kn">import</span> <span class="n">login</span><span class="p">,</span> <span class="n">logout</span><span class="p">,</span> <span class="n">authenticate</span>  <span class="c1"># login、logout and authentication</span>
  
  
<span class="c1"># Create your views here.</span>
<span class="k">class</span> <span class="nc">Register</span><span class="p">(</span><span class="n">View</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
        <span class="k">pass</span>
  
    <span class="k">def</span> <span class="nf">post</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
        <span class="k">pass</span>
  
  
<span class="k">class</span> <span class="nc">Login</span><span class="p">(</span><span class="n">View</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
        <span class="k">pass</span>
  
    <span class="k">def</span> <span class="nf">post</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
        <span class="k">pass</span>
  
  
<span class="k">class</span> <span class="nc">Index</span><span class="p">(</span><span class="n">View</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
        <span class="k">pass</span>
  
    <span class="k">def</span> <span class="nf">post</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
        <span class="k">pass</span>
  
  
<span class="k">class</span> <span class="nc">Logout</span><span class="p">(</span><span class="n">View</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
        <span class="k">pass</span>
  
    <span class="k">def</span> <span class="nf">post</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
        <span class="k">pass</span>
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>set up child routes and root routes</p>
<p><code>root routes</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="s2">&#34;&#34;&#34;django_08 URL Configuration
</span><span class="s2">  
</span><span class="s2">The `urlpatterns` list routes URLs to views. For more information please see:
</span><span class="s2">    https://docs.djangoproject.com/en/2.2/topics/http/urls/
</span><span class="s2">Examples:
</span><span class="s2">Function views
</span><span class="s2">    1. Add an import:  from my_app import views
</span><span class="s2">    2. Add a URL to urlpatterns:  path(&#39;&#39;, views.home, name=&#39;home&#39;)
</span><span class="s2">Class-based views
</span><span class="s2">    1. Add an import:  from other_app.views import Home
</span><span class="s2">    2. Add a URL to urlpatterns:  path(&#39;&#39;, Home.as_view(), name=&#39;home&#39;)
</span><span class="s2">Including another URLconf
</span><span class="s2">    1. Import the include() function: from django.urls import include, path
</span><span class="s2">    2. Add a URL to urlpatterns:  path(&#39;blog/&#39;, include(&#39;blog.urls&#39;))
</span><span class="s2">&#34;&#34;&#34;</span>
<span class="kn">from</span> <span class="nn">django.contrib</span> <span class="kn">import</span> <span class="n">admin</span>
<span class="kn">from</span> <span class="nn">django.urls</span> <span class="kn">import</span> <span class="n">path</span><span class="p">,</span> <span class="n">include</span>
  
<span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;admin/&#39;</span><span class="p">,</span> <span class="n">admin</span><span class="o">.</span><span class="n">site</span><span class="o">.</span><span class="n">urls</span><span class="p">),</span>
    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">include</span><span class="p">(</span><span class="s1">&#39;app.urls&#39;</span><span class="p">)),</span>
<span class="p">]</span>
</code></pre></td></tr></table>
</div>
</div><p><code>child routes</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">django.urls</span> <span class="kn">import</span> <span class="n">path</span>
<span class="kn">from</span> <span class="nn">.views</span> <span class="kn">import</span> <span class="n">Register</span><span class="p">,</span> <span class="n">Index</span><span class="p">,</span> <span class="n">Login</span><span class="p">,</span> <span class="n">Logout</span>
  
<span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">Register</span><span class="o">.</span><span class="n">as_view</span><span class="p">(),</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;register&#39;</span><span class="p">),</span>
    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;login/&#39;</span><span class="p">,</span> <span class="n">Login</span><span class="o">.</span><span class="n">as_view</span><span class="p">(),</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;login&#39;</span><span class="p">),</span>
    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;index/&#39;</span><span class="p">,</span> <span class="n">Index</span><span class="o">.</span><span class="n">as_view</span><span class="p">(),</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;index&#39;</span><span class="p">),</span>
    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;logout/&#39;</span><span class="p">,</span> <span class="n">Logout</span><span class="o">.</span><span class="n">as_view</span><span class="p">(),</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;logout&#39;</span><span class="p">),</span>
<span class="p">]</span>
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>synchronize the database</p>
<ul>
<li>
<p>tools-&gt;run manage.py task</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">migrate
</code></pre></td></tr></table>
</div>
</div></li>
</ul>
</li>
<li>
<p>complete logic</p>
<p><code>views.py</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">django.shortcuts</span> <span class="kn">import</span> <span class="n">render</span><span class="p">,</span> <span class="n">HttpResponse</span><span class="p">,</span> <span class="n">reverse</span><span class="p">,</span> <span class="n">redirect</span>  <span class="c1"># used for(被用于) page jump</span>
<span class="kn">from</span> <span class="nn">django.views.generic</span> <span class="kn">import</span> <span class="n">View</span>
<span class="kn">from</span> <span class="nn">django.contrib.auth.models</span> <span class="kn">import</span> <span class="n">User</span>  <span class="c1"># entity class that come with django</span>
<span class="kn">from</span> <span class="nn">django.contrib.auth</span> <span class="kn">import</span> <span class="n">login</span><span class="p">,</span> <span class="n">logout</span><span class="p">,</span> <span class="n">authenticate</span>  <span class="c1"># login、logoutnd authentication</span>
  
  
<span class="c1"># Create your views here.</span>
<span class="k">class</span> <span class="nc">Register</span><span class="p">(</span><span class="n">View</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">is_authenticated</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">reverse</span><span class="p">(</span><span class="s1">&#39;index&#39;</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">&#39;register.html&#39;</span><span class="p">)</span>
  
    <span class="k">def</span> <span class="nf">post</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
        <span class="n">username</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;username&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="n">password</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;password&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="n">check_password</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;check_password&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
  
        <span class="k">if</span> <span class="n">password</span> <span class="o">!=</span> <span class="n">check_password</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="s1">&#39;different passwords twice!!!&#39;</span><span class="p">)</span>
  
        <span class="n">exists</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="n">username</span><span class="p">)</span><span class="o">.</span><span class="n">exists</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">exists</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="s1">&#39;This account is already registered!!!&#39;</span><span class="p">)</span>
        <span class="n">User</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create_user</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="n">password</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">reverse</span><span class="p">(</span><span class="s1">&#39;login&#39;</span><span class="p">))</span>
  
  
<span class="k">class</span> <span class="nc">Login</span><span class="p">(</span><span class="n">View</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">&#39;login.html&#39;</span><span class="p">)</span>
  
    <span class="k">def</span> <span class="nf">post</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
        <span class="n">username</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;username&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="n">password</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;password&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
  
        <span class="n">exists</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="n">username</span><span class="p">)</span><span class="o">.</span><span class="n">exists</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">exists</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="s1">&#39;this account does not exist,please log in again!!!&#39;</span><span class="p">)</span>
        <span class="n">user</span> <span class="o">=</span> <span class="n">authenticate</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="n">password</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">user</span><span class="p">:</span>
            <span class="n">login</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">user</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">reverse</span><span class="p">(</span><span class="s1">&#39;index&#39;</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="s1">&#39;wrong password!!!&#39;</span><span class="p">)</span>
  
  
<span class="k">class</span> <span class="nc">Index</span><span class="p">(</span><span class="n">View</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">&#39;index.html&#39;</span><span class="p">)</span>
  
    <span class="k">def</span> <span class="nf">post</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
        <span class="k">pass</span>
  
  
<span class="k">class</span> <span class="nc">Logout</span><span class="p">(</span><span class="n">View</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
        <span class="n">logout</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">reverse</span><span class="p">(</span><span class="s1">&#39;login&#39;</span><span class="p">))</span>
  
    <span class="k">def</span> <span class="nf">post</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
        <span class="k">pass</span>
</code></pre></td></tr></table>
</div>
</div></li>
</ul>
<hr>
<h1 id="step02构建个人博客">Step02.构建个人博客</h1>
<h2 id="创建数据库和数据表">创建数据库和数据表</h2>
<ul>
<li>
<p>创建两个表,一个是<code>博客类型</code>,一个是<code>每篇博客</code></p>
</li>
<li>
<p>创建一个名为<code>blog</code>的app并在settings.py中注册</p>
</li>
<li>
<p>确保项目能跑起来</p>
</li>
<li>
<p>在根应用的<code>__init__.py</code>中添加</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">pymysql</span>
<span class="n">pymysql</span><span class="o">.</span><span class="n">install_as_MySQLdb</span><span class="p">()</span>
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>在子应用的models.py中,编写两个数据表</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">operator</span> <span class="kn">import</span> <span class="n">mod</span>
<span class="kn">from</span> <span class="nn">pyexpat</span> <span class="kn">import</span> <span class="n">model</span>
<span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>
<span class="kn">from</span> <span class="nn">django.contrib.auth.models</span> <span class="kn">import</span> <span class="n">User</span>
  
  
<span class="k">class</span> <span class="nc">BlogType</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">type_name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
  
  
<span class="c1"># Create your models here.</span>
<span class="k">class</span> <span class="nc">Blog</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">title</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
    <span class="n">blog_type</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">BlogType</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">DO_NOTHING</span><span class="p">)</span>
    <span class="n">content</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">()</span>
    <span class="n">author</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">User</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">DO_NOTHING</span><span class="p">)</span>  <span class="c1"># 外键删除事件,什么都不做  || User是django自带的User对象</span>
    <span class="n">create_time</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">(</span><span class="n">auto_now_add</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>  <span class="c1"># 自动获取当前时间戳 这个类型一旦创建,就不可被更改</span>
    <span class="n">last_updated_time</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">(</span><span class="n">auto_now</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>  <span class="c1"># 自动获取当前时间戳</span>
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>在终端,执行</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">python3 manage.py createsuperuser
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>创建超级管理员</p>
</li>
<li>
<p>然后,将models.py中的数据同步数据库</p>
</li>
<li>
<p><strong>因为在settings.py中,将子应用注册了,所以同步子应用到数据库是可行的</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">python3 manage.py migrate
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>现在访问<code>localhost:8000/admin</code>,登录进入管理员页面,但是看不到这两张表</p>
</li>
<li>
<p>需要在子应用的<code>admin.py</code>中,<strong>将这两个数据表在admin(管理员)中注册</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">django.contrib</span> <span class="kn">import</span> <span class="n">admin</span>
<span class="kn">from</span> <span class="nn">.models</span> <span class="kn">import</span> <span class="n">BlogType</span><span class="p">,</span> <span class="n">Blog</span>
  
<span class="nd">@admin.register</span><span class="p">(</span><span class="n">BlogType</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">BlogTypeAdmin</span><span class="p">(</span><span class="n">admin</span><span class="o">.</span><span class="n">ModelAdmin</span><span class="p">):</span>
    <span class="n">list_display</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;type_name&#39;</span><span class="p">)</span>
  
<span class="nd">@admin.register</span><span class="p">(</span><span class="n">Blog</span><span class="p">)</span>
<span class="c1"># Register your models here.</span>
<span class="k">class</span> <span class="nc">BlogAdmin</span><span class="p">(</span><span class="n">admin</span><span class="o">.</span><span class="n">ModelAdmin</span><span class="p">):</span>
    <span class="n">list_display</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;blog_type&#39;</span><span class="p">,</span> <span class="s1">&#39;title&#39;</span><span class="p">,</span> <span class="s1">&#39;content&#39;</span><span class="p">,</span> <span class="s1">&#39;author&#39;</span><span class="p">,</span> <span class="s1">&#39;create_time&#39;</span><span class="p">,</span> <span class="s1">&#39;last_updated_time&#39;</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p><code>list_display</code>,意思是,当前数据表中哪些字段会被显示出来</p>
</li>
<li>
<p>同步数据库</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">python3 manage.py makemigrations
python3 manage.py migrate
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>再次进入数据库</p>
</li>
<li>
<p>在blog_type表中创建几个类型</p>
</li>
<li>
<p>不然创建博客时,没有类型可选</p>
</li>
<li>
<p>创建完博客类型</p>
</li>
<li>
<p>创建博客</p>
</li>
<li>
<p>发现<code>博客类型下拉组件</code>中,无法看到博客类型的具体内容</p>
</li>
<li>
<p>只能看到blog_type object1、blog_type object2这种</p>
</li>
<li>
<p>需要在models.py,创建数据表模型时,就编写好一个<code>def __str__</code>,用于返回指定字段的内容</p>
<p><code>models.py</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">operator</span> <span class="kn">import</span> <span class="n">mod</span>
<span class="kn">from</span> <span class="nn">pyexpat</span> <span class="kn">import</span> <span class="n">model</span>
<span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>
<span class="kn">from</span> <span class="nn">django.contrib.auth.models</span> <span class="kn">import</span> <span class="n">User</span>
  
  
<span class="k">class</span> <span class="nc">BlogType</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">type_name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
  
    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">type_name</span>
  
  
<span class="c1"># Create your models here.</span>
<span class="k">class</span> <span class="nc">Blog</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">title</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
    <span class="n">blog_type</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">BlogType</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">DO_NOTHING</span><span class="p">)</span>
    <span class="n">content</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">()</span>
    <span class="n">author</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">User</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">DO_NOTHING</span><span class="p">)</span>  <span class="c1"># 外键删除事件,什么都不做  || User是django自带的User对象</span>
    <span class="n">create_time</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">(</span><span class="n">auto_now_add</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>  <span class="c1"># 自动获取当前时间戳 这个类型一旦创建,就不可被更改</span>
    <span class="n">last_updated_time</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">(</span><span class="n">auto_now</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>  <span class="c1"># 自动获取当前时间戳</span>
  
    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&#34;&lt;Blog:</span><span class="si">%s</span><span class="s2">&gt;&#34;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">title</span>
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>这样就解决了</p>
</li>
</ul>
<hr>
<h2 id="博客简单逻辑">博客简单逻辑</h2>
<ul>
<li>
<p>实现三个页面</p>
</li>
<li>
<p>博客列表页、博客详情页、某个类型博客列表页</p>
</li>
<li>
<p>创建三个视图</p>
<p><code>views.py</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">django.shortcuts</span> <span class="kn">import</span> <span class="n">render</span><span class="p">,</span> <span class="n">render_to_response</span>
  
<span class="c1"># 博客列表页</span>
<span class="k">def</span> <span class="nf">blog_list</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="k">pass</span>
  
<span class="c1"># 博客详情页</span>
<span class="k">def</span> <span class="nf">blog_detail</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">blog_pk</span><span class="p">):</span>
    <span class="k">pass</span>
  
<span class="c1"># 指定分类列表页</span>
<span class="k">def</span> <span class="nf">blogs_with_type</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">blog_type_pk</span><span class="p">):</span>
    <span class="k">pass</span>
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>在templates下创建blog目录,作为blog应用的静态页面目录</p>
</li>
<li>
<p>在blog目录下创建<code>blog_list.html(博客列表页)</code>、<code>blog_detail.html(博客详情页)</code>和<code>blog_with_type.html(指定类型博客列表页)</code>三个页面</p>
</li>
<li>
<p>其中</p>
<ul>
<li>博客详情页的参数是博客id,在博客列表页点击某个博客,将这篇博客的id作为参数传递给这个方法,方法中通过id,在博客表中查出这篇博客,并返回给变量</li>
<li>指定分类列表页的参数是,类型id,在博客详情页,点击该博客的分类,将类型对象的id作为参数传递给方法,方法在<code>博客类别表</code>中通过<code>类别id</code>,查询出<code>类别名称</code>,然后在<code>博客表</code>中通过<code>类别名称</code>,查询出所有<code>类型为该类型名称</code>的博客,并封装到对象,携带对象跳转到页面</li>
</ul>
</li>
</ul>
<h3 id="全部代码">全部代码</h3>
<h4 id="静态页面">静态页面</h4>
<p><code>blog_list.html</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html"><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="p">&lt;</span><span class="nt">html</span> <span class="na">lang</span><span class="o">=</span><span class="s">&#34;en&#34;</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">charset</span><span class="o">=</span><span class="s">&#34;UTF-8&#34;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>blog_list<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;{% url &#39;home&#39; %}&#34;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>个人博客网站<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

    <span class="p">&lt;</span><span class="nt">hr</span><span class="p">&gt;</span>

    {% for blog in blogs %}
        <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;{% url &#39;blog_detail&#39; blog.pk %}&#34;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">h3</span><span class="p">&gt;</span>{{blog.title}}<span class="p">&lt;/</span><span class="nt">h3</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>{{blog.content | truncatechars:30}}<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>  <span class="c">&lt;!-- 限制显示字符长度,超出长度部分使用省略号隐藏 --&gt;</span>
    {% empty %}
        <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>暂无博客<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
    {% endfor %}

    <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>一共有{{ blogs | length }}篇博客<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</code></pre></td></tr></table>
</div>
</div><p><code>blog_detail.html</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html"><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="p">&lt;</span><span class="nt">html</span> <span class="na">lang</span><span class="o">=</span><span class="s">&#34;en&#34;</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">charset</span><span class="o">=</span><span class="s">&#34;UTF-8&#34;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>{{ blog.title }}<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;{% url &#39;home&#39; %}&#34;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>个人博客网站<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

    <span class="p">&lt;</span><span class="nt">hr</span><span class="p">&gt;</span>

    <span class="p">&lt;</span><span class="nt">h3</span><span class="p">&gt;</span>标题:{{ blog.title }}<span class="p">&lt;/</span><span class="nt">h3</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>作者:{{ blog.author }}<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>发表日期:{{ blog.create_time | date:&#34;Y-m-d Hⓜs&#34;}}<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>  <span class="c">&lt;!-- 时间过滤器 --&gt;</span>
    <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>分类: <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;{% url &#39;blog_with_type&#39; blog.blog_type.pk %}&#34;</span><span class="p">&gt;</span>{{ blog.blog_type }}<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span> <span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>内容:{{ blog.content }}<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</code></pre></td></tr></table>
</div>
</div><p><code>blog_with_type.html</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html"><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="p">&lt;</span><span class="nt">html</span> <span class="na">lang</span><span class="o">=</span><span class="s">&#34;en&#34;</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">charset</span><span class="o">=</span><span class="s">&#34;UTF-8&#34;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>{{ blog_type.type_name }}<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;{% url &#39;home&#39; %}&#34;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>个人博客网站<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

    <span class="p">&lt;</span><span class="nt">hr</span><span class="p">&gt;</span>

    {% for blog in blogs %}
        <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;{% url &#39;blog_detail&#39; blog.pk %}&#34;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">h3</span><span class="p">&gt;</span>{{blog.title}}<span class="p">&lt;/</span><span class="nt">h3</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>{{blog.content | truncatechars:30}}<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
    {% empty %}
        <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>暂无博客<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
    {% endfor %}

    <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>一共有{{ blogs | length }}篇博客<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</code></pre></td></tr></table>
</div>
</div><h4 id="视图文件">视图文件</h4>
<p><code>views.py</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">django.shortcuts</span> <span class="kn">import</span> <span class="n">render</span><span class="p">,</span> <span class="n">render_to_response</span><span class="p">,</span> <span class="n">get_object_or_404</span> 
<span class="kn">from</span> <span class="nn">.models</span> <span class="kn">import</span> <span class="n">Blog</span><span class="p">,</span> <span class="n">BlogType</span>


<span class="c1"># 博客列表页</span>
<span class="k">def</span> <span class="nf">blog_list</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="n">context</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">context</span><span class="p">[</span><span class="s1">&#39;blogs&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Blog</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
    <span class="c1"># context[&#39;blogs_count&#39;] = Blog.objects.all().count()</span>
    <span class="k">return</span> <span class="n">render_to_response</span><span class="p">(</span><span class="s1">&#39;blog_list.html&#39;</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>


<span class="c1"># 博客详情页</span>
<span class="k">def</span> <span class="nf">blog_detail</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">blog_pk</span><span class="p">):</span>
    <span class="n">context</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">context</span><span class="p">[</span><span class="s1">&#39;blog&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_object_or_404</span><span class="p">(</span><span class="n">Blog</span><span class="p">,</span> <span class="n">pk</span><span class="o">=</span><span class="n">blog_pk</span><span class="p">)</span>  <span class="c1"># get_object_or_404,因为有可能获取不到</span>
    <span class="k">return</span> <span class="n">render_to_response</span><span class="p">(</span><span class="s1">&#39;blog_detail.html&#39;</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>


<span class="c1"># 指定分类列表页</span>
<span class="k">def</span> <span class="nf">blogs_with_type</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">blog_type_pk</span><span class="p">):</span>
    <span class="n">context</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">blog_type</span> <span class="o">=</span> <span class="n">get_object_or_404</span><span class="p">(</span><span class="n">BlogType</span><span class="p">,</span> <span class="n">pk</span><span class="o">=</span><span class="n">blog_type_pk</span><span class="p">)</span>
    <span class="n">context</span><span class="p">[</span><span class="s1">&#39;blogs&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Blog</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">blog_type</span><span class="o">=</span><span class="n">blog_type</span><span class="p">)</span>
    <span class="n">context</span><span class="p">[</span><span class="s1">&#39;blog_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">blog_type</span>
    <span class="k">return</span> <span class="n">render_to_response</span><span class="p">(</span><span class="s1">&#39;blog_with_type.html&#39;</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><h4 id="路由">路由</h4>
<h5 id="根路由">根路由</h5>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">django.contrib</span> <span class="kn">import</span> <span class="n">admin</span>
<span class="kn">from</span> <span class="nn">django.urls</span> <span class="kn">import</span> <span class="n">path</span><span class="p">,</span> <span class="n">include</span>
<span class="kn">from</span> <span class="nn">blog.views</span> <span class="kn">import</span> <span class="n">blog_list</span>

<span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">blog_list</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;home&#39;</span><span class="p">),</span>  <span class="c1"># 博客列表页</span>
    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;admin/&#39;</span><span class="p">,</span> <span class="n">admin</span><span class="o">.</span><span class="n">site</span><span class="o">.</span><span class="n">urls</span><span class="p">),</span>
    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;blog/&#39;</span><span class="p">,</span> <span class="n">include</span><span class="p">(</span><span class="s1">&#39;blog.urls&#39;</span><span class="p">)),</span>  <span class="c1"># 子路由的路由</span>
<span class="p">]</span>
</code></pre></td></tr></table>
</div>
</div><h5 id="子路由">子路由</h5>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">django.urls</span> <span class="kn">import</span> <span class="n">path</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">views</span>

<span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;&lt;int:blog_pk&gt;&#39;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">blog_detail</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;blog_detail&#39;</span><span class="p">),</span>  <span class="c1"># 博客详情页</span>
    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;type/&lt;int:blog_type_pk&gt;&#39;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">blogs_with_type</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;blog_with_type&#39;</span><span class="p">),</span>  <span class="c1"># 指定类型博客列表页</span>
<span class="p">]</span>
</code></pre></td></tr></table>
</div>
</div><hr>
<h2 id="公用html模板">公用html模板</h2>
<ul>
<li>
<p>开发过程中,可能会有很多页面,页面中可能会有相同的代码</p>
</li>
<li>
<p>这样每次切换页面,这些相同部分都被加载一次岂不是浪费资源</p>
</li>
<li>
<p>django给出了一种,将公共部分写在一个页面中</p>
</li>
<li>
<p>然后其他页面,不需要写这些部分,直接将不同的部分插入到指定位置</p>
</li>
<li>
<p>是这样的</p>
</li>
<li>
<p>你写一个公共页面a.html</p>
<p><code>a.html</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html"><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="p">&lt;</span><span class="nt">html</span> <span class="na">lang</span><span class="o">=</span><span class="s">&#34;en&#34;</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">charset</span><span class="o">=</span><span class="s">&#34;UTF-8&#34;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>{% block a %}{% endblock %}<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
    {% block b %}{% endblock %}
<span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>在其他页面中,你就可以</p>
<p><code>b.html</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html">{% extends &#39;a.html&#39; %} <span class="c">&lt;!-- 第一步,继承公共模板页面,这个页面中,除了{% block xxx %},其余的都会被公共模板页面中的内容替换 --&gt;</span>
{% block a % }我是不同的内容,通过block插入到了公共模板页面{% endblock %} <span class="c">&lt;!-- 而block部分,block后面的是这个块的名称 --&gt;</span>
<span class="c">&lt;!-- 这里的作用就是,将这个页面中的{%block a%}中的全部内容,插入到公共模板页面中的{%block a%}中,也就是说,block名称对应上了,就是插入 --&gt;</span>
{% block b %}{% endblock %}
</code></pre></td></tr></table>
</div>
</div></li>
</ul>
<h3 id="全部代码-1">全部代码</h3>
<p><code>base.html</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-django" data-lang="django"><span class="x">&lt;!DOCTYPE html&gt;
</span><span class="x">&lt;html lang=&#34;en&#34;&gt;
</span><span class="x">&lt;head&gt;
</span><span class="x">    &lt;meta charset=&#34;UTF-8&#34;&gt;
</span><span class="x">    &lt;title&gt;</span><span class="cp">{%</span> <span class="k">block</span> <span class="nv">title</span> <span class="cp">%}{%</span> <span class="k">endblock</span> <span class="cp">%}</span><span class="x">&lt;/title&gt;
</span><span class="x">&lt;/head&gt;
</span><span class="x">&lt;body&gt;
</span><span class="x">    &lt;div&gt;
</span><span class="x">        &lt;a href=&#34;</span><span class="cp">{%</span> <span class="k">url</span> <span class="s1">&#39;home&#39;</span> <span class="cp">%}</span><span class="x">&#34;&gt;
</span><span class="x">            &lt;h1&gt;个人博客网站&lt;/h1&gt;
</span><span class="x">        &lt;/a&gt;
</span><span class="x">    &lt;/div&gt;
</span><span class="x">
</span><span class="x">    &lt;hr&gt;
</span><span class="x">
</span><span class="x">    </span><span class="cp">{%</span> <span class="k">block</span> <span class="nv">content</span> <span class="cp">%}{%</span> <span class="k">endblock</span> <span class="cp">%}</span><span class="x">
</span><span class="x">&lt;/body&gt;
</span><span class="x">&lt;/html&gt;
</span></code></pre></td></tr></table>
</div>
</div><p><code>blog_list.html</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html">{% extends &#39;base.html&#39; %}

{% block title %}blog_list{% endblock %}

{% block content %}
    {% for blog in blogs %}
        <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;{% url &#39;blog_detail&#39; blog.pk %}&#34;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">h3</span><span class="p">&gt;</span>{{blog.title}}<span class="p">&lt;/</span><span class="nt">h3</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>{{blog.content | truncatechars:30}}<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
    {% empty %}
        <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>暂无博客<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
    {% endfor %}

    <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>一共有{{ blogs | length }}篇博客<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
{% endblock %}
</code></pre></td></tr></table>
</div>
</div><p><code>blog_detail.html</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html">{% extends &#39;base.html&#39; %}

{% block title %}
    {{ blog.title }}
{% endblock %}

{% block content %}
    <span class="p">&lt;</span><span class="nt">h3</span><span class="p">&gt;</span>标题:{{ blog.title }}<span class="p">&lt;/</span><span class="nt">h3</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>作者:{{ blog.author }}<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>发表日期:{{ blog.create_time | date:&#34;Y-m-d Hⓜs&#34;}}<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>分类: <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;{% url &#39;blog_with_type&#39; blog.blog_type.pk %}&#34;</span><span class="p">&gt;</span>{{ blog.blog_type }}<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span> <span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>内容:{{ blog.content }}<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
{% endblock %}
</code></pre></td></tr></table>
</div>
</div><p><code>blog_with_type.html</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html">{% extends &#39;base.html&#39; %}

{% block title %}{{ blog_type.type_name }}{% endblock %}

{% block content %}
    {% for blog in blogs %}
        <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;{% url &#39;blog_detail&#39; blog.pk %}&#34;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">h3</span><span class="p">&gt;</span>{{blog.title}}<span class="p">&lt;/</span><span class="nt">h3</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>{{blog.content | truncatechars:30}}<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
    {% empty %}
        <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>暂无博客<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
    {% endfor %}

    <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>一共有{{ blogs | length }}篇博客<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
{% endblock %}
</code></pre></td></tr></table>
</div>
</div><hr>
<h2 id="重新布置结构首页列表页的导航栏">重新布置结构,首页、列表页的导航栏</h2>
<ul>
<li>
<p>在项目根应用中,创建一个<code>views.py</code></p>
<p><code>views.py</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">django.shortcuts</span> <span class="kn">import</span> <span class="n">render_to_response</span>
  
  
<span class="k">def</span> <span class="nf">home</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="n">context</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">return</span> <span class="n">render_to_response</span><span class="p">(</span><span class="s1">&#39;home.html&#39;</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>跳转到首页</p>
</li>
<li>
<p>在templates下创建一个home.html</p>
<p><code>home.html</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html">{% extends &#39;base.html&#39; %}
  
{% block title %}
    个人博客网站
{% endblock %}
  
{% block content %}
    <span class="p">&lt;</span><span class="nt">h1</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;home-info&#34;</span><span class="p">&gt;</span>欢迎来到我的博客<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
{% endblock %}
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>根路由中,运行项目默认跳转到<code>home.html</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">django.contrib</span> <span class="kn">import</span> <span class="n">admin</span>
<span class="kn">from</span> <span class="nn">django.urls</span> <span class="kn">import</span> <span class="n">path</span><span class="p">,</span> <span class="n">include</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">views</span>  
  
<span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">home</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;home&#39;</span><span class="p">),</span>  <span class="c1"># 默认是home.html</span>
    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;admin/&#39;</span><span class="p">,</span> <span class="n">admin</span><span class="o">.</span><span class="n">site</span><span class="o">.</span><span class="n">urls</span><span class="p">),</span>
    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;blog/&#39;</span><span class="p">,</span> <span class="n">include</span><span class="p">(</span><span class="s1">&#39;blog.urls&#39;</span><span class="p">)),</span>  <span class="c1"># 子路由</span>
<span class="p">]</span>
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>子路由中</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">django.urls</span> <span class="kn">import</span> <span class="n">path</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">views</span>  <span class="c1"># 自己声明的视图</span>
  
<span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;blog_list/&#39;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">blog_list</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;blog_list&#39;</span><span class="p">),</span>  <span class="c1"># 博客列表路由,restful风格在django中的好处是,a标签可以通过{%url name%}跳转到指定name的路由,至于路由内容是什么随便写</span>
    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;&lt;int:blog_pk&gt;&#39;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">blog_detail</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;blog_detail&#39;</span><span class="p">),</span>  <span class="c1"># 博客详情页</span>
    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;type/&lt;int:blog_type_pk&gt;&#39;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">blogs_with_type</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;blog_with_type&#39;</span><span class="p">),</span>  <span class="c1"># 某类博客列表页</span>
<span class="p">]</span>
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>前面只是更改了一个路由的跳转</p>
</li>
<li>
<p>不是默认进入列表页,而是进入<code>首页</code></p>
</li>
<li>
<p>放一些花里胡哨的东西</p>
</li>
</ul>
<h3 id="全部代码-2">全部代码</h3>
<p><code>根路由/urls.py</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">django.contrib</span> <span class="kn">import</span> <span class="n">admin</span>
<span class="kn">from</span> <span class="nn">django.urls</span> <span class="kn">import</span> <span class="n">path</span><span class="p">,</span> <span class="n">include</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">views</span>

<span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">home</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;home&#39;</span><span class="p">),</span>  <span class="c1"># 默认是home.html</span>
    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;admin/&#39;</span><span class="p">,</span> <span class="n">admin</span><span class="o">.</span><span class="n">site</span><span class="o">.</span><span class="n">urls</span><span class="p">),</span>
    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;blog/&#39;</span><span class="p">,</span> <span class="n">include</span><span class="p">(</span><span class="s1">&#39;blog.urls&#39;</span><span class="p">)),</span>  <span class="c1"># 子路由</span>
<span class="p">]</span>
</code></pre></td></tr></table>
</div>
</div><p><code>子路由/urls.py</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">django.urls</span> <span class="kn">import</span> <span class="n">path</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">views</span>  <span class="c1"># 自己声明的视图</span>

<span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;blog_list/&#39;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">blog_list</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;blog_list&#39;</span><span class="p">),</span>  <span class="c1"># 博客列表路由,restful风格在django中的好处是,a标签可以通过{%url name%}跳转到指定name的路由,至于路由内容是什么随便写</span>
    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;&lt;int:blog_pk&gt;&#39;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">blog_detail</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;blog_detail&#39;</span><span class="p">),</span>  <span class="c1"># 博客详情页</span>
    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;type/&lt;int:blog_type_pk&gt;&#39;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">blogs_with_type</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;blog_with_type&#39;</span><span class="p">),</span>  <span class="c1"># 某类博客列表页</span>
<span class="p">]</span>
</code></pre></td></tr></table>
</div>
</div><p><code>根应用/views.py</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">django.shortcuts</span> <span class="kn">import</span> <span class="n">render_to_response</span>


<span class="k">def</span> <span class="nf">home</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="n">context</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">return</span> <span class="n">render_to_response</span><span class="p">(</span><span class="s1">&#39;home.html&#39;</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><p><code>home.html</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html">{% extends &#39;base.html&#39; %}

{% block title %}
    个人博客网站
{% endblock %}

{% block content %}
    <span class="p">&lt;</span><span class="nt">h1</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;home-info&#34;</span><span class="p">&gt;</span>欢迎来到我的博客<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
{% endblock %}
</code></pre></td></tr></table>
</div>
</div><hr>
<h2 id="使用css美化首页">使用css美化首页</h2>
<ul>
<li>
<p>在settings.py中配置static</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="n">STATIC_URL</span> <span class="o">=</span> <span class="s1">&#39;/static/&#39;</span>
  
<span class="n">STATICFILES_DIRS</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">BASE_DIR</span><span class="p">,</span> <span class="s1">&#39;static&#39;</span><span class="p">),</span>
<span class="p">]</span>
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>在项目根目录创建static目录</p>
</li>
<li>
<p>创建base.css</p>
<p><code>base.css</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-css" data-lang="css"><span class="nt">body</span><span class="p">{</span>
     <span class="k">margin</span><span class="p">:</span> <span class="mi">0</span><span class="p">;</span>
     <span class="k">padding</span><span class="p">:</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
<span class="nt">div</span><span class="p">.</span><span class="nc">nav</span><span class="p">{</span>
    <span class="k">background-color</span><span class="p">:</span> <span class="mh">#eee</span><span class="p">;</span>
    <span class="k">border-bottom</span><span class="p">:</span> <span class="mi">1</span><span class="kt">px</span> <span class="mh">#ccc</span> <span class="kc">solid</span><span class="p">;</span>
<span class="p">}</span>
<span class="nt">div</span><span class="p">.</span><span class="nc">nav</span> <span class="nt">a</span><span class="p">{</span>
    <span class="k">display</span><span class="p">:</span><span class="kc">inline</span><span class="o">-</span><span class="kc">block</span><span class="p">;</span>
    <span class="k">text-decoration</span><span class="p">:</span> <span class="kc">none</span><span class="p">;</span>
    <span class="k">color</span><span class="p">:</span> <span class="mh">#000</span><span class="p">;</span>
    <span class="k">padding</span><span class="p">:</span> <span class="mi">5</span><span class="kt">px</span> <span class="mi">10</span><span class="kt">px</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>首页<code>home.html</code>的破标题也需要美化一下</p>
</li>
<li>
<p>中间的大标题居中</p>
</li>
<li>
<p>在static下创建home.css</p>
<p><code>home.css</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-css" data-lang="css"><span class="p">.</span><span class="nc">home-info</span><span class="p">{</span>
    <span class="k">position</span><span class="p">:</span> <span class="kc">absolute</span><span class="p">;</span>
    <span class="k">top</span><span class="p">:</span> <span class="mi">50</span><span class="kt">%</span><span class="p">;</span>
    <span class="k">left</span><span class="p">:</span> <span class="mi">50</span><span class="kt">%</span><span class="p">;</span>
    <span class="k">transform</span><span class="p">:</span> <span class="nb">translate</span><span class="p">(</span><span class="mi">-50</span><span class="kt">%</span><span class="p">,</span><span class="mi">-50</span><span class="kt">%</span><span class="p">);</span>
  
    <span class="k">font-size</span><span class="p">:</span> <span class="mi">50</span><span class="kt">px</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div></li>
</ul>
<hr>
<h2 id="使用bootstrap进行页面布局">使用bootstrap进行页面布局</h2>
<ul>
<li>
<p>打开<a href="https://www.bootcss.com/">bootstrap官网</a></p>
</li>
<li>
<p>下载bootstrap官网</p>
</li>
<li>
<p>将下载的压缩包解压,复制到项目static目录下</p>
</li>
<li>
<p>删除css下的theme</p>
</li>
<li>
<p>删除js下的npm</p>
</li>
<li>
<p>在base.html公共模板导入bootstrap.css和js</p>
<p><code>base.html</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html">{% load staticfiles %}
<span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="p">&lt;</span><span class="nt">html</span> <span class="na">lang</span><span class="o">=</span><span class="s">&#34;en&#34;</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">charset</span><span class="o">=</span><span class="s">&#34;utf-8&#34;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">http-equiv</span><span class="o">=</span><span class="s">&#34;X-UA-Compatible&#34;</span> <span class="na">content</span><span class="o">=</span><span class="s">&#34;IE=edge&#34;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">name</span><span class="o">=</span><span class="s">&#34;viewport&#34;</span> <span class="na">content</span><span class="o">=</span><span class="s">&#34;width=device-width, initial-scale=1&#34;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">link</span> <span class="na">rel</span><span class="o">=</span><span class="s">&#34;stylesheet&#34;</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;{% static &#39;base.css&#39; %}&#34;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">link</span> <span class="na">rel</span><span class="o">=</span><span class="s">&#34;stylesheet&#34;</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;{% static &#39;home.css&#39; %}&#34;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">link</span> <span class="na">rel</span><span class="o">=</span><span class="s">&#34;stylesheet&#34;</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;{% static &#39;bootstrap-3.4.1-dist/css/bootstrap.min.css&#39; %}&#34;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>{% block title %}{% endblock %}<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;nav&#34;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">a</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;logo&#34;</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;{% url &#39;home&#39; %}&#34;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>个人博客网站<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
  
        <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;{% url &#39;home&#39; %}&#34;</span><span class="p">&gt;</span>首页<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;{% url &#39;blog_list&#39; %}&#34;</span><span class="p">&gt;</span>博客<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
  
    {% block content %}{% endblock %}
  
    <span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&#34;{% static &#39;bootstrap-3.4.1-dist/js/bootstrap.min.js&#39; %}&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>打开官网,找到一个<code>固定的导航栏</code></p>
</li>
<li>
<p>找一个案例</p>
</li>
<li>
<p>里面要导入jquery.js</p>
</li>
<li>
<p>而且bootstrap.js需要jquery.js</p>
</li>
<li>
<p>所以在bootstrap.js<strong>上面</strong>导入jquery.js</p>
<p><code>base.html</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html">{% load staticfiles %}
<span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="p">&lt;</span><span class="nt">html</span> <span class="na">lang</span><span class="o">=</span><span class="s">&#34;en&#34;</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">charset</span><span class="o">=</span><span class="s">&#34;utf-8&#34;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">http-equiv</span><span class="o">=</span><span class="s">&#34;X-UA-Compatible&#34;</span> <span class="na">content</span><span class="o">=</span><span class="s">&#34;IE=edge&#34;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">name</span><span class="o">=</span><span class="s">&#34;viewport&#34;</span> <span class="na">content</span><span class="o">=</span><span class="s">&#34;width=device-width, initial-scale=1&#34;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">link</span> <span class="na">rel</span><span class="o">=</span><span class="s">&#34;stylesheet&#34;</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;{% static &#39;base.css&#39; %}&#34;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">link</span> <span class="na">rel</span><span class="o">=</span><span class="s">&#34;stylesheet&#34;</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;{% static &#39;home.css&#39; %}&#34;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">link</span> <span class="na">rel</span><span class="o">=</span><span class="s">&#34;stylesheet&#34;</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;{% static &#39;bootstrap-3.4.1-dist/css/bootstrap.min.css&#39; %}&#34;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>{% block title %}{% endblock %}<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;nav&#34;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">a</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;logo&#34;</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;{% url &#39;home&#39; %}&#34;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>个人博客网站<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
  
        <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;{% url &#39;home&#39; %}&#34;</span><span class="p">&gt;</span>首页<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;{% url &#39;blog_list&#39; %}&#34;</span><span class="p">&gt;</span>博客<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
  
    {% block content %}{% endblock %}
  
    <span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&#34;{% static &#39;jquery.min.js&#39; %}&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&#34;{% static &#39;bootstrap-3.4.1-dist/js/bootstrap.min.js&#39; %}&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>案例是这样的</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html"><span class="p">&lt;</span><span class="nt">nav</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;navbar navbar-default&#34;</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;container-fluid&#34;</span><span class="p">&gt;</span>
    <span class="c">&lt;!-- Brand and toggle get grouped for better mobile display --&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;navbar-header&#34;</span><span class="p">&gt;</span>
        <span class="c">&lt;!-- 屏幕缩小到手机那么大,将导航部分隐藏,使用一个图标替代,点击图标导航部分以下拉形式显示,span就是图标,data-target就是指定要隐藏的导航部分的id --&gt;</span>
      <span class="p">&lt;</span><span class="nt">button</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;button&#34;</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;navbar-toggle collapsed&#34;</span> <span class="na">data-toggle</span><span class="o">=</span><span class="s">&#34;collapse&#34;</span> <span class="na">data-target</span><span class="o">=</span><span class="s">&#34;#bs-example-navbar-collapse-1&#34;</span> <span class="na">aria-expanded</span><span class="o">=</span><span class="s">&#34;false&#34;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;icon-bar&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;icon-bar&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;icon-bar&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
      <span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
      <span class="c">&lt;!-- 导航栏Logo --&gt;</span>
      <span class="p">&lt;</span><span class="nt">a</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;navbar-brand&#34;</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;#&#34;</span><span class="p">&gt;</span>Brand<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
  
  <span class="c">&lt;!-- 导航部分 --&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;collapse navbar-collapse&#34;</span> <span class="na">id</span><span class="o">=</span><span class="s">&#34;bs-example-navbar-collapse-1&#34;</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">ul</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;nav navbar-nav&#34;</span><span class="p">&gt;</span>
        <span class="c">&lt;!-- active,哪个导航组件active,哪个就高亮 --&gt;</span>
        <span class="p">&lt;</span><span class="nt">li</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;active&#34;</span><span class="p">&gt;&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;#&#34;</span><span class="p">&gt;</span>Link <span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;sr-only&#34;</span><span class="p">&gt;</span>(current)<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;&lt;/</span><span class="nt">a</span><span class="p">&gt;&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;#&#34;</span><span class="p">&gt;</span>Link<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">li</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;dropdown&#34;</span><span class="p">&gt;</span>
          <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;#&#34;</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;dropdown-toggle&#34;</span> <span class="na">data-toggle</span><span class="o">=</span><span class="s">&#34;dropdown&#34;</span> <span class="na">role</span><span class="o">=</span><span class="s">&#34;button&#34;</span> <span class="na">aria-haspopup</span><span class="o">=</span><span class="s">&#34;true&#34;</span> <span class="na">aria-expanded</span><span class="o">=</span><span class="s">&#34;false&#34;</span><span class="p">&gt;</span>Dropdown <span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;caret&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">span</span><span class="p">&gt;&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
          <span class="p">&lt;</span><span class="nt">ul</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;dropdown-menu&#34;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;#&#34;</span><span class="p">&gt;</span>Action<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;#&#34;</span><span class="p">&gt;</span>Another action<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;#&#34;</span><span class="p">&gt;</span>Something else here<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">li</span> <span class="na">role</span><span class="o">=</span><span class="s">&#34;separator&#34;</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;divider&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;#&#34;</span><span class="p">&gt;</span>Separated link<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">li</span> <span class="na">role</span><span class="o">=</span><span class="s">&#34;separator&#34;</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;divider&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;#&#34;</span><span class="p">&gt;</span>One more separated link<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
          <span class="p">&lt;/</span><span class="nt">ul</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
      <span class="p">&lt;/</span><span class="nt">ul</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span><span class="c">&lt;!-- /.navbar-collapse --&gt;</span>
  <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span><span class="c">&lt;!-- /.container-fluid --&gt;</span>
<span class="p">&lt;/</span><span class="nt">nav</span><span class="p">&gt;</span>
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>将我的base.html改成这种格式</p>
</li>
<li>
<p>然后在不同页面的block中,向导航部分的li,通过不同的block,插入各自的active</p>
</li>
<li>
<p>比如,blog_list.html中是,<code>{% block nav_blog_active %}{% endblock %}</code></p>
</li>
<li>
<p>home.html是<code>{% block nav_blog_active %}{% endblock %}</code></p>
</li>
</ul>
<h3 id="全部代码-3">全部代码</h3>
<p><code>base.html</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html">{% load staticfiles %}
<span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="p">&lt;</span><span class="nt">html</span> <span class="na">lang</span><span class="o">=</span><span class="s">&#34;en&#34;</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">charset</span><span class="o">=</span><span class="s">&#34;utf-8&#34;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">http-equiv</span><span class="o">=</span><span class="s">&#34;X-UA-Compatible&#34;</span> <span class="na">content</span><span class="o">=</span><span class="s">&#34;IE=edge&#34;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">name</span><span class="o">=</span><span class="s">&#34;viewport&#34;</span> <span class="na">content</span><span class="o">=</span><span class="s">&#34;width=device-width, initial-scale=1&#34;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">link</span> <span class="na">rel</span><span class="o">=</span><span class="s">&#34;stylesheet&#34;</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;{% static &#39;base.css&#39; %}&#34;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">link</span> <span class="na">rel</span><span class="o">=</span><span class="s">&#34;stylesheet&#34;</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;{% static &#39;home.css&#39; %}&#34;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">link</span> <span class="na">rel</span><span class="o">=</span><span class="s">&#34;stylesheet&#34;</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;{% static &#39;bootstrap-3.4.1-dist/css/bootstrap.min.css&#39; %}&#34;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>{% block title %}{% endblock %}<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;navbar navbar-default navbar-fixed-top&#34;</span> <span class="na">role</span><span class="o">=</span><span class="s">&#34;navigation&#34;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;container-fluid&#34;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;navbar-header&#34;</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">button</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;button&#34;</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;navbar-toggle collapsed&#34;</span> <span class="na">data-toggle</span><span class="o">=</span><span class="s">&#34;collapse&#34;</span> <span class="na">data-target</span><span class="o">=</span><span class="s">&#34;#bs-example-navbar-collapse-1&#34;</span> <span class="na">aria-expanded</span><span class="o">=</span><span class="s">&#34;false&#34;</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;icon-bar&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;icon-bar&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;icon-bar&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
                <span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">a</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;navbar-brand logo&#34;</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;{% url &#39;home&#39; %}&#34;</span><span class="p">&gt;</span>
                    个人博客网站
                <span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

            <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;collapse navbar-collapse&#34;</span> <span class="na">id</span><span class="o">=</span><span class="s">&#34;bs-example-navbar-collapse-1&#34;</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">ul</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;nav navbar-nav&#34;</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">li</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;{% block nav_home_active %}{% endblock %}&#34;</span><span class="p">&gt;&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;{% url &#39;home&#39; %}&#34;</span><span class="p">&gt;</span>首页<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">li</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;{% block nav_blog_active %}{% endblock %}&#34;</span><span class="p">&gt;&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;{% url &#39;blog_list&#39; %}&#34;</span><span class="p">&gt;</span>博客<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
                <span class="p">&lt;/</span><span class="nt">ul</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

    {% block content %}{% endblock %}

    <span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&#34;{% static &#39;jquery.min.js&#39; %}&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&#34;{% static &#39;bootstrap-3.4.1-dist/js/bootstrap.min.js&#39; %}&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</code></pre></td></tr></table>
</div>
</div><p><code>base.css</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-css" data-lang="css"><span class="o">*</span><span class="p">{</span>
     <span class="k">margin</span><span class="p">:</span> <span class="mi">0</span><span class="p">;</span>
     <span class="k">padding</span><span class="p">:</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="nt">body</span><span class="p">{</span>
     <span class="k">margin-top</span><span class="p">:</span> <span class="mi">80</span><span class="kt">px</span> <span class="cp">!important</span><span class="p">;</span>
<span class="p">}</span>

<span class="p">.</span><span class="nc">logo</span><span class="p">{</span>
     <span class="k">font-size</span><span class="p">:</span> <span class="mi">25</span><span class="kt">px</span> <span class="cp">!important</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p><code>blog_list.html</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html">{% extends &#39;base.html&#39; %}

{% block title %}blog_list{% endblock %}

{% block nav_blog_active %}active{% endblock %}

{% block content %}
    {% for blog in blogs %}
        <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;{% url &#39;blog_detail&#39; blog.pk %}&#34;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">h3</span><span class="p">&gt;</span>{{blog.title}}<span class="p">&lt;/</span><span class="nt">h3</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>{{blog.content | truncatechars:30}}<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
    {% empty %}
        <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>暂无博客<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
    {% endfor %}

    <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>一共有{{ blogs | length }}篇博客<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
{% endblock %}
</code></pre></td></tr></table>
</div>
</div><p><code>home.html</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-django" data-lang="django"><span class="cp">{%</span> <span class="k">extends</span> <span class="s1">&#39;base.html&#39;</span> <span class="cp">%}</span><span class="x">
</span><span class="x">
</span><span class="x"></span><span class="cp">{%</span> <span class="k">block</span> <span class="nv">title</span> <span class="cp">%}</span><span class="x">
</span><span class="x">    个人博客网站
</span><span class="x"></span><span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span><span class="x">
</span><span class="x">
</span><span class="x"></span><span class="cp">{%</span> <span class="k">block</span> <span class="nv">nav_home_active</span> <span class="cp">%}</span><span class="x">active</span><span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span><span class="x">
</span><span class="x">
</span><span class="x"></span><span class="cp">{%</span> <span class="k">block</span> <span class="nv">content</span> <span class="cp">%}</span><span class="x">
</span><span class="x">    &lt;h1 class=&#34;home-info&#34;&gt;欢迎来到我的博客&lt;/h1&gt;
</span><span class="x"></span><span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span><span class="x">
</span></code></pre></td></tr></table>
</div>
</div><hr>
<h2 id="使用bootstrap美化页面--响应式布局">使用bootstrap美化页面 + 响应式布局</h2>
<ul>
<li>
<p>首页已经美化过了</p>
</li>
<li>
<p>现在就剩下博客列表页、指定类型博客列表页以及博客详情页</p>
</li>
<li>
<p>主要思路就是</p>
<ul>
<li>
<p>1.bootstrap的<code>栅格系统</code>,可以将页面分成多少行多少列,具体读文档</p>
<blockquote>
<p>一行2列,左边那列(博客列表)占8格,右边(博客分类)占4格,正好12列</p>
</blockquote>
</li>
<li>
<p>博客列表、博客分类等,上面需要一个灰色的带有大标题的长条做牌子,这个是bootstrap的<code>面板</code></p>
</li>
</ul>
</li>
</ul>
<h3 id="全部代码-4">全部代码</h3>
<h4 id="博客列表页">博客列表页</h4>
<p><code>blog_list.html</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html">{% extends &#39;base.html&#39; %}

{% block title %}blog_list{% endblock %}

{% block nav_blog_active %}active{% endblock %}

{% block content %}
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;container&#34;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;row&#34;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;col-sm-8 col-lg-8&#34;</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;panel panel-default&#34;</span><span class="p">&gt;</span>
                  <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;panel-heading&#34;</span><span class="p">&gt;</span>一共有{{ blogs | length }}篇博客<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
                      <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;panel-body&#34;</span><span class="p">&gt;</span>
                        {% for blog in blogs %}
                            <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;blog&#34;</span><span class="p">&gt;</span>
                                <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;{% url &#39;blog_detail&#39; blog.pk %}&#34;</span><span class="p">&gt;</span>
                                    <span class="p">&lt;</span><span class="nt">h3</span><span class="p">&gt;</span>{{blog.title}}<span class="p">&lt;/</span><span class="nt">h3</span><span class="p">&gt;</span>
                                    <span class="p">&lt;</span><span class="nt">p</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;blog_info&#34;</span><span class="p">&gt;</span>
                                        <span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;glyphicon glyphicon-star&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
                                        <span class="p">&lt;</span><span class="nt">span</span><span class="p">&gt;</span>
                                            分类: <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;{% url &#39;blog_with_type&#39; blog.blog_type.pk %}&#34;</span><span class="p">&gt;</span>{{ blog.blog_type }}<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
                                        <span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
                                        <span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;glyphicon glyphicon-time&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
                                        <span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;blog_list_li_date&#34;</span><span class="p">&gt;</span>
                                            发表日期:{{ blog.create_time | date:&#34;Y-m-d&#34;}}
                                        <span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
                                    <span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
                                <span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
                                <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>{{blog.content | truncatechars:30}}<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
                            <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
                        {% empty %}
                            <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>暂无博客<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
                        {% endfor %}
                      <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
                <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;col-sm-4 col-lg-4&#34;</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;panel panel-default&#34;</span><span class="p">&gt;</span>
                   <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;panel-heading&#34;</span><span class="p">&gt;</span>博客分类<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
                       <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;panel-body&#34;</span><span class="p">&gt;</span>
                           <span class="p">&lt;</span><span class="nt">ul</span><span class="p">&gt;</span>
                               {% for blog_type in blog_types %}
                                   <span class="p">&lt;</span><span class="nt">li</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;blog_list_li&#34;</span><span class="p">&gt;&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;{% url &#39;blog_with_type&#39; blog_type.pk %}&#34;</span><span class="p">&gt;</span>{{ blog_type.type_name }}<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
                               {% empty %}
                                   <span class="p">&lt;</span><span class="nt">li</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;blog_list_li&#34;</span><span class="p">&gt;</span>暂无分类<span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
                               {% endfor %}
                           <span class="p">&lt;/</span><span class="nt">ul</span><span class="p">&gt;</span>
                       <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
                <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
{% endblock %}
</code></pre></td></tr></table>
</div>
</div><p><code>blog_list.css</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-css" data-lang="css"><span class="p">.</span><span class="nc">blog_list_li</span><span class="p">{</span>
    <span class="k">list-style-type</span><span class="p">:</span> <span class="kc">none</span> <span class="cp">!important</span><span class="p">;</span>
<span class="p">}</span>

<span class="p">.</span><span class="nc">blog</span><span class="p">:</span><span class="nd">not</span><span class="o">(</span><span class="p">:</span><span class="nd">last-child</span><span class="o">)</span><span class="p">{</span>
    <span class="k">margin-top</span><span class="p">:</span> <span class="mi">20</span><span class="kt">px</span> <span class="cp">!important</span><span class="p">;</span>
    <span class="k">border-bottom</span><span class="p">:</span> <span class="mi">1</span><span class="kt">px</span> <span class="kc">solid</span> <span class="mh">#eee</span><span class="p">;</span>
<span class="p">}</span>

<span class="p">.</span><span class="nc">blog_info</span> <span class="nt">span</span><span class="p">{</span>
    <span class="k">color</span><span class="p">:</span> <span class="mh">#9a9797</span> <span class="cp">!important</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><h4 id="指定类型博客列表页">指定类型博客列表页</h4>
<ul>
<li>和博客列表页完全一样</li>
<li>在views.py中多加一个<code>全部类型数据</code>,传递到html就行了</li>
</ul>
<p><code>blog_with_type.html</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html">{% extends &#39;base.html&#39; %}

{% block title %}{{ blog_type.type_name }}{% endblock %}

{% block content %}
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;container&#34;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;row&#34;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;col-sm-8 col-lg-8&#34;</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;panel panel-default&#34;</span><span class="p">&gt;</span>
                  <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;panel-heading&#34;</span><span class="p">&gt;</span>一共有{{ blogs | length }}篇博客<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
                      <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;panel-body&#34;</span><span class="p">&gt;</span>
                        {% for blog in blogs %}
                            <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;blog&#34;</span><span class="p">&gt;</span>
                                <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;{% url &#39;blog_detail&#39; blog.pk %}&#34;</span><span class="p">&gt;</span>
                                    <span class="p">&lt;</span><span class="nt">h3</span><span class="p">&gt;</span>{{blog.title}}<span class="p">&lt;/</span><span class="nt">h3</span><span class="p">&gt;</span>
                                    <span class="p">&lt;</span><span class="nt">p</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;blog_info&#34;</span><span class="p">&gt;</span>
                                        <span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;glyphicon glyphicon-star&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
                                        <span class="p">&lt;</span><span class="nt">span</span><span class="p">&gt;</span>
                                            分类: <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;{% url &#39;blog_with_type&#39; blog.blog_type.pk %}&#34;</span><span class="p">&gt;</span>{{ blog.blog_type }}<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
                                        <span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
                                        <span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;glyphicon glyphicon-time&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
                                        <span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;blog_list_li_date&#34;</span><span class="p">&gt;</span>
                                            发表日期:{{ blog.create_time | date:&#34;Y-m-d&#34;}}
                                        <span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
                                    <span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
                                <span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
                                <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>{{blog.content | truncatechars:30}}<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
                            <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
                        {% empty %}
                            <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>暂无博客<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
                        {% endfor %}
                      <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
                <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;col-sm-4 col-lg-4&#34;</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;panel panel-default&#34;</span><span class="p">&gt;</span>
                   <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;panel-heading&#34;</span><span class="p">&gt;</span>博客分类<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
                       <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;panel-body&#34;</span><span class="p">&gt;</span>
                           <span class="p">&lt;</span><span class="nt">ul</span><span class="p">&gt;</span>
                               {% for blog_type in blog_types %}
                                   <span class="p">&lt;</span><span class="nt">li</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;blog_list_li&#34;</span><span class="p">&gt;&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;{% url &#39;blog_with_type&#39; blog_type.pk %}&#34;</span><span class="p">&gt;</span>{{ blog_type.type_name }}<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
                               {% empty %}
                                   <span class="p">&lt;</span><span class="nt">li</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;blog_list_li&#34;</span><span class="p">&gt;</span>暂无分类<span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
                               {% endfor %}
                           <span class="p">&lt;/</span><span class="nt">ul</span><span class="p">&gt;</span>
                       <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
                <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
{% endblock %}
</code></pre></td></tr></table>
</div>
</div><p><code>views.py</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">django.shortcuts</span> <span class="kn">import</span> <span class="n">render</span><span class="p">,</span> <span class="n">render_to_response</span><span class="p">,</span> <span class="n">get_object_or_404</span> 
<span class="kn">from</span> <span class="nn">.models</span> <span class="kn">import</span> <span class="n">Blog</span><span class="p">,</span> <span class="n">BlogType</span>


<span class="c1"># 博客列表页</span>
<span class="k">def</span> <span class="nf">blog_list</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="n">context</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">context</span><span class="p">[</span><span class="s1">&#39;blogs&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Blog</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
    <span class="c1"># context[&#39;blogs_count&#39;] = Blog.objects.all().count()</span>
    <span class="n">context</span><span class="p">[</span><span class="s1">&#39;blog_types&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">BlogType</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>  <span class="c1"># 博客列表页面,右侧,博客分类数据</span>
    <span class="k">return</span> <span class="n">render_to_response</span><span class="p">(</span><span class="s1">&#39;blog/blog_list.html&#39;</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>


<span class="c1"># 博客详情页</span>
<span class="k">def</span> <span class="nf">blog_detail</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">blog_pk</span><span class="p">):</span>
    <span class="n">context</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">context</span><span class="p">[</span><span class="s1">&#39;blog&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_object_or_404</span><span class="p">(</span><span class="n">Blog</span><span class="p">,</span> <span class="n">pk</span><span class="o">=</span><span class="n">blog_pk</span><span class="p">)</span>  <span class="c1"># get_object_or_404,因为有可能获取不到</span>
    <span class="k">return</span> <span class="n">render_to_response</span><span class="p">(</span><span class="s1">&#39;blog/blog_detail.html&#39;</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>


<span class="c1"># 指定分类列表页</span>
<span class="k">def</span> <span class="nf">blogs_with_type</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">blog_type_pk</span><span class="p">):</span>
    <span class="n">context</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">blog_type</span> <span class="o">=</span> <span class="n">get_object_or_404</span><span class="p">(</span><span class="n">BlogType</span><span class="p">,</span> <span class="n">pk</span><span class="o">=</span><span class="n">blog_type_pk</span><span class="p">)</span>
    <span class="n">context</span><span class="p">[</span><span class="s1">&#39;blogs&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Blog</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">blog_type</span><span class="o">=</span><span class="n">blog_type</span><span class="p">)</span>
    <span class="n">context</span><span class="p">[</span><span class="s1">&#39;blog_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">blog_type</span>
    <span class="n">context</span><span class="p">[</span><span class="s1">&#39;blog_types&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">BlogType</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>  <span class="c1"># 博客列表页面,右侧,博客分类数据</span>
    <span class="k">return</span> <span class="n">render_to_response</span><span class="p">(</span><span class="s1">&#39;blog/blog_with_type.html&#39;</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><h4 id="博客详情页">博客详情页</h4>
<p><code>blog_detail.html</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html">{% extends &#39;base.html&#39; %}

{% block title %}
    {{ blog.title }}
{% endblock %}

{% block content %}
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;container&#34;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;row&#34;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;col-xs-10 col-xs-offset-2&#34;</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">h3</span><span class="p">&gt;</span>标题:{{ blog.title }}<span class="p">&lt;/</span><span class="nt">h3</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">ul</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;blog_detail_ul&#34;</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;</span>作者:{{ blog.author }}<span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;</span>发表日期:{{ blog.create_time | date:&#34;Y-m-d Hⓜs&#34;}}<span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;</span>分类: <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;{% url &#39;blog_with_type&#39; blog.blog_type.pk %}&#34;</span><span class="p">&gt;</span>{{ blog.blog_type }}<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span> <span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">li</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;blog_detail_content&#34;</span><span class="p">&gt;</span>{{ blog.content }}<span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
                <span class="p">&lt;/</span><span class="nt">ul</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
{% endblock %}
</code></pre></td></tr></table>
</div>
</div><p><code>blog_detail.css</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-css" data-lang="css"><span class="p">.</span><span class="nc">blog_detail_ul</span> <span class="nt">li</span> <span class="p">{</span>
    <span class="c">/* 设置li前面的小点的样式 */</span>
    <span class="k">list-style-type</span><span class="p">:</span> <span class="kc">none</span> <span class="cp">!important</span><span class="p">;</span>
<span class="p">}</span>

<span class="p">.</span><span class="nc">blog_detail_ul</span> <span class="nt">li</span><span class="p">:</span><span class="nd">not</span><span class="o">(</span><span class="p">:</span><span class="nd">last-child</span><span class="o">)</span> <span class="p">{</span>
    <span class="c">/* :not(:last-child) -&gt; 不要最后一个 */</span>
    <span class="k">display</span><span class="p">:</span> <span class="kc">inline</span><span class="o">-</span><span class="kc">block</span><span class="p">;</span>
    <span class="k">margin-right</span><span class="p">:</span> <span class="mi">10</span><span class="kt">px</span> <span class="cp">!important</span><span class="p">;</span>
<span class="p">}</span>

<span class="p">.</span><span class="nc">blog_detail_content</span> <span class="p">{</span>
    <span class="k">margin-top</span><span class="p">:</span> <span class="mi">20</span><span class="kt">px</span><span class="p">;</span>
    <span class="k">text-indent</span><span class="p">:</span> <span class="mi">2</span><span class="kt">em</span><span class="p">;</span>
    <span class="c">/* 首行缩进2字符 */</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><hr>
<h2 id="博客列表页面分页">博客列表页面分页</h2>
<ul>
<li>
<p>django中提供了自带的分页组件</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">django.core.paginator</span> <span class="kn">import</span> <span class="n">Paginator</span>
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>在views.py中编写blog_list方法</p>
<p><code>views.py</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">django.shortcuts</span> <span class="kn">import</span> <span class="n">render_to_response</span><span class="p">,</span> <span class="n">get_object_or_404</span>
<span class="kn">from</span> <span class="nn">.models</span> <span class="kn">import</span> <span class="n">Blog</span><span class="p">,</span> <span class="n">BlogType</span>
<span class="kn">from</span> <span class="nn">django.core.paginator</span> <span class="kn">import</span> <span class="n">Paginator</span>
  
  
<span class="c1"># 博客列表页</span>
<span class="k">def</span> <span class="nf">blog_list</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="n">page_num</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">GET</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;page&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>  <span class="c1"># 通过request获取当前页码,默认是第一页</span>
    <span class="n">blogs_all_list</span> <span class="o">=</span> <span class="n">Blog</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>  <span class="c1"># 获取全部博客列表,并存储到对象里</span>
    <span class="n">paginator</span> <span class="o">=</span> <span class="n">Paginator</span><span class="p">(</span><span class="n">blogs_all_list</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>  <span class="c1"># 使用分页组件,参数为 -&gt; ( 需要分页的集合(全部博客列表) , 每页显示几条 ) , 返回一个分页对象,这个对象中包含需要分页的集合数据</span>
    <span class="n">page</span> <span class="o">=</span> <span class="n">paginator</span><span class="o">.</span><span class="n">get_page</span><span class="p">(</span><span class="n">page_num</span><span class="p">)</span>  <span class="c1"># 向分页对象的get_page方法传参数,获取第几页的全部数据,并返回一个对象</span>
  
    <span class="n">context</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">context</span><span class="p">[</span><span class="s1">&#39;page&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">page</span>
    <span class="n">context</span><span class="p">[</span><span class="s1">&#39;blogs_length&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">Blog</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">())</span>  <span class="c1"># 博客总数</span>
    <span class="c1"># context[&#39;blogs_count&#39;] = Blog.objects.all().count()</span>
    <span class="n">context</span><span class="p">[</span><span class="s1">&#39;blog_types&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">BlogType</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>  <span class="c1"># 博客列表页面,右侧,博客分类数据</span>
    <span class="k">return</span> <span class="n">render_to_response</span><span class="p">(</span><span class="s1">&#39;blog/blog_list.html&#39;</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>
  
  
<span class="c1"># 博客详情页</span>
<span class="k">def</span> <span class="nf">blog_detail</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">blog_pk</span><span class="p">):</span>
    <span class="n">context</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">context</span><span class="p">[</span><span class="s1">&#39;blog&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_object_or_404</span><span class="p">(</span><span class="n">Blog</span><span class="p">,</span> <span class="n">pk</span><span class="o">=</span><span class="n">blog_pk</span><span class="p">)</span>  <span class="c1"># get_object_or_404,因为有可能获取不到</span>
    <span class="k">return</span> <span class="n">render_to_response</span><span class="p">(</span><span class="s1">&#39;blog/blog_detail.html&#39;</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>
  
  
<span class="c1"># 指定分类列表页</span>
<span class="k">def</span> <span class="nf">blogs_with_type</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">blog_type_pk</span><span class="p">):</span>
    <span class="n">context</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">blog_type</span> <span class="o">=</span> <span class="n">get_object_or_404</span><span class="p">(</span><span class="n">BlogType</span><span class="p">,</span> <span class="n">pk</span><span class="o">=</span><span class="n">blog_type_pk</span><span class="p">)</span>
    <span class="n">context</span><span class="p">[</span><span class="s1">&#39;blogs&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Blog</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">blog_type</span><span class="o">=</span><span class="n">blog_type</span><span class="p">)</span>
    <span class="n">context</span><span class="p">[</span><span class="s1">&#39;blog_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">blog_type</span>
    <span class="n">context</span><span class="p">[</span><span class="s1">&#39;blog_types&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">BlogType</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>  <span class="c1"># 博客列表页面,右侧,博客分类数据</span>
    <span class="k">return</span> <span class="n">render_to_response</span><span class="p">(</span><span class="s1">&#39;blog/blog_with_type.html&#39;</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>在模板页面,<code>blog_list.html</code>,将一些变量做替换</p>
<ul>
<li>
<p>遍历博客部分</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-django" data-lang="django"><span class="cp">{%</span> <span class="k">for</span> <span class="nv">blog</span> <span class="k">in</span> <span class="nv">page.object_list</span> <span class="cp">%}</span><span class="x">
</span></code></pre></td></tr></table>
</div>
</div><blockquote>
<p>当前页对象.object_list,代表当前页对象中,存储的全部数据,返回值是一个集合</p>
</blockquote>
</li>
<li>
<p>分页图标部分</p>
<ul>
<li>
<p>组件内容到bootstrap找一个</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-django" data-lang="django"><span class="x">&lt;nav aria-label=&#34;Page navigation&#34;&gt;
</span><span class="x">  &lt;ul class=&#34;pagination&#34;&gt;
</span><span class="x">    &lt;li&gt;
</span><span class="x">        </span><span class="c">{# 当前页对象.has_previous -&gt; 前一页 #}</span><span class="x">
</span><span class="x">        </span><span class="cp">{%</span> <span class="k">if</span> <span class="nv">page.has_previous</span> <span class="cp">%}</span><span class="x">
</span><span class="x">            </span><span class="c">{# django中,在href内写 ?xxx,就是在当前页面的路由后面拼接上href中的内容,点击还会跳转 #}</span><span class="x">
</span><span class="x">            </span><span class="c">{# 当前页对象.previous_page_number -&gt; 当前页的前一页 #}</span><span class="x">
</span><span class="x">            &lt;a href=&#34;?page=</span><span class="cp">{{</span> <span class="nv">page.previous_page_number</span> <span class="cp">}}</span><span class="x">&#34; aria-label=&#34;Previous&#34;&gt;
</span><span class="x">                &lt;span aria-hidden=&#34;true&#34;&gt;&amp;laquo;&lt;/span&gt;
</span><span class="x">            &lt;/a&gt;
</span><span class="x">        </span><span class="cp">{%</span> <span class="k">else</span> <span class="cp">%}</span><span class="x">
</span><span class="x">            &lt;span aria-hidden=&#34;true&#34;&gt;&amp;laquo;&lt;/span&gt;
</span><span class="x">        </span><span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span><span class="x">
</span><span class="x">    &lt;/li&gt;
</span><span class="x">    &lt;li&gt;
</span><span class="x">        </span><span class="c">{# 当前页对象.paginator.page_range -&gt; 返回整个分页对象,一共有几页 #}</span><span class="x">
</span><span class="x">        </span><span class="cp">{%</span> <span class="k">for</span> <span class="nv">page_child</span> <span class="k">in</span> <span class="nv">page.paginator.page_range</span> <span class="cp">%}</span><span class="x">
</span><span class="x">            &lt;a href=&#34;?page=</span><span class="cp">{{</span> <span class="nv">page_child</span> <span class="cp">}}</span><span class="x">&#34;&gt;</span><span class="cp">{{</span> <span class="nv">page_child</span> <span class="cp">}}</span><span class="x">&lt;/a&gt;
</span><span class="x">        </span><span class="cp">{%</span> <span class="k">endfor</span> <span class="cp">%}</span><span class="x">
</span><span class="x">    &lt;/li&gt;
</span><span class="x">    &lt;li&gt;
</span><span class="x">        </span><span class="c">{# 当前页对象.has_next -&gt; 后一页 #}</span><span class="x">
</span><span class="x">        </span><span class="cp">{%</span> <span class="k">if</span> <span class="nv">page.has_next</span> <span class="cp">%}</span><span class="x">
</span><span class="x">        </span><span class="c">{# 当前页对象.next_page_number -&gt; 当前页的后一页 #}</span><span class="x">
</span><span class="x">          &lt;a href=&#34;?page=</span><span class="cp">{{</span> <span class="nv">page.next_page_number</span> <span class="cp">}}</span><span class="x">&#34; aria-label=&#34;Next&#34;&gt;
</span><span class="x">            &lt;span aria-hidden=&#34;true&#34;&gt;&amp;raquo;&lt;/span&gt;
</span><span class="x">          &lt;/a&gt;
</span><span class="x">        </span><span class="cp">{%</span> <span class="k">else</span> <span class="cp">%}</span><span class="x">
</span><span class="x">            &lt;span aria-hidden=&#34;true&#34;&gt;&amp;raquo;&lt;/span&gt;
</span><span class="x">        </span><span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span><span class="x">
</span><span class="x">    &lt;/li&gt;
</span><span class="x">  &lt;/ul&gt;
</span><span class="x">&lt;/nav&gt;
</span></code></pre></td></tr></table>
</div>
</div></li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="全部代码-5">全部代码</h3>
<p><code>views.py</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">django.shortcuts</span> <span class="kn">import</span> <span class="n">render_to_response</span><span class="p">,</span> <span class="n">get_object_or_404</span>
<span class="kn">from</span> <span class="nn">.models</span> <span class="kn">import</span> <span class="n">Blog</span><span class="p">,</span> <span class="n">BlogType</span>
<span class="kn">from</span> <span class="nn">django.core.paginator</span> <span class="kn">import</span> <span class="n">Paginator</span>


<span class="c1"># 博客列表页</span>
<span class="k">def</span> <span class="nf">blog_list</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="n">page_num</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">GET</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;page&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>  <span class="c1"># 通过request获取当前页码,默认是第一页</span>
    <span class="n">blogs_all_list</span> <span class="o">=</span> <span class="n">Blog</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>  <span class="c1"># 获取全部博客列表,并存储到对象里</span>
    <span class="n">paginator</span> <span class="o">=</span> <span class="n">Paginator</span><span class="p">(</span><span class="n">blogs_all_list</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>  <span class="c1"># 使用分页组件,参数为 -&gt; ( 需要分页的集合(全部博客列表) , 每页显示几条 ) , 返回一个分页对象,这个对象中包含需要分页的集合数据</span>
    <span class="n">page</span> <span class="o">=</span> <span class="n">paginator</span><span class="o">.</span><span class="n">get_page</span><span class="p">(</span><span class="n">page_num</span><span class="p">)</span>  <span class="c1"># 向分页对象的get_page方法传参数,获取第几页的全部数据,并返回一个对象</span>

    <span class="n">context</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">context</span><span class="p">[</span><span class="s1">&#39;page&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">page</span>
    <span class="c1"># context[&#39;blogs_count&#39;] = Blog.objects.all().count()</span>
    <span class="n">context</span><span class="p">[</span><span class="s1">&#39;blog_types&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">BlogType</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>  <span class="c1"># 博客列表页面,右侧,博客分类数据</span>
    <span class="k">return</span> <span class="n">render_to_response</span><span class="p">(</span><span class="s1">&#39;blog/blog_list.html&#39;</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>


<span class="c1"># 博客详情页</span>
<span class="k">def</span> <span class="nf">blog_detail</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">blog_pk</span><span class="p">):</span>
    <span class="n">context</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">context</span><span class="p">[</span><span class="s1">&#39;blog&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_object_or_404</span><span class="p">(</span><span class="n">Blog</span><span class="p">,</span> <span class="n">pk</span><span class="o">=</span><span class="n">blog_pk</span><span class="p">)</span>  <span class="c1"># get_object_or_404,因为有可能获取不到</span>
    <span class="k">return</span> <span class="n">render_to_response</span><span class="p">(</span><span class="s1">&#39;blog/blog_detail.html&#39;</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>


<span class="c1"># 指定分类列表页</span>
<span class="k">def</span> <span class="nf">blogs_with_type</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">blog_type_pk</span><span class="p">):</span>
    <span class="n">context</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">blog_type</span> <span class="o">=</span> <span class="n">get_object_or_404</span><span class="p">(</span><span class="n">BlogType</span><span class="p">,</span> <span class="n">pk</span><span class="o">=</span><span class="n">blog_type_pk</span><span class="p">)</span>
    <span class="n">context</span><span class="p">[</span><span class="s1">&#39;blogs&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Blog</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">blog_type</span><span class="o">=</span><span class="n">blog_type</span><span class="p">)</span>
    <span class="n">context</span><span class="p">[</span><span class="s1">&#39;blog_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">blog_type</span>
    <span class="n">context</span><span class="p">[</span><span class="s1">&#39;blog_types&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">BlogType</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>  <span class="c1"># 博客列表页面,右侧,博客分类数据</span>
    <span class="k">return</span> <span class="n">render_to_response</span><span class="p">(</span><span class="s1">&#39;blog/blog_with_type.html&#39;</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><p><code>blog_list.html</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span><span class="lnt">78
</span><span class="lnt">79
</span><span class="lnt">80
</span><span class="lnt">81
</span><span class="lnt">82
</span><span class="lnt">83
</span><span class="lnt">84
</span><span class="lnt">85
</span><span class="lnt">86
</span><span class="lnt">87
</span><span class="lnt">88
</span><span class="lnt">89
</span><span class="lnt">90
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-django" data-lang="django"><span class="cp">{%</span> <span class="k">extends</span> <span class="s1">&#39;base.html&#39;</span> <span class="cp">%}</span><span class="x">
</span><span class="x">
</span><span class="x"></span><span class="cp">{%</span> <span class="k">block</span> <span class="nv">title</span> <span class="cp">%}</span><span class="x">blog_list</span><span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span><span class="x">
</span><span class="x">
</span><span class="x"></span><span class="cp">{%</span> <span class="k">block</span> <span class="nv">nav_blog_active</span> <span class="cp">%}</span><span class="x">active</span><span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span><span class="x">
</span><span class="x">
</span><span class="x"></span><span class="cp">{%</span> <span class="k">block</span> <span class="nv">content</span> <span class="cp">%}</span><span class="x">
</span><span class="x">    &lt;div class=&#34;container&#34;&gt;
</span><span class="x">        &lt;div class=&#34;row&#34;&gt;
</span><span class="x">            &lt;div class=&#34;col-sm-8 col-lg-8&#34;&gt;
</span><span class="x">                &lt;div class=&#34;panel panel-default&#34;&gt;
</span><span class="x">                  </span><span class="c">{# page是当前页对象 paginator是整个大的分页对象 当前分页对象.paginator,就是回调到整个大的分页对象 当前分页对象.paginator.count,就是整个大的分页对象中全部内容的长度 #}</span><span class="x">
</span><span class="x">                  &lt;div class=&#34;panel-heading&#34;&gt;一共有</span><span class="cp">{{</span> <span class="nv">page.paginator.count</span> <span class="cp">}}</span><span class="x">篇博客&lt;/div&gt;
</span><span class="x">                      &lt;div class=&#34;panel-body&#34;&gt;
</span><span class="x">                        </span><span class="c">{# 遍历当前页的全部数据 #}</span><span class="x">
</span><span class="x">                        </span><span class="cp">{%</span> <span class="k">for</span> <span class="nv">blog</span> <span class="k">in</span> <span class="nv">page.object_list</span> <span class="cp">%}</span><span class="x">
</span><span class="x">                            &lt;div class=&#34;blog&#34;&gt;
</span><span class="x">                                &lt;a href=&#34;</span><span class="cp">{%</span> <span class="k">url</span> <span class="s1">&#39;blog_detail&#39;</span> <span class="nv">blog.pk</span> <span class="cp">%}</span><span class="x">&#34;&gt;
</span><span class="x">                                    &lt;h3&gt;</span><span class="cp">{{</span><span class="nv">blog.title</span><span class="cp">}}</span><span class="x">&lt;/h3&gt;
</span><span class="x">                                    &lt;p class=&#34;blog_info&#34;&gt;
</span><span class="x">                                        &lt;span class=&#34;glyphicon glyphicon-star&#34;&gt;&lt;/span&gt;
</span><span class="x">                                        &lt;span&gt;
</span><span class="x">                                            分类: &lt;a href=&#34;</span><span class="cp">{%</span> <span class="k">url</span> <span class="s1">&#39;blog_with_type&#39;</span> <span class="nv">blog.blog_type.pk</span> <span class="cp">%}</span><span class="x">&#34;&gt;</span><span class="cp">{{</span> <span class="nv">blog.blog_type</span> <span class="cp">}}</span><span class="x">&lt;/a&gt;
</span><span class="x">                                        &lt;/span&gt;
</span><span class="x">                                        &lt;span class=&#34;glyphicon glyphicon-time&#34;&gt;&lt;/span&gt;
</span><span class="x">                                        &lt;span class=&#34;blog_list_li_date&#34;&gt;
</span><span class="x">                                            发表日期:</span><span class="cp">{{</span> <span class="nv">blog.create_time</span> <span class="o">|</span> <span class="nf">date</span><span class="s2">:&#34;Y-m-d&#34;</span><span class="cp">}}</span><span class="x">
</span><span class="x">                                        &lt;/span&gt;
</span><span class="x">                                    &lt;/p&gt;
</span><span class="x">                                &lt;/a&gt;
</span><span class="x">                                &lt;p&gt;</span><span class="cp">{{</span><span class="nv">blog.content</span> <span class="o">|</span> <span class="nf">truncatechars</span><span class="o">:</span><span class="m">30</span><span class="cp">}}</span><span class="x">&lt;/p&gt;
</span><span class="x">                            &lt;/div&gt;
</span><span class="x">                        </span><span class="cp">{%</span> <span class="k">empty</span> <span class="cp">%}</span><span class="x">
</span><span class="x">                            &lt;p&gt;暂无博客&lt;/p&gt;
</span><span class="x">                        </span><span class="cp">{%</span> <span class="k">endfor</span> <span class="cp">%}</span><span class="x">
</span><span class="x">                      &lt;/div&gt;
</span><span class="x">                &lt;/div&gt;
</span><span class="x">
</span><span class="x">                </span><span class="c">{# 分页图标 #}</span><span class="x">
</span><span class="x">                &lt;nav aria-label=&#34;Page navigation&#34;&gt;
</span><span class="x">                  &lt;ul class=&#34;pagination&#34;&gt;
</span><span class="x">                    &lt;li&gt;
</span><span class="x">                        </span><span class="c">{# 当前页对象.has_previous -&gt; 前一页 #}</span><span class="x">
</span><span class="x">                        </span><span class="cp">{%</span> <span class="k">if</span> <span class="nv">page.has_previous</span> <span class="cp">%}</span><span class="x">
</span><span class="x">                            </span><span class="c">{# django中,在href内写 ?xxx,就是在当前页面的路由后面拼接上href中的内容,点击还会跳转 #}</span><span class="x">
</span><span class="x">                            </span><span class="c">{# 当前页对象.previous_page_number -&gt; 当前页的前一页 #}</span><span class="x">
</span><span class="x">                            &lt;a href=&#34;?page=</span><span class="cp">{{</span> <span class="nv">page.previous_page_number</span> <span class="cp">}}</span><span class="x">&#34; aria-label=&#34;Previous&#34;&gt;
</span><span class="x">                                &lt;span aria-hidden=&#34;true&#34;&gt;&amp;laquo;&lt;/span&gt;
</span><span class="x">                            &lt;/a&gt;
</span><span class="x">                        </span><span class="cp">{%</span> <span class="k">else</span> <span class="cp">%}</span><span class="x">
</span><span class="x">                            &lt;span aria-hidden=&#34;true&#34;&gt;&amp;laquo;&lt;/span&gt;
</span><span class="x">                        </span><span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span><span class="x">
</span><span class="x">                    &lt;/li&gt;
</span><span class="x">                    &lt;li&gt;
</span><span class="x">                        </span><span class="c">{# 当前页对象.paginator.page_range -&gt; 返回整个分页对象,一共有几页 #}</span><span class="x">
</span><span class="x">                        </span><span class="cp">{%</span> <span class="k">for</span> <span class="nv">page_child</span> <span class="k">in</span> <span class="nv">page.paginator.page_range</span> <span class="cp">%}</span><span class="x">
</span><span class="x">                            &lt;a href=&#34;?page=</span><span class="cp">{{</span> <span class="nv">page_child</span> <span class="cp">}}</span><span class="x">&#34;&gt;</span><span class="cp">{{</span> <span class="nv">page_child</span> <span class="cp">}}</span><span class="x">&lt;/a&gt;
</span><span class="x">                        </span><span class="cp">{%</span> <span class="k">endfor</span> <span class="cp">%}</span><span class="x">
</span><span class="x">                    &lt;/li&gt;
</span><span class="x">                    &lt;li&gt;
</span><span class="x">                        </span><span class="c">{# 当前页对象.has_next -&gt; 后一页 #}</span><span class="x">
</span><span class="x">                        </span><span class="cp">{%</span> <span class="k">if</span> <span class="nv">page.has_next</span> <span class="cp">%}</span><span class="x">
</span><span class="x">                        </span><span class="c">{# 当前页对象.next_page_number -&gt; 当前页的后一页 #}</span><span class="x">
</span><span class="x">                          &lt;a href=&#34;?page=</span><span class="cp">{{</span> <span class="nv">page.next_page_number</span> <span class="cp">}}</span><span class="x">&#34; aria-label=&#34;Next&#34;&gt;
</span><span class="x">                            &lt;span aria-hidden=&#34;true&#34;&gt;&amp;raquo;&lt;/span&gt;
</span><span class="x">                          &lt;/a&gt;
</span><span class="x">                        </span><span class="cp">{%</span> <span class="k">else</span> <span class="cp">%}</span><span class="x">
</span><span class="x">                            &lt;span aria-hidden=&#34;true&#34;&gt;&amp;raquo;&lt;/span&gt;
</span><span class="x">                        </span><span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span><span class="x">
</span><span class="x">                    &lt;/li&gt;
</span><span class="x">                  &lt;/ul&gt;
</span><span class="x">                &lt;/nav&gt;
</span><span class="x">            &lt;/div&gt;
</span><span class="x">            &lt;div class=&#34;col-sm-4 col-lg-4&#34;&gt;
</span><span class="x">                &lt;div class=&#34;panel panel-default&#34;&gt;
</span><span class="x">                   &lt;div class=&#34;panel-heading&#34;&gt;博客分类&lt;/div&gt;
</span><span class="x">                       &lt;div class=&#34;panel-body&#34;&gt;
</span><span class="x">                           &lt;ul&gt;
</span><span class="x">                               </span><span class="cp">{%</span> <span class="k">for</span> <span class="nv">blog_type</span> <span class="k">in</span> <span class="nv">blog_types</span> <span class="cp">%}</span><span class="x">
</span><span class="x">                                   &lt;li class=&#34;blog_list_li&#34;&gt;&lt;a href=&#34;</span><span class="cp">{%</span> <span class="k">url</span> <span class="s1">&#39;blog_with_type&#39;</span> <span class="nv">blog_type.pk</span> <span class="cp">%}</span><span class="x">&#34;&gt;</span><span class="cp">{{</span> <span class="nv">blog_type.type_name</span> <span class="cp">}}</span><span class="x">&lt;/a&gt;&lt;/li&gt;
</span><span class="x">                               </span><span class="cp">{%</span> <span class="k">empty</span> <span class="cp">%}</span><span class="x">
</span><span class="x">                                   &lt;li class=&#34;blog_list_li&#34;&gt;暂无分类&lt;/li&gt;
</span><span class="x">                               </span><span class="cp">{%</span> <span class="k">endfor</span> <span class="cp">%}</span><span class="x">
</span><span class="x">                           &lt;/ul&gt;
</span><span class="x">                       &lt;/div&gt;
</span><span class="x">                &lt;/div&gt;
</span><span class="x">            &lt;/div&gt;
</span><span class="x">        &lt;/div&gt;
</span><span class="x">    &lt;/div&gt;
</span><span class="x"></span><span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span><span class="x">
</span></code></pre></td></tr></table>
</div>
</div><hr>
<h2 id="分页优化">分页优化</h2>
<h3 id="当前页点击图标高亮">当前页点击图标高亮</h3>
<ul>
<li>
<p>在遍历生成底部页码图标时做判断</p>
</li>
<li>
<p>如果这个是当前页,就高亮<code>class=&quot;active&quot;</code></p>
</li>
<li>
<p>否则就不加高亮</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-django" data-lang="django"><span class="c">{# 当前页对象.paginator.page_range -&gt; 返回整个分页对象,一共有几页 #}</span><span class="x">
</span><span class="x"></span><span class="cp">{%</span> <span class="k">for</span> <span class="nv">page_child</span> <span class="k">in</span> <span class="nv">page.paginator.page_range</span> <span class="cp">%}</span><span class="x">
</span><span class="x">  </span><span class="cp">{%</span> <span class="k">if</span> <span class="nv">page_child</span> <span class="o">==</span> <span class="nv">page.number</span> <span class="cp">%}</span><span class="x">
</span><span class="x">      &lt;li class=&#34;active&#34;&gt;
</span><span class="x">          &lt;a href=&#34;?page=</span><span class="cp">{{</span> <span class="nv">page_child</span> <span class="cp">}}</span><span class="x">&#34;&gt;</span><span class="cp">{{</span> <span class="nv">page_child</span> <span class="cp">}}</span><span class="x">&lt;/a&gt;
</span><span class="x">      &lt;/li&gt;
</span><span class="x">  </span><span class="cp">{%</span> <span class="k">else</span> <span class="cp">%}</span><span class="x">
</span><span class="x">        &lt;li&gt;
</span><span class="x">          &lt;a href=&#34;?page=</span><span class="cp">{{</span> <span class="nv">page_child</span> <span class="cp">}}</span><span class="x">&#34;&gt;</span><span class="cp">{{</span> <span class="nv">page_child</span> <span class="cp">}}</span><span class="x">&lt;/a&gt;
</span><span class="x">      &lt;/li&gt;
</span><span class="x">  </span><span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span><span class="x">
</span><span class="x"></span><span class="cp">{%</span> <span class="k">endfor</span> <span class="cp">%}</span><span class="x">
</span></code></pre></td></tr></table>
</div>
</div></li>
</ul>
<hr>
<h3 id="页码太多隐藏中间的页码部分只显示两头的几页">页码太多,隐藏中间的页码部分,只显示两头的几页</h3>
<h4 id="第一步在viewspy中获取当前页页码然后获取到当前页的前两页和后两页封装到列表中前端遍历的不是所有页码而是当前页的前2页和后2页">第一步,在views.py中获取当前页页码,然后获取到当前页的前两页和后两页,封装到列表中,前端遍历的不是所有页码,而是当前页的前2页和后2页</h4>
<p><code>views.py</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">django.shortcuts</span> <span class="kn">import</span> <span class="n">render_to_response</span><span class="p">,</span> <span class="n">get_object_or_404</span>
<span class="kn">from</span> <span class="nn">.models</span> <span class="kn">import</span> <span class="n">Blog</span><span class="p">,</span> <span class="n">BlogType</span>
<span class="kn">from</span> <span class="nn">django.core.paginator</span> <span class="kn">import</span> <span class="n">Paginator</span>
<span class="kn">from</span> <span class="nn">django.contrib.auth.models</span> <span class="kn">import</span> <span class="n">User</span>

<span class="c1"># 批量添加数据</span>
<span class="k">def</span> <span class="nf">add</span><span class="p">():</span>
    <span class="n">blog_type</span> <span class="o">=</span> <span class="n">BlogType</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">user</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">30</span><span class="p">):</span>
        <span class="n">Blog</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;第&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;个&#39;</span><span class="p">,</span> <span class="n">blog_type</span><span class="o">=</span><span class="n">blog_type</span><span class="p">,</span> <span class="n">content</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="n">author</span><span class="o">=</span><span class="n">user</span><span class="p">)</span>


<span class="c1"># 博客列表页</span>
<span class="k">def</span> <span class="nf">blog_list</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="c1"># add()</span>
    <span class="n">context</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">page_num</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">GET</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;page&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>  <span class="c1"># 通过request获取当前页码,默认是第一页</span>
    <span class="n">blogs_all_list</span> <span class="o">=</span> <span class="n">Blog</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>  <span class="c1"># 获取全部博客列表,并存储到对象里</span>
    <span class="n">paginator</span> <span class="o">=</span> <span class="n">Paginator</span><span class="p">(</span><span class="n">blogs_all_list</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>  <span class="c1"># 使用分页组件,参数为 -&gt; ( 需要分页的集合(全部博客列表) , 每页显示几条 ) , 返回一个分页对象,这个对象中包含需要分页的集合数据</span>
    <span class="n">page</span> <span class="o">=</span> <span class="n">paginator</span><span class="o">.</span><span class="n">get_page</span><span class="p">(</span><span class="n">page_num</span><span class="p">)</span>  <span class="c1"># 向分页对象的get_page方法传参数,获取第几页的全部数据,并返回一个对象</span>

    <span class="n">current_page_number</span> <span class="o">=</span> <span class="n">page</span><span class="o">.</span><span class="n">number</span>  <span class="c1"># 当前页</span>
    <span class="c1"># 当前页的前两页,当前页和当前页的后两页</span>
    <span class="n">context</span><span class="p">[</span><span class="s1">&#39;many_page_hide_list&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">current_page_number</span> <span class="o">-</span> <span class="mi">2</span><span class="p">,</span> <span class="n">current_page_number</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">current_page_number</span><span class="p">,</span> <span class="n">current_page_number</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">current_page_number</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]</span>

    <span class="n">context</span><span class="p">[</span><span class="s1">&#39;page&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">page</span>
    <span class="c1"># context[&#39;blogs_count&#39;] = Blog.objects.all().count()</span>
    <span class="n">context</span><span class="p">[</span><span class="s1">&#39;blog_types&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">BlogType</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>  <span class="c1"># 博客列表页面,右侧,博客分类数据</span>
    <span class="k">return</span> <span class="n">render_to_response</span><span class="p">(</span><span class="s1">&#39;blog/blog_list.html&#39;</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>


<span class="c1"># 博客详情页</span>
<span class="k">def</span> <span class="nf">blog_detail</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">blog_pk</span><span class="p">):</span>
    <span class="n">context</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">context</span><span class="p">[</span><span class="s1">&#39;blog&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_object_or_404</span><span class="p">(</span><span class="n">Blog</span><span class="p">,</span> <span class="n">pk</span><span class="o">=</span><span class="n">blog_pk</span><span class="p">)</span>  <span class="c1"># get_object_or_404,因为有可能获取不到</span>
    <span class="k">return</span> <span class="n">render_to_response</span><span class="p">(</span><span class="s1">&#39;blog/blog_detail.html&#39;</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>


<span class="c1"># 指定分类列表页</span>
<span class="k">def</span> <span class="nf">blogs_with_type</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">blog_type_pk</span><span class="p">):</span>
    <span class="n">context</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">blog_type</span> <span class="o">=</span> <span class="n">get_object_or_404</span><span class="p">(</span><span class="n">BlogType</span><span class="p">,</span> <span class="n">pk</span><span class="o">=</span><span class="n">blog_type_pk</span><span class="p">)</span>
    <span class="n">context</span><span class="p">[</span><span class="s1">&#39;blogs&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Blog</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">blog_type</span><span class="o">=</span><span class="n">blog_type</span><span class="p">)</span>
    <span class="n">context</span><span class="p">[</span><span class="s1">&#39;blog_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">blog_type</span>
    <span class="n">context</span><span class="p">[</span><span class="s1">&#39;blog_types&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">BlogType</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>  <span class="c1"># 博客列表页面,右侧,博客分类数据</span>
    <span class="k">return</span> <span class="n">render_to_response</span><span class="p">(</span><span class="s1">&#39;blog/blog_with_type.html&#39;</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><p><code>blog_list.html</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span><span class="lnt">78
</span><span class="lnt">79
</span><span class="lnt">80
</span><span class="lnt">81
</span><span class="lnt">82
</span><span class="lnt">83
</span><span class="lnt">84
</span><span class="lnt">85
</span><span class="lnt">86
</span><span class="lnt">87
</span><span class="lnt">88
</span><span class="lnt">89
</span><span class="lnt">90
</span><span class="lnt">91
</span><span class="lnt">92
</span><span class="lnt">93
</span><span class="lnt">94
</span><span class="lnt">95
</span><span class="lnt">96
</span><span class="lnt">97
</span><span class="lnt">98
</span><span class="lnt">99
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html">{% extends &#39;base.html&#39; %}

{% block title %}blog_list{% endblock %}

{% block nav_blog_active %}active{% endblock %}

{% block content %}
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;container&#34;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;row&#34;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;col-sm-8 col-lg-8&#34;</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;panel panel-default&#34;</span><span class="p">&gt;</span>
                  {# page是当前页对象 paginator是整个大的分页对象 当前分页对象.paginator,就是回调到整个大的分页对象 当前分页对象.paginator.count,就是整个大的分页对象中全部内容的长度 #}
                  <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;panel-heading&#34;</span><span class="p">&gt;</span>一共有{{ page.paginator.count }}篇博客<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
                      <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;panel-body&#34;</span><span class="p">&gt;</span>
                        {# 遍历当前页的全部数据 #}
                        {% for blog in page.object_list %}
                            <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;blog&#34;</span><span class="p">&gt;</span>
                                <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;{% url &#39;blog_detail&#39; blog.pk %}&#34;</span><span class="p">&gt;</span>
                                    <span class="p">&lt;</span><span class="nt">h3</span><span class="p">&gt;</span>{{blog.title}}<span class="p">&lt;/</span><span class="nt">h3</span><span class="p">&gt;</span>
                                    <span class="p">&lt;</span><span class="nt">p</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;blog_info&#34;</span><span class="p">&gt;</span>
                                        <span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;glyphicon glyphicon-star&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
                                        <span class="p">&lt;</span><span class="nt">span</span><span class="p">&gt;</span>
                                            分类: <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;{% url &#39;blog_with_type&#39; blog.blog_type.pk %}&#34;</span><span class="p">&gt;</span>{{ blog.blog_type }}<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
                                        <span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
                                        <span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;glyphicon glyphicon-time&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
                                        <span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;blog_list_li_date&#34;</span><span class="p">&gt;</span>
                                            发表日期:{{ blog.create_time | date:&#34;Y-m-d&#34;}}
                                        <span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
                                    <span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
                                <span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
                                <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>{{blog.content | truncatechars:30}}<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
                            <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
                        {% empty %}
                            <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>暂无博客<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
                        {% endfor %}
                      <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
                <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

                {# 分页图标 #}
                <span class="p">&lt;</span><span class="nt">nav</span> <span class="na">aria-label</span><span class="o">=</span><span class="s">&#34;Page navigation&#34;</span><span class="p">&gt;</span>
                  <span class="p">&lt;</span><span class="nt">ul</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;pagination&#34;</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;</span>
                        {# 当前页对象.has_previous -&gt; 前一页 #}
                        {% if page.has_previous %}
                            {# django中,在href内写 ?xxx,就是在当前页面的路由后面拼接上href中的内容,点击还会跳转 #}
                            {# 当前页对象.previous_page_number -&gt; 当前页的前一页 #}
                            <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;?page={{ page.previous_page_number }}&#34;</span> <span class="na">aria-label</span><span class="o">=</span><span class="s">&#34;Previous&#34;</span><span class="p">&gt;</span>
                                <span class="p">&lt;</span><span class="nt">span</span> <span class="na">aria-hidden</span><span class="o">=</span><span class="s">&#34;true&#34;</span><span class="p">&gt;</span><span class="ni">&amp;laquo;</span><span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
                            <span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
                        {% else %}
                            <span class="p">&lt;</span><span class="nt">span</span> <span class="na">aria-hidden</span><span class="o">=</span><span class="s">&#34;true&#34;</span><span class="p">&gt;</span><span class="ni">&amp;laquo;</span><span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
                        {% endif %}
                    <span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
                    {# 这里遍历的是 当前页的前两页 当前页 当前页的后两页 #}
                    {# 当前页对象.paginator.page_range -&gt; 返回整个分页对象,一共有几页 #}
                    {% for page_child in many_page_hide_list %}
{#                    {% for page_child in page.paginator.page_range %}#}
                        {% if page_child == page.number %}
                            <span class="p">&lt;</span><span class="nt">li</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;active&#34;</span><span class="p">&gt;</span>
                                <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;?page={{ page_child }}&#34;</span><span class="p">&gt;</span>{{ page_child }}<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
                            <span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
                        {% else %}
                            <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;</span>
                                <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;?page={{ page_child }}&#34;</span><span class="p">&gt;</span>{{ page_child }}<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
                            <span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
                        {% endif %}
                    {% endfor %}

                    <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;</span>
                        {# 当前页对象.has_next -&gt; 后一页 #}
                        {% if page.has_next %}
                        {# 当前页对象.next_page_number -&gt; 当前页的后一页 #}
                          <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;?page={{ page.next_page_number }}&#34;</span> <span class="na">aria-label</span><span class="o">=</span><span class="s">&#34;Next&#34;</span><span class="p">&gt;</span>
                            <span class="p">&lt;</span><span class="nt">span</span> <span class="na">aria-hidden</span><span class="o">=</span><span class="s">&#34;true&#34;</span><span class="p">&gt;</span><span class="ni">&amp;raquo;</span><span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
                          <span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
                        {% else %}
                            <span class="p">&lt;</span><span class="nt">span</span> <span class="na">aria-hidden</span><span class="o">=</span><span class="s">&#34;true&#34;</span><span class="p">&gt;</span><span class="ni">&amp;raquo;</span><span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
                        {% endif %}
                    <span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
                  <span class="p">&lt;/</span><span class="nt">ul</span><span class="p">&gt;</span>
                <span class="p">&lt;/</span><span class="nt">nav</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;col-sm-4 col-lg-4&#34;</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;panel panel-default&#34;</span><span class="p">&gt;</span>
                   <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;panel-heading&#34;</span><span class="p">&gt;</span>博客分类<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
                       <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;panel-body&#34;</span><span class="p">&gt;</span>
                           <span class="p">&lt;</span><span class="nt">ul</span><span class="p">&gt;</span>
                               {% for blog_type in blog_types %}
                                   <span class="p">&lt;</span><span class="nt">li</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;blog_list_li&#34;</span><span class="p">&gt;&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;{% url &#39;blog_with_type&#39; blog_type.pk %}&#34;</span><span class="p">&gt;</span>{{ blog_type.type_name }}<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
                               {% empty %}
                                   <span class="p">&lt;</span><span class="nt">li</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;blog_list_li&#34;</span><span class="p">&gt;</span>暂无分类<span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
                               {% endfor %}
                           <span class="p">&lt;/</span><span class="nt">ul</span><span class="p">&gt;</span>
                       <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
                <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
{% endblock %}
</code></pre></td></tr></table>
</div>
</div><h4 id="第二步解决---第一种做法中当点击第1页前面显示-1和0的问题第一页和最后一页越界">第二步,解决 - 第一种做法中,当点击第1页,前面显示-1和0的问题(第一页和最后一页越界)</h4>
<p><code>views.py</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="c1"># 博客列表页</span>
<span class="k">def</span> <span class="nf">blog_list</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="c1"># add()</span>
    <span class="n">context</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">page_num</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">GET</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;page&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>  <span class="c1"># 通过request获取当前页码,默认是第一页</span>
    <span class="n">blogs_all_list</span> <span class="o">=</span> <span class="n">Blog</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>  <span class="c1"># 获取全部博客列表,并存储到对象里</span>
    <span class="n">paginator</span> <span class="o">=</span> <span class="n">Paginator</span><span class="p">(</span><span class="n">blogs_all_list</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>  <span class="c1"># 使用分页组件,参数为 -&gt; ( 需要分页的集合(全部博客列表) , 每页显示几条 ) , 返回一个分页对象,这个对象中包含需要分页的集合数据</span>
    <span class="n">page</span> <span class="o">=</span> <span class="n">paginator</span><span class="o">.</span><span class="n">get_page</span><span class="p">(</span><span class="n">page_num</span><span class="p">)</span>  <span class="c1"># 向分页对象的get_page方法传参数,获取第几页的全部数据,并返回一个对象</span>

    <span class="n">current_page_number</span> <span class="o">=</span> <span class="n">page</span><span class="o">.</span><span class="n">number</span>  <span class="c1"># 当前页</span>
    <span class="c1"># 当前页的前两页,当前页和当前页的后两页</span>
    <span class="c1"># context[&#39;many_page_hide_list&#39;] = [current_page_number - 2, current_page_number - 1, current_page_number, current_page_number + 1, current_page_number + 2]</span>

    <span class="c1"># 从当前页的前两页到当前页(前两页的页码,和第一页比对大小,取大的,这样就保证了前两页的第一页的页码,最小是1) - 左闭右开</span>
    <span class="c1"># 从当前页到最后一页(后两页最后一页的页码,和&#34;一共有多少页&#34;作比较,取小的,即使是点击最后一页,当前页后面的两页的页码比当前页(最后一页)大,取的也是最后一页)</span>
    <span class="c1"># python3的range方法返回的不是list,需要使用list转一下</span>
    <span class="n">many_page_hide_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
                                 <span class="nb">range</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">current_page_number</span> <span class="o">-</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">current_page_number</span><span class="p">)</span>
                              <span class="p">)</span> <span class="o">+</span> \
                          <span class="nb">list</span><span class="p">(</span>
                                 <span class="c1"># 分页对象.num_pages, 分页器中一共有多少页</span>
                                 <span class="nb">range</span><span class="p">(</span><span class="n">current_page_number</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="n">current_page_number</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span> <span class="n">paginator</span><span class="o">.</span><span class="n">num_pages</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
                              <span class="p">)</span>
    
    <span class="n">context</span><span class="p">[</span><span class="s1">&#39;many_page_hide_list&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">many_page_hide_list</span>

    <span class="n">context</span><span class="p">[</span><span class="s1">&#39;page&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">page</span>
    <span class="c1"># context[&#39;blogs_count&#39;] = Blog.objects.all().count()</span>
    <span class="n">context</span><span class="p">[</span><span class="s1">&#39;blog_types&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">BlogType</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>  <span class="c1"># 博客列表页面,右侧,博客分类数据</span>
    <span class="k">return</span> <span class="n">render_to_response</span><span class="p">(</span><span class="s1">&#39;blog/blog_list.html&#39;</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>

</code></pre></td></tr></table>
</div>
</div><h4 id="第三步添加页码省略号">第三步添加页码省略号</h4>
<ul>
<li>
<p>实现了显示少量页码,而且不越界</p>
</li>
<li>
<p>但是不美观</p>
</li>
<li>
<p>这里要实现两个功能</p>
</li>
<li>
<p>点击第一页,最后面有最后一页的页码图标</p>
</li>
<li>
<p>点击最后一页,最前面有第一页的页码图标</p>
</li>
<li>
<p>先批量向博客列表中添加数据</p>
<p><code>views.py</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="c1"># 批量添加数据</span>
<span class="k">def</span> <span class="nf">add</span><span class="p">():</span>
    <span class="n">blog_type</span> <span class="o">=</span> <span class="n">BlogType</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">user</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">30</span><span class="p">):</span>
        <span class="n">Blog</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;第&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;个&#39;</span><span class="p">,</span> <span class="n">blog_type</span><span class="o">=</span><span class="n">blog_type</span><span class="p">,</span> <span class="n">content</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="n">author</span><span class="o">=</span><span class="n">user</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>添加逻辑</p>
<p><code>views.py</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="c1"># 博客列表页</span>
<span class="k">def</span> <span class="nf">blog_list</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="c1"># add()</span>
    <span class="n">context</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">page_num</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">GET</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;page&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>  <span class="c1"># 通过request获取当前页码,默认是第一页</span>
    <span class="n">blogs_all_list</span> <span class="o">=</span> <span class="n">Blog</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>  <span class="c1"># 获取全部博客列表,并存储到对象里</span>
    <span class="n">paginator</span> <span class="o">=</span> <span class="n">Paginator</span><span class="p">(</span><span class="n">blogs_all_list</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>  <span class="c1"># 使用分页组件,参数为 -&gt; ( 需要分页的集合(全部博客列表) , 每页显示几条 ) , 返回一个分页对象,这个对象中包含需要分页的集合数据</span>
    <span class="n">page</span> <span class="o">=</span> <span class="n">paginator</span><span class="o">.</span><span class="n">get_page</span><span class="p">(</span><span class="n">page_num</span><span class="p">)</span>  <span class="c1"># 向分页对象的get_page方法传参数,获取第几页的全部数据,并返回一个对象</span>
  
    <span class="n">current_page_number</span> <span class="o">=</span> <span class="n">page</span><span class="o">.</span><span class="n">number</span>  <span class="c1"># 当前页</span>
    <span class="c1"># 当前页的前两页,当前页和当前页的后两页</span>
    <span class="c1"># context[&#39;many_page_hide_list&#39;] = [current_page_number - 2, current_page_number - 1, current_page_number, current_page_number + 1, current_page_number + 2]</span>
  
    <span class="c1"># 分页数组 : [当前页的第前两个,当前页的前一个,当前页,当前页的后一个,当前页的第后两个] -&gt; 前端遍历页码图标,遍历的就是这五个</span>
    <span class="c1"># 从当前页的前两页到当前页(前两页的页码,和第一页比对大小,取大的,这样就保证了前两页的第一页的页码,最小是1) - 左闭右开</span>
    <span class="c1"># 从当前页到最后一页(后两页最后一页的页码,和&#34;一共有多少页&#34;作比较,取小的,即使是点击最后一页,当前页后面的两页的页码比当前页(最后一页)大,取的也是最后一页)</span>
    <span class="c1"># python3的range方法返回的不是list,需要使用list转一下</span>
    <span class="n">many_page_hide_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
                                 <span class="nb">range</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">current_page_number</span> <span class="o">-</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">current_page_number</span><span class="p">)</span>
                              <span class="p">)</span> <span class="o">+</span> \
                          <span class="nb">list</span><span class="p">(</span>
                                <span class="c1"># 分页对象.num_pages, 分页器中一共有多少页</span>
                                 <span class="nb">range</span><span class="p">(</span><span class="n">current_page_number</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="n">current_page_numr</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span> <span class="n">paginator</span><span class="o">.</span><span class="n">num_pages</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
                              <span class="p">)</span>
  
    <span class="c1"># 如果当前分页数组中,第一页的页码大于3,就是说前面至少有两个页码图标,那就向数组最前面添加省略号</span>
    <span class="k">if</span> <span class="n">many_page_hide_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">many_page_hide_list</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;...&#39;</span><span class="p">)</span>
    <span class="c1"># 如果当前分页数组中,最后一页的页码(当前页的后两个的第二个)比(全部数据的最后一页,真正的最后一页)往前2个,就是说 数组中的最后一页 的后面至少有两个页码图标,那就向数组最后面添加省略号</span>
    <span class="k">if</span> <span class="n">paginator</span><span class="o">.</span><span class="n">num_pages</span> <span class="o">-</span> <span class="n">many_page_hide_list</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">many_page_hide_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;...&#39;</span><span class="p">)</span>
    <span class="c1"># 如果当前分页数组中,第一个不是第一页,也就是说当前页的前两个的第一个不是全部数据的第一页,那就把第一页插入到当前分页数组的最前面(因为这样方便从后面比较大的数字直接跳回到第一页)</span>
    <span class="k">if</span> <span class="n">many_page_hide_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">many_page_hide_list</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">many_page_hide_list</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="n">paginator</span><span class="o">.</span><span class="n">num_pages</span><span class="p">:</span>
        <span class="n">many_page_hide_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">paginator</span><span class="o">.</span><span class="n">num_pages</span><span class="p">)</span>
  
    <span class="n">context</span><span class="p">[</span><span class="s1">&#39;many_page_hide_list&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">many_page_hide_list</span>
  
    <span class="n">context</span><span class="p">[</span><span class="s1">&#39;page&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">page</span>
    <span class="c1"># context[&#39;blogs_count&#39;] = Blog.objects.all().count()</span>
    <span class="n">context</span><span class="p">[</span><span class="s1">&#39;blog_types&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">BlogType</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>  <span class="c1"># 博客列表页面,右侧,博客分类数据</span>
    <span class="k">return</span> <span class="n">render_to_response</span><span class="p">(</span><span class="s1">&#39;blog/blog_list.html&#39;</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>博客列表页</p>
<p><code>blog.html</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html">{% extends &#39;base.html&#39; %}
  
{% block title %}{{ blog_type.type_name }}{% endblock %}
  
{% block content %}
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;container&#34;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;row&#34;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;col-sm-8 col-lg-8&#34;</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;panel panel-default&#34;</span><span class="p">&gt;</span>
                  {# page是当前页对象 paginator是整个大的分页对象 当前分页对象.paginator,就是回调到整个大的分页对象 当前分页对象.paginator.count,就是整个大的分页对象中全部内容的长度 #}
                  <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;panel-heading&#34;</span><span class="p">&gt;</span>一共有{{ page.paginator.count }}篇博客<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
                      <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;panel-body&#34;</span><span class="p">&gt;</span>
                        {# 遍历当前页的全部数据 #}
                        {% for blog in page.object_list %}
                            <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;blog&#34;</span><span class="p">&gt;</span>
                                <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;{% url &#39;blog_detail&#39; blog.pk %}&#34;</span><span class="p">&gt;</span>
                                    <span class="p">&lt;</span><span class="nt">h3</span><span class="p">&gt;</span>{{blog.title}}<span class="p">&lt;/</span><span class="nt">h3</span><span class="p">&gt;</span>
                                    <span class="p">&lt;</span><span class="nt">p</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;blog_info&#34;</span><span class="p">&gt;</span>
                                        <span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;glyphicon glyphicon-star&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
                                        <span class="p">&lt;</span><span class="nt">span</span><span class="p">&gt;</span>
                                            分类: <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;{% url &#39;blog_with_type&#39; blog.blog_type.pk %}&#34;</span><span class="p">&gt;</span>{{ blog.blog_type }}<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
                                        <span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
                                        <span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;glyphicon glyphicon-time&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
                                        <span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;blog_list_li_date&#34;</span><span class="p">&gt;</span>
                                            发表日期:{{ blog.create_time | date:&#34;Y-m-d&#34;}}
                                        <span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
                                    <span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
                                <span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
                                <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>{{blog.content | truncatechars:30}}<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
                            <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
                        {% empty %}
                            <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>暂无博客<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
                        {% endfor %}
                      <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
                <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
  
                {# 分页图标 #}
                <span class="p">&lt;</span><span class="nt">nav</span> <span class="na">aria-label</span><span class="o">=</span><span class="s">&#34;Page navigation&#34;</span><span class="p">&gt;</span>
                  <span class="p">&lt;</span><span class="nt">ul</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;pagination&#34;</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;</span>
                        {# 当前页对象.has_previous -&gt; 前一页 #}
                        {% if page.has_previous %}
                            {# django中,在href内写 ?xxx,就是在当前页面的路由后面拼接上href中的内容,点击还会跳转 #}
                            {# 当前页对象.previous_page_number -&gt; 当前页的前一页 #}
                            <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;?page={{ page.previous_page_number }}&#34;</span> <span class="na">aria-label</span><span class="o">=</span><span class="s">&#34;Previous&#34;</span><span class="p">&gt;</span>
                                <span class="p">&lt;</span><span class="nt">span</span> <span class="na">aria-hidden</span><span class="o">=</span><span class="s">&#34;true&#34;</span><span class="p">&gt;</span><span class="ni">&amp;laquo;</span><span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
                            <span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
                        {% else %}
                            <span class="p">&lt;</span><span class="nt">span</span> <span class="na">aria-hidden</span><span class="o">=</span><span class="s">&#34;true&#34;</span><span class="p">&gt;</span><span class="ni">&amp;laquo;</span><span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
                        {% endif %}
                    <span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
                    {# 这里遍历的是 当前页的前两页 当前页 当前页的后两页 #}
                    {# 当前页对象.paginator.page_range -&gt; 返回整个分页对象,一共有几页 #}
                    {% for page_child in many_page_hide_list %}
{#                    {% for page_child in page.paginator.page_range %}#}
                        {% if page_child == page.number %}
                            <span class="p">&lt;</span><span class="nt">li</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;active&#34;</span><span class="p">&gt;</span>
                                <span class="p">&lt;</span><span class="nt">span</span><span class="p">&gt;</span>{{ page_child }}<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
                            <span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
                        {% else %}
                            {% if page_child == &#39;...&#39; %}
                                <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;</span>
                                   <span class="p">&lt;</span><span class="nt">span</span><span class="p">&gt;</span>{{ page_child }}<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
                                <span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
                            {% else %}
                                <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;</span>
                                    <span class="p">&lt;</span><span class="nt">span</span><span class="p">&gt;</span>
                                        <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;?page={{ page_child }}&#34;</span><span class="p">&gt;</span>{{ page_child }}<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
                                    <span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
                                <span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
                            {% endif %}
                        {% endif %}
                    {% endfor %}
  
                    <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;</span>
                        {# 当前页对象.has_next -&gt; 后一页 #}
                        {% if page.has_next %}
                        {# 当前页对象.next_page_number -&gt; 当前页的后一页 #}
                          <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;?page={{ page.next_page_number }}&#34;</span> <span class="na">aria-label</span><span class="o">=</span><span class="s">&#34;Next&#34;</span><span class="p">&gt;</span>
                            <span class="p">&lt;</span><span class="nt">span</span> <span class="na">aria-hidden</span><span class="o">=</span><span class="s">&#34;true&#34;</span><span class="p">&gt;</span><span class="ni">&amp;raquo;</span><span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
                          <span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
                        {% else %}
                            <span class="p">&lt;</span><span class="nt">span</span> <span class="na">aria-hidden</span><span class="o">=</span><span class="s">&#34;true&#34;</span><span class="p">&gt;</span><span class="ni">&amp;raquo;</span><span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
                        {% endif %}
                    <span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
                  <span class="p">&lt;/</span><span class="nt">ul</span><span class="p">&gt;</span>
                <span class="p">&lt;/</span><span class="nt">nav</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;col-sm-4 col-lg-4&#34;</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;panel panel-default&#34;</span><span class="p">&gt;</span>
                   <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;panel-heading&#34;</span><span class="p">&gt;</span>博客分类<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
                       <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;panel-body&#34;</span><span class="p">&gt;</span>
                           <span class="p">&lt;</span><span class="nt">ul</span><span class="p">&gt;</span>
                               {% for blog_type in blog_types %}
                                   <span class="p">&lt;</span><span class="nt">li</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;blog_list_li&#34;</span><span class="p">&gt;&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;{% url &#39;blog_with_type&#39; blog_type.pk %}&#34;</span><span class="p">&gt;</span>{{ blog_type.type_name }}<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
                               {% empty %}
                                   <span class="p">&lt;</span><span class="nt">li</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;blog_list_li&#34;</span><span class="p">&gt;</span>暂无分类<span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
                               {% endfor %}
                           <span class="p">&lt;/</span><span class="nt">ul</span><span class="p">&gt;</span>
                       <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
                <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
{% endblock %}
</code></pre></td></tr></table>
</div>
</div></li>
</ul>
<h4 id="全部代码-6">全部代码</h4>
<p><code>views.py</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span><span class="lnt">78
</span><span class="lnt">79
</span><span class="lnt">80
</span><span class="lnt">81
</span><span class="lnt">82
</span><span class="lnt">83
</span><span class="lnt">84
</span><span class="lnt">85
</span><span class="lnt">86
</span><span class="lnt">87
</span><span class="lnt">88
</span><span class="lnt">89
</span><span class="lnt">90
</span><span class="lnt">91
</span><span class="lnt">92
</span><span class="lnt">93
</span><span class="lnt">94
</span><span class="lnt">95
</span><span class="lnt">96
</span><span class="lnt">97
</span><span class="lnt">98
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">django.shortcuts</span> <span class="kn">import</span> <span class="n">render_to_response</span><span class="p">,</span> <span class="n">get_object_or_404</span>
<span class="kn">from</span> <span class="nn">.models</span> <span class="kn">import</span> <span class="n">Blog</span><span class="p">,</span> <span class="n">BlogType</span>
<span class="kn">from</span> <span class="nn">django.core.paginator</span> <span class="kn">import</span> <span class="n">Paginator</span>
<span class="kn">from</span> <span class="nn">django.contrib.auth.models</span> <span class="kn">import</span> <span class="n">User</span>

<span class="c1"># 批量添加数据</span>
<span class="k">def</span> <span class="nf">add</span><span class="p">():</span>
    <span class="n">blog_type</span> <span class="o">=</span> <span class="n">BlogType</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">user</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">30</span><span class="p">):</span>
        <span class="n">Blog</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;第&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;个&#39;</span><span class="p">,</span> <span class="n">blog_type</span><span class="o">=</span><span class="n">blog_type</span><span class="p">,</span> <span class="n">content</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="n">author</span><span class="o">=</span><span class="n">user</span><span class="p">)</span>


<span class="c1"># 博客列表页</span>
<span class="k">def</span> <span class="nf">blog_list</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="c1"># add()</span>
    <span class="n">context</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">page_num</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">GET</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;page&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>  <span class="c1"># 通过request获取当前页码,默认是第一页</span>
    <span class="n">blogs_all_list</span> <span class="o">=</span> <span class="n">Blog</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>  <span class="c1"># 获取全部博客列表,并存储到对象里</span>
    <span class="n">paginator</span> <span class="o">=</span> <span class="n">Paginator</span><span class="p">(</span><span class="n">blogs_all_list</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>  <span class="c1"># 使用分页组件,参数为 -&gt; ( 需要分页的集合(全部博客列表) , 每页显示几条 ) , 返回一个分页对象,这个对象中包含需要分页的集合数据</span>
    <span class="n">page</span> <span class="o">=</span> <span class="n">paginator</span><span class="o">.</span><span class="n">get_page</span><span class="p">(</span><span class="n">page_num</span><span class="p">)</span>  <span class="c1"># 向分页对象的get_page方法传参数,获取第几页的全部数据,并返回一个对象</span>

    <span class="n">current_page_number</span> <span class="o">=</span> <span class="n">page</span><span class="o">.</span><span class="n">number</span>  <span class="c1"># 当前页</span>
    <span class="c1"># 当前页的前两页,当前页和当前页的后两页</span>
    <span class="c1"># context[&#39;many_page_hide_list&#39;] = [current_page_number - 2, current_page_number - 1, current_page_number, current_page_number + 1, current_page_number + 2]</span>

    <span class="c1"># 分页数组 : [当前页的第前两个,当前页的前一个,当前页,当前页的后一个,当前页的第后两个] -&gt; 前端遍历页码图标,遍历的就是这五个</span>
    <span class="c1"># 从当前页的前两页到当前页(前两页的页码,和第一页比对大小,取大的,这样就保证了前两页的第一页的页码,最小是1) - 左闭右开</span>
    <span class="c1"># 从当前页到最后一页(后两页最后一页的页码,和&#34;一共有多少页&#34;作比较,取小的,即使是点击最后一页,当前页后面的两页的页码比当前页(最后一页)大,取的也是最后一页)</span>
    <span class="c1"># python3的range方法返回的不是list,需要使用list转一下</span>
    <span class="n">many_page_hide_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
                                 <span class="nb">range</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">current_page_number</span> <span class="o">-</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">current_page_number</span><span class="p">)</span>
                              <span class="p">)</span> <span class="o">+</span> \
                          <span class="nb">list</span><span class="p">(</span>
                                <span class="c1"># 分页对象.num_pages, 分页器中一共有多少页</span>
                                 <span class="nb">range</span><span class="p">(</span><span class="n">current_page_number</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="n">current_page_numr</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span> <span class="n">paginator</span><span class="o">.</span><span class="n">num_pages</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
                              <span class="p">)</span>

    <span class="c1"># 如果当前分页数组中,第一页的页码大于3,就是说前面至少有两个页码图标,那就向数组最前面添加省略号</span>
    <span class="k">if</span> <span class="n">many_page_hide_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">many_page_hide_list</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;...&#39;</span><span class="p">)</span>
    <span class="c1"># 如果当前分页数组中,最后一页的页码(当前页的后两个的第二个)比(全部数据的最后一页,真正的最后一页)往前2个,就是说 数组中的最后一页 的后面至少有两个页码图标,那就向数组最后面添加省略号</span>
    <span class="k">if</span> <span class="n">paginator</span><span class="o">.</span><span class="n">num_pages</span> <span class="o">-</span> <span class="n">many_page_hide_list</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">many_page_hide_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;...&#39;</span><span class="p">)</span>
    <span class="c1"># 如果当前分页数组中,第一个不是第一页,也就是说当前页的前两个的第一个不是全部数据的第一页,那就把第一页插入到当前分页数组的最前面(因为这样方便从后面比较大的数字直接跳回到第一页)</span>
    <span class="k">if</span> <span class="n">many_page_hide_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">many_page_hide_list</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">many_page_hide_list</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="n">paginator</span><span class="o">.</span><span class="n">num_pages</span><span class="p">:</span>
        <span class="n">many_page_hide_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">paginator</span><span class="o">.</span><span class="n">num_pages</span><span class="p">)</span>

    <span class="n">context</span><span class="p">[</span><span class="s1">&#39;many_page_hide_list&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">many_page_hide_list</span>

    <span class="n">context</span><span class="p">[</span><span class="s1">&#39;page&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">page</span>
    <span class="c1"># context[&#39;blogs_count&#39;] = Blog.objects.all().count()</span>
    <span class="n">context</span><span class="p">[</span><span class="s1">&#39;blog_types&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">BlogType</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>  <span class="c1"># 博客列表页面,右侧,博客分类数据</span>
    <span class="k">return</span> <span class="n">render_to_response</span><span class="p">(</span><span class="s1">&#39;blog/blog_list.html&#39;</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>


<span class="c1"># 博客详情页</span>
<span class="k">def</span> <span class="nf">blog_detail</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">blog_pk</span><span class="p">):</span>
    <span class="n">context</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">context</span><span class="p">[</span><span class="s1">&#39;blog&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_object_or_404</span><span class="p">(</span><span class="n">Blog</span><span class="p">,</span> <span class="n">pk</span><span class="o">=</span><span class="n">blog_pk</span><span class="p">)</span>  <span class="c1"># get_object_or_404,因为有可能获取不到</span>
    <span class="k">return</span> <span class="n">render_to_response</span><span class="p">(</span><span class="s1">&#39;blog/blog_detail.html&#39;</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>


<span class="c1"># 指定分类列表页</span>
<span class="k">def</span> <span class="nf">blogs_with_type</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">blog_type_pk</span><span class="p">):</span>
    <span class="n">context</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="n">blog_type</span> <span class="o">=</span> <span class="n">get_object_or_404</span><span class="p">(</span><span class="n">BlogType</span><span class="p">,</span> <span class="n">pk</span><span class="o">=</span><span class="n">blog_type_pk</span><span class="p">)</span>
    <span class="n">page_num</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">GET</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;page&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">blogs_all_list</span> <span class="o">=</span> <span class="n">Blog</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">blog_type</span><span class="o">=</span><span class="n">blog_type</span><span class="p">)</span>
    <span class="n">paginator</span> <span class="o">=</span> <span class="n">Paginator</span><span class="p">(</span><span class="n">blogs_all_list</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
    <span class="n">page</span> <span class="o">=</span> <span class="n">paginator</span><span class="o">.</span><span class="n">get_page</span><span class="p">(</span><span class="n">page_num</span><span class="p">)</span>

    <span class="n">current_page_number</span> <span class="o">=</span> <span class="n">page</span><span class="o">.</span><span class="n">number</span>
    <span class="n">many_page_hide_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
                              <span class="nb">range</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">current_page_number</span> <span class="o">-</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">current_page_number</span><span class="p">)</span>
                          <span class="p">)</span> <span class="o">+</span> \
                          <span class="nb">list</span><span class="p">(</span>
                              <span class="nb">range</span><span class="p">(</span><span class="n">current_page_number</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="n">current_page_number</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span> <span class="n">paginator</span><span class="o">.</span><span class="n">num_pages</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
                          <span class="p">)</span>

    <span class="k">if</span> <span class="n">many_page_hide_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">many_page_hide_list</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;...&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">paginator</span><span class="o">.</span><span class="n">num_pages</span> <span class="o">-</span> <span class="n">many_page_hide_list</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">many_page_hide_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">paginator</span><span class="o">.</span><span class="n">num_pages</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">many_page_hide_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">many_page_hide_list</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">many_page_hide_list</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="n">paginator</span><span class="o">.</span><span class="n">num_pages</span><span class="p">:</span>
        <span class="n">many_page_hide_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">paginator</span><span class="o">.</span><span class="n">num_pages</span><span class="p">)</span>

    <span class="n">context</span><span class="p">[</span><span class="s1">&#39;many_page_hide_list&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">many_page_hide_list</span>
    <span class="n">context</span><span class="p">[</span><span class="s1">&#39;page&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">page</span>
    <span class="n">context</span><span class="p">[</span><span class="s1">&#39;blogs&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Blog</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">blog_type</span><span class="o">=</span><span class="n">blog_type</span><span class="p">)</span>
    <span class="n">context</span><span class="p">[</span><span class="s1">&#39;blog_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">blog_type</span>
    <span class="n">context</span><span class="p">[</span><span class="s1">&#39;blog_types&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">BlogType</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>  <span class="c1"># 博客列表页面,右侧,博客分类数据</span>
    <span class="k">return</span> <span class="n">render_to_response</span><span class="p">(</span><span class="s1">&#39;blog/blog_with_type.html&#39;</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><p><code>blog_list.html</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html">{% extends &#39;base.html&#39; %}

{% block title %}blog_list{% endblock %}

{% block nav_blog_active %}active{% endblock %}

{% block content %}
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;container&#34;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;row&#34;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;col-sm-8 col-lg-8&#34;</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;panel panel-default&#34;</span><span class="p">&gt;</span>
                  {# page是当前页对象 paginator是整个大的分页对象 当前分页对象.paginator,就是回调到整个大的分页对象 当前分页对象.paginator.count,就是整个大的分页对象中全部内容的长度 #}
                  <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;panel-heading&#34;</span><span class="p">&gt;</span>一共有{{ page.paginator.count }}篇博客<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
                      <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;panel-body&#34;</span><span class="p">&gt;</span>
                        {# 遍历当前页的全部数据 #}
                        {% for blog in page.object_list %}
                            <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;blog&#34;</span><span class="p">&gt;</span>
                                <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;{% url &#39;blog_detail&#39; blog.pk %}&#34;</span><span class="p">&gt;</span>
                                    <span class="p">&lt;</span><span class="nt">h3</span><span class="p">&gt;</span>{{blog.title}}<span class="p">&lt;/</span><span class="nt">h3</span><span class="p">&gt;</span>
                                    <span class="p">&lt;</span><span class="nt">p</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;blog_info&#34;</span><span class="p">&gt;</span>
                                        <span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;glyphicon glyphicon-star&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
                                        <span class="p">&lt;</span><span class="nt">span</span><span class="p">&gt;</span>
                                            分类: <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;{% url &#39;blog_with_type&#39; blog.blog_type.pk %}&#34;</span><span class="p">&gt;</span>{{ blog.blog_type }}<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
                                        <span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
                                        <span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;glyphicon glyphicon-time&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
                                        <span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;blog_list_li_date&#34;</span><span class="p">&gt;</span>
                                            发表日期:{{ blog.create_time | date:&#34;Y-m-d&#34;}}
                                        <span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
                                    <span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
                                <span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
                                <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>{{blog.content | truncatechars:30}}<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
                            <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
                        {% empty %}
                            <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>暂无博客<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
                        {% endfor %}
                      <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
                <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

                {# 分页图标 #}
                <span class="p">&lt;</span><span class="nt">nav</span> <span class="na">aria-label</span><span class="o">=</span><span class="s">&#34;Page navigation&#34;</span><span class="p">&gt;</span>
                  <span class="p">&lt;</span><span class="nt">ul</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;pagination&#34;</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;</span>
                        {# 当前页对象.has_previous -&gt; 前一页 #}
                        {% if page.has_previous %}
                            {# django中,在href内写 ?xxx,就是在当前页面的路由后面拼接上href中的内容,点击还会跳转 #}
                            {# 当前页对象.previous_page_number -&gt; 当前页的前一页 #}
                            <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;?page={{ page.previous_page_number }}&#34;</span> <span class="na">aria-label</span><span class="o">=</span><span class="s">&#34;Previous&#34;</span><span class="p">&gt;</span>
                                <span class="p">&lt;</span><span class="nt">span</span> <span class="na">aria-hidden</span><span class="o">=</span><span class="s">&#34;true&#34;</span><span class="p">&gt;</span><span class="ni">&amp;laquo;</span><span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
                            <span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
                        {% else %}
                            <span class="p">&lt;</span><span class="nt">span</span> <span class="na">aria-hidden</span><span class="o">=</span><span class="s">&#34;true&#34;</span><span class="p">&gt;</span><span class="ni">&amp;laquo;</span><span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
                        {% endif %}
                    <span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
                    {# 这里遍历的是 当前页的前两页 当前页 当前页的后两页 #}
                    {# 当前页对象.paginator.page_range -&gt; 返回整个分页对象,一共有几页 #}
                    {% for page_child in many_page_hide_list %}
{#                    {% for page_child in page.paginator.page_range %}#}
                        {% if page_child == page.number %}
                            <span class="p">&lt;</span><span class="nt">li</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;active&#34;</span><span class="p">&gt;</span>
                                <span class="p">&lt;</span><span class="nt">span</span><span class="p">&gt;</span>{{ page_child }}<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
                            <span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
                        {% else %}
                            {% if page_child == &#39;...&#39; %}
                                <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;</span>
                                   <span class="p">&lt;</span><span class="nt">span</span><span class="p">&gt;</span>{{ page_child }}<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
                                <span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
                            {% else %}
                                <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;</span>
                                    <span class="p">&lt;</span><span class="nt">span</span><span class="p">&gt;</span>
                                        <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;?page={{ page_child }}&#34;</span><span class="p">&gt;</span>{{ page_child }}<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
                                    <span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
                                <span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
                            {% endif %}
                        {% endif %}
                    {% endfor %}

                    <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;</span>
                        {# 当前页对象.has_next -&gt; 后一页 #}
                        {% if page.has_next %}
                        {# 当前页对象.next_page_number -&gt; 当前页的后一页 #}
                          <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;?page={{ page.next_page_number }}&#34;</span> <span class="na">aria-label</span><span class="o">=</span><span class="s">&#34;Next&#34;</span><span class="p">&gt;</span>
                            <span class="p">&lt;</span><span class="nt">span</span> <span class="na">aria-hidden</span><span class="o">=</span><span class="s">&#34;true&#34;</span><span class="p">&gt;</span><span class="ni">&amp;raquo;</span><span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
                          <span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
                        {% else %}
                            <span class="p">&lt;</span><span class="nt">span</span> <span class="na">aria-hidden</span><span class="o">=</span><span class="s">&#34;true&#34;</span><span class="p">&gt;</span><span class="ni">&amp;raquo;</span><span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
                        {% endif %}
                    <span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
                  <span class="p">&lt;/</span><span class="nt">ul</span><span class="p">&gt;</span>
                <span class="p">&lt;/</span><span class="nt">nav</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;col-sm-4 col-lg-4&#34;</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;panel panel-default&#34;</span><span class="p">&gt;</span>
                   <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;panel-heading&#34;</span><span class="p">&gt;</span>博客分类<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
                       <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;panel-body&#34;</span><span class="p">&gt;</span>
                           <span class="p">&lt;</span><span class="nt">ul</span><span class="p">&gt;</span>
                               {% for blog_type in blog_types %}
                                   <span class="p">&lt;</span><span class="nt">li</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;blog_list_li&#34;</span><span class="p">&gt;&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;{% url &#39;blog_with_type&#39; blog_type.pk %}&#34;</span><span class="p">&gt;</span>{{ blog_type.type_name }}<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
                               {% empty %}
                                   <span class="p">&lt;</span><span class="nt">li</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;blog_list_li&#34;</span><span class="p">&gt;</span>暂无分类<span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
                               {% endfor %}
                           <span class="p">&lt;/</span><span class="nt">ul</span><span class="p">&gt;</span>
                       <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
                <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
{% endblock %}
</code></pre></td></tr></table>
</div>
</div><p><code>blog_with_type.html</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html">{% extends &#39;base.html&#39; %}

{% block title %}{{ blog_type.type_name }}{% endblock %}

{% block content %}
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;container&#34;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;row&#34;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;col-sm-8 col-lg-8&#34;</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;panel panel-default&#34;</span><span class="p">&gt;</span>
                  {# page是当前页对象 paginator是整个大的分页对象 当前分页对象.paginator,就是回调到整个大的分页对象 当前分页对象.paginator.count,就是整个大的分页对象中全部内容的长度 #}
                  <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;panel-heading&#34;</span><span class="p">&gt;</span>一共有{{ page.paginator.count }}篇博客<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
                      <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;panel-body&#34;</span><span class="p">&gt;</span>
                        {# 遍历当前页的全部数据 #}
                        {% for blog in page.object_list %}
                            <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;blog&#34;</span><span class="p">&gt;</span>
                                <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;{% url &#39;blog_detail&#39; blog.pk %}&#34;</span><span class="p">&gt;</span>
                                    <span class="p">&lt;</span><span class="nt">h3</span><span class="p">&gt;</span>{{blog.title}}<span class="p">&lt;/</span><span class="nt">h3</span><span class="p">&gt;</span>
                                    <span class="p">&lt;</span><span class="nt">p</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;blog_info&#34;</span><span class="p">&gt;</span>
                                        <span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;glyphicon glyphicon-star&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
                                        <span class="p">&lt;</span><span class="nt">span</span><span class="p">&gt;</span>
                                            分类: <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;{% url &#39;blog_with_type&#39; blog.blog_type.pk %}&#34;</span><span class="p">&gt;</span>{{ blog.blog_type }}<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
                                        <span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
                                        <span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;glyphicon glyphicon-time&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
                                        <span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;blog_list_li_date&#34;</span><span class="p">&gt;</span>
                                            发表日期:{{ blog.create_time | date:&#34;Y-m-d&#34;}}
                                        <span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
                                    <span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
                                <span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
                                <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>{{blog.content | truncatechars:30}}<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
                            <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
                        {% empty %}
                            <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>暂无博客<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
                        {% endfor %}
                      <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
                <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

                {# 分页图标 #}
                <span class="p">&lt;</span><span class="nt">nav</span> <span class="na">aria-label</span><span class="o">=</span><span class="s">&#34;Page navigation&#34;</span><span class="p">&gt;</span>
                  <span class="p">&lt;</span><span class="nt">ul</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;pagination&#34;</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;</span>
                        {# 当前页对象.has_previous -&gt; 前一页 #}
                        {% if page.has_previous %}
                            {# django中,在href内写 ?xxx,就是在当前页面的路由后面拼接上href中的内容,点击还会跳转 #}
                            {# 当前页对象.previous_page_number -&gt; 当前页的前一页 #}
                            <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;?page={{ page.previous_page_number }}&#34;</span> <span class="na">aria-label</span><span class="o">=</span><span class="s">&#34;Previous&#34;</span><span class="p">&gt;</span>
                                <span class="p">&lt;</span><span class="nt">span</span> <span class="na">aria-hidden</span><span class="o">=</span><span class="s">&#34;true&#34;</span><span class="p">&gt;</span><span class="ni">&amp;laquo;</span><span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
                            <span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
                        {% else %}
                            <span class="p">&lt;</span><span class="nt">span</span> <span class="na">aria-hidden</span><span class="o">=</span><span class="s">&#34;true&#34;</span><span class="p">&gt;</span><span class="ni">&amp;laquo;</span><span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
                        {% endif %}
                    <span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
                    {# 这里遍历的是 当前页的前两页 当前页 当前页的后两页 #}
                    {# 当前页对象.paginator.page_range -&gt; 返回整个分页对象,一共有几页 #}
                    {% for page_child in many_page_hide_list %}
{#                    {% for page_child in page.paginator.page_range %}#}
                        {% if page_child == page.number %}
                            <span class="p">&lt;</span><span class="nt">li</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;active&#34;</span><span class="p">&gt;</span>
                                <span class="p">&lt;</span><span class="nt">span</span><span class="p">&gt;</span>{{ page_child }}<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
                            <span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
                        {% else %}
                            {% if page_child == &#39;...&#39; %}
                                <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;</span>
                                   <span class="p">&lt;</span><span class="nt">span</span><span class="p">&gt;</span>{{ page_child }}<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
                                <span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
                            {% else %}
                                <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;</span>
                                    <span class="p">&lt;</span><span class="nt">span</span><span class="p">&gt;</span>
                                        <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;?page={{ page_child }}&#34;</span><span class="p">&gt;</span>{{ page_child }}<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
                                    <span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
                                <span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
                            {% endif %}
                        {% endif %}
                    {% endfor %}

                    <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;</span>
                        {# 当前页对象.has_next -&gt; 后一页 #}
                        {% if page.has_next %}
                        {# 当前页对象.next_page_number -&gt; 当前页的后一页 #}
                          <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;?page={{ page.next_page_number }}&#34;</span> <span class="na">aria-label</span><span class="o">=</span><span class="s">&#34;Next&#34;</span><span class="p">&gt;</span>
                            <span class="p">&lt;</span><span class="nt">span</span> <span class="na">aria-hidden</span><span class="o">=</span><span class="s">&#34;true&#34;</span><span class="p">&gt;</span><span class="ni">&amp;raquo;</span><span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
                          <span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
                        {% else %}
                            <span class="p">&lt;</span><span class="nt">span</span> <span class="na">aria-hidden</span><span class="o">=</span><span class="s">&#34;true&#34;</span><span class="p">&gt;</span><span class="ni">&amp;raquo;</span><span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
                        {% endif %}
                    <span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
                  <span class="p">&lt;/</span><span class="nt">ul</span><span class="p">&gt;</span>
                <span class="p">&lt;/</span><span class="nt">nav</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;col-sm-4 col-lg-4&#34;</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;panel panel-default&#34;</span><span class="p">&gt;</span>
                   <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;panel-heading&#34;</span><span class="p">&gt;</span>博客分类<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
                       <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;panel-body&#34;</span><span class="p">&gt;</span>
                           <span class="p">&lt;</span><span class="nt">ul</span><span class="p">&gt;</span>
                               {% for blog_type in blog_types %}
                                   <span class="p">&lt;</span><span class="nt">li</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;blog_list_li&#34;</span><span class="p">&gt;&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;{% url &#39;blog_with_type&#39; blog_type.pk %}&#34;</span><span class="p">&gt;</span>{{ blog_type.type_name }}<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
                               {% empty %}
                                   <span class="p">&lt;</span><span class="nt">li</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;blog_list_li&#34;</span><span class="p">&gt;</span>暂无分类<span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
                               {% endfor %}
                           <span class="p">&lt;/</span><span class="nt">ul</span><span class="p">&gt;</span>
                       <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
                <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
{% endblock %}
</code></pre></td></tr></table>
</div>
</div><h2 id="前一篇博客和后一篇博客">前一篇博客和后一篇博客</h2>
<p><code>views.py</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="c1"># 博客详情页</span>
<span class="k">def</span> <span class="nf">blog_detail</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">blog_pk</span><span class="p">):</span>
    <span class="n">context</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">blog</span> <span class="o">=</span> <span class="n">get_object_or_404</span><span class="p">(</span><span class="n">Blog</span><span class="p">,</span> <span class="n">pk</span><span class="o">=</span><span class="n">blog_pk</span><span class="p">)</span>
    <span class="n">context</span><span class="p">[</span><span class="s1">&#39;blog&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_object_or_404</span><span class="p">(</span><span class="n">Blog</span><span class="p">,</span> <span class="n">pk</span><span class="o">=</span><span class="n">blog_pk</span><span class="p">)</span>  <span class="c1"># get_object_or_404,因为有可能获取不到</span>

    <span class="c1"># 属性后面加上 __,后面就可以写 gt(大于)、lt(小于)这种判断过滤器</span>
    <span class="n">context</span><span class="p">[</span><span class="s1">&#39;previous_blog&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Blog</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">create_time__gt</span><span class="o">=</span><span class="n">blog</span><span class="o">.</span><span class="n">create_time</span><span class="p">)</span><span class="o">.</span><span class="n">last</span><span class="p">()</span>  <span class="c1"># 前一篇博客,筛选出大于当前博客(创建时间)的博客,并获取到这些博客的最后一个</span>
    <span class="n">context</span><span class="p">[</span><span class="s1">&#39;next_blog&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Blog</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">create_time__lt</span><span class="o">=</span><span class="n">blog</span><span class="o">.</span><span class="n">create_time</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>  <span class="c1"># 后一篇博客,筛选出小于当前博客(创建时间)的博客,并获取到这些博客的第一个</span>
    <span class="k">return</span> <span class="n">render_to_response</span><span class="p">(</span><span class="s1">&#39;blog/blog_detail.html&#39;</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><ul>
<li>
<p>views.py</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">django.shortcuts</span> <span class="kn">import</span> <span class="n">render_to_response</span><span class="p">,</span> <span class="n">get_object_or_404</span>
<span class="kn">from</span> <span class="nn">.models</span> <span class="kn">import</span> <span class="n">Blog</span><span class="p">,</span> <span class="n">BlogType</span>
<span class="kn">from</span> <span class="nn">django.core.paginator</span> <span class="kn">import</span> <span class="n">Paginator</span>
<span class="kn">from</span> <span class="nn">django.contrib.auth.models</span> <span class="kn">import</span> <span class="n">User</span>
  
<span class="c1"># 批量添加数据</span>
<span class="k">def</span> <span class="nf">add</span><span class="p">():</span>
    <span class="n">blog_type</span> <span class="o">=</span> <span class="n">BlogType</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">user</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">30</span><span class="p">):</span>
        <span class="n">Blog</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;第&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;个&#39;</span><span class="p">,</span> <span class="n">blog_type</span><span class="o">=</span><span class="n">blog_type</span><span class="p">,</span> <span class="n">content</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="n">author</span><span class="o">=</span><span class="n">user</span><span class="p">)</span>
  
  
<span class="c1"># 博客列表页</span>
<span class="k">def</span> <span class="nf">blog_list</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="c1"># add()</span>
    <span class="n">context</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">page_num</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">GET</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;page&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>  <span class="c1"># 通过request获取当前页码,默认是第一页</span>
    <span class="n">blogs_all_list</span> <span class="o">=</span> <span class="n">Blog</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>  <span class="c1"># 获取全部博客列表,并存储到对象里</span>
    <span class="n">paginator</span> <span class="o">=</span> <span class="n">Paginator</span><span class="p">(</span><span class="n">blogs_all_list</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>  <span class="c1"># 使用分页组件,参数为 -&gt; ( 需要分页的集合(全部博客列表) , 每页显示几条 ) , 返回一个分页对象,这个对象中包含需要分页的集合数据</span>
    <span class="n">page</span> <span class="o">=</span> <span class="n">paginator</span><span class="o">.</span><span class="n">get_page</span><span class="p">(</span><span class="n">page_num</span><span class="p">)</span>  <span class="c1"># 向分页对象的get_page方法传参数,获取第几页的全部数据,并返回一个对象</span>
  
    <span class="n">current_page_number</span> <span class="o">=</span> <span class="n">page</span><span class="o">.</span><span class="n">number</span>  <span class="c1"># 当前页</span>
    <span class="c1"># 当前页的前两页,当前页和当前页的后两页</span>
    <span class="c1"># context[&#39;many_page_hide_list&#39;] = [current_page_number - 2, current_page_number - 1, current_page_number, current_page_number + 1, current_page_number + 2]</span>
  
    <span class="c1"># 分页数组 : [当前页的第前两个,当前页的前一个,当前页,当前页的后一个,当前页的第后两个] -&gt; 前端遍历页码图标,遍历的就是这五个</span>
    <span class="c1"># 从当前页的前两页到当前页(前两页的页码,和第一页比对大小,取大的,这样就保证了前两页的第一页的页码,最小是1) - 左闭右开</span>
    <span class="c1"># 从当前页到最后一页(后两页最后一页的页码,和&#34;一共有多少页&#34;作比较,取小的,即使是点击最后一页,当前页后面的两页的页码比当前页(最后一页)大,取的也是最后一页)</span>
    <span class="c1"># python3的range方法返回的不是list,需要使用list转一下</span>
    <span class="n">many_page_hide_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
                                 <span class="nb">range</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">current_page_number</span> <span class="o">-</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">current_page_number</span><span class="p">)</span>
                              <span class="p">)</span> <span class="o">+</span> \
                          <span class="nb">list</span><span class="p">(</span>
                                <span class="c1"># 分页对象.num_pages, 分页器中一共有多少页</span>
                                 <span class="nb">range</span><span class="p">(</span><span class="n">current_page_number</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="n">current_page_number</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span> <span class="n">paginator</span><span class="o">.</span><span class="n">num_pages</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
                              <span class="p">)</span>
  
    <span class="c1"># 如果当前分页数组中,第一页的页码大于3,就是说前面至少有两个页码图标,那就向数组最前面添加省略号</span>
    <span class="k">if</span> <span class="n">many_page_hide_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">many_page_hide_list</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;...&#39;</span><span class="p">)</span>
    <span class="c1"># 如果当前分页数组中,最后一页的页码(当前页的后两个的第二个)比(全部数据的最后一页,真正的最后一页)往前2个,就是说 数组中的最后一页 的后面至少有两个页码图标,那就向数组最后面添加省略号</span>
    <span class="k">if</span> <span class="n">paginator</span><span class="o">.</span><span class="n">num_pages</span> <span class="o">-</span> <span class="n">many_page_hide_list</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">many_page_hide_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;...&#39;</span><span class="p">)</span>
    <span class="c1"># 如果当前分页数组中,第一个不是第一页,也就是说当前页的前两个的第一个不是全部数据的第一页,那就把第一页插入到当前分页数组的最前面(因为这样方便从后面比较大的数字直接跳回到第一页)</span>
    <span class="k">if</span> <span class="n">many_page_hide_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">many_page_hide_list</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">many_page_hide_list</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="n">paginator</span><span class="o">.</span><span class="n">num_pages</span><span class="p">:</span>
        <span class="n">many_page_hide_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">paginator</span><span class="o">.</span><span class="n">num_pages</span><span class="p">)</span>
  
    <span class="n">context</span><span class="p">[</span><span class="s1">&#39;many_page_hide_list&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">many_page_hide_list</span>
  
    <span class="n">context</span><span class="p">[</span><span class="s1">&#39;page&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">page</span>
    <span class="c1"># context[&#39;blogs_count&#39;] = Blog.objects.all().count()</span>
    <span class="n">context</span><span class="p">[</span><span class="s1">&#39;blog_types&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">BlogType</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>  <span class="c1"># 博客列表页面,右侧,博客分类数据</span>
    <span class="k">return</span> <span class="n">render_to_response</span><span class="p">(</span><span class="s1">&#39;blog/blog_list.html&#39;</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>
  
  
<span class="c1"># 博客详情页</span>
<span class="k">def</span> <span class="nf">blog_detail</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">blog_pk</span><span class="p">):</span>
    <span class="n">context</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">blog</span> <span class="o">=</span> <span class="n">get_object_or_404</span><span class="p">(</span><span class="n">Blog</span><span class="p">,</span> <span class="n">pk</span><span class="o">=</span><span class="n">blog_pk</span><span class="p">)</span>
    <span class="n">context</span><span class="p">[</span><span class="s1">&#39;blog&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_object_or_404</span><span class="p">(</span><span class="n">Blog</span><span class="p">,</span> <span class="n">pk</span><span class="o">=</span><span class="n">blog_pk</span><span class="p">)</span>  <span class="c1"># get_object_or_404,因为有可能获取不到</span>
  
    <span class="c1"># 属性后面加上 __,后面就可以写 gt(大于)、lt(小于)这种判断过滤器</span>
    <span class="n">context</span><span class="p">[</span><span class="s1">&#39;previous_blog&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Blog</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">create_time__gt</span><span class="o">=</span><span class="n">blog</span><span class="o">.</span><span class="n">create_time</span><span class="p">)</span><span class="o">.</span><span class="n">last</span><span class="p">()</span>  <span class="c1"># 前一篇博客,筛选出大于当前博客(创建时间)的博客,并获取到这些博客的最后一个</span>
    <span class="n">context</span><span class="p">[</span><span class="s1">&#39;next_blog&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Blog</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">create_time__lt</span><span class="o">=</span><span class="n">blog</span><span class="o">.</span><span class="n">create_time</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>  <span class="c1"># 后一篇博客,筛选出小于当前博客(创建时间)的博客,并获取到这些博客的第一个</span>
    <span class="k">return</span> <span class="n">render_to_response</span><span class="p">(</span><span class="s1">&#39;blog/blog_detail.html&#39;</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>
  
  
<span class="c1"># 指定分类列表页</span>
<span class="k">def</span> <span class="nf">blogs_with_type</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">blog_type_pk</span><span class="p">):</span>
    <span class="n">context</span> <span class="o">=</span> <span class="p">{}</span>
  
    <span class="n">blog_type</span> <span class="o">=</span> <span class="n">get_object_or_404</span><span class="p">(</span><span class="n">BlogType</span><span class="p">,</span> <span class="n">pk</span><span class="o">=</span><span class="n">blog_type_pk</span><span class="p">)</span>
    <span class="n">page_num</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">GET</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;page&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">blogs_all_list</span> <span class="o">=</span> <span class="n">Blog</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">blog_type</span><span class="o">=</span><span class="n">blog_type</span><span class="p">)</span>
    <span class="n">paginator</span> <span class="o">=</span> <span class="n">Paginator</span><span class="p">(</span><span class="n">blogs_all_list</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
    <span class="n">page</span> <span class="o">=</span> <span class="n">paginator</span><span class="o">.</span><span class="n">get_page</span><span class="p">(</span><span class="n">page_num</span><span class="p">)</span>
  
    <span class="n">current_page_number</span> <span class="o">=</span> <span class="n">page</span><span class="o">.</span><span class="n">number</span>
    <span class="n">many_page_hide_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
                              <span class="nb">range</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">current_page_number</span> <span class="o">-</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">current_page_number</span><span class="p">)</span>
                          <span class="p">)</span> <span class="o">+</span> \
                          <span class="nb">list</span><span class="p">(</span>
                              <span class="nb">range</span><span class="p">(</span><span class="n">current_page_number</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="n">current_page_number</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span> <span class="n">paginator</span><span class="o">.</span><span class="n">num_pages</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
                          <span class="p">)</span>
  
    <span class="k">if</span> <span class="n">many_page_hide_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">many_page_hide_list</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;...&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">paginator</span><span class="o">.</span><span class="n">num_pages</span> <span class="o">-</span> <span class="n">many_page_hide_list</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">many_page_hide_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">paginator</span><span class="o">.</span><span class="n">num_pages</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">many_page_hide_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">many_page_hide_list</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">many_page_hide_list</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="n">paginator</span><span class="o">.</span><span class="n">num_pages</span><span class="p">:</span>
        <span class="n">many_page_hide_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">paginator</span><span class="o">.</span><span class="n">num_pages</span><span class="p">)</span>
  
    <span class="n">context</span><span class="p">[</span><span class="s1">&#39;many_page_hide_list&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">many_page_hide_list</span>
    <span class="n">context</span><span class="p">[</span><span class="s1">&#39;page&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">page</span>
    <span class="n">context</span><span class="p">[</span><span class="s1">&#39;blogs&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Blog</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">blog_type</span><span class="o">=</span><span class="n">blog_type</span><span class="p">)</span>
    <span class="n">context</span><span class="p">[</span><span class="s1">&#39;blog_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">blog_type</span>
    <span class="n">context</span><span class="p">[</span><span class="s1">&#39;blog_types&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">BlogType</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">render_to_response</span><span class="p">(</span><span class="s1">&#39;blog/blog_with_type.html&#39;</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>到bootstrap官网找一个<code>翻页</code>组件</p>
<p><code>blog_detail.html</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html">{% extends &#39;base.html&#39; %}
  
{% block title %}
    {{ blog.title }}
{% endblock %}
  
{% block content %}
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;container&#34;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;row&#34;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;col-xs-10 col-xs-offset-2&#34;</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">h3</span><span class="p">&gt;</span>标题:{{ blog.title }}<span class="p">&lt;/</span><span class="nt">h3</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">ul</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;blog_detail_ul&#34;</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;</span>作者:{{ blog.author }}<span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;</span>发表日期:{{ blog.create_time | date:&#34;Y-m-d Hⓜs&#34;}}<span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;</span>分类: <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;{% url &#39;blog_with_type&#39; blog.blog_type.pk %}&#34;</span><span class="p">&gt;</span>{{ blog.blog_type }}<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span> <span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">li</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;blog_detail_content&#34;</span><span class="p">&gt;</span>{{ blog.content }}<span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
                <span class="p">&lt;/</span><span class="nt">ul</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">nav</span> <span class="na">aria-label</span><span class="o">=</span><span class="s">&#34;...&#34;</span><span class="p">&gt;</span>
                  <span class="p">&lt;</span><span class="nt">ul</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;pager&#34;</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;</span>
                        {% if previous_blog %}
                            上一篇:
                          <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;{% url &#39;blog_detail&#39; previous_blog.pk %}&#34;</span><span class="p">&gt;</span>
                                {{ previous_blog.title }}
                            <span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
                        {% else %}
                            上一篇:没有了
                        {% endif %}
                    <span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;</span>
                        {% if next_blog %}
                            下一篇:
                             <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;{% url &#39;blog_detail&#39; next_blog.pk %}&#34;</span><span class="p">&gt;</span>
                                {{ next_blog.title }}
                             <span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
                        {% else %}
                            下一篇:没有了
                        {% endif %}
                    <span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
                  <span class="p">&lt;/</span><span class="nt">ul</span><span class="p">&gt;</span>
                <span class="p">&lt;/</span><span class="nt">nav</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
              
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
{% endblock %}
</code></pre></td></tr></table>
</div>
</div></li>
</ul>
<hr>
<h2 id="在列表页的右边---博客分类底下加上一个社区就是那些破图标">在列表页的右边 - 博客分类底下,加上一个<code>社区</code>,就是那些破图标</h2>
<p><code>blog_list.html</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span><span class="lnt">128
</span><span class="lnt">129
</span><span class="lnt">130
</span><span class="lnt">131
</span><span class="lnt">132
</span><span class="lnt">133
</span><span class="lnt">134
</span><span class="lnt">135
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-django" data-lang="django"><span class="cp">{%</span> <span class="k">extends</span> <span class="s1">&#39;base.html&#39;</span> <span class="cp">%}</span><span class="x">
</span><span class="x"></span><span class="cp">{%</span> <span class="k">load</span> <span class="nv">staticfiles</span> <span class="cp">%}</span><span class="x">
</span><span class="x">
</span><span class="x"></span><span class="cp">{%</span> <span class="k">block</span> <span class="nv">title</span> <span class="cp">%}</span><span class="x">blog_list</span><span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span><span class="x">
</span><span class="x">
</span><span class="x"></span><span class="cp">{%</span> <span class="k">block</span> <span class="nv">nav_blog_active</span> <span class="cp">%}</span><span class="x">active</span><span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span><span class="x">
</span><span class="x">
</span><span class="x"></span><span class="cp">{%</span> <span class="k">block</span> <span class="nv">content</span> <span class="cp">%}</span><span class="x">
</span><span class="x">    &lt;div class=&#34;container&#34;&gt;
</span><span class="x">        &lt;div class=&#34;row&#34;&gt;
</span><span class="x">            &lt;div class=&#34;col-sm-8 col-lg-8&#34;&gt;
</span><span class="x">                </span><span class="c">{# 博客列表 #}</span><span class="x">
</span><span class="x">                &lt;div class=&#34;panel panel-default&#34;&gt;
</span><span class="x">                  </span><span class="c">{# page是当前页对象 paginator是整个大的分页对象 当前分页对象.paginator,就是回调到整个大的分页对象 当前分页对象.paginator.count,就是整个大的分页对象中全部内容的长度 #}</span><span class="x">
</span><span class="x">                  &lt;div class=&#34;panel-heading&#34;&gt;一共有</span><span class="cp">{{</span> <span class="nv">page.paginator.count</span> <span class="cp">}}</span><span class="x">篇博客&lt;/div&gt;
</span><span class="x">                      &lt;div class=&#34;panel-body&#34;&gt;
</span><span class="x">                        </span><span class="c">{# 遍历当前页的全部数据 #}</span><span class="x">
</span><span class="x">                        </span><span class="cp">{%</span> <span class="k">for</span> <span class="nv">blog</span> <span class="k">in</span> <span class="nv">page.object_list</span> <span class="cp">%}</span><span class="x">
</span><span class="x">                            &lt;div class=&#34;blog&#34;&gt;
</span><span class="x">                                &lt;a href=&#34;</span><span class="cp">{%</span> <span class="k">url</span> <span class="s1">&#39;blog_detail&#39;</span> <span class="nv">blog.pk</span> <span class="cp">%}</span><span class="x">&#34;&gt;
</span><span class="x">                                    &lt;h3&gt;</span><span class="cp">{{</span><span class="nv">blog.title</span><span class="cp">}}</span><span class="x">&lt;/h3&gt;
</span><span class="x">                                    &lt;p class=&#34;blog_info&#34;&gt;
</span><span class="x">                                        &lt;span class=&#34;glyphicon glyphicon-star&#34;&gt;&lt;/span&gt;
</span><span class="x">                                        &lt;span&gt;
</span><span class="x">                                            分类: &lt;a href=&#34;</span><span class="cp">{%</span> <span class="k">url</span> <span class="s1">&#39;blog_with_type&#39;</span> <span class="nv">blog.blog_type.pk</span> <span class="cp">%}</span><span class="x">&#34;&gt;</span><span class="cp">{{</span> <span class="nv">blog.blog_type</span> <span class="cp">}}</span><span class="x">&lt;/a&gt;
</span><span class="x">                                        &lt;/span&gt;
</span><span class="x">                                        &lt;span class=&#34;glyphicon glyphicon-time&#34;&gt;&lt;/span&gt;
</span><span class="x">                                        &lt;span class=&#34;blog_list_li_date&#34;&gt;
</span><span class="x">                                            发表日期:</span><span class="cp">{{</span> <span class="nv">blog.create_time</span> <span class="o">|</span> <span class="nf">date</span><span class="s2">:&#34;Y-m-d&#34;</span><span class="cp">}}</span><span class="x">
</span><span class="x">                                        &lt;/span&gt;
</span><span class="x">                                    &lt;/p&gt;
</span><span class="x">                                &lt;/a&gt;
</span><span class="x">                                &lt;p&gt;</span><span class="cp">{{</span><span class="nv">blog.content</span> <span class="o">|</span> <span class="nf">truncatechars</span><span class="o">:</span><span class="m">30</span><span class="cp">}}</span><span class="x">&lt;/p&gt;
</span><span class="x">                            &lt;/div&gt;
</span><span class="x">                        </span><span class="cp">{%</span> <span class="k">empty</span> <span class="cp">%}</span><span class="x">
</span><span class="x">                            &lt;p&gt;暂无博客&lt;/p&gt;
</span><span class="x">                        </span><span class="cp">{%</span> <span class="k">endfor</span> <span class="cp">%}</span><span class="x">
</span><span class="x">                      &lt;/div&gt;
</span><span class="x">                &lt;/div&gt;
</span><span class="x">
</span><span class="x">                </span><span class="c">{# 分页图标 #}</span><span class="x">
</span><span class="x">                </span><span class="c">{# col-lg-offset-6,行方向向右偏移6列 #}</span><span class="x">
</span><span class="x">                &lt;nav aria-label=&#34;Page navigation&#34; class=&#34;col-lg-offset-6&#34;&gt;
</span><span class="x">                  &lt;ul class=&#34;pagination&#34;&gt;
</span><span class="x">                    &lt;li&gt;
</span><span class="x">                        </span><span class="c">{# 当前页对象.has_previous -&gt; 前一页 #}</span><span class="x">
</span><span class="x">                        </span><span class="cp">{%</span> <span class="k">if</span> <span class="nv">page.has_previous</span> <span class="cp">%}</span><span class="x">
</span><span class="x">                            </span><span class="c">{# django中,在href内写 ?xxx,就是在当前页面的路由后面拼接上href中的内容,点击还会跳转 #}</span><span class="x">
</span><span class="x">                            </span><span class="c">{# 当前页对象.previous_page_number -&gt; 当前页的前一页 #}</span><span class="x">
</span><span class="x">                            &lt;a href=&#34;?page=</span><span class="cp">{{</span> <span class="nv">page.previous_page_number</span> <span class="cp">}}</span><span class="x">&#34; aria-label=&#34;Previous&#34;&gt;
</span><span class="x">                                &lt;span aria-hidden=&#34;true&#34;&gt;&amp;laquo;&lt;/span&gt;
</span><span class="x">                            &lt;/a&gt;
</span><span class="x">                        </span><span class="cp">{%</span> <span class="k">else</span> <span class="cp">%}</span><span class="x">
</span><span class="x">                            &lt;span aria-hidden=&#34;true&#34;&gt;&amp;laquo;&lt;/span&gt;
</span><span class="x">                        </span><span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span><span class="x">
</span><span class="x">                    &lt;/li&gt;
</span><span class="x">                    </span><span class="c">{# 这里遍历的是 当前页的前两页 当前页 当前页的后两页 #}</span><span class="x">
</span><span class="x">                    </span><span class="c">{# 当前页对象.paginator.page_range -&gt; 返回整个分页对象,一共有几页 #}</span><span class="x">
</span><span class="x">                    </span><span class="cp">{%</span> <span class="k">for</span> <span class="nv">page_child</span> <span class="k">in</span> <span class="nv">many_page_hide_list</span> <span class="cp">%}</span><span class="x">
</span><span class="x"></span><span class="c">{#                    {% for page_child in page.paginator.page_range %}#}</span><span class="x">
</span><span class="x">                        </span><span class="cp">{%</span> <span class="k">if</span> <span class="nv">page_child</span> <span class="o">==</span> <span class="nv">page.number</span> <span class="cp">%}</span><span class="x">
</span><span class="x">                            &lt;li class=&#34;active&#34;&gt;
</span><span class="x">                                &lt;span&gt;</span><span class="cp">{{</span> <span class="nv">page_child</span> <span class="cp">}}</span><span class="x">&lt;/span&gt;
</span><span class="x">                            &lt;/li&gt;
</span><span class="x">                        </span><span class="cp">{%</span> <span class="k">else</span> <span class="cp">%}</span><span class="x">
</span><span class="x">                            </span><span class="cp">{%</span> <span class="k">if</span> <span class="nv">page_child</span> <span class="o">==</span> <span class="s1">&#39;...&#39;</span> <span class="cp">%}</span><span class="x">
</span><span class="x">                                &lt;li&gt;
</span><span class="x">                                   &lt;span&gt;</span><span class="cp">{{</span> <span class="nv">page_child</span> <span class="cp">}}</span><span class="x">&lt;/span&gt;
</span><span class="x">                                &lt;/li&gt;
</span><span class="x">                            </span><span class="cp">{%</span> <span class="k">else</span> <span class="cp">%}</span><span class="x">
</span><span class="x">                                &lt;li&gt;
</span><span class="x">                                    &lt;span&gt;
</span><span class="x">                                        &lt;a href=&#34;?page=</span><span class="cp">{{</span> <span class="nv">page_child</span> <span class="cp">}}</span><span class="x">&#34;&gt;</span><span class="cp">{{</span> <span class="nv">page_child</span> <span class="cp">}}</span><span class="x">&lt;/a&gt;
</span><span class="x">                                    &lt;/span&gt;
</span><span class="x">                                &lt;/li&gt;
</span><span class="x">                            </span><span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span><span class="x">
</span><span class="x">                        </span><span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span><span class="x">
</span><span class="x">                    </span><span class="cp">{%</span> <span class="k">endfor</span> <span class="cp">%}</span><span class="x">
</span><span class="x">
</span><span class="x">                    &lt;li&gt;
</span><span class="x">                        </span><span class="c">{# 当前页对象.has_next -&gt; 后一页 #}</span><span class="x">
</span><span class="x">                        </span><span class="cp">{%</span> <span class="k">if</span> <span class="nv">page.has_next</span> <span class="cp">%}</span><span class="x">
</span><span class="x">                        </span><span class="c">{# 当前页对象.next_page_number -&gt; 当前页的后一页 #}</span><span class="x">
</span><span class="x">                          &lt;a href=&#34;?page=</span><span class="cp">{{</span> <span class="nv">page.next_page_number</span> <span class="cp">}}</span><span class="x">&#34; aria-label=&#34;Next&#34;&gt;
</span><span class="x">                            &lt;span aria-hidden=&#34;true&#34;&gt;&amp;raquo;&lt;/span&gt;
</span><span class="x">                          &lt;/a&gt;
</span><span class="x">                        </span><span class="cp">{%</span> <span class="k">else</span> <span class="cp">%}</span><span class="x">
</span><span class="x">                            &lt;span aria-hidden=&#34;true&#34;&gt;&amp;raquo;&lt;/span&gt;
</span><span class="x">                        </span><span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span><span class="x">
</span><span class="x">                    &lt;/li&gt;
</span><span class="x">                  &lt;/ul&gt;
</span><span class="x">                &lt;/nav&gt;
</span><span class="x">            &lt;/div&gt;
</span><span class="x">
</span><span class="x">            </span><span class="c">{# 博客分类 #}</span><span class="x">
</span><span class="x">            &lt;div class=&#34;col-sm-4 col-lg-4&#34;&gt;
</span><span class="x">                &lt;div class=&#34;panel panel-default&#34;&gt;
</span><span class="x">                   &lt;div class=&#34;panel-heading&#34;&gt;博客分类&lt;/div&gt;
</span><span class="x">                       &lt;div class=&#34;panel-body&#34;&gt;
</span><span class="x">                           &lt;ul&gt;
</span><span class="x">                               </span><span class="cp">{%</span> <span class="k">for</span> <span class="nv">blog_type</span> <span class="k">in</span> <span class="nv">blog_types</span> <span class="cp">%}</span><span class="x">
</span><span class="x">                                   &lt;li class=&#34;blog_list_li&#34;&gt;&lt;a href=&#34;</span><span class="cp">{%</span> <span class="k">url</span> <span class="s1">&#39;blog_with_type&#39;</span> <span class="nv">blog_type.pk</span> <span class="cp">%}</span><span class="x">&#34;&gt;</span><span class="cp">{{</span> <span class="nv">blog_type.type_name</span> <span class="cp">}}</span><span class="x">&lt;/a&gt;&lt;/li&gt;
</span><span class="x">                               </span><span class="cp">{%</span> <span class="k">empty</span> <span class="cp">%}</span><span class="x">
</span><span class="x">                                   &lt;li class=&#34;blog_list_li&#34;&gt;暂无分类&lt;/li&gt;
</span><span class="x">                               </span><span class="cp">{%</span> <span class="k">endfor</span> <span class="cp">%}</span><span class="x">
</span><span class="x">                           &lt;/ul&gt;
</span><span class="x">                       &lt;/div&gt;
</span><span class="x">                &lt;/div&gt;
</span><span class="x">
</span><span class="x">                &lt;div class=&#34;panel panel-default&#34;&gt;
</span><span class="x">                   &lt;div class=&#34;panel-heading&#34;&gt;社区&lt;/div&gt;
</span><span class="x">                       &lt;div class=&#34;panel-body&#34;&gt;
</span><span class="x">                           &lt;div class=&#34;logo_div row&#34; style=&#34;display: flex;justify-content: space-between;&#34;&gt;
</span><span class="x">                               &lt;a href=&#34;https://space.bilibili.com/628950169?spm_id_from=333.1007.0.0&#34; class=&#34;col-md-2&#34;&gt;
</span><span class="x">                                   &lt;img style=&#34;width: 20px;height:20px&#34; src=&#34;</span><span class="cp">{%</span> <span class="k">static</span> <span class="s1">&#39;images/bilibili.png&#39;</span> <span class="cp">%}</span><span class="x">&#34; alt=&#34;&#34;&gt;
</span><span class="x">                               &lt;/a&gt;
</span><span class="x">                               &lt;a href=&#34;https://gitee.com/yuzhoudaima&#34; class=&#34;col-md-2&#34;&gt;
</span><span class="x">                                   &lt;img style=&#34;width: 20px;height:20px&#34; src=&#34;</span><span class="cp">{%</span> <span class="k">static</span> <span class="s1">&#39;images/gitee.png&#39;</span> <span class="cp">%}</span><span class="x">&#34; alt=&#34;&#34;&gt;
</span><span class="x">                               &lt;/a&gt;
</span><span class="x">                               &lt;a href=&#34;https://www.google.com/?hl=zh_CN&#34; class=&#34;col-md-2&#34;&gt;
</span><span class="x">                                   &lt;img style=&#34;width: 20px;height:20px&#34; src=&#34;</span><span class="cp">{%</span> <span class="k">static</span> <span class="s1">&#39;images/google.png&#39;</span><span class="cp">%}</span><span class="x">&#34; alt=&#34;&#34;&gt;
</span><span class="x">                               &lt;/a&gt;
</span><span class="x">                               &lt;a href=&#34;https://web.telegram.org/&#34; class=&#34;col-md-2&#34;&gt;
</span><span class="x">                                   &lt;img style=&#34;width: 20px;height:20px&#34; src=&#34;</span><span class="cp">{%</span> <span class="k">static</span> <span class="s1">&#39;images/telegram.png&#39;</span> <span class="cp">%}</span><span class="x">&#34; alt=&#34;&#34;&gt;
</span><span class="x">                               &lt;/a&gt;
</span><span class="x">                               &lt;a href=&#34;https://twitter.com/WRiS24sIWr2ICRP&#34; class=&#34;col-md-2&#34;&gt;
</span><span class="x">                                   &lt;img style=&#34;width: 20px;height:20px&#34; src=&#34;</span><span class="cp">{%</span> <span class="k">static</span> <span class="s1">&#39;images/twitter.png&#39;</span> <span class="cp">%}</span><span class="x">&#34; alt=&#34;&#34;&gt;
</span><span class="x">                               &lt;/a&gt;
</span><span class="x">                           &lt;/div&gt;
</span><span class="x">                       &lt;/div&gt;
</span><span class="x">                &lt;/div&gt;
</span><span class="x">            &lt;/div&gt;
</span><span class="x">        &lt;/div&gt;
</span><span class="x">    &lt;/div&gt;
</span><span class="x"></span><span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span><span class="x">
</span></code></pre></td></tr></table>
</div>
</div><hr>
<h2 id="博客列表页的分类区块---每个分类后面加上对应的博客数量">博客列表页的分类区块 - 每个分类后面加上对应的博客数量</h2>
<ul>
<li>
<p>思路</p>
<ul>
<li>前面是获取到所有分类</li>
<li>这里也是,先获取到所有分类</li>
<li>然后遍历分类列表</li>
<li>对于每一个分类</li>
<li>在博客表中查询,符合分类的博客,然后通过<code>.count()</code>方法获取这种类的博客的博客数量</li>
<li>将这个数量,作为属性,添加到遍历的当前这个对象中</li>
<li>然后将这个对象添加到一个新的列表中</li>
<li>携带这个新的列表,跳转到博客列表页面</li>
<li>博客列表页面,遍历的就是这个新的集合</li>
</ul>
</li>
<li>
<p><code>views.py</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="c1"># 博客列表页</span>
<span class="k">def</span> <span class="nf">blog_list</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="c1"># add()</span>
    <span class="n">context</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">page_num</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">GET</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;page&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>  <span class="c1"># 通过request获取当前页码,默认是第一页</span>
    <span class="n">blogs_all_list</span> <span class="o">=</span> <span class="n">Blog</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>  <span class="c1"># 获取全部博客列表,并存储到对象里</span>
    <span class="n">paginator</span> <span class="o">=</span> <span class="n">Paginator</span><span class="p">(</span><span class="n">blogs_all_list</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>  <span class="c1"># 使用分页组件,参数为 -&gt; ( 需要分页的集合(全部博客列表) , 每页显示几条 ) , 返回一个分页对象,这个对象中包含需要分页的集合数据</span>
    <span class="n">page</span> <span class="o">=</span> <span class="n">paginator</span><span class="o">.</span><span class="n">get_page</span><span class="p">(</span><span class="n">page_num</span><span class="p">)</span>  <span class="c1"># 向分页对象的get_page方法传参数,获取第几页的全部数据,并返回一个对象</span>
  
    <span class="n">current_page_number</span> <span class="o">=</span> <span class="n">page</span><span class="o">.</span><span class="n">number</span>  <span class="c1"># 当前页</span>
    <span class="c1"># 当前页的前两页,当前页和当前页的后两页</span>
    <span class="c1"># context[&#39;many_page_hide_list&#39;] = [current_page_number - 2, current_page_number - 1, current_page_number, current_page_number + 1, current_page_number + 2]</span>
  
    <span class="c1"># 分页数组 : [当前页的第前两个,当前页的前一个,当前页,当前页的后一个,当前页的第后两个] -&gt; 前端遍历页码图标,遍历的就是这五个</span>
    <span class="c1"># 从当前页的前两页到当前页(前两页的页码,和第一页比对大小,取大的,这样就保证了前两页的第一页的页码,最小是1) - 左闭右开</span>
    <span class="c1"># 从当前页到最后一页(后两页最后一页的页码,和&#34;一共有多少页&#34;作比较,取小的,即使是点击最后一页,当前页后面的两页的页码比当前页(最后一页)大,取的也是最后一页)</span>
    <span class="c1"># python3的range方法返回的不是list,需要使用list转一下</span>
    <span class="n">many_page_hide_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
                                 <span class="nb">range</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">current_page_number</span> <span class="o">-</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">current_page_number</span><span class="p">)</span>
                              <span class="p">)</span> <span class="o">+</span> \
                          <span class="nb">list</span><span class="p">(</span>
                                <span class="c1"># 分页对象.num_pages, 分页器中一共有多少页</span>
                                 <span class="nb">range</span><span class="p">(</span><span class="n">current_page_number</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="n">current_page_number</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span> <span class="n">paginator</span><span class="o">.</span><span class="n">num_pages</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
                              <span class="p">)</span>
  
    <span class="c1"># 如果当前分页数组中,第一页的页码大于3,就是说前面至少有两个页码图标,那就向数组最前面添加省略号</span>
    <span class="k">if</span> <span class="n">many_page_hide_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">many_page_hide_list</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;...&#39;</span><span class="p">)</span>
    <span class="c1"># 如果当前分页数组中,最后一页的页码(当前页的后两个的第二个)比(全部数据的最后一页,真正的最后一页)往前2个,就是说 数组中的最后一页 的后面至少有两个页码图标,那就向数组最后面添加省略号</span>
    <span class="k">if</span> <span class="n">paginator</span><span class="o">.</span><span class="n">num_pages</span> <span class="o">-</span> <span class="n">many_page_hide_list</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">many_page_hide_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;...&#39;</span><span class="p">)</span>
    <span class="c1"># 如果当前分页数组中,第一个不是第一页,也就是说当前页的前两个的第一个不是全部数据的第一页,那就把第一页插入到当前分页数组的最前面(因为这样方便从后面比较大的数字直接跳回到第一页)</span>
    <span class="k">if</span> <span class="n">many_page_hide_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">many_page_hide_list</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">many_page_hide_list</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="n">paginator</span><span class="o">.</span><span class="n">num_pages</span><span class="p">:</span>
        <span class="n">many_page_hide_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">paginator</span><span class="o">.</span><span class="n">num_pages</span><span class="p">)</span>
  
    <span class="n">blog_type_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">blog_list</span> <span class="o">=</span> <span class="n">BlogType</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">blog_type</span> <span class="ow">in</span> <span class="n">blog_list</span><span class="p">:</span>
        <span class="n">blog_type</span><span class="o">.</span><span class="n">blog_count</span> <span class="o">=</span> <span class="n">Blog</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">blog_type</span><span class="o">=</span><span class="n">blog_type</span><span class="p">)</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
        <span class="n">blog_type_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">blog_type</span><span class="p">)</span>
    <span class="n">context</span><span class="p">[</span><span class="s1">&#39;many_page_hide_list&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">many_page_hide_list</span>
    <span class="n">context</span><span class="p">[</span><span class="s1">&#39;page&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">page</span>
    <span class="n">context</span><span class="p">[</span><span class="s1">&#39;blog_types&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">blog_type_list</span>  <span class="c1"># 博客列表页面,右侧,博客分类数据</span>
  
    <span class="k">return</span> <span class="n">render_to_response</span><span class="p">(</span><span class="s1">&#39;blog/blog_list.html&#39;</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p><code>blog_list.html</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span><span class="lnt">128
</span><span class="lnt">129
</span><span class="lnt">130
</span><span class="lnt">131
</span><span class="lnt">132
</span><span class="lnt">133
</span><span class="lnt">134
</span><span class="lnt">135
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html">{% extends &#39;base.html&#39; %}
{% load staticfiles %}
  
{% block title %}blog_list{% endblock %}
  
{% block nav_blog_active %}active{% endblock %}
  
{% block content %}
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;container&#34;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;row&#34;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;col-sm-8 col-lg-8&#34;</span><span class="p">&gt;</span>
                {# 博客列表 #}
                <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;panel panel-default&#34;</span><span class="p">&gt;</span>
                  {# page是当前页对象 paginator是整个大的分页对象 当前分页对象.paginator,就是回调到整个大的分页对象 当前分页对象.paginator.count,就是整个大的分页对象中全部内容的长度 #}
                  <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;panel-heading&#34;</span><span class="p">&gt;</span>一共有{{ page.paginator.count }}篇博客<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
                      <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;panel-body&#34;</span><span class="p">&gt;</span>
                        {# 遍历当前页的全部数据 #}
                        {% for blog in page.object_list %}
                            <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;blog&#34;</span><span class="p">&gt;</span>
                                <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;{% url &#39;blog_detail&#39; blog.pk %}&#34;</span><span class="p">&gt;</span>
                                    <span class="p">&lt;</span><span class="nt">h3</span><span class="p">&gt;</span>{{blog.title}}<span class="p">&lt;/</span><span class="nt">h3</span><span class="p">&gt;</span>
                                    <span class="p">&lt;</span><span class="nt">p</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;blog_info&#34;</span><span class="p">&gt;</span>
                                        <span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;glyphicon glyphicon-star&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
                                        <span class="p">&lt;</span><span class="nt">span</span><span class="p">&gt;</span>
                                            分类: <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;{% url &#39;blog_with_type&#39; blog.blog_type.pk %}&#34;</span><span class="p">&gt;</span>{{ blog.blog_type }}<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
                                        <span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
                                        <span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;glyphicon glyphicon-time&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
                                        <span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;blog_list_li_date&#34;</span><span class="p">&gt;</span>
                                            发表日期:{{ blog.create_time | date:&#34;Y-m-d&#34;}}
                                        <span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
                                    <span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
                                <span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
                                <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>{{blog.content | truncatechars:30}}<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
                            <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
                        {% empty %}
                            <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>暂无博客<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
                        {% endfor %}
                      <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
                <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
  
                {# 分页图标 #}
                {# col-lg-offset-6,行方向向右偏移6列 #}
                <span class="p">&lt;</span><span class="nt">nav</span> <span class="na">aria-label</span><span class="o">=</span><span class="s">&#34;Page navigation&#34;</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;col-lg-offset-6&#34;</span><span class="p">&gt;</span>
                  <span class="p">&lt;</span><span class="nt">ul</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;pagination&#34;</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;</span>
                        {# 当前页对象.has_previous -&gt; 前一页 #}
                        {% if page.has_previous %}
                            {# django中,在href内写 ?xxx,就是在当前页面的路由后面拼接上href中的内容,点击还会跳转 #}
                            {# 当前页对象.previous_page_number -&gt; 当前页的前一页 #}
                            <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;?page={{ page.previous_page_number }}&#34;</span> <span class="na">aria-label</span><span class="o">=</span><span class="s">&#34;Previous&#34;</span><span class="p">&gt;</span>
                                <span class="p">&lt;</span><span class="nt">span</span> <span class="na">aria-hidden</span><span class="o">=</span><span class="s">&#34;true&#34;</span><span class="p">&gt;</span><span class="ni">&amp;laquo;</span><span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
                            <span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
                        {% else %}
                            <span class="p">&lt;</span><span class="nt">span</span> <span class="na">aria-hidden</span><span class="o">=</span><span class="s">&#34;true&#34;</span><span class="p">&gt;</span><span class="ni">&amp;laquo;</span><span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
                        {% endif %}
                    <span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
                    {# 这里遍历的是 当前页的前两页 当前页 当前页的后两页 #}
                    {# 当前页对象.paginator.page_range -&gt; 返回整个分页对象,一共有几页 #}
                    {% for page_child in many_page_hide_list %}
{#                    {% for page_child in page.paginator.page_range %}#}
                        {% if page_child == page.number %}
                            <span class="p">&lt;</span><span class="nt">li</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;active&#34;</span><span class="p">&gt;</span>
                                <span class="p">&lt;</span><span class="nt">span</span><span class="p">&gt;</span>{{ page_child }}<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
                            <span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
                        {% else %}
                            {% if page_child == &#39;...&#39; %}
                                <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;</span>
                                   <span class="p">&lt;</span><span class="nt">span</span><span class="p">&gt;</span>{{ page_child }}<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
                                <span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
                            {% else %}
                                <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;</span>
                                    <span class="p">&lt;</span><span class="nt">span</span><span class="p">&gt;</span>
                                        <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;?page={{ page_child }}&#34;</span><span class="p">&gt;</span>{{ page_child }}<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
                                    <span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
                                <span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
                            {% endif %}
                        {% endif %}
                    {% endfor %}
  
                    <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;</span>
                        {# 当前页对象.has_next -&gt; 后一页 #}
                        {% if page.has_next %}
                        {# 当前页对象.next_page_number -&gt; 当前页的后一页 #}
                          <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;?page={{ page.next_page_number }}&#34;</span> <span class="na">aria-label</span><span class="o">=</span><span class="s">&#34;Next&#34;</span><span class="p">&gt;</span>
                            <span class="p">&lt;</span><span class="nt">span</span> <span class="na">aria-hidden</span><span class="o">=</span><span class="s">&#34;true&#34;</span><span class="p">&gt;</span><span class="ni">&amp;raquo;</span><span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
                          <span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
                        {% else %}
                            <span class="p">&lt;</span><span class="nt">span</span> <span class="na">aria-hidden</span><span class="o">=</span><span class="s">&#34;true&#34;</span><span class="p">&gt;</span><span class="ni">&amp;raquo;</span><span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
                        {% endif %}
                    <span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
                  <span class="p">&lt;/</span><span class="nt">ul</span><span class="p">&gt;</span>
                <span class="p">&lt;/</span><span class="nt">nav</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
  
            {# 博客分类 #}
            <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;col-sm-4 col-lg-4&#34;</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;panel panel-default&#34;</span><span class="p">&gt;</span>
                   <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;panel-heading&#34;</span><span class="p">&gt;</span>博客分类<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
                       <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;panel-body&#34;</span><span class="p">&gt;</span>
                           <span class="p">&lt;</span><span class="nt">ul</span><span class="p">&gt;</span>
                               {% for blog_type in blog_types %}
                                   <span class="p">&lt;</span><span class="nt">li</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;blog_list_li&#34;</span><span class="p">&gt;&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;{% url &#39;blog_with_type&#39; blog_type.pk %}&#34;</span><span class="p">&gt;</span>{{ blog_type.type_name }}({{ blog_type.blog_count }})<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
                               {% empty %}
                                   <span class="p">&lt;</span><span class="nt">li</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;blog_list_li&#34;</span><span class="p">&gt;</span>暂无分类<span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
                               {% endfor %}
                           <span class="p">&lt;/</span><span class="nt">ul</span><span class="p">&gt;</span>
                       <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
                <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
  
                <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;panel panel-default&#34;</span><span class="p">&gt;</span>
                   <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;panel-heading&#34;</span><span class="p">&gt;</span>社区<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
                       <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;panel-body&#34;</span><span class="p">&gt;</span>
                           <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;logo_div row&#34;</span> <span class="na">style</span><span class="o">=</span><span class="s">&#34;display: flex;justify-content: space-between;&#34;</span><span class="p">&gt;</span>
                               <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;https://space.bilibili.com/628950169?spm_id_from=333.1007.0.0&#34;</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;col-md-2&#34;</span><span class="p">&gt;</span>
                                   <span class="p">&lt;</span><span class="nt">img</span> <span class="na">style</span><span class="o">=</span><span class="s">&#34;width: 20px;height:20px&#34;</span> <span class="na">src</span><span class="o">=</span><span class="s">&#34;{% static &#39;images/bilibili.png&#39; %}&#34;</span> <span class="na">alt</span><span class="o">=</span><span class="s">&#34;&#34;</span><span class="p">&gt;</span>
                               <span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
                               <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;https://gitee.com/yuzhoudaima&#34;</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;col-md-2&#34;</span><span class="p">&gt;</span>
                                   <span class="p">&lt;</span><span class="nt">img</span> <span class="na">style</span><span class="o">=</span><span class="s">&#34;width: 20px;height:20px&#34;</span> <span class="na">src</span><span class="o">=</span><span class="s">&#34;{% static &#39;images/gitee.png&#39; %}&#34;</span> <span class="na">alt</span><span class="o">=</span><span class="s">&#34;&#34;</span><span class="p">&gt;</span>
                               <span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
                               <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;https://www.google.com/?hl=zh_CN&#34;</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;col-md-2&#34;</span><span class="p">&gt;</span>
                                   <span class="p">&lt;</span><span class="nt">img</span> <span class="na">style</span><span class="o">=</span><span class="s">&#34;width: 20px;height:20px&#34;</span> <span class="na">src</span><span class="o">=</span><span class="s">&#34;{% static &#39;images/google.png&#39;%}&#34;</span> <span class="na">alt</span><span class="o">=</span><span class="s">&#34;&#34;</span><span class="p">&gt;</span>
                               <span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
                               <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;https://web.telegram.org/&#34;</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;col-md-2&#34;</span><span class="p">&gt;</span>
                                   <span class="p">&lt;</span><span class="nt">img</span> <span class="na">style</span><span class="o">=</span><span class="s">&#34;width: 20px;height:20px&#34;</span> <span class="na">src</span><span class="o">=</span><span class="s">&#34;{% static &#39;images/telegram.png&#39; %}&#34;</span> <span class="na">alt</span><span class="o">=</span><span class="s">&#34;&#34;</span><span class="p">&gt;</span>
                               <span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
                               <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;https://twitter.com/WRiS24sIWr2ICRP&#34;</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;col-md-2&#34;</span><span class="p">&gt;</span>
                                   <span class="p">&lt;</span><span class="nt">img</span> <span class="na">style</span><span class="o">=</span><span class="s">&#34;width: 20px;height:20px&#34;</span> <span class="na">src</span><span class="o">=</span><span class="s">&#34;{% static &#39;images/twitter.png&#39; %}&#34;</span> <span class="na">alt</span><span class="o">=</span><span class="s">&#34;&#34;</span><span class="p">&gt;</span>
                               <span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
                           <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
                       <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
                <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
{% endblock %}
</code></pre></td></tr></table>
</div>
</div></li>
</ul>
<hr>
<h2 id="django后台美化">django后台美化</h2>
<ul>
<li>这个是django4的,对于django2,会出不止以下bug</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">pip install django-simpleui
</code></pre></td></tr></table>
</div>
</div><ul>
<li>
<p>在<code>settings.py</code>中添加</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="n">INSTALLED_APPS</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;simpleui&#39;</span><span class="p">,</span>
    <span class="s1">&#39;django.contrib.admin&#39;</span><span class="p">,</span>
    <span class="s1">&#39;django.contrib.auth&#39;</span><span class="p">,</span>
    <span class="s1">&#39;django.contrib.contenttypes&#39;</span><span class="p">,</span>
    <span class="s1">&#39;django.contrib.sessions&#39;</span><span class="p">,</span>
    <span class="s1">&#39;django.contrib.messages&#39;</span><span class="p">,</span>
    <span class="s1">&#39;django.contrib.staticfiles&#39;</span><span class="p">,</span>
    <span class="s1">&#39;blog&#39;</span><span class="p">,</span>
<span class="p">]</span>
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>第一行添加<code>simpleui</code></p>
</li>
<li>
<p>然后启动,如果是django2,会报错</p>
</li>
<li>
<p>第一</p>
<blockquote>
<p>render_to_response改为render</p>
</blockquote>
</li>
<li>
<p>第二</p>
<blockquote>
<p>{% load staticfiles %} 改为 {% load static %}</p>
</blockquote>
</li>
<li>
<p>访问<code>localhost:8080/admin</code>,打开新世界</p>
</li>
</ul>
<hr>
<h2 id="富文本编辑器">富文本编辑器</h2>
<ul>
<li>
<p>下载</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">pip install django-ckeditor
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>在settings.py中的app添加</p>
<p><code>settings.py</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="n">INSTALLED_APPS</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;simpleui&#39;</span><span class="p">,</span>
    <span class="s1">&#39;django.contrib.admin&#39;</span><span class="p">,</span>
    <span class="s1">&#39;django.contrib.auth&#39;</span><span class="p">,</span>
    <span class="s1">&#39;django.contrib.contenttypes&#39;</span><span class="p">,</span>
    <span class="s1">&#39;django.contrib.sessions&#39;</span><span class="p">,</span>
    <span class="s1">&#39;django.contrib.messages&#39;</span><span class="p">,</span>
    <span class="s1">&#39;django.contrib.staticfiles&#39;</span><span class="p">,</span>
    <span class="s1">&#39;blog&#39;</span><span class="p">,</span>
    <span class="s1">&#39;ckeditor&#39;</span><span class="p">,</span>
<span class="p">]</span>
</code></pre></td></tr></table>
</div>
</div><blockquote>
<p>&lsquo;ckeditor&rsquo;</p>
</blockquote>
</li>
<li>
<p>在models.py中导入</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">ckeditor.fields</span> <span class="kn">import</span> <span class="n">RichTextField</span>
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>将<code>内容content</code>属性的<code>model.TextFields()</code>改为</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="n">RichTextField</span><span class="p">()</span>
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>就可以在admin后台使用富文本编辑器了</p>
</li>
</ul>
<p><code>models.py</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>
<span class="kn">from</span> <span class="nn">django.contrib.auth.models</span> <span class="kn">import</span> <span class="n">User</span>
<span class="kn">from</span> <span class="nn">ckeditor.fields</span> <span class="kn">import</span> <span class="n">RichTextField</span>


<span class="k">class</span> <span class="nc">BlogType</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">type_name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">type_name</span>


<span class="c1"># Create your models here.</span>
<span class="k">class</span> <span class="nc">Blog</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">title</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
    <span class="n">blog_type</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">BlogType</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">DO_NOTHING</span><span class="p">)</span>
    <span class="n">content</span> <span class="o">=</span> <span class="n">RichTextField</span><span class="p">()</span>
    <span class="n">author</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">User</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">DO_NOTHING</span><span class="p">)</span>  <span class="c1"># 外键删除事件,什么都不做  || User是django自带的User对象</span>
    <span class="n">create_time</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">(</span><span class="n">auto_now_add</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>  <span class="c1"># 自动获取当前时间戳 这个类型一旦创建,就不可被更改</span>
    <span class="n">last_updated_time</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">(</span><span class="n">auto_now</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>  <span class="c1"># 自动获取当前时间戳</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&#34;&lt;Blog:</span><span class="si">%s</span><span class="s2">&gt;&#34;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">title</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">ordering</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;-create_time&#39;</span><span class="p">]</span>
</code></pre></td></tr></table>
</div>
</div><ul>
<li>
<p>在后台写几个富文本</p>
</li>
<li>
<p>但是,博客列表中,每个博客条底部的<code>概述</code>,就是只显示<code>博客开头一点详细内容</code>的部分</p>
</li>
<li>
<p>在富文本中有<code>html标签</code>,它会被显示出来</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-django" data-lang="django"><span class="x">&lt;p&gt;</span><span class="cp">{{</span><span class="nv">blog.content</span> <span class="o">|</span> <span class="nf">striptags</span> <span class="o">|</span> <span class="nf">truncaars</span><span class="o">:</span><span class="m">30</span><span class="cp">}}</span><span class="x">&lt;/p&gt;
</span></code></pre></td></tr></table>
</div>
</div></li>
<li>
<p><code>striptags</code>,可以隐藏显示的<code>html标签</code></p>
</li>
<li>
<p>在博客详情页中</p>
</li>
<li>
<p>给详情内容加上<code>safe</code>过滤器</p>
</li>
<li>
<p>它就是将富文本中的HTML内容和CSS样式,正常的渲染到元素和页面上</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-django" data-lang="django"><span class="x">&lt;li class=&#34;blog_detail_content&#34;&gt;</span><span class="cp">{{</span> <span class="nv">blog.content</span> <span class="o">|</span> <span class="nf">safe</span><span class="cp">}}</span><span class="x">&lt;/li&gt;
</span></code></pre></td></tr></table>
</div>
</div></li>
</ul>
<hr>
<h2 id="浏览次数">浏览次数</h2>
<ul>
<li>
<p>在models.py中,给blog表添加访问次数字段</p>
<p><code>models.py</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>
<span class="kn">from</span> <span class="nn">django.contrib.auth.models</span> <span class="kn">import</span> <span class="n">User</span>
<span class="kn">from</span> <span class="nn">ckeditor.fields</span> <span class="kn">import</span> <span class="n">RichTextField</span>
  
  
<span class="k">class</span> <span class="nc">BlogType</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">type_name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
  
    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">type_name</span>
  
  
<span class="c1"># Create your models here.</span>
<span class="k">class</span> <span class="nc">Blog</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">title</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
    <span class="n">blog_type</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">BlogType</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">DO_NOTHING</span><span class="p">)</span>
    <span class="n">content</span> <span class="o">=</span> <span class="n">RichTextField</span><span class="p">()</span>
    <span class="n">author</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">User</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">DO_NOTHING</span><span class="p">)</span>  <span class="c1"># 外键删除事件,什么都不做  || User是django自带的User对象</span>
    <span class="n">reader_num</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">IntegerField</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">create_time</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">(</span><span class="n">auto_now_add</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>  <span class="c1"># 自动获取当前时间戳 这个类型一旦创建,就不可被更改</span>
    <span class="n">last_updated_time</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">(</span><span class="n">auto_now</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>  <span class="c1"># 自动获取当前时间戳</span>
  
    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&#34;&lt;Blog:</span><span class="si">%s</span><span class="s2">&gt;&#34;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">title</span>
  
    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">ordering</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;-create_time&#39;</span><span class="p">]</span>
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>在views.py中,每请求一次方法,这个字段值就增加1,并保存到数据库<code>object.save()</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">django.shortcuts</span> <span class="kn">import</span> <span class="n">render</span><span class="p">,</span> <span class="n">get_object_or_404</span>
<span class="kn">from</span> <span class="nn">.models</span> <span class="kn">import</span> <span class="n">Blog</span><span class="p">,</span> <span class="n">BlogType</span>
<span class="kn">from</span> <span class="nn">django.core.paginator</span> <span class="kn">import</span> <span class="n">Paginator</span>
<span class="kn">from</span> <span class="nn">django.contrib.auth.models</span> <span class="kn">import</span> <span class="n">User</span>
  
  
<span class="c1"># 批量添加数据</span>
<span class="k">def</span> <span class="nf">add</span><span class="p">():</span>
    <span class="n">blog_type</span> <span class="o">=</span> <span class="n">BlogType</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">user</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">30</span><span class="p">):</span>
        <span class="n">Blog</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;第&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;个&#39;</span><span class="p">,</span> <span class="n">blog_type</span><span class="o">=</span><span class="n">blog_type</span><span class="p">,</span> <span class="n">content</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="n">author</span><span class="o">=</span><span class="n">user</span><span class="p">)</span>
  
  
<span class="c1"># 博客列表页</span>
<span class="k">def</span> <span class="nf">blog_list</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="c1"># add()</span>
    <span class="n">context</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">page_num</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">GET</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;page&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>  <span class="c1"># 通过request获取当前页码,默认是第一页</span>
    <span class="n">blogs_all_list</span> <span class="o">=</span> <span class="n">Blog</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>  <span class="c1"># 获取全部博客列表,并存储到对象里</span>
    <span class="n">paginator</span> <span class="o">=</span> <span class="n">Paginator</span><span class="p">(</span><span class="n">blogs_all_list</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>  <span class="c1"># 使用分页组件,参数为 -&gt; ( 需要分页的集合(全部博客列表) , 每页显示几条 ) , 返回一个分页对象,这个对象中包含需要分页的集合数据</span>
    <span class="n">page</span> <span class="o">=</span> <span class="n">paginator</span><span class="o">.</span><span class="n">get_page</span><span class="p">(</span><span class="n">page_num</span><span class="p">)</span>  <span class="c1"># 向分页对象的get_page方法传参数,获取第几页的全部数据,并返回一个对象</span>
  
    <span class="n">current_page_number</span> <span class="o">=</span> <span class="n">page</span><span class="o">.</span><span class="n">number</span>  <span class="c1"># 当前页</span>
    <span class="c1"># 当前页的前两页,当前页和当前页的后两页</span>
    <span class="c1"># context[&#39;many_page_hide_list&#39;] = [current_page_number - 2, current_page_number - 1, current_page_number, current_page_number + 1, current_page_number + 2]</span>
  
    <span class="c1"># 分页数组 : [当前页的第前两个,当前页的前一个,当前页,当前页的后一个,当前页的第后两个] -&gt; 前端遍历页码图标,遍历的就是这五个</span>
    <span class="c1"># 从当前页的前两页到当前页(前两页的页码,和第一页比对大小,取大的,这样就保证了前两页的第一页的页码,最小是1) - 左闭右开</span>
    <span class="c1"># 从当前页到最后一页(后两页最后一页的页码,和&#34;一共有多少页&#34;作比较,取小的,即使是点击最后一页,当前页后面的两页的页码比当前页(最后一页)大,取的也是最后一页)</span>
    <span class="c1"># python3的range方法返回的不是list,需要使用list转一下</span>
    <span class="n">many_page_hide_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
                                 <span class="nb">range</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">current_page_number</span> <span class="o">-</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">current_page_number</span><span class="p">)</span>
                              <span class="p">)</span> <span class="o">+</span> \
                          <span class="nb">list</span><span class="p">(</span>
                                <span class="c1"># 分页对象.num_pages, 分页器中一共有多少页</span>
                                 <span class="nb">range</span><span class="p">(</span><span class="n">current_page_number</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="n">current_page_number</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span> <span class="n">paginator</span><span class="o">.</span><span class="n">num_pages</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
                              <span class="p">)</span>
  
    <span class="c1"># 如果当前分页数组中,第一页的页码大于3,就是说前面至少有两个页码图标,那就向数组最前面添加省略号</span>
    <span class="k">if</span> <span class="n">many_page_hide_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">many_page_hide_list</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;...&#39;</span><span class="p">)</span>
    <span class="c1"># 如果当前分页数组中,最后一页的页码(当前页的后两个的第二个)比(全部数据的最后一页,真正的最后一页)往前2个,就是说 数组中的最后一页 的后面至少有两个页码图标,那就向数组最后面添加省略号</span>
    <span class="k">if</span> <span class="n">paginator</span><span class="o">.</span><span class="n">num_pages</span> <span class="o">-</span> <span class="n">many_page_hide_list</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">many_page_hide_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;...&#39;</span><span class="p">)</span>
    <span class="c1"># 如果当前分页数组中,第一个不是第一页,也就是说当前页的前两个的第一个不是全部数据的第一页,那就把第一页插入到当前分页数组的最前面(因为这样方便从后面比较大的数字直接跳回到第一页)</span>
    <span class="k">if</span> <span class="n">many_page_hide_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">many_page_hide_list</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">many_page_hide_list</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="n">paginator</span><span class="o">.</span><span class="n">num_pages</span><span class="p">:</span>
        <span class="n">many_page_hide_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">paginator</span><span class="o">.</span><span class="n">num_pages</span><span class="p">)</span>
  
    <span class="n">blog_type_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">blog_list</span> <span class="o">=</span> <span class="n">BlogType</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">blog_type</span> <span class="ow">in</span> <span class="n">blog_list</span><span class="p">:</span>
        <span class="n">blog_type</span><span class="o">.</span><span class="n">blog_count</span> <span class="o">=</span> <span class="n">Blog</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">blog_type</span><span class="o">=</span><span class="n">blog_type</span><span class="p">)</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
        <span class="n">blog_type_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">blog_type</span><span class="p">)</span>
  
    <span class="n">context</span><span class="p">[</span><span class="s1">&#39;many_page_hide_list&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">many_page_hide_list</span>
    <span class="n">context</span><span class="p">[</span><span class="s1">&#39;page&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">page</span>
    <span class="n">context</span><span class="p">[</span><span class="s1">&#39;blog_types&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">blog_type_list</span>  <span class="c1"># 博客列表页面,右侧,博客分类数据</span>
  
    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">&#39;blog/blog_list.html&#39;</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>
  
  
<span class="c1"># 博客详情页</span>
<span class="k">def</span> <span class="nf">blog_detail</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">blog_pk</span><span class="p">):</span>
    <span class="n">context</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">blog</span> <span class="o">=</span> <span class="n">get_object_or_404</span><span class="p">(</span><span class="n">Blog</span><span class="p">,</span> <span class="n">pk</span><span class="o">=</span><span class="n">blog_pk</span><span class="p">)</span>
  
    <span class="n">blog</span><span class="o">.</span><span class="n">reader_num</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="n">blog</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
  
    <span class="n">context</span><span class="p">[</span><span class="s1">&#39;blog&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_object_or_404</span><span class="p">(</span><span class="n">Blog</span><span class="p">,</span> <span class="n">pk</span><span class="o">=</span><span class="n">blog_pk</span><span class="p">)</span>  <span class="c1"># get_object_or_404,因为有可能获取不到</span>
  
    <span class="c1"># 属性后面加上 __,后面就可以写 gt(大于)、lt(小于)这种判断过滤器</span>
    <span class="n">context</span><span class="p">[</span><span class="s1">&#39;previous_blog&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Blog</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">create_time__gt</span><span class="o">=</span><span class="n">blog</span><span class="o">.</span><span class="n">create_time</span><span class="p">)</span><span class="o">.</span><span class="n">last</span><span class="p">()</span>  <span class="c1"># 前一篇博客,筛选出大于当前博客(创建时间)的博客,并获取到这些博客的最后一个</span>
    <span class="n">context</span><span class="p">[</span><span class="s1">&#39;next_blog&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Blog</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">create_time__lt</span><span class="o">=</span><span class="n">blog</span><span class="o">.</span><span class="n">create_time</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>  <span class="c1"># 后一篇博客,筛选出小于当前博客(创建时间)的博客,并获取到这些博客的第一个</span>
  	
    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">&#39;blog/blog_detail.html&#39;</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>
  
  
<span class="c1"># 指定分类列表页</span>
<span class="k">def</span> <span class="nf">blogs_with_type</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">blog_type_pk</span><span class="p">):</span>
    <span class="n">context</span> <span class="o">=</span> <span class="p">{}</span>
  
    <span class="n">blog_type</span> <span class="o">=</span> <span class="n">get_object_or_404</span><span class="p">(</span><span class="n">BlogType</span><span class="p">,</span> <span class="n">pk</span><span class="o">=</span><span class="n">blog_type_pk</span><span class="p">)</span>
    <span class="n">page_num</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">GET</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;page&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">blogs_all_list</span> <span class="o">=</span> <span class="n">Blog</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">blog_type</span><span class="o">=</span><span class="n">blog_type</span><span class="p">)</span>
    <span class="n">paginator</span> <span class="o">=</span> <span class="n">Paginator</span><span class="p">(</span><span class="n">blogs_all_list</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
    <span class="n">page</span> <span class="o">=</span> <span class="n">paginator</span><span class="o">.</span><span class="n">get_page</span><span class="p">(</span><span class="n">page_num</span><span class="p">)</span>
  
    <span class="n">current_page_number</span> <span class="o">=</span> <span class="n">page</span><span class="o">.</span><span class="n">number</span>
    <span class="n">many_page_hide_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
                              <span class="nb">range</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">current_page_number</span> <span class="o">-</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">current_page_number</span><span class="p">)</span>
                          <span class="p">)</span> <span class="o">+</span> \
                          <span class="nb">list</span><span class="p">(</span>
                              <span class="nb">range</span><span class="p">(</span><span class="n">current_page_number</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="n">current_page_number</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span> <span class="n">paginator</span><span class="o">.</span><span class="n">num_pages</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
                          <span class="p">)</span>
  
    <span class="k">if</span> <span class="n">many_page_hide_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">many_page_hide_list</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;...&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">paginator</span><span class="o">.</span><span class="n">num_pages</span> <span class="o">-</span> <span class="n">many_page_hide_list</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">many_page_hide_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">paginator</span><span class="o">.</span><span class="n">num_pages</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">many_page_hide_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">many_page_hide_list</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">many_page_hide_list</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="n">paginator</span><span class="o">.</span><span class="n">num_pages</span><span class="p">:</span>
        <span class="n">many_page_hide_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">paginator</span><span class="o">.</span><span class="n">num_pages</span><span class="p">)</span>
  
    <span class="n">context</span><span class="p">[</span><span class="s1">&#39;many_page_hide_list&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">many_page_hide_list</span>
    <span class="n">context</span><span class="p">[</span><span class="s1">&#39;page&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">page</span>
    <span class="n">context</span><span class="p">[</span><span class="s1">&#39;blogs&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Blog</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">blog_type</span><span class="o">=</span><span class="n">blog_type</span><span class="p">)</span>
    <span class="n">context</span><span class="p">[</span><span class="s1">&#39;blog_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">blog_type</span>
    <span class="n">context</span><span class="p">[</span><span class="s1">&#39;blog_types&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">BlogType</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">&#39;blog/blog_with_type.html&#39;</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>在博客列表页面,添加一个浏览次数的字段和眼睛图标</p>
<p><code>blog_list.html</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span><span class="lnt">128
</span><span class="lnt">129
</span><span class="lnt">130
</span><span class="lnt">131
</span><span class="lnt">132
</span><span class="lnt">133
</span><span class="lnt">134
</span><span class="lnt">135
</span><span class="lnt">136
</span><span class="lnt">137
</span><span class="lnt">138
</span><span class="lnt">139
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html">{% extends &#39;base.html&#39; %}
{% load static %}
  
{% block title %}blog_list{% endblock %}
  
{% block nav_blog_active %}active{% endblock %}
  
{% block content %}
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;container&#34;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;row&#34;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;col-sm-8 col-lg-8&#34;</span><span class="p">&gt;</span>
                {# 博客列表 #}
                <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;panel panel-default&#34;</span><span class="p">&gt;</span>
                  {# page是当前页对象 paginator是整个大的分页对象 当前分页对象.paginator,就是回调到整个大的分页对象 当前分页对象.paginator.count,就是整个大的分页对象中全部内容的长度 #}
                  <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;panel-heading&#34;</span><span class="p">&gt;</span>一共有{{ page.paginator.count }}篇博客<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
                      <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;panel-body&#34;</span><span class="p">&gt;</span>
                        {# 遍历当前页的全部数据 #}
                        {% for blog in page.object_list %}
                            <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;blog&#34;</span><span class="p">&gt;</span>
                                <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;{% url &#39;blog_detail&#39; blog.pk %}&#34;</span><span class="p">&gt;</span>
                                    <span class="p">&lt;</span><span class="nt">h3</span><span class="p">&gt;</span>{{blog.title}}<span class="p">&lt;/</span><span class="nt">h3</span><span class="p">&gt;</span>
                                    <span class="p">&lt;</span><span class="nt">p</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;blog_info&#34;</span><span class="p">&gt;</span>
                                        <span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;glyphicon glyphicon-star&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
                                        <span class="p">&lt;</span><span class="nt">span</span><span class="p">&gt;</span>
                                            分类: <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;{% url &#39;blog_with_type&#39; blog.blog_type.pk %}&#34;</span><span class="p">&gt;</span>{{ blog.blog_type }}<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
                                        <span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
                                        <span class="ni">&amp;nbsp;&amp;nbsp;</span>
                                        <span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;glyphicon glyphicon-time&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
                                        <span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;blog_list_li_date&#34;</span><span class="p">&gt;</span>
                                            发表日期:{{ blog.create_time | date:&#34;Y-m-d&#34;}}
                                        <span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
                                        <span class="ni">&amp;nbsp;&amp;nbsp;</span>
                                        <span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;glyphicon glyphicon-eye-open&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
                                        <span class="p">&lt;</span><span class="nt">span</span><span class="p">&gt;</span>浏览次数:{{ blog.reader_num }}<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
                                    <span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
                                <span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
                                <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>{{blog.content | striptags | truncatechars:30}}<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
                            <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
                        {% empty %}
                            <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>暂无博客<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
                        {% endfor %}
                      <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
                <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
  
                {# 分页图标 #}
                {# col-lg-offset-6,行方向向右偏移6列 #}
                <span class="p">&lt;</span><span class="nt">nav</span> <span class="na">aria-label</span><span class="o">=</span><span class="s">&#34;Page navigation&#34;</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;col-lg-offset-6&#34;</span><span class="p">&gt;</span>
                  <span class="p">&lt;</span><span class="nt">ul</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;pagination&#34;</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;</span>
                        {# 当前页对象.has_previous -&gt; 前一页 #}
                        {% if page.has_previous %}
                            {# django中,在href内写 ?xxx,就是在当前页面的路由后面拼接上href中的内容,点击还会跳转 #}
                            {# 当前页对象.previous_page_number -&gt; 当前页的前一页 #}
                            <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;?page={{ page.previous_page_number }}&#34;</span> <span class="na">aria-label</span><span class="o">=</span><span class="s">&#34;Previous&#34;</span><span class="p">&gt;</span>
                                <span class="p">&lt;</span><span class="nt">span</span> <span class="na">aria-hidden</span><span class="o">=</span><span class="s">&#34;true&#34;</span><span class="p">&gt;</span><span class="ni">&amp;laquo;</span><span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
                            <span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
                        {% else %}
                            <span class="p">&lt;</span><span class="nt">span</span> <span class="na">aria-hidden</span><span class="o">=</span><span class="s">&#34;true&#34;</span><span class="p">&gt;</span><span class="ni">&amp;laquo;</span><span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
                        {% endif %}
                    <span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
                    {# 这里遍历的是 当前页的前两页 当前页 当前页的后两页 #}
                    {# 当前页对象.paginator.page_range -&gt; 返回整个分页对象,一共有几页 #}
                    {% for page_child in many_page_hide_list %}
{#                    {% for page_child in page.paginator.page_range %}#}
                        {% if page_child == page.number %}
                            <span class="p">&lt;</span><span class="nt">li</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;active&#34;</span><span class="p">&gt;</span>
                                <span class="p">&lt;</span><span class="nt">span</span><span class="p">&gt;</span>{{ page_child }}<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
                            <span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
                        {% else %}
                            {% if page_child == &#39;...&#39; %}
                                <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;</span>
                                   <span class="p">&lt;</span><span class="nt">span</span><span class="p">&gt;</span>{{ page_child }}<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
                                <span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
                            {% else %}
                                <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;</span>
                                    <span class="p">&lt;</span><span class="nt">span</span><span class="p">&gt;</span>
                                        <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;?page={{ page_child }}&#34;</span><span class="p">&gt;</span>{{ page_child }}<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
                                    <span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
                                <span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
                            {% endif %}
                        {% endif %}
                    {% endfor %}
  
                    <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;</span>
                        {# 当前页对象.has_next -&gt; 后一页 #}
                        {% if page.has_next %}
                        {# 当前页对象.next_page_number -&gt; 当前页的后一页 #}
                          <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;?page={{ page.next_page_number }}&#34;</span> <span class="na">aria-label</span><span class="o">=</span><span class="s">&#34;Next&#34;</span><span class="p">&gt;</span>
                            <span class="p">&lt;</span><span class="nt">span</span> <span class="na">aria-hidden</span><span class="o">=</span><span class="s">&#34;true&#34;</span><span class="p">&gt;</span><span class="ni">&amp;raquo;</span><span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
                          <span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
                        {% else %}
                            <span class="p">&lt;</span><span class="nt">span</span> <span class="na">aria-hidden</span><span class="o">=</span><span class="s">&#34;true&#34;</span><span class="p">&gt;</span><span class="ni">&amp;raquo;</span><span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
                        {% endif %}
                    <span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
                  <span class="p">&lt;/</span><span class="nt">ul</span><span class="p">&gt;</span>
                <span class="p">&lt;/</span><span class="nt">nav</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
  
            {# 博客分类 #}
            <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;col-sm-4 col-lg-4&#34;</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;panel panel-default&#34;</span><span class="p">&gt;</span>
                   <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;panel-heading&#34;</span><span class="p">&gt;</span>博客分类<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
                       <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;panel-body&#34;</span><span class="p">&gt;</span>
                           <span class="p">&lt;</span><span class="nt">ul</span><span class="p">&gt;</span>
                               {% for blog_type in blog_types %}
                                   <span class="p">&lt;</span><span class="nt">li</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;blog_list_li&#34;</span><span class="p">&gt;&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;{% url &#39;blog_with_type&#39; blog_type.pk %}&#34;</span><span class="p">&gt;</span>{{ blog_type.type_name }}({{ blog_type.blog_count }})<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
                               {% empty %}
                                   <span class="p">&lt;</span><span class="nt">li</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;blog_list_li&#34;</span><span class="p">&gt;</span>暂无分类<span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
                               {% endfor %}
                           <span class="p">&lt;/</span><span class="nt">ul</span><span class="p">&gt;</span>
                       <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
                <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
  
                <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;panel panel-default&#34;</span><span class="p">&gt;</span>
                   <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;panel-heading&#34;</span><span class="p">&gt;</span>社区<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
                       <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;panel-body&#34;</span><span class="p">&gt;</span>
                           <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;row other_logo&#34;</span> <span class="na">style</span><span class="o">=</span><span class="s">&#34;display: flex;justify-content: space-between;&#34;</span><span class="p">&gt;</span>
                               <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;https://space.bilibili.com/628950169?spm_id_from=333.1007.0.0&#34;</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;col-md-2&#34;</span><span class="p">&gt;</span>
                                   <span class="p">&lt;</span><span class="nt">img</span> <span class="na">src</span><span class="o">=</span><span class="s">&#34;{% static &#39;images/bilibili.png&#39; %}&#34;</span> <span class="na">alt</span><span class="o">=</span><span class="s">&#34;&#34;</span><span class="p">&gt;</span>
                               <span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
                               <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;https://gitee.com/yuzhoudaima&#34;</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;col-md-2&#34;</span><span class="p">&gt;</span>
                                   <span class="p">&lt;</span><span class="nt">img</span> <span class="na">src</span><span class="o">=</span><span class="s">&#34;{% static &#39;images/gitee.png&#39; %}&#34;</span> <span class="na">alt</span><span class="o">=</span><span class="s">&#34;&#34;</span><span class="p">&gt;</span>
                               <span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
                               <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;https://www.google.com/?hl=zh_CN&#34;</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;col-md-2&#34;</span><span class="p">&gt;</span>
                                   <span class="p">&lt;</span><span class="nt">img</span> <span class="na">src</span><span class="o">=</span><span class="s">&#34;{% static &#39;images/google.png&#39;%}&#34;</span> <span class="na">alt</span><span class="o">=</span><span class="s">&#34;&#34;</span><span class="p">&gt;</span>
                               <span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
                               <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;https://web.telegram.org/&#34;</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;col-md-2&#34;</span><span class="p">&gt;</span>
                                   <span class="p">&lt;</span><span class="nt">img</span> <span class="na">src</span><span class="o">=</span><span class="s">&#34;{% static &#39;images/telegram.png&#39; %}&#34;</span> <span class="na">alt</span><span class="o">=</span><span class="s">&#34;&#34;</span><span class="p">&gt;</span>
                               <span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
                               <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;https://twitter.com/WRiS24sIWr2ICRP&#34;</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;col-md-2&#34;</span><span class="p">&gt;</span>
                                   <span class="p">&lt;</span><span class="nt">img</span> <span class="na">src</span><span class="o">=</span><span class="s">&#34;{% static &#39;images/twitter.png&#39; %}&#34;</span> <span class="na">alt</span><span class="o">=</span><span class="s">&#34;&#34;</span><span class="p">&gt;</span>
                               <span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
                           <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
                       <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
                <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
{% endblock %}
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>但是,这种有个问题</p>
</li>
<li>
<p>假设你在一个页面,不停的刷新,刷新一次就算访问一次</p>
</li>
<li>
<p>第一,这样不算数</p>
</li>
<li>
<p>第二,人家写个脚本,强行访问几十万次,不崩溃了</p>
</li>
<li>
<p>所以改一下</p>
</li>
<li>
<p>在views.py中</p>
</li>
<li>
<p>将<code>博客列表</code>方法的响应,封装到一个对象中</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="n">response</span> <span class="o">=</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">&#39;blog/blog_detail.html&#39;</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>给这个对象设置cookie(key - value)</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="n">response</span><span class="o">.</span><span class="n">set_cookie</span><span class="p">(</span><span class="s1">&#39;blog_</span><span class="si">%s</span><span class="s1">_readed&#39;</span> <span class="o">%</span> <span class="n">blog</span><span class="o">.</span><span class="n">pk</span><span class="p">,</span> <span class="s1">&#39;true&#39;</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>然后将这个对象返回</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="k">return</span> <span class="n">response</span>
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>这样,再次访问页面,页面中就多了一个cookie</p>
</li>
<li>
<p>在函数最上面加上</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="k">if</span> <span class="ow">not</span> <span class="n">request</span><span class="o">.</span><span class="n">COOKIES</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;blog_</span><span class="si">%s</span><span class="s1">_readed&#39;</span> <span class="o">%</span> <span class="n">blog</span><span class="o">.</span><span class="n">pk</span><span class="p">):</span>
    <span class="n">blog</span><span class="o">.</span><span class="n">reader_num</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="n">blog</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>如果这个cookie不存在,说明是<code>第一次访问</code>或者是<code>隔一段时间访问的</code></p>
</li>
<li>
<p>给浏览次数加1</p>
</li>
</ul>
<hr>
<h2 id="浏览次数优化">浏览次数优化</h2>
<h3 id="手写">手写</h3>
<ul>
<li>
<p>上面的cookie方法判断浏览次数的方法,存在一些问题</p>
</li>
<li>
<p>例如,后台修改博客,也会被算作浏览一次</p>
</li>
<li>
<p>本来这个字段是写在<code>blog</code>表中</p>
</li>
<li>
<p>这样,单独创建一个<code>浏览量</code>表</p>
</li>
<li>
<p>在models.py中</p>
<p><code>models.py</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>
<span class="kn">from</span> <span class="nn">django.contrib.auth.models</span> <span class="kn">import</span> <span class="n">User</span>
<span class="kn">from</span> <span class="nn">ckeditor.fields</span> <span class="kn">import</span> <span class="n">RichTextField</span>
<span class="kn">from</span> <span class="nn">django.contrib.contenttypes.models</span> <span class="kn">import</span> <span class="n">ContentType</span>
  
  
<span class="k">class</span> <span class="nc">BlogType</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">type_name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
  
    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">type_name</span>
  
  
<span class="c1"># Create your models here.</span>
<span class="k">class</span> <span class="nc">Blog</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">title</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
    <span class="n">blog_type</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">BlogType</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">DO_NOTHING</span><span class="p">)</span>
    <span class="n">content</span> <span class="o">=</span> <span class="n">RichTextField</span><span class="p">()</span>
    <span class="n">author</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">User</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">DO_NOTHING</span><span class="p">)</span>  <span class="c1"># 外键删除事件,什么都不做  || User是django自带的User对象</span>
    <span class="c1"># reader_num = models.IntegerField(default=0)</span>
    <span class="n">create_time</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">(</span><span class="n">auto_now_add</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>  <span class="c1"># 自动获取当前时间戳 这个类型一旦创建,就不可被更改</span>
    <span class="n">last_updated_time</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">(</span><span class="n">auto_now</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>  <span class="c1"># 自动获取当前时间戳</span>
  
    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&#34;&lt;Blog:</span><span class="si">%s</span><span class="s2">&gt;&#34;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">title</span>
  
    <span class="k">def</span> <span class="nf">get_read_num</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">readnum</span><span class="o">.</span><span class="n">read_num</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">0</span>
  
    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">ordering</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;-create_time&#39;</span><span class="p">]</span>
  
  
<span class="k">class</span> <span class="nc">ReadNum</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">read_num</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">IntegerField</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">blog</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">OneToOneField</span><span class="p">(</span><span class="n">Blog</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">DO_NOTHING</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p><code>浏览量表</code>中的一条数据,对应<code>博客表</code>中的一条数据</p>
</li>
<li>
<p>在<code>博客表</code>中,声明一个函数,用于返回浏览次数</p>
</li>
<li>
<p>这个是怎么实现的呢</p>
<ul>
<li>
<p>1.models.py中的,继承models.Model的类,也就是数据表模型,中的方法,会作为表的字段</p>
</li>
<li>
<p>2.因为<code>浏览次数表</code>中,和<code>博客表</code>进行了一对一绑定,所以可以在<code>博客表模型</code>中直接使用<code>浏览次数</code>属性</p>
<blockquote>
<p><code>浏览次数表</code>命名方式是大写,就可以在<code>博客表模型</code>中,用小写方式调用</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="k">def</span> <span class="nf">get_read_num</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">readnum</span><span class="o">.</span><span class="n">read_num</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">0</span>
</code></pre></td></tr></table>
</div>
</div><blockquote>
<p>self.readnum , 是当前<code>博客对象</code>对应的<code>浏览次数对象</code>,这个关系在<code>浏览次数表模型</code>中进行了声明</p>
<p>self.readnum.read_num,就是调用<code>浏览次数对象</code>的<code>浏览次数属性</code></p>
<p>获取这个属性的时候,正常获取,当前<code>博客对象</code>对应的<code>浏览次数对象</code></p>
<p>获取到了,返回这个对象的<code>浏览次数</code></p>
<p>获取不到,返回0</p>
</blockquote>
</li>
</ul>
</li>
</ul>
<p><strong>就,这就是博客表的浏览次数字段,不过这个字段被独立出一个表,这个表中每个对象有两个属性,一个是博客,一个是博客阅读数量</strong></p>
<ul>
<li>
<p>然后,views.py中,博客详情页,判断是否cookie,就可以这样写</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="k">if</span> <span class="ow">not</span> <span class="n">request</span><span class="o">.</span><span class="n">COOKIES</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;blog_</span><span class="si">%s</span><span class="s1">_readed&#39;</span> <span class="o">%</span> <span class="n">blog</span><span class="o">.</span><span class="n">pk</span><span class="p">):</span>
  <span class="k">if</span> <span class="n">ReadNum</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">blog</span><span class="o">=</span><span class="n">blog</span><span class="p">)</span><span class="o">.</span><span class="n">count</span><span class="p">():</span>
        <span class="n">readnum</span> <span class="o">=</span> <span class="n">ReadNum</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">blog</span><span class="o">=</span><span class="n">blog</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">readnum</span> <span class="o">=</span> <span class="n">ReadNum</span><span class="p">(</span><span class="n">blog</span><span class="o">=</span><span class="n">blog</span><span class="p">)</span>
  
    <span class="n">readnum</span><span class="o">.</span><span class="n">read_num</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="n">readnum</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</code></pre></td></tr></table>
</div>
</div><blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="n">ReadNum</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">blog</span><span class="o">=</span><span class="n">blog</span><span class="p">)</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
</code></pre></td></tr></table>
</div>
</div><p>在<code>浏览次数表</code>中,是否可以查询到当前博客</p>
<p>如果查得到</p>
<p>查询出这个<code>当前博客</code>在<code>浏览次数表</code>中所属的对象</p>
<p>如果查不到</p>
<p>就初始化一个<code>浏览次数</code>对象,参数是当前博客</p>
<p>因为你在上面的<code>博客表</code>中的<code>get_read_num</code>函数 | 浏览次数字段中,如果获取不到(初始化),那么默认返回0,这样就防止了空值</p>
</blockquote>
</li>
<li>
<p>最后在admin.py中设置一下</p>
<p><code>admin.py</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">django.contrib</span> <span class="kn">import</span> <span class="n">admin</span>
<span class="kn">from</span> <span class="nn">.models</span> <span class="kn">import</span> <span class="n">BlogType</span><span class="p">,</span> <span class="n">Blog</span><span class="p">,</span> <span class="n">ReadNum</span>
  
  
<span class="nd">@admin.register</span><span class="p">(</span><span class="n">BlogType</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">BlogTypeAdmin</span><span class="p">(</span><span class="n">admin</span><span class="o">.</span><span class="n">ModelAdmin</span><span class="p">):</span>
    <span class="n">list_display</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;type_name&#39;</span><span class="p">)</span>
  
  
<span class="nd">@admin.register</span><span class="p">(</span><span class="n">Blog</span><span class="p">)</span>
<span class="c1"># Register your models here.</span>
<span class="k">class</span> <span class="nc">BlogAdmin</span><span class="p">(</span><span class="n">admin</span><span class="o">.</span><span class="n">ModelAdmin</span><span class="p">):</span>
    <span class="c1"># list_display = (&#39;id&#39;, &#39;title&#39;, &#39;blog_type&#39;, &#39;content&#39;, &#39;author&#39;, &#39;reader_num&#39;, &#39;create_time&#39;, &#39;last_updated_time&#39;)</span>
    <span class="n">list_display</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;title&#39;</span><span class="p">,</span> <span class="s1">&#39;blog_type&#39;</span><span class="p">,</span> <span class="s1">&#39;content&#39;</span><span class="p">,</span> <span class="s1">&#39;author&#39;</span><span class="p">,</span> <span class="s1">&#39;get_read_num&#39;</span><span class="p">,</span> <span class="s1">&#39;create_time&#39;</span><span class="p">,</span> <span class="s1">&#39;last_updated_time&#39;</span><span class="p">)</span>
  
  
<span class="nd">@admin.register</span><span class="p">(</span><span class="n">ReadNum</span><span class="p">)</span>
<span class="c1"># Register your models here.</span>
<span class="k">class</span> <span class="nc">ReadNumAdmin</span><span class="p">(</span><span class="n">admin</span><span class="o">.</span><span class="n">ModelAdmin</span><span class="p">):</span>
    <span class="n">list_display</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;read_num&#39;</span><span class="p">,</span> <span class="s1">&#39;blog&#39;</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>在前端获取浏览次数,就是调用<code>博客表模型</code>的<code>get_read_num</code>函数,函数会将浏览次数返回</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-django" data-lang="django"><span class="x">&lt;span&gt;浏览次数:(</span><span class="cp">{{</span> <span class="nv">blog.get_read_num</span> <span class="cp">}}</span><span class="x">)&lt;/span&gt;
</span></code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>配置下数据库</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">python3 manage.py makemigrations
python3 manage.py migrate
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>这样,后台修改博客,也不会影响到浏览次数</p>
</li>
</ul>
<hr>
<h3 id="使用官方组件---任意类型对象的浏览次数增加">使用官方组件 - 任意类型对象的浏览次数增加</h3>
<ul>
<li>
<p>将<code>blog</code> app中的views.py中的博客详情页的浏览次数 + 1,注释掉</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="c1"># 博客详情页</span>
<span class="k">def</span> <span class="nf">blog_detail</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">blog_pk</span><span class="p">):</span>
    <span class="n">context</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">blog</span> <span class="o">=</span> <span class="n">get_object_or_404</span><span class="p">(</span><span class="n">Blog</span><span class="p">,</span> <span class="n">pk</span><span class="o">=</span><span class="n">blog_pk</span><span class="p">)</span>
  
    <span class="k">if</span> <span class="ow">not</span> <span class="n">request</span><span class="o">.</span><span class="n">COOKIES</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;blog_</span><span class="si">%s</span><span class="s1">_readed&#39;</span> <span class="o">%</span> <span class="n">blog</span><span class="o">.</span><span class="n">pk</span><span class="p">):</span>
        <span class="c1"># blog.reader_num += 1</span>
        <span class="c1"># blog.save()</span>
  
        <span class="s1">&#39;&#39;&#39;
</span><span class="s1">        if ReadNum.objects.filter(blog=blog).count():
</span><span class="s1">            readnum = ReadNum.objects.get(blog=blog)
</span><span class="s1">        else:
</span><span class="s1">            readnum = ReadNum(blog=blog)
</span><span class="s1">  
</span><span class="s1">        readnum.read_num += 1
</span><span class="s1">        readnum.save()
</span><span class="s1">        &#39;&#39;&#39;</span>
        <span class="k">pass</span>
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>将<code>blog</code> app中的models.py中的<code>博客表模型</code>中的<code>get_read_num</code>函数,也就是<code>浏览次数字段</code></p>
</li>
<li>
<p>注释掉</p>
</li>
<li>
<p>把浏览次数的类 - 表模型注释掉</p>
<p><code>models.py</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>
<span class="kn">from</span> <span class="nn">django.contrib.auth.models</span> <span class="kn">import</span> <span class="n">User</span>
<span class="kn">from</span> <span class="nn">ckeditor.fields</span> <span class="kn">import</span> <span class="n">RichTextField</span>
<span class="kn">from</span> <span class="nn">django.contrib.contenttypes.models</span> <span class="kn">import</span> <span class="n">ContentType</span>
<span class="kn">from</span> <span class="nn">django.contrib.contenttypes.models</span> <span class="kn">import</span> <span class="n">ContentType</span>
<span class="kn">from</span> <span class="nn">read_statistics.models</span> <span class="kn">import</span> <span class="n">ReadNum</span>
<span class="kn">from</span> <span class="nn">django.core</span> <span class="kn">import</span> <span class="n">exceptions</span>
  
  
<span class="k">class</span> <span class="nc">BlogType</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">type_name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
  
    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">type_name</span>
  
  
<span class="c1"># Create your models here.</span>
<span class="k">class</span> <span class="nc">Blog</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">title</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
    <span class="n">blog_type</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">BlogType</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">DO_NOTHING</span><span class="p">)</span>
    <span class="n">content</span> <span class="o">=</span> <span class="n">RichTextField</span><span class="p">()</span>
    <span class="n">author</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">User</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">DO_NOTHING</span><span class="p">)</span>  <span class="c1"># 外键删除事件,什么都不做  || User是django自带的User对象</span>
    <span class="c1"># reader_num = models.IntegerField(default=0)</span>
    <span class="n">create_time</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">(</span><span class="n">auto_now_add</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>  <span class="c1"># 自动获取当前时间戳 这个类型一旦创建,就不可被更改</span>
    <span class="n">last_updated_time</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">(</span><span class="n">auto_now</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>  <span class="c1"># 自动获取当前时间戳</span>
  
    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&#34;&lt;Blog:</span><span class="si">%s</span><span class="s2">&gt;&#34;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">title</span>
  
    <span class="s1">&#39;&#39;&#39;
</span><span class="s1">    def get_read_num(self):
</span><span class="s1">        try:
</span><span class="s1">            return self.readnum.read_num
</span><span class="s1">        except Exception as e:
</span><span class="s1">            return 0
</span><span class="s1">    &#39;&#39;&#39;</span>
  
    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">ordering</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;-create_time&#39;</span><span class="p">]</span>
  
  
<span class="s1">&#39;&#39;&#39;
</span><span class="s1">class ReadNum(models.Model):
</span><span class="s1">    read_num = models.IntegerField(default=0)
</span><span class="s1">    blog = models.OneToOneField(Blog, on_delete=models.DO_NOTHING)
</span><span class="s1">&#39;&#39;&#39;</span>
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>将admin中的 显示浏览次数的 class注释掉</p>
</li>
<li>
<p>和blog表中的,显示浏览次数的字段注释掉</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">django.contrib</span> <span class="kn">import</span> <span class="n">admin</span>
<span class="kn">from</span> <span class="nn">.models</span> <span class="kn">import</span> <span class="n">BlogType</span><span class="p">,</span> <span class="n">Blog</span>
  
  
<span class="nd">@admin.register</span><span class="p">(</span><span class="n">BlogType</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">BlogTypeAdmin</span><span class="p">(</span><span class="n">admin</span><span class="o">.</span><span class="n">ModelAdmin</span><span class="p">):</span>
    <span class="n">list_display</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;type_name&#39;</span><span class="p">)</span>
  
  
<span class="nd">@admin.register</span><span class="p">(</span><span class="n">Blog</span><span class="p">)</span>
<span class="c1"># Register your models here.</span>
<span class="k">class</span> <span class="nc">BlogAdmin</span><span class="p">(</span><span class="n">admin</span><span class="o">.</span><span class="n">ModelAdmin</span><span class="p">):</span>
    <span class="c1"># list_display = (&#39;id&#39;, &#39;title&#39;, &#39;blog_type&#39;, &#39;content&#39;, &#39;author&#39;, &#39;reader_num&#39;, &#39;create_time&#39;, &#39;last_updated_time&#39;)</span>
    <span class="c1"># list_display = (&#39;id&#39;, &#39;title&#39;, &#39;blog_type&#39;, &#39;content&#39;, &#39;author&#39;, &#39;get_read_num&#39;, &#39;create_time&#39;, &#39;last_updated_time&#39;)</span>
    <span class="n">list_display</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;title&#39;</span><span class="p">,</span> <span class="s1">&#39;blog_type&#39;</span><span class="p">,</span> <span class="s1">&#39;content&#39;</span><span class="p">,</span> <span class="s1">&#39;author&#39;</span><span class="p">,</span> <span class="s1">&#39;create_time&#39;</span><span class="p">,</span> <span class="s1">&#39;last_updated_time&#39;</span><span class="p">)</span>
  
<span class="s1">&#39;&#39;&#39;
</span><span class="s1">@admin.register(ReadNum)
</span><span class="s1"># Register your models here.
</span><span class="s1">class ReadNumAdmin(admin.ModelAdmin):
</span><span class="s1">    list_display = (&#39;id&#39;, &#39;read_num&#39;, &#39;blog&#39;)
</span><span class="s1">&#39;&#39;&#39;</span>
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>创建一个子应用<code>read_statistics</code></p>
</li>
<li>
<p>在settings.py中注册</p>
</li>
<li>
<p>在<code>read_statistics</code>的models.py中,声明浏览次数表模型</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>
  
  
<span class="c1"># Create your models here.</span>
<span class="k">class</span> <span class="nc">ReadNum</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">read_num</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">IntegerField</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>这个表,是要存储对象和这个对象的浏览次数的</p>
</li>
<li>
<p>打开<a href="https://docs.djangoproject.com/en/2.0/ref/contrib/contenttypes/">官方文档</a></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">django.contrib.contenttypes.fields</span> <span class="kn">import</span> <span class="n">GenericForeignKey</span>
<span class="kn">from</span> <span class="nn">django.contrib.contenttypes.models</span> <span class="kn">import</span> <span class="n">ContentType</span>
<span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>
  
<span class="k">class</span> <span class="nc">TaggedItem</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">tag</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">SlugField</span><span class="p">()</span>
    <span class="n">content_type</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">ContentType</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">)</span>
    <span class="n">object_id</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">PositiveIntegerField</span><span class="p">()</span>
    <span class="n">content_object</span> <span class="o">=</span> <span class="n">GenericForeignKey</span><span class="p">(</span><span class="s1">&#39;content_type&#39;</span><span class="p">,</span> <span class="s1">&#39;object_id&#39;</span><span class="p">)</span>
  
    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">tag</span>
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>这个里面,tag没啥用,一个标签</p>
</li>
<li>
<p>content_type : 要增加浏览次数的对象的类型, ContentType是django的通用类型</p>
</li>
<li>
<p>object_id :  要增加浏览次数对象,在它主表中的id</p>
</li>
<li>
<p>content_object : 将上面两者封装成对象,因为查询一个数据表中的数据,无非就是<code>数据对象的类型</code>和<code>这条数据的id</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>
<span class="kn">from</span> <span class="nn">django.contrib.contenttypes.fields</span> <span class="kn">import</span> <span class="n">GenericForeignKey</span>
<span class="kn">from</span> <span class="nn">django.contrib.contenttypes.models</span> <span class="kn">import</span> <span class="n">ContentType</span>
  
  
<span class="c1"># Create your models here.</span>
<span class="k">class</span> <span class="nc">ReadNum</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">read_num</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">IntegerField</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">content_type</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">ContentType</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">DO_NOTHING</span><span class="p">)</span>
    <span class="n">object_id</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">PositiveIntegerField</span><span class="p">()</span>
    <span class="n">content_object</span> <span class="o">=</span> <span class="n">GenericForeignKey</span><span class="p">(</span><span class="s1">&#39;content_type&#39;</span><span class="p">,</span> <span class="s1">&#39;object_id&#39;</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>在read_statistics的admin.py中,设置数据表显示</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">django.contrib</span> <span class="kn">import</span> <span class="n">admin</span>
<span class="kn">from</span> <span class="nn">.models</span> <span class="kn">import</span> <span class="n">ReadNum</span>
  
  
<span class="c1"># Register your models here.</span>
<span class="nd">@admin.register</span><span class="p">(</span><span class="n">ReadNum</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">ReadNumAdmin</span><span class="p">(</span><span class="n">admin</span><span class="o">.</span><span class="n">ModelAdmin</span><span class="p">):</span>
   <span class="n">list_display</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;read_num&#39;</span><span class="p">,</span> <span class="s1">&#39;content_object&#39;</span><span class="p">]</span>
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>这样,<code>通用浏览次数表</code>就做好了</p>
</li>
<li>
<p>你只需要传进去表里的数据类型和要操作的id(或者其他字段),实例化出一个对象,就可以操作了</p>
</li>
<li>
<p>在blog - app的models.py中,设置 浏览次数 字段</p>
<p><code>models.py</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>
<span class="kn">from</span> <span class="nn">django.contrib.auth.models</span> <span class="kn">import</span> <span class="n">User</span>
<span class="kn">from</span> <span class="nn">ckeditor.fields</span> <span class="kn">import</span> <span class="n">RichTextField</span>
<span class="kn">from</span> <span class="nn">django.contrib.contenttypes.models</span> <span class="kn">import</span> <span class="n">ContentType</span>
<span class="kn">from</span> <span class="nn">django.contrib.contenttypes.models</span> <span class="kn">import</span> <span class="n">ContentType</span>
<span class="kn">from</span> <span class="nn">read_statistics.models</span> <span class="kn">import</span> <span class="n">ReadNum</span>
<span class="kn">from</span> <span class="nn">django.core</span> <span class="kn">import</span> <span class="n">exceptions</span>
  
  
<span class="k">class</span> <span class="nc">BlogType</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">type_name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
  
    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">type_name</span>
  
  
<span class="c1"># Create your models here.</span>
<span class="k">class</span> <span class="nc">Blog</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">title</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
    <span class="n">blog_type</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">BlogType</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">DO_NOTHING</span><span class="p">)</span>
    <span class="n">content</span> <span class="o">=</span> <span class="n">RichTextField</span><span class="p">()</span>
    <span class="n">author</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">User</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">DO_NOTHING</span><span class="p">)</span>  <span class="c1"># 外键删除事件,什么都不做  || User是django自带的User对象</span>
    <span class="c1"># reader_num = models.IntegerField(default=0)</span>
    <span class="n">create_time</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">(</span><span class="n">auto_now_add</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>  <span class="c1"># 自动获取当前时间戳 这个类型一旦创建,就不可被更改</span>
    <span class="n">last_updated_time</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">(</span><span class="n">auto_now</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>  <span class="c1"># 自动获取当前时间戳</span>
  
    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&#34;&lt;Blog:</span><span class="si">%s</span><span class="s2">&gt;&#34;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">title</span>
  
    <span class="k">def</span> <span class="nf">get_read_num</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">ct</span> <span class="o">=</span> <span class="n">ContentType</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get_for_model</span><span class="p">(</span><span class="n">Blog</span><span class="p">)</span>
            <span class="n">readnum</span> <span class="o">=</span> <span class="n">ReadNum</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">content_type</span><span class="o">=</span><span class="n">ct</span><span class="p">,</span> <span class="n">object_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">pk</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">readnum</span><span class="o">.</span><span class="n">read_num</span>
        <span class="k">except</span> <span class="n">exceptions</span><span class="o">.</span><span class="n">ObjectDoesNotExist</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">0</span>
  
    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">ordering</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;-create_time&#39;</span><span class="p">]</span>
</code></pre></td></tr></table>
</div>
</div><ul>
<li>
<p>1.ContentType.objects.get_for_model(要增加浏览次数的对象的类型)</p>
<blockquote>
<p>实例化出一个通用类型,django使用ContentType,将对象的类型,传为了ContentType和Blog的综合类型,只有这样的类型才能被用于<code>通用浏览次数模型</code></p>
</blockquote>
</li>
<li>
<p>2.ReadNum.objects.get(content_type=ct, object_id=self.pk)</p>
<blockquote>
<p>像<code>read_statistics</code>中一样,声明了 要操作的对象的类型(上面实例化出的通用类型) 和id,这里就是实例化出这个对象</p>
<p>然后,ContentType,就会在这个类型的表(Blog)中,通过id查询出这个对象,然后返回</p>
</blockquote>
</li>
<li>
<p>3.返回这个对象</p>
</li>
</ul>
</li>
<li>
<p>在blog的views.py中,重新编写<code>浏览次数 + 1</code>的算法</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="c1"># 博客详情页</span>
<span class="k">def</span> <span class="nf">blog_detail</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">blog_pk</span><span class="p">):</span>
    <span class="n">context</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">blog</span> <span class="o">=</span> <span class="n">get_object_or_404</span><span class="p">(</span><span class="n">Blog</span><span class="p">,</span> <span class="n">pk</span><span class="o">=</span><span class="n">blog_pk</span><span class="p">)</span>
  
    <span class="k">if</span> <span class="ow">not</span> <span class="n">request</span><span class="o">.</span><span class="n">COOKIES</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;blog_</span><span class="si">%s</span><span class="s1">_readed&#39;</span> <span class="o">%</span> <span class="n">blog</span><span class="o">.</span><span class="n">pk</span><span class="p">):</span>
  
        <span class="n">ct</span> <span class="o">=</span> <span class="n">ContentType</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get_for_model</span><span class="p">(</span><span class="n">Blog</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ReadNum</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">content_type</span><span class="o">=</span><span class="n">ct</span><span class="p">,</span> <span class="n">object_id</span><span class="o">=</span><span class="n">blog</span><span class="o">.</span><span class="n">pk</span><span class="p">)</span><span class="o">.</span><span class="n">count</span><span class="p">():</span>
            <span class="n">readnum</span> <span class="o">=</span> <span class="n">ReadNum</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">content_type</span><span class="o">=</span><span class="n">ct</span><span class="p">,</span> <span class="n">object_id</span><span class="o">=</span><span class="n">blog</span><span class="o">.</span><span class="n">pk</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">readnum</span> <span class="o">=</span> <span class="n">ReadNum</span><span class="p">(</span><span class="n">content_type</span><span class="o">=</span><span class="n">ct</span><span class="p">,</span> <span class="n">object_id</span><span class="o">=</span><span class="n">blog</span><span class="o">.</span><span class="n">pk</span><span class="p">)</span>
  
        <span class="n">readnum</span><span class="o">.</span><span class="n">read_num</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">readnum</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>就是把原来的查询条件,换成了通过<code>对象类型</code>和<code>id</code>查询,因为数据表改动了</p>
</li>
<li>
<p>最后再将这个字段,在blog的admin中显示出来</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">django.contrib</span> <span class="kn">import</span> <span class="n">admin</span>
<span class="kn">from</span> <span class="nn">.models</span> <span class="kn">import</span> <span class="n">BlogType</span><span class="p">,</span> <span class="n">Blog</span>
  
  
<span class="nd">@admin.register</span><span class="p">(</span><span class="n">BlogType</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">BlogTypeAdmin</span><span class="p">(</span><span class="n">admin</span><span class="o">.</span><span class="n">ModelAdmin</span><span class="p">):</span>
    <span class="n">list_display</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;type_name&#39;</span><span class="p">)</span>
  
  
<span class="nd">@admin.register</span><span class="p">(</span><span class="n">Blog</span><span class="p">)</span>
<span class="c1"># Register your models here.</span>
<span class="k">class</span> <span class="nc">BlogAdmin</span><span class="p">(</span><span class="n">admin</span><span class="o">.</span><span class="n">ModelAdmin</span><span class="p">):</span>
    <span class="c1"># list_display = (&#39;id&#39;, &#39;title&#39;, &#39;blog_type&#39;, &#39;content&#39;, &#39;author&#39;, &#39;reader_num&#39;, &#39;create_time&#39;, &#39;last_updated_time&#39;)</span>
    <span class="c1"># list_display = (&#39;id&#39;, &#39;title&#39;, &#39;blog_type&#39;, &#39;content&#39;, &#39;author&#39;, &#39;get_read_num&#39;, &#39;create_time&#39;, &#39;last_updated_time&#39;)</span>
    <span class="c1"># list_display = (&#39;id&#39;, &#39;title&#39;, &#39;blog_type&#39;, &#39;content&#39;, &#39;author&#39;, &#39;create_time&#39;, &#39;last_updated_time&#39;)</span>
    <span class="n">list_display</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;title&#39;</span><span class="p">,</span> <span class="s1">&#39;blog_type&#39;</span><span class="p">,</span> <span class="s1">&#39;content&#39;</span><span class="p">,</span> <span class="s1">&#39;author&#39;</span><span class="p">,</span> <span class="s1">&#39;get_read_num&#39;</span><span class="p">,</span> <span class="s1">&#39;create_time&#39;</span><span class="p">,</span> <span class="s1">&#39;last_updated_time&#39;</span><span class="p">)</span>
  
  
<span class="s1">&#39;&#39;&#39;
</span><span class="s1">@admin.register(ReadNum)
</span><span class="s1"># Register your models here.
</span><span class="s1">class ReadNumAdmin(admin.ModelAdmin):
</span><span class="s1">    list_display = (&#39;id&#39;, &#39;read_num&#39;, &#39;blog&#39;)
</span><span class="s1">&#39;&#39;&#39;</span>
</code></pre></td></tr></table>
</div>
</div></li>
</ul>
<h3 id="代码优化">代码优化</h3>
<h4 id="提取阅读数量字段函数出来">提取阅读数量字段函数出来</h4>
<ul>
<li>
<p>blog表模型中,有一个<code>get_read_num</code>函数,作为blog的阅读数量字段</p>
</li>
<li>
<p>可以把它提取出来,到<code>read_statistics</code> - app的models.py中,单独作为一个表,作为扩展方法</p>
<p><code>read_statistics/models.py</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">django.core</span> <span class="kn">import</span> <span class="n">exceptions</span>
<span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>
<span class="kn">from</span> <span class="nn">django.contrib.contenttypes.fields</span> <span class="kn">import</span> <span class="n">GenericForeignKey</span>
<span class="kn">from</span> <span class="nn">django.contrib.contenttypes.models</span> <span class="kn">import</span> <span class="n">ContentType</span>
  
  
<span class="c1"># Create your models here.</span>
<span class="k">class</span> <span class="nc">ReadNum</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">read_num</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">IntegerField</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">content_type</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">ContentType</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">DO_NOTHING</span><span class="p">)</span>
    <span class="n">object_id</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">PositiveIntegerField</span><span class="p">()</span>
    <span class="n">content_object</span> <span class="o">=</span> <span class="n">GenericForeignKey</span><span class="p">(</span><span class="s1">&#39;content_type&#39;</span><span class="p">,</span> <span class="s1">&#39;object_id&#39;</span><span class="p">)</span>
  
  
<span class="k">class</span> <span class="nc">ReadNumExpandMethod</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">get_read_num</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">ct</span> <span class="o">=</span> <span class="n">ContentType</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get_for_model</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            <span class="n">readnum</span> <span class="o">=</span> <span class="n">ReadNum</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">content_type</span><span class="o">=</span><span class="n">ct</span><span class="p">,</span> <span class="n">object_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">pk</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">readnum</span><span class="o">.</span><span class="n">read_num</span>
        <span class="k">except</span> <span class="n">exceptions</span><span class="o">.</span><span class="n">ObjectDoesNotExist</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">0</span>
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>对于blog,想要使用<code>get_read_nums</code>,可以直接继承这个类,继承这个类,就有它的全部方法了</p>
</li>
<li>
<p>这样的代码扩展性就更高了</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>
<span class="kn">from</span> <span class="nn">django.contrib.auth.models</span> <span class="kn">import</span> <span class="n">User</span>
<span class="kn">from</span> <span class="nn">ckeditor.fields</span> <span class="kn">import</span> <span class="n">RichTextField</span>
<span class="kn">from</span> <span class="nn">django.contrib.contenttypes.models</span> <span class="kn">import</span> <span class="n">ContentType</span>
<span class="kn">from</span> <span class="nn">django.contrib.contenttypes.models</span> <span class="kn">import</span> <span class="n">ContentType</span>
<span class="kn">from</span> <span class="nn">read_statistics.models</span> <span class="kn">import</span> <span class="n">ReadNum</span><span class="p">,</span> <span class="n">ReadNumExpandMethod</span>
  
  
<span class="k">class</span> <span class="nc">BlogType</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">type_name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
  
    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">type_name</span>
  
  
<span class="c1"># Create your models here.</span>
<span class="k">class</span> <span class="nc">Blog</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">,</span> <span class="n">ReadNumExpandMethod</span><span class="p">):</span>
    <span class="n">title</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
    <span class="n">blog_type</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">BlogType</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">DO_NOTHING</span><span class="p">)</span>
    <span class="n">content</span> <span class="o">=</span> <span class="n">RichTextField</span><span class="p">()</span>
    <span class="n">author</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">User</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">DO_NOTHING</span><span class="p">)</span>  <span class="c1"># 外键删除事件,什么都不做  || User是django自带的User对象</span>
    <span class="c1"># reader_num = models.IntegerField(default=0)</span>
    <span class="n">create_time</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">(</span><span class="n">auto_now_add</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>  <span class="c1"># 自动获取当前时间戳 这个类型一旦创建,就不可被更改</span>
    <span class="n">last_updated_time</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">(</span><span class="n">auto_now</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>  <span class="c1"># 自动获取当前时间戳</span>
  
    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&#34;&lt;Blog:</span><span class="si">%s</span><span class="s2">&gt;&#34;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">title</span>
  
    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">ordering</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;-create_time&#39;</span><span class="p">]</span>
</code></pre></td></tr></table>
</div>
</div></li>
</ul>
<h4 id="将viewspy中判断cookie的部分代码提取出来到一个单独的utilspy文件">将views.py中,判断cookie的部分代码提取出来,到一个单独的utils.py文件</h4>
<ul>
<li>
<p>在<code>read_statistics</code> - app下,创建utils.py文件</p>
</li>
<li>
<p>文件中创建一个方法,并将判断cookie部分的代码,复制到里面</p>
<p><code>utils.py</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">django.contrib.contenttypes.models</span> <span class="kn">import</span> <span class="n">ContentType</span>
<span class="kn">from</span> <span class="nn">read_statistics.models</span> <span class="kn">import</span> <span class="n">ReadNum</span>
  
<span class="c1"># 在调用者那里,你只需要将要增加浏览次数的对象传入到方法中就好了</span>
<span class="k">def</span> <span class="nf">read_statistics_once_read</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
    <span class="n">ct</span> <span class="o">=</span> <span class="n">ContentType</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get_for_model</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
    <span class="n">key</span> <span class="o">=</span> <span class="s2">&#34;</span><span class="si">%s</span><span class="s2">_</span><span class="si">%s</span><span class="s2">_read&#34;</span> <span class="o">%</span> <span class="p">(</span><span class="n">ct</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="n">obj</span><span class="o">.</span><span class="n">pk</span><span class="p">)</span> <span class="c1"># cookie的key</span>
  
    <span class="k">if</span> <span class="ow">not</span> <span class="n">request</span><span class="o">.</span><span class="n">COOKIES</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">ReadNum</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">content_type</span><span class="o">=</span><span class="n">ct</span><span class="p">,</span> <span class="n">object_id</span><span class="o">=</span><span class="n">obj</span><span class="o">.</span><span class="n">pk</span><span class="p">)</span><span class="o">.</span><span class="n">count</span><span class="p">():</span>
            <span class="n">readnum</span> <span class="o">=</span> <span class="n">ReadNum</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">content_type</span><span class="o">=</span><span class="n">ct</span><span class="p">,</span> <span class="n">object_id</span><span class="o">=</span><span class="n">obj</span><span class="o">.</span><span class="n">pk</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">readnum</span> <span class="o">=</span> <span class="n">ReadNum</span><span class="p">(</span><span class="n">content_type</span><span class="o">=</span><span class="n">ct</span><span class="p">,</span> <span class="n">object_id</span><span class="o">=</span><span class="n">obj</span><span class="o">.</span><span class="n">pk</span><span class="p">)</span>
  
        <span class="n">readnum</span><span class="o">.</span><span class="n">read_num</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">readnum</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
  
    <span class="k">return</span> <span class="n">key</span> <span class="c1"># 将这个key返回</span>
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>调用方views.py,只需要获取到这个key</p>
<p><code>views.py</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">read_statistics.utils</span> <span class="kn">import</span> <span class="n">read_statistics_once_read</span>
  
<span class="c1"># 博客详情页</span>
<span class="k">def</span> <span class="nf">blog_detail</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">blog_pk</span><span class="p">):</span>
    <span class="n">context</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">blog</span> <span class="o">=</span> <span class="n">get_object_or_404</span><span class="p">(</span><span class="n">Blog</span><span class="p">,</span> <span class="n">pk</span><span class="o">=</span><span class="n">blog_pk</span><span class="p">)</span>
  
    <span class="c1"># 调用方法,获取key</span>
    <span class="n">read_cookie_key</span> <span class="o">=</span> <span class="n">read_statistics_once_read</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">blog</span><span class="p">)</span>
  
    <span class="n">context</span><span class="p">[</span><span class="s1">&#39;blog&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_object_or_404</span><span class="p">(</span><span class="n">Blog</span><span class="p">,</span> <span class="n">pk</span><span class="o">=</span><span class="n">blog_pk</span><span class="p">)</span>  
  
    <span class="n">context</span><span class="p">[</span><span class="s1">&#39;previous_blog&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Blog</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">create_time__gt</span><span class="o">=</span><span class="n">blog</span><span class="o">.</span><span class="n">create_time</span><span class="p">)</span><span class="o">.</span><span class="n">last</span><span class="p">()</span>
    <span class="n">context</span><span class="p">[</span><span class="s1">&#39;next_blog&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Blog</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">create_time__lt</span><span class="o">=</span><span class="n">blog</span><span class="o">.</span><span class="n">create_time</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>  
  
    <span class="n">response</span> <span class="o">=</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">&#39;blog/blog_detail.html&#39;</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>
    <span class="n">response</span><span class="o">.</span><span class="n">set_cookie</span><span class="p">(</span><span class="n">read_cookie_key</span><span class="p">,</span> <span class="s1">&#39;true&#39;</span><span class="p">)</span> <span class="c1"># 将这个key设置到cookie中</span>
    <span class="k">return</span> <span class="n">response</span>
</code></pre></td></tr></table>
</div>
</div></li>
</ul>
<h2 id="制作一个首页图表统计7天内浏览次数">制作一个首页图表,统计7天内浏览次数</h2>
<ul>
<li>
<p>在<code>read_statistics</code> - app中</p>
</li>
<li>
<p>复制出一个<code>浏览次数的类</code></p>
<p><code>models.py</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">django.core</span> <span class="kn">import</span> <span class="n">exceptions</span>
<span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>
<span class="kn">from</span> <span class="nn">django.contrib.contenttypes.fields</span> <span class="kn">import</span> <span class="n">GenericForeignKey</span>
<span class="kn">from</span> <span class="nn">django.contrib.contenttypes.models</span> <span class="kn">import</span> <span class="n">ContentType</span>
<span class="kn">from</span> <span class="nn">django.utils</span> <span class="kn">import</span> <span class="n">timezone</span>
  
  
<span class="c1"># Create your models here.</span>
<span class="k">class</span> <span class="nc">ReadNum</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">read_num</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">IntegerField</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">content_type</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">ContentType</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">DO_NOTHING</span><span class="p">)</span>
    <span class="n">object_id</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">PositiveIntegerField</span><span class="p">()</span>
    <span class="n">content_object</span> <span class="o">=</span> <span class="n">GenericForeignKey</span><span class="p">(</span><span class="s1">&#39;content_type&#39;</span><span class="p">,</span> <span class="s1">&#39;object_id&#39;</span><span class="p">)</span>
  
  
<span class="k">class</span> <span class="nc">ReadNumExpandMethod</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">get_read_num</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">ct</span> <span class="o">=</span> <span class="n">ContentType</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get_for_model</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            <span class="n">readnum</span> <span class="o">=</span> <span class="n">ReadNum</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">content_type</span><span class="o">=</span><span class="n">ct</span><span class="p">,</span> <span class="n">object_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">pk</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">readnum</span><span class="o">.</span><span class="n">read_num</span>
        <span class="k">except</span> <span class="n">exceptions</span><span class="o">.</span><span class="n">ObjectDoesNotExist</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">0</span>
  
  
<span class="k">class</span> <span class="nc">ReadDetail</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">date</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateField</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">timezone</span><span class="o">.</span><span class="n">now</span><span class="p">)</span>
    <span class="n">read_num</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">IntegerField</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">content_type</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">ContentType</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">DO_NOTHING</span><span class="p">)</span>
    <span class="n">object_id</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">PositiveIntegerField</span><span class="p">()</span>
    <span class="n">content_object</span> <span class="o">=</span> <span class="n">GenericForeignKey</span><span class="p">(</span><span class="s1">&#39;content_type&#39;</span><span class="p">,</span> <span class="s1">&#39;object_id&#39;</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>然后添加一个date字段,代表这个播放量的日期</p>
</li>
<li>
<p>这个数据表就是存储,这个日期内,所有的播放量的加和</p>
</li>
<li>
<p>然后在首页用一个图表显示出来</p>
</li>
<li>
<p>在<code>admin.py</code>中</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">django.contrib</span> <span class="kn">import</span> <span class="n">admin</span>
<span class="kn">from</span> <span class="nn">.models</span> <span class="kn">import</span> <span class="n">ReadNum</span><span class="p">,</span> <span class="n">ReadDetail</span>
  
  
<span class="c1"># Register your models here.</span>
<span class="nd">@admin.register</span><span class="p">(</span><span class="n">ReadNum</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">ReadNumAdmin</span><span class="p">(</span><span class="n">admin</span><span class="o">.</span><span class="n">ModelAdmin</span><span class="p">):</span>
   <span class="n">list_display</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;read_num&#39;</span><span class="p">,</span> <span class="s1">&#39;content_object&#39;</span><span class="p">]</span>
  
  
<span class="nd">@admin.register</span><span class="p">(</span><span class="n">ReadDetail</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">ReadDetailAdmin</span><span class="p">(</span><span class="n">admin</span><span class="o">.</span><span class="n">ModelAdmin</span><span class="p">):</span>
   <span class="n">list_display</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">,</span> <span class="s1">&#39;read_num&#39;</span><span class="p">,</span> <span class="s1">&#39;content_object&#39;</span><span class="p">]</span>                              
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>在后台显示这个图表</p>
</li>
<li>
<p>然后在utils.py中</p>
<ul>
<li>先使用get_or_create方法优化一下之前写的if-else判断数据表中,浏览次数是否存在的逻辑</li>
<li>然后添加一个和<code>判断一片博客浏览次数</code>相同的代码,操作的类是<code>这一天一共的浏览量</code> - ReadDetail</li>
<li>最后写一个方法<code>get_seven_days_read_data</code>,获取近7天全部浏览次数的方法</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">django.contrib.contenttypes.models</span> <span class="kn">import</span> <span class="n">ContentType</span>
<span class="kn">from</span> <span class="nn">read_statistics.models</span> <span class="kn">import</span> <span class="n">ReadNum</span><span class="p">,</span> <span class="n">ReadDetail</span>
<span class="kn">from</span> <span class="nn">django.utils</span> <span class="kn">import</span> <span class="n">timezone</span>
<span class="kn">import</span> <span class="nn">datetime</span>
<span class="kn">from</span> <span class="nn">django.db.models</span> <span class="kn">import</span> <span class="n">Sum</span>
  
  
<span class="k">def</span> <span class="nf">read_statistics_once_read</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
    <span class="n">ct</span> <span class="o">=</span> <span class="n">ContentType</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get_for_model</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
    <span class="n">key</span> <span class="o">=</span> <span class="s2">&#34;</span><span class="si">%s</span><span class="s2">_</span><span class="si">%s</span><span class="s2">_read&#34;</span> <span class="o">%</span> <span class="p">(</span><span class="n">ct</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="n">obj</span><span class="o">.</span><span class="n">pk</span><span class="p">)</span>
  
    <span class="k">if</span> <span class="ow">not</span> <span class="n">request</span><span class="o">.</span><span class="n">COOKIES</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">):</span>
        <span class="c1"># get_or_create方法,可以代替filter,因为filter只能查找,而get_or_create在filter查找的基础上,如果查找不到会主动创建一个</span>
        <span class="c1"># 每篇博客的浏览次数</span>
        <span class="n">readnum</span><span class="p">,</span> <span class="n">created</span> <span class="o">=</span> <span class="n">ReadNum</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get_or_create</span><span class="p">(</span><span class="n">content_type</span><span class="o">=</span><span class="n">ct</span><span class="p">,</span> <span class="n">object_id</span><span class="o">=</span><span class="n">obj</span><span class="o">.</span><span class="n">pk</span><span class="p">)</span>
        <span class="s1">&#39;&#39;&#39;
</span><span class="s1">        if ReadNum.objects.filter(content_type=ct, object_id=obj.pk).count():
</span><span class="s1">            readnum = ReadNum.objects.get(content_type=ct, object_id=obj.pk)
</span><span class="s1">        else:
</span><span class="s1">            readnum = ReadNum(content_type=ct, object_id=obj.pk)
</span><span class="s1">        &#39;&#39;&#39;</span>
  
        <span class="n">readnum</span><span class="o">.</span><span class="n">read_num</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">readnum</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
  
        <span class="c1"># 这一天全部的浏览次数</span>
        <span class="n">date</span> <span class="o">=</span> <span class="n">timezone</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">date</span><span class="p">()</span>
        <span class="n">readDetail</span><span class="p">,</span> <span class="n">created</span> <span class="o">=</span> <span class="n">ReadDetail</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get_or_create</span><span class="p">(</span><span class="n">date</span><span class="o">=</span><span class="n">date</span><span class="p">,</span> <span class="n">content_type</span><span class="o">=</span><span class="n">ct</span><span class="p">,</span> <span class="n">object_id</span><span class="o">=</span><span class="n">obj</span><span class="o">.</span><span class="n">pk</span><span class="p">)</span>
        <span class="s1">&#39;&#39;&#39;
</span><span class="s1">        if ReadDetail.objects.filter(date=date, content_type=ct, object_id=obj.pk).count():
</span><span class="s1">            readDetail = ReadDetail.objects.get(date=date, content_type=ct, object_id=obj.pk)
</span><span class="s1">        else:
</span><span class="s1">            readDetail = ReadDetail(date=date, content_type=ct, object_id=obj.pk)
</span><span class="s1">        &#39;&#39;&#39;</span>
        <span class="n">readDetail</span><span class="o">.</span><span class="n">read_num</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">readDetail</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
  
  
    <span class="k">return</span> <span class="n">key</span>
  
<span class="c1"># 获取近7天全部浏览次数的方法</span>
<span class="k">def</span> <span class="nf">get_seven_days_read_data</span><span class="p">(</span><span class="n">content_type</span><span class="p">):</span>
    <span class="n">today</span> <span class="o">=</span> <span class="n">timezone</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">date</span><span class="p">()</span>
    <span class="n">read_nums</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># 折线图点值</span>
    <span class="n">date_str_list</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># 图表的横坐标的坐标</span>
  
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span> <span class="c1"># 从7到0倒遍历,-1是右开</span>
        <span class="n">date</span> <span class="o">=</span> <span class="n">today</span> <span class="o">-</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="n">i</span><span class="p">)</span>  <span class="c1"># timedelta(i)就是今天的前i天 , today - 这个值 , 就是第(前i)天 , 从而实现获取今天到后六天的日期,一共7天</span>
        <span class="n">date_str_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">date</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%m/</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">))</span>  <span class="c1"># 将date格式化</span>
        <span class="n">read_details</span> <span class="o">=</span> <span class="n">ReadDetail</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">content_type</span><span class="o">=</span><span class="n">content_type</span><span class="p">,</span> <span class="n">date</span><span class="o">=</span><span class="n">date</span><span class="p">)</span>  <span class="c1"># 根据日期,在 统计这个日期浏览次数 数据表中,查找博客对象(就是查询这个日期下的被浏览过的全部博客)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">read_details</span><span class="o">.</span><span class="n">aggregate</span><span class="p">(</span><span class="n">read_num_sum</span><span class="o">=</span><span class="n">Sum</span><span class="p">(</span><span class="s1">&#39;read_num&#39;</span><span class="p">))</span>  <span class="c1"># 将read_details对象(查询出来的结果)中的全部对象(博客)的指定日起的播放量(read_num字段),做加和,并将(read_num_sum)作为key,加和作为value,返回json</span>
        <span class="n">read_nums</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;read_num_sum&#39;</span><span class="p">]</span> <span class="ow">or</span> <span class="mi">0</span><span class="p">)</span> <span class="c1"># 取出json值,如果这个值不存在,也就是说这个日期内,这篇博客没有被浏览,那么就返回0</span>
        <span class="c1"># 获取当天全部浏览次数</span>
  
    <span class="k">return</span> <span class="n">read_nums</span><span class="p">,</span> <span class="n">date_str_list</span>
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>然后在<code>根应用</code>中,之前是在根应用的<code>views.py</code>中进行home.html的首页渲染</p>
<p><code>views.py</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">django.contrib.contenttypes.models</span> <span class="kn">import</span> <span class="n">ContentType</span>
<span class="kn">from</span> <span class="nn">django.shortcuts</span> <span class="kn">import</span> <span class="n">render</span>
<span class="kn">from</span> <span class="nn">read_statistics.utils</span> <span class="kn">import</span> <span class="n">get_seven_days_read_data</span>
  
<span class="kn">from</span> <span class="nn">blog.models</span> <span class="kn">import</span> <span class="n">Blog</span>
  
  
<span class="k">def</span> <span class="nf">home</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="n">blog_content_type</span> <span class="o">=</span> <span class="n">ContentType</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get_for_model</span><span class="p">(</span><span class="n">Blog</span><span class="p">)</span>
    <span class="n">read_nums</span><span class="p">,</span> <span class="n">date_str_list</span> <span class="o">=</span> <span class="n">get_seven_days_read_data</span><span class="p">(</span><span class="n">blog_content_type</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">&#39;home.html&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;read_nums&#39;</span><span class="p">:</span> <span class="n">read_nums</span><span class="p">,</span> <span class="s1">&#39;date_str_list&#39;</span><span class="p">:</span> <span class="n">date_str_list</span><span class="p">})</span>
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>调用刚才在<code>read_statistics/utils.py</code>中写的<code>获取近7天全部浏览次数的方法</code></p>
</li>
<li>
<p>携带返回数据,跳转到前端</p>
</li>
<li>
<p>这里使用<a href="https://www.highcharts.com.cn/">highchart</a></p>
</li>
<li>
<p>echarts和它一模一样,不知道谁抄谁</p>
</li>
<li>
<p>读文档,写一下,在options中绑定动态数据就行了</p>
<p><code>home.html</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html">{% extends &#39;base.html&#39; %}
  
{% block title %}
    个人博客网站
{% endblock %}
  
{% block nav_home_active %}active{% endblock %}
  
{% block content %}
    <span class="p">&lt;</span><span class="nt">h1</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;home-info&#34;</span><span class="p">&gt;</span>欢迎来到我的博客<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">&#34;container&#34;</span> <span class="na">style</span><span class="o">=</span><span class="s">&#34;width: 600px;height:400px;&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&#34;http://cdn.highcharts.com.cn/highcharts/highcharts.js&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">script</span><span class="p">&gt;</span>
            <span class="c1">// 图表配置
</span><span class="c1"></span>            <span class="kd">var</span> <span class="nx">options</span> <span class="o">=</span> <span class="p">{</span>
                <span class="nx">chart</span><span class="o">:</span> <span class="p">{</span>
                    <span class="nx">type</span><span class="o">:</span> <span class="s1">&#39;line&#39;</span>                          <span class="c1">//指定图表的类型，默认是折线图（line）
</span><span class="c1"></span>                <span class="p">},</span>
                <span class="nx">title</span><span class="o">:</span> <span class="p">{</span>
                    <span class="nx">text</span><span class="o">:</span> <span class="s1">&#39;我的第一个图表&#39;</span>                 <span class="c1">// 标题
</span><span class="c1"></span>                <span class="p">},</span>
                <span class="nx">xAxis</span><span class="o">:</span> <span class="p">{</span>
                    <span class="nx">categories</span><span class="o">:</span> <span class="p">{{</span> <span class="nx">date_str_list</span> <span class="o">|</span> <span class="nx">safe</span> <span class="p">}}</span>   <span class="c1">// x 轴分类
</span><span class="c1"></span>                <span class="p">},</span>
                <span class="nx">yAxis</span><span class="o">:</span> <span class="p">{</span>
                    <span class="nx">title</span><span class="o">:</span> <span class="p">{</span>
                        <span class="nx">text</span><span class="o">:</span> <span class="kc">null</span>                <span class="c1">// y 轴标题
</span><span class="c1"></span>                    <span class="p">},</span>
                    <span class="nx">labels</span><span class="o">:</span><span class="p">{</span>
                        <span class="nx">enabled</span><span class="o">:</span><span class="kc">false</span>
                    <span class="p">}</span>
                <span class="p">},</span>
                <span class="nx">series</span><span class="o">:</span> <span class="p">[{</span>                              <span class="c1">// 数据列
</span><span class="c1"></span>                    <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;最近浏览量&#39;</span><span class="p">,</span>                        <span class="c1">// 数据列名
</span><span class="c1"></span>                    <span class="nx">data</span><span class="o">:</span> <span class="p">{{</span> <span class="nx">read_nums</span> <span class="p">}}</span>                  <span class="c1">// 数据
</span><span class="c1"></span>                <span class="p">}]</span>
            <span class="p">};</span>
            <span class="c1">// 图表初始化函数
</span><span class="c1"></span>            <span class="kd">var</span> <span class="nx">chart</span> <span class="o">=</span> <span class="nx">Highcharts</span><span class="p">.</span><span class="nx">chart</span><span class="p">(</span><span class="s1">&#39;container&#39;</span><span class="p">,</span> <span class="nx">options</span><span class="p">);</span>
        <span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
{% endblock %}
</code></pre></td></tr></table>
</div>
</div></li>
</ul>
<hr>
<h2 id="首页获取指定日期的热门博客">首页获取指定日期的热门博客</h2>
<h3 id="当天热门博客">当天热门博客</h3>
<ul>
<li>
<p>就在utils.py中,写一个,获取当天热门博客的方法,然后在<code>根应用的views.py</code>中调用方法获取数据,然后渲染到html页面上就行了</p>
<p><code>utils.py</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="k">def</span> <span class="nf">get_today_hot_data</span><span class="p">(</span><span class="n">content_type</span><span class="p">):</span>
    <span class="n">today</span> <span class="o">=</span> <span class="n">timezone</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">date</span><span class="p">()</span>
    <span class="n">read_details</span> <span class="o">=</span> <span class="n">ReadDetail</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">content_type</span><span class="o">=</span><span class="n">content_type</span><span class="p">,</span> <span class="n">date</span><span class="o">=</span><span class="n">today</span><span class="p">)</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s1">&#39;-read_num&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">read_details</span><span class="p">[:</span><span class="mi">7</span><span class="p">]</span>
</code></pre></td></tr></table>
</div>
</div><ul>
<li>在<code>某一天全部博客浏览次数加和表</code>中,查询出全部博客对象,然后按照<code>当日浏览量</code>进行倒序</li>
<li>返回前七个</li>
</ul>
</li>
</ul>
<h3 id="昨天热门博客">昨天热门博客</h3>
<ul>
<li>
<p>原理和<code>当天热门博客</code>是一模一样的</p>
<p><code>utils.py</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="k">def</span> <span class="nf">get_yesterday_hot_data</span><span class="p">(</span><span class="n">content_type</span><span class="p">):</span>
    <span class="n">today</span> <span class="o">=</span> <span class="n">timezone</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">date</span><span class="p">()</span>
    <span class="n">yesterday</span> <span class="o">=</span> <span class="n">today</span> <span class="o">-</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">read_details</span> <span class="o">=</span> <span class="n">ReadDetail</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">content_type</span><span class="o">=</span><span class="n">content_type</span><span class="p">,</span> <span class="n">date</span><span class="o">=</span><span class="n">yesterday</span><span class="p">)</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s1">&#39;-read_num&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">read_details</span><span class="p">[:</span><span class="mi">7</span><span class="p">]</span>
</code></pre></td></tr></table>
</div>
</div></li>
</ul>
<hr>
<h3 id="全部代码-7">全部代码</h3>
<p><code>utils.py</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">django.contrib.contenttypes.models</span> <span class="kn">import</span> <span class="n">ContentType</span>
<span class="kn">from</span> <span class="nn">read_statistics.models</span> <span class="kn">import</span> <span class="n">ReadNum</span><span class="p">,</span> <span class="n">ReadDetail</span>
<span class="kn">from</span> <span class="nn">django.utils</span> <span class="kn">import</span> <span class="n">timezone</span>
<span class="kn">import</span> <span class="nn">datetime</span>
<span class="kn">from</span> <span class="nn">django.db.models</span> <span class="kn">import</span> <span class="n">Sum</span>


<span class="k">def</span> <span class="nf">read_statistics_once_read</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
    <span class="n">ct</span> <span class="o">=</span> <span class="n">ContentType</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get_for_model</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
    <span class="n">key</span> <span class="o">=</span> <span class="s2">&#34;</span><span class="si">%s</span><span class="s2">_</span><span class="si">%s</span><span class="s2">_read&#34;</span> <span class="o">%</span> <span class="p">(</span><span class="n">ct</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="n">obj</span><span class="o">.</span><span class="n">pk</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">request</span><span class="o">.</span><span class="n">COOKIES</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">):</span>
        <span class="n">readnum</span><span class="p">,</span> <span class="n">created</span> <span class="o">=</span> <span class="n">ReadNum</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get_or_create</span><span class="p">(</span><span class="n">content_type</span><span class="o">=</span><span class="n">ct</span><span class="p">,</span> <span class="n">object_id</span><span class="o">=</span><span class="n">obj</span><span class="o">.</span><span class="n">pk</span><span class="p">)</span>

        <span class="n">readnum</span><span class="o">.</span><span class="n">read_num</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">readnum</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

        <span class="n">date</span> <span class="o">=</span> <span class="n">timezone</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">date</span><span class="p">()</span>
        <span class="n">readDetail</span><span class="p">,</span> <span class="n">created</span> <span class="o">=</span> <span class="n">ReadDetail</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get_or_create</span><span class="p">(</span><span class="n">date</span><span class="o">=</span><span class="n">date</span><span class="p">,</span> <span class="n">content_type</span><span class="o">=</span><span class="n">ct</span><span class="p">,</span> <span class="n">object_id</span><span class="o">=</span><span class="n">obj</span><span class="o">.</span><span class="n">pk</span><span class="p">)</span>
        <span class="n">readDetail</span><span class="o">.</span><span class="n">read_num</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">readDetail</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">key</span>

<span class="k">def</span> <span class="nf">get_seven_days_read_data</span><span class="p">(</span><span class="n">content_type</span><span class="p">):</span>
    <span class="n">today</span> <span class="o">=</span> <span class="n">timezone</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">date</span><span class="p">()</span>
    <span class="n">read_nums</span> <span class="o">=</span> <span class="p">[]</span> 
    <span class="n">date_str_list</span> <span class="o">=</span> <span class="p">[]</span>  

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span> 
        <span class="n">date</span> <span class="o">=</span> <span class="n">today</span> <span class="o">-</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="n">i</span><span class="p">)</span>  
        <span class="n">date_str_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">date</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%m/</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">))</span> 
        <span class="n">read_details</span> <span class="o">=</span> <span class="n">ReadDetail</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">content_type</span><span class="o">=</span><span class="n">content_type</span><span class="p">,</span><span class="n">date</span><span class="o">=</span><span class="n">date</span><span class="p">)</span>  
        <span class="n">result</span> <span class="o">=</span> <span class="n">read_details</span><span class="o">.</span><span class="n">aggregate</span><span class="p">(</span><span class="n">read_num_sum</span><span class="o">=</span><span class="n">Sum</span><span class="p">(</span><span class="s1">&#39;read_num&#39;</span><span class="p">))</span>  
        <span class="n">read_nums</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;read_num_sum&#39;</span><span class="p">]</span> <span class="ow">or</span> <span class="mi">0</span><span class="p">)</span>  

    <span class="k">return</span> <span class="n">read_nums</span><span class="p">,</span> <span class="n">date_str_list</span>


<span class="k">def</span> <span class="nf">get_today_hot_data</span><span class="p">(</span><span class="n">content_type</span><span class="p">):</span>
    <span class="n">today</span> <span class="o">=</span> <span class="n">timezone</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">date</span><span class="p">()</span>
    <span class="n">read_details</span> <span class="o">=</span> <span class="n">ReadDetail</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">content_type</span><span class="o">=</span><span class="n">content_type</span><span class="p">,</span> <span class="n">date</span><span class="o">=</span><span class="n">today</span><span class="p">)</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s1">&#39;-read_num&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">read_details</span><span class="p">[:</span><span class="mi">7</span><span class="p">]</span>


<span class="k">def</span> <span class="nf">get_yesterday_hot_data</span><span class="p">(</span><span class="n">content_type</span><span class="p">):</span>
    <span class="n">today</span> <span class="o">=</span> <span class="n">timezone</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">date</span><span class="p">()</span>
    <span class="n">yesterday</span> <span class="o">=</span> <span class="n">today</span> <span class="o">-</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">read_details</span> <span class="o">=</span> <span class="n">ReadDetail</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">content_type</span><span class="o">=</span><span class="n">content_type</span><span class="p">,</span> <span class="n">date</span><span class="o">=</span><span class="n">yesterday</span><span class="p">)</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s1">&#39;-read_num&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">read_details</span><span class="p">[:</span><span class="mi">7</span><span class="p">]</span>
</code></pre></td></tr></table>
</div>
</div><p><code>mysite/views.py</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">django.contrib.contenttypes.models</span> <span class="kn">import</span> <span class="n">ContentType</span>
<span class="kn">from</span> <span class="nn">django.shortcuts</span> <span class="kn">import</span> <span class="n">render</span>
<span class="kn">from</span> <span class="nn">read_statistics.utils</span> <span class="kn">import</span> <span class="n">get_seven_days_read_data</span><span class="p">,</span> <span class="n">get_today_hot_data</span><span class="p">,</span> <span class="n">get_yesterday_hot_data</span>
<span class="kn">from</span> <span class="nn">blog.models</span> <span class="kn">import</span> <span class="n">Blog</span>


<span class="k">def</span> <span class="nf">home</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="n">blog_content_type</span> <span class="o">=</span> <span class="n">ContentType</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get_for_model</span><span class="p">(</span><span class="n">Blog</span><span class="p">)</span>

    <span class="n">read_nums</span><span class="p">,</span> <span class="n">date_str_list</span> <span class="o">=</span> <span class="n">get_seven_days_read_data</span><span class="p">(</span><span class="n">blog_content_type</span><span class="p">)</span>
    <span class="n">today_hot_data</span> <span class="o">=</span> <span class="n">get_today_hot_data</span><span class="p">(</span><span class="n">blog_content_type</span><span class="p">)</span>
    <span class="n">yesterday_hot_data</span> <span class="o">=</span> <span class="n">get_yesterday_hot_data</span><span class="p">(</span><span class="n">blog_content_type</span><span class="p">)</span>
    <span class="n">content</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s1">&#39;read_nums&#39;</span><span class="p">:</span> <span class="n">read_nums</span><span class="p">,</span>
                <span class="s1">&#39;date_str_list&#39;</span><span class="p">:</span> <span class="n">date_str_list</span><span class="p">,</span>
                <span class="s1">&#39;today_hot_data&#39;</span><span class="p">:</span> <span class="n">today_hot_data</span><span class="p">,</span>
                <span class="s1">&#39;yesterday_hot_data&#39;</span><span class="p">:</span> <span class="n">yesterday_hot_data</span>
              <span class="p">}</span>
    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">&#39;home.html&#39;</span><span class="p">,</span> <span class="n">content</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><p><code>home.html</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-django" data-lang="django"><span class="cp">{%</span> <span class="k">extends</span> <span class="s1">&#39;base.html&#39;</span> <span class="cp">%}</span><span class="x">
</span><span class="x">
</span><span class="x"></span><span class="cp">{%</span> <span class="k">block</span> <span class="nv">title</span> <span class="cp">%}</span><span class="x">
</span><span class="x">    个人博客网站
</span><span class="x"></span><span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span><span class="x">
</span><span class="x">
</span><span class="x"></span><span class="cp">{%</span> <span class="k">block</span> <span class="nv">nav_home_active</span> <span class="cp">%}</span><span class="x">active</span><span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span><span class="x">
</span><span class="x">
</span><span class="x"></span><span class="cp">{%</span> <span class="k">block</span> <span class="nv">content</span> <span class="cp">%}</span><span class="x">
</span><span class="x">    &lt;h1 class=&#34;home-info&#34;&gt;欢迎来到我的博客&lt;/h1&gt;
</span><span class="x">    &lt;div id=&#34;container&#34; style=&#34;width: 600px;height:400px;&#34;&gt;&lt;/div&gt;
</span><span class="x">
</span><span class="x">    &lt;h3&gt;当日热门博客&lt;/h3&gt;
</span><span class="x">    &lt;ul&gt;
</span><span class="x">        </span><span class="cp">{%</span> <span class="k">for</span> <span class="nv">item</span> <span class="k">in</span> <span class="nv">today_hot_data</span> <span class="cp">%}</span><span class="x">
</span><span class="x">            &lt;li&gt;&lt;a href=&#34;</span><span class="cp">{%</span> <span class="k">url</span> <span class="s1">&#39;blog_detail&#39;</span> <span class="nv">item.object_id</span> <span class="cp">%}</span><span class="x">&#34;&gt;</span><span class="cp">{{</span> <span class="nv">item.object_id</span> <span class="cp">}}</span><span class="x"> (</span><span class="cp">{{</span> <span class="nv">item.read_num</span> <span class="cp">}}</span><span class="x">)&lt;/a&gt;&lt;/li&gt;
</span><span class="x">        </span><span class="cp">{%</span> <span class="k">empty</span> <span class="cp">%}</span><span class="x">
</span><span class="x">            &lt;li&gt;今天暂时没有热门博客&lt;/li&gt;
</span><span class="x">        </span><span class="cp">{%</span> <span class="k">endfor</span> <span class="cp">%}</span><span class="x">
</span><span class="x">    &lt;/ul&gt;
</span><span class="x">
</span><span class="x">    &lt;h3&gt;昨日热门博客&lt;/h3&gt;
</span><span class="x">    &lt;ul&gt;
</span><span class="x">        </span><span class="cp">{%</span> <span class="k">for</span> <span class="nv">item</span> <span class="k">in</span> <span class="nv">yesterday_hot_data</span> <span class="cp">%}</span><span class="x">
</span><span class="x">            &lt;li&gt;&lt;a href=&#34;</span><span class="cp">{%</span> <span class="k">url</span> <span class="s1">&#39;blog_detail&#39;</span> <span class="nv">item.object_id</span> <span class="cp">%}</span><span class="x">&#34;&gt;</span><span class="cp">{{</span> <span class="nv">item.object_id</span> <span class="cp">}}</span><span class="x"> (</span><span class="cp">{{</span> <span class="nv">item.read_num</span> <span class="cp">}}</span><span class="x">)&lt;/a&gt;&lt;/li&gt;
</span><span class="x">        </span><span class="cp">{%</span> <span class="k">empty</span> <span class="cp">%}</span><span class="x">
</span><span class="x">            &lt;li&gt;昨天暂时没有热门博客&lt;/li&gt;
</span><span class="x">        </span><span class="cp">{%</span> <span class="k">endfor</span> <span class="cp">%}</span><span class="x">
</span><span class="x">    &lt;/ul&gt;
</span><span class="x">
</span><span class="x">    &lt;script src=&#34;http://cdn.highcharts.com.cn/highcharts/highcharts.js&#34;&gt;&lt;/script&gt;
</span><span class="x">    &lt;script&gt;
</span><span class="x">            // 图表配置
</span><span class="x">            var options = {
</span><span class="x">                chart: {
</span><span class="x">                    type: &#39;line&#39;                          //指定图表的类型，默认是折线图（line）
</span><span class="x">                },
</span><span class="x">                title: {
</span><span class="x">                    text: &#39;近7天浏览数量&#39;                 // 标题
</span><span class="x">                },
</span><span class="x">                xAxis: {
</span><span class="x">                    categories: </span><span class="cp">{{</span> <span class="nv">date_str_list</span> <span class="o">|</span> <span class="nf">safe</span> <span class="cp">}}</span><span class="x">   // x 轴分类
</span><span class="x">                },
</span><span class="x">                yAxis: {
</span><span class="x">                    title: {
</span><span class="x">                        text: null                // y 轴标题
</span><span class="x">                    },
</span><span class="x">                    labels:{
</span><span class="x">                        enabled:false
</span><span class="x">                    }
</span><span class="x">                },
</span><span class="x">                series: [{                              // 数据列
</span><span class="x">                    name: &#39;日期&#39;,                        // 数据列名
</span><span class="x">                    data: </span><span class="cp">{{</span> <span class="nv">read_nums</span> <span class="cp">}}</span><span class="x">                  // 数据
</span><span class="x">                }]
</span><span class="x">            };
</span><span class="x">            // 图表初始化函数
</span><span class="x">            var chart = Highcharts.chart(&#39;container&#39;, options);
</span><span class="x">        &lt;/script&gt;
</span><span class="x"></span><span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span><span class="x">
</span></code></pre></td></tr></table>
</div>
</div><hr>
<h2 id="django的cache---缓存提速">django的cache - 缓存提速</h2>
<ul>
<li>
<p><a href="https://docs.djangoproject.com/en/2.0/topics/cache/#accessing-the-cache">官网</a></p>
</li>
<li>
<p>官网给出了好几种方法,这里使用<code>数据库缓存</code></p>
</li>
<li>
<p>在使用cache之前,需要在数据库中创建一张缓存表</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">python3 manage.py createcachetable
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>它会创建出django需要的缓存表,名称、各种属性等等都完全匹配</p>
</li>
<li>
<p>然后在settings.py中设置</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="c1"># db_cache_django</span>
<span class="n">CACHES</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;default&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;BACKEND&#39;</span><span class="p">:</span> <span class="s1">&#39;django.core.cache.backends.db.DatabaseCache&#39;</span><span class="p">,</span>
        <span class="s1">&#39;LOCATION&#39;</span><span class="p">:</span> <span class="s1">&#39;my_cache_table&#39;</span><span class="p">,</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>这样就让项目链接上了刚才创建的缓存表</p>
</li>
<li>
<p>在<code>home/views.py</code>中使用缓存</p>
</li>
<li>
<p>无非就是将从后端获取到的数据保存到缓存中,减少服务器负担</p>
</li>
<li>
<p>引入缓存包</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">django.core.cache</span> <span class="kn">import</span> <span class="n">cache</span>
</code></pre></td></tr></table>
</div>
</div><p><code>home/views.py</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">django.contrib.contenttypes.models</span> <span class="kn">import</span> <span class="n">ContentType</span>
<span class="kn">from</span> <span class="nn">django.shortcuts</span> <span class="kn">import</span> <span class="n">render</span>
<span class="kn">from</span> <span class="nn">read_statistics.utils</span> <span class="kn">import</span> <span class="n">get_seven_days_read_data</span><span class="p">,</span> <span class="n">get_today_hot_data</span><span class="p">,</span> <span class="n">get_yesterday_hot_data</span>
<span class="kn">from</span> <span class="nn">django.core.cache</span> <span class="kn">import</span> <span class="n">cache</span>
<span class="kn">from</span> <span class="nn">blog.models</span> <span class="kn">import</span> <span class="n">Blog</span>
  
  
<span class="k">def</span> <span class="nf">home</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="n">blog_content_type</span> <span class="o">=</span> <span class="n">ContentType</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get_for_model</span><span class="p">(</span><span class="n">Blog</span><span class="p">)</span>
  
    <span class="c1"># 从缓存表中获取key的value</span>
    <span class="n">today_hot_data</span> <span class="o">=</span> <span class="n">cache</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;today_hot_data&#39;</span><span class="p">)</span>
    <span class="c1"># 如果获取不到</span>
    <span class="k">if</span> <span class="n">today_hot_data</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="c1"># set一下</span>
        <span class="n">today_hot_data</span> <span class="o">=</span> <span class="n">get_today_hot_data</span><span class="p">(</span><span class="n">blog_content_type</span><span class="p">)</span>
        <span class="n">cache</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;today_hot_data&#39;</span><span class="p">,</span> <span class="n">today_hot_data</span><span class="p">,</span> <span class="mi">3600</span><span class="p">)</span>  <span class="c1"># 时间:3600秒</span>
        <span class="k">print</span><span class="p">(</span><span class="s1">&#39;init cache&#39;</span><span class="p">)</span>
    <span class="c1"># 如果获取到了</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&#34;use cache&#34;</span><span class="p">)</span>
  
    <span class="n">read_nums</span><span class="p">,</span> <span class="n">date_str_list</span> <span class="o">=</span> <span class="n">get_seven_days_read_data</span><span class="p">(</span><span class="n">blog_content_type</span><span class="p">)</span>
    <span class="c1"># today_hot_data = get_today_hot_data(blog_content_type)</span>
    <span class="n">yesterday_hot_data</span> <span class="o">=</span> <span class="n">get_yesterday_hot_data</span><span class="p">(</span><span class="n">blog_content_type</span><span class="p">)</span>
    <span class="n">content</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s1">&#39;read_nums&#39;</span><span class="p">:</span> <span class="n">read_nums</span><span class="p">,</span>
                <span class="s1">&#39;date_str_list&#39;</span><span class="p">:</span> <span class="n">date_str_list</span><span class="p">,</span>
                <span class="s1">&#39;today_hot_data&#39;</span><span class="p">:</span> <span class="n">today_hot_data</span><span class="p">,</span>  <span class="c1"># 直接使用缓存</span>
                <span class="s1">&#39;yesterday_hot_data&#39;</span><span class="p">:</span> <span class="n">yesterday_hot_data</span>
              <span class="p">}</span>
    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">&#39;home.html&#39;</span><span class="p">,</span> <span class="n">content</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div></li>
</ul>
<hr>
<h2 id="首页重新布局一下">首页重新布局一下</h2>
<p><code>home.html</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-django" data-lang="django"><span class="cp">{%</span> <span class="k">extends</span> <span class="s1">&#39;base.html&#39;</span> <span class="cp">%}</span><span class="x">
</span><span class="x">
</span><span class="x"></span><span class="cp">{%</span> <span class="k">block</span> <span class="nv">title</span> <span class="cp">%}</span><span class="x">
</span><span class="x">    个人博客网站
</span><span class="x"></span><span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span><span class="x">
</span><span class="x">
</span><span class="x"></span><span class="cp">{%</span> <span class="k">block</span> <span class="nv">nav_home_active</span> <span class="cp">%}</span><span class="x">active</span><span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span><span class="x">
</span><span class="x">
</span><span class="x"></span><span class="cp">{%</span> <span class="k">block</span> <span class="nv">content</span> <span class="cp">%}</span><span class="x">
</span><span class="x">    &lt;div class=&#34;row home_title&#34;&gt;
</span><span class="x">        &lt;h1&gt;欢迎来到我的博客&lt;/h1&gt;
</span><span class="x">    &lt;/div&gt;
</span><span class="x">    &lt;div class=&#34;row chart&#34;&gt;
</span><span class="x">        &lt;div id=&#34;container&#34; style=&#34;width: 600px;height:400px;&#34;&gt;&lt;/div&gt;
</span><span class="x">    &lt;/div&gt;
</span><span class="x">    &lt;div class=&#34;hot_blogs&#34;&gt;
</span><span class="x">        &lt;div id=&#34;hot_blog&#34;&gt;
</span><span class="x">            &lt;h3&gt;当日热门博客&lt;/h3&gt;
</span><span class="x">            &lt;ul&gt;
</span><span class="x">                </span><span class="cp">{%</span> <span class="k">for</span> <span class="nv">item</span> <span class="k">in</span> <span class="nv">today_hot_data</span> <span class="cp">%}</span><span class="x">
</span><span class="x">                    &lt;li&gt;&lt;a href=&#34;</span><span class="cp">{%</span> <span class="k">url</span> <span class="s1">&#39;blog_detail&#39;</span> <span class="nv">item.object_id</span> <span class="cp">%}</span><span class="x">&#34;&gt;</span><span class="cp">{{</span> <span class="nv">item.object_id</span> <span class="cp">}}</span><span class="x"> (</span><span class="cp">{{</span> <span class="nv">item.read_num</span> <span class="cp">}}</span><span class="x">)&lt;/a&gt;&lt;/li&gt;
</span><span class="x">                </span><span class="cp">{%</span> <span class="k">empty</span> <span class="cp">%}</span><span class="x">
</span><span class="x">                    &lt;li&gt;今天暂时没有热门博客&lt;/li&gt;
</span><span class="x">                </span><span class="cp">{%</span> <span class="k">endfor</span> <span class="cp">%}</span><span class="x">
</span><span class="x">            &lt;/ul&gt;
</span><span class="x">        &lt;/div&gt;
</span><span class="x">        &lt;div id=&#34;hot_blog&#34;&gt;
</span><span class="x">            &lt;h3&gt;昨日热门博客&lt;/h3&gt;
</span><span class="x">            &lt;ul&gt;
</span><span class="x">                </span><span class="cp">{%</span> <span class="k">for</span> <span class="nv">item</span> <span class="k">in</span> <span class="nv">yesterday_hot_data</span> <span class="cp">%}</span><span class="x">
</span><span class="x">                    &lt;li&gt;&lt;a href=&#34;</span><span class="cp">{%</span> <span class="k">url</span> <span class="s1">&#39;blog_detail&#39;</span> <span class="nv">item.object_id</span> <span class="cp">%}</span><span class="x">&#34;&gt;</span><span class="cp">{{</span> <span class="nv">item.title</span> <span class="cp">}}</span><span class="x"> (</span><span class="cp">{{</span> <span class="nv">item.read_num</span> <span class="cp">}}</span><span class="x">)&lt;/a&gt;&lt;/li&gt;
</span><span class="x">                </span><span class="cp">{%</span> <span class="k">empty</span> <span class="cp">%}</span><span class="x">
</span><span class="x">                    &lt;li&gt;昨天暂时没有热门博客&lt;/li&gt;
</span><span class="x">                </span><span class="cp">{%</span> <span class="k">endfor</span> <span class="cp">%}</span><span class="x">
</span><span class="x">            &lt;/ul&gt;
</span><span class="x">        &lt;/div&gt;
</span><span class="x">    &lt;/div&gt;
</span><span class="x">
</span><span class="x">    &lt;script src=&#34;http://cdn.highcharts.com.cn/highcharts/highcharts.js&#34;&gt;&lt;/script&gt;
</span><span class="x">    &lt;script&gt;
</span><span class="x">            // 图表配置
</span><span class="x">            var options = {
</span><span class="x">                chart: {
</span><span class="x">                    type: &#39;line&#39;                          //指定图表的类型，默认是折线图（line）
</span><span class="x">                },
</span><span class="x">                title: {
</span><span class="x">                    text: &#39;近7天浏览数量&#39;                 // 标题
</span><span class="x">                },
</span><span class="x">                xAxis: {
</span><span class="x">                    categories: </span><span class="cp">{{</span> <span class="nv">date_str_list</span> <span class="o">|</span> <span class="nf">safe</span> <span class="cp">}}</span><span class="x">   // x 轴分类
</span><span class="x">                },
</span><span class="x">                yAxis: {
</span><span class="x">                    title: {
</span><span class="x">                        text: null                // y 轴标题
</span><span class="x">                    },
</span><span class="x">                    labels:{
</span><span class="x">                        enabled:false
</span><span class="x">                    }
</span><span class="x">                },
</span><span class="x">                series: [{                              // 数据列
</span><span class="x">                    name: &#39;日期&#39;,                        // 数据列名
</span><span class="x">                    data: </span><span class="cp">{{</span> <span class="nv">read_nums</span> <span class="cp">}}</span><span class="x">                  // 数据
</span><span class="x">                }]
</span><span class="x">            };
</span><span class="x">            // 图表初始化函数
</span><span class="x">            var chart = Highcharts.chart(&#39;container&#39;, options);
</span><span class="x">        &lt;/script&gt;
</span><span class="x"></span><span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span><span class="x">
</span></code></pre></td></tr></table>
</div>
</div><p><code>home.css</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-css" data-lang="css"><span class="p">.</span><span class="nc">home_title</span><span class="p">{</span>
    <span class="k">margin-top</span><span class="p">:</span> <span class="mi">20</span><span class="kt">px</span><span class="p">;</span>
    <span class="k">text-align</span><span class="p">:</span> <span class="kc">center</span><span class="p">;</span>
<span class="p">}</span>

<span class="p">.</span><span class="nc">home_title</span> <span class="nt">h1</span><span class="p">{</span>
    <span class="k">font-size</span><span class="p">:</span> <span class="mi">50</span><span class="kt">px</span><span class="p">;</span>
<span class="p">}</span>

<span class="nt">div</span><span class="p">#</span><span class="nn">container</span><span class="p">{</span>
    <span class="k">margin</span><span class="p">:</span> <span class="mi">100</span><span class="kt">px</span> <span class="kc">auto</span> <span class="cp">!important</span><span class="p">;</span>
<span class="p">}</span>

<span class="p">.</span><span class="nc">hot_blogs</span> <span class="p">#</span><span class="nn">hot_blog</span><span class="p">{</span>
    <span class="k">margin</span><span class="p">:</span> <span class="mi">50</span><span class="kt">px</span> <span class="kc">auto</span><span class="p">;</span>
    <span class="k">text-align</span><span class="p">:</span> <span class="kc">center</span><span class="p">;</span>
<span class="p">}</span>

<span class="p">.</span><span class="nc">hot_blogs</span> <span class="p">#</span><span class="nn">hot_blog</span> <span class="nt">ul</span> <span class="nt">li</span><span class="p">{</span>
    <span class="k">margin</span><span class="p">:</span> <span class="mi">10</span><span class="kt">px</span> <span class="mi">0</span> <span class="cp">!important</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><hr>
<h2 id="博客评论系统">博客评论系统</h2>
<h3 id="模型创建">模型创建</h3>
<ul>
<li>
<p>创建<code>comment</code> - app</p>
</li>
<li>
<p>在comment/models.py中,创建</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">django.contrib.contenttypes.fields</span> <span class="kn">import</span> <span class="n">GenericForeignKey</span>
<span class="kn">from</span> <span class="nn">django.contrib.contenttypes.models</span> <span class="kn">import</span> <span class="n">ContentType</span>
<span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>
<span class="kn">from</span> <span class="nn">django.contrib.auth.models</span> <span class="kn">import</span> <span class="n">User</span>
  
  
<span class="c1"># Create your models here.</span>
<span class="k">class</span> <span class="nc">Comment</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">content_type</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">ContentType</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">DO_NOTHING</span><span class="p">)</span>
    <span class="n">object_id</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">PositiveIntegerField</span><span class="p">()</span>
    <span class="n">content_object</span> <span class="o">=</span> <span class="n">GenericForeignKey</span><span class="p">(</span><span class="s1">&#39;content_type&#39;</span><span class="p">,</span> <span class="s1">&#39;object_id&#39;</span><span class="p">)</span>
  
    <span class="n">text</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">()</span>
    <span class="n">comment_time</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">(</span><span class="n">auto_now_add</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">user</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">User</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">DO_NOTHING</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>text(评论内容), comment_time(评论时间)， user(评论用户)，上面那一坨也是为了,任何类型的对象都能使用这个评论机制,这样这个评论app就变成了模板,通用性很高</p>
</li>
<li>
<p>这里使用User,是因为我们的<code>localhost:8000/admin</code>就是使用的django的User</p>
</li>
<li>
<p>设置下admin显示</p>
<p><code>comment/admin.py</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">django.contrib</span> <span class="kn">import</span> <span class="n">admin</span>
<span class="kn">from</span> <span class="nn">comment.models</span> <span class="kn">import</span> <span class="n">Comment</span>
  
  
<span class="c1"># Register your models here.</span>
<span class="nd">@admin.register</span><span class="p">(</span><span class="n">Comment</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">CommentAdmin</span><span class="p">(</span><span class="n">admin</span><span class="o">.</span><span class="n">ModelAdmin</span><span class="p">):</span>
    <span class="n">list_display</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;content_object&#39;</span><span class="p">,</span> <span class="s1">&#39;text&#39;</span><span class="p">,</span> <span class="s1">&#39;comment_time&#39;</span><span class="p">,</span> <span class="s1">&#39;user&#39;</span><span class="p">]</span>
</code></pre></td></tr></table>
</div>
</div></li>
</ul>
<h4 id="登录">登录</h4>
<ul>
<li>
<p>在博客详情页添加,先写个样式放一下</p>
<p><code>blog_detail.html</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html">{% extends &#39;base.html&#39; %}
  
{% block title %}
    {{ blog.title }}
{% endblock %}
  
{% block content %}
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;container&#34;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;row&#34;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;col-xs-10 col-xs-offset-2&#34;</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">h3</span><span class="p">&gt;</span>标题:{{ blog.title }}<span class="p">&lt;/</span><span class="nt">h3</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">ul</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;blog_detail_ul&#34;</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;</span>作者:{{ blog.author }}<span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;</span>发表日期:{{ blog.create_time | date:&#34;Y-m-d Hⓜs&#34;}}<span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;</span>分类: <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;{% url &#39;blog_with_type&#39; blog.blog_type.pk %}&#34;</span><span class="p">&gt;</span>{{ blog.blog_type }}<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span> <span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">li</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;blog_detail_content&#34;</span><span class="p">&gt;</span>{{ blog.content | safe}}<span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
                <span class="p">&lt;/</span><span class="nt">ul</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">nav</span> <span class="na">aria-label</span><span class="o">=</span><span class="s">&#34;...&#34;</span><span class="p">&gt;</span>
                  <span class="p">&lt;</span><span class="nt">ul</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;pager&#34;</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;</span>
                        {% if previous_blog %}
                            上一篇:
                          <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;{% url &#39;blog_detail&#39; previous_blog.pk %}&#34;</span><span class="p">&gt;</span>
                                {{ previous_blog.title }}
                            <span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
                        {% else %}
                            上一篇:没有了
                        {% endif %}
                    <span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;</span>
                        {% if next_blog %}
                            下一篇:
                             <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;{% url &#39;blog_detail&#39; next_blog.pk %}&#34;</span><span class="p">&gt;</span>
                                {{ next_blog.title }}
                             <span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
                        {% else %}
                            下一篇:没有了
                        {% endif %}
                    <span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
                  <span class="p">&lt;/</span><span class="nt">ul</span><span class="p">&gt;</span>
                <span class="p">&lt;/</span><span class="nt">nav</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
              
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;row&#34;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">div</span> <span class="na">style</span><span class="o">=</span><span class="s">&#34;margin-top: 2em;border: 1px dashed #000000;padding: 2em;&#34;</span><span class="p">&gt;</span>
                评论区
                {% if user.is_authenticated %}
                    {{ user }}
                {% else %}
                    未登录
                    <span class="p">&lt;</span><span class="nt">form</span> <span class="na">action</span><span class="o">=</span><span class="s">&#34;&#34;</span> <span class="na">method</span><span class="o">=</span><span class="s">&#34;post&#34;</span><span class="p">&gt;</span>
                        {% csrf_token %}
                        用户名:<span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;text&#34;</span> <span class="na">name</span><span class="o">=</span><span class="s">&#34;username&#34;</span><span class="p">&gt;</span>
                        密码:<span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;password&#34;</span> <span class="na">name</span><span class="o">=</span><span class="s">&#34;password&#34;</span><span class="p">&gt;</span>
                        <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;submit&#34;</span> <span class="na">value</span><span class="o">=</span><span class="s">&#34;登录&#34;</span><span class="p">&gt;</span>
                    <span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
                {% endif %}
            <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">div</span> <span class="na">style</span><span class="o">=</span><span class="s">&#34;margin-top: 2em;border: 1px dashed #000000;padding: 2em;&#34;</span><span class="p">&gt;</span>评论列表<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
{% endblock %}
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>在根应用中的urls.py,创建路由<code>login</code>,用于登录</p>
<p><code>urls.py</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">django.contrib</span> <span class="kn">import</span> <span class="n">admin</span>
<span class="kn">from</span> <span class="nn">django.urls</span> <span class="kn">import</span> <span class="n">path</span><span class="p">,</span> <span class="n">include</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">views</span>
  
<span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">home</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;home&#39;</span><span class="p">),</span>  <span class="c1"># 默认是home.html</span>
    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;admin/&#39;</span><span class="p">,</span> <span class="n">admin</span><span class="o">.</span><span class="n">site</span><span class="o">.</span><span class="n">urls</span><span class="p">),</span>
    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;blog/&#39;</span><span class="p">,</span> <span class="n">include</span><span class="p">(</span><span class="s1">&#39;blog.urls&#39;</span><span class="p">)),</span>  <span class="c1"># 子路由</span>
    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;login/&#39;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">login</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&#34;login&#34;</span><span class="p">),</span>
<span class="p">]</span>
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>在根应用的views.py中创建这个login方法</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">django.contrib.contenttypes.models</span> <span class="kn">import</span> <span class="n">ContentType</span>
<span class="kn">from</span> <span class="nn">read_statistics.utils</span> <span class="kn">import</span> <span class="n">get_seven_days_read_data</span><span class="p">,</span> <span class="n">get_today_hot_data</span><span class="p">,</span> <span class="n">get_yesterday_hot_data</span>
<span class="kn">from</span> <span class="nn">django.core.cache</span> <span class="kn">import</span> <span class="n">cache</span>
<span class="kn">from</span> <span class="nn">blog.models</span> <span class="kn">import</span> <span class="n">Blog</span>
<span class="kn">from</span> <span class="nn">django.contrib</span> <span class="kn">import</span> <span class="n">auth</span>
<span class="kn">from</span> <span class="nn">django.shortcuts</span> <span class="kn">import</span> <span class="n">redirect</span><span class="p">,</span> <span class="n">render</span>
  
  
<span class="k">def</span> <span class="nf">home</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="n">blog_content_type</span> <span class="o">=</span> <span class="n">ContentType</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get_for_model</span><span class="p">(</span><span class="n">Blog</span><span class="p">)</span>
  
    <span class="c1"># 从缓存表中获取key的value</span>
    <span class="n">today_hot_data</span> <span class="o">=</span> <span class="n">cache</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;today_hot_data&#39;</span><span class="p">)</span>
    <span class="c1"># 如果获取不到</span>
    <span class="k">if</span> <span class="n">today_hot_data</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="c1"># set一下</span>
        <span class="n">today_hot_data</span> <span class="o">=</span> <span class="n">get_today_hot_data</span><span class="p">(</span><span class="n">blog_content_type</span><span class="p">)</span>
        <span class="n">cache</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;today_hot_data&#39;</span><span class="p">,</span> <span class="n">today_hot_data</span><span class="p">,</span> <span class="mi">3600</span><span class="p">)</span>  <span class="c1"># 时间:3600秒</span>
        <span class="k">print</span><span class="p">(</span><span class="s1">&#39;init cache&#39;</span><span class="p">)</span>
    <span class="c1"># 如果获取到了</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&#34;use cache&#34;</span><span class="p">)</span>
  
    <span class="n">read_nums</span><span class="p">,</span> <span class="n">date_str_list</span> <span class="o">=</span> <span class="n">get_seven_days_read_data</span><span class="p">(</span><span class="n">blog_content_type</span><span class="p">)</span>
    <span class="c1"># today_hot_data = get_today_hot_data(blog_content_type)</span>
    <span class="n">yesterday_hot_data</span> <span class="o">=</span> <span class="n">get_yesterday_hot_data</span><span class="p">(</span><span class="n">blog_content_type</span><span class="p">)</span>
    <span class="n">content</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s1">&#39;read_nums&#39;</span><span class="p">:</span> <span class="n">read_nums</span><span class="p">,</span>
                <span class="s1">&#39;date_str_list&#39;</span><span class="p">:</span> <span class="n">date_str_list</span><span class="p">,</span>
                <span class="s1">&#39;today_hot_data&#39;</span><span class="p">:</span> <span class="n">today_hot_data</span><span class="p">,</span>  <span class="c1"># 直接使用缓存</span>
                <span class="s1">&#39;yesterday_hot_data&#39;</span><span class="p">:</span> <span class="n">yesterday_hot_data</span>
              <span class="p">}</span>
    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">&#39;home.html&#39;</span><span class="p">,</span> <span class="n">content</span><span class="p">)</span>
  
  
<span class="k">def</span> <span class="nf">login</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="n">username</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;username&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
    <span class="n">password</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;password&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
  
    <span class="n">user</span> <span class="o">=</span> <span class="n">auth</span><span class="o">.</span><span class="n">authenticate</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="n">password</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">user</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">auth</span><span class="o">.</span><span class="n">login</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">user</span><span class="p">)</span>  <span class="c1"># 自动登录</span>
        <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span> <span class="c1"># 重定向到首页</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">&#39;error.html&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;message&#39;</span><span class="p">:</span> <span class="s1">&#39;用户名或密码不正确!!!&#39;</span><span class="p">})</span>  <span class="c1"># 跳转到错误页面</span>
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>在templates下创建<code>error.html</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-django" data-lang="django"><span class="cp">{%</span> <span class="k">extends</span> <span class="s1">&#39;base.html&#39;</span> <span class="cp">%}</span><span class="x">
</span><span class="x">  
</span><span class="x"></span><span class="cp">{%</span> <span class="k">block</span> <span class="nv">title</span> <span class="cp">%}</span><span class="x">
</span><span class="x">    错误
</span><span class="x"></span><span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span><span class="x">
</span><span class="x">  
</span><span class="x"></span><span class="cp">{%</span> <span class="k">block</span> <span class="nv">content</span> <span class="cp">%}</span><span class="x">
</span><span class="x">    </span><span class="cp">{{</span> <span class="nv">message</span> <span class="cp">}}</span><span class="x">
</span><span class="x"></span><span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span><span class="x">
</span></code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>最后,在博客详情页完善路由跳转</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-django" data-lang="django"><span class="x">&lt;div class=&#34;row&#34;&gt;
</span><span class="x">            &lt;div style=&#34;margin-top: 2em;border: 1px dashed #000000;padding: 2em;&#34;&gt;
</span><span class="x">                评论区
</span><span class="x">                </span><span class="cp">{%</span> <span class="k">if</span> <span class="nv">user.is_authenticated</span> <span class="cp">%}</span><span class="x">
</span><span class="x">                    </span><span class="cp">{{</span> <span class="nv">user</span> <span class="cp">}}</span><span class="x">
</span><span class="x">                </span><span class="cp">{%</span> <span class="k">else</span> <span class="cp">%}</span><span class="x">
</span><span class="x">                    未登录
</span><span class="x">                    &lt;form action=&#34;</span><span class="cp">{%</span> <span class="k">url</span> <span class="s1">&#39;login&#39;</span> <span class="cp">%}</span><span class="x">&#34; method=&#34;post&#34;&gt;
</span><span class="x">                        </span><span class="cp">{%</span> <span class="k">csrf_token</span> <span class="cp">%}</span><span class="x">
</span><span class="x">                        用户名:&lt;input type=&#34;text&#34; name=&#34;username&#34;&gt;
</span><span class="x">                        密码:&lt;input type=&#34;password&#34; name=&#34;password&#34;&gt;
</span><span class="x">                        &lt;input type=&#34;submit&#34; value=&#34;登录&#34;&gt;
</span><span class="x">                    &lt;/form&gt;
</span><span class="x">                </span><span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span><span class="x">
</span><span class="x">            &lt;/div&gt;
</span><span class="x">            &lt;div style=&#34;margin-top: 2em;border: 1px dashed #000000;padding: 2em;&#34;&gt;评论列表&lt;/div&gt;
</span><span class="x">        &lt;/div&gt;
</span></code></pre></td></tr></table>
</div>
</div></li>
</ul>
<h4 id="登录后重定向回该博客详情页">登录后重定向回该博客详情页</h4>
<ul>
<li>
<p>更改<code>mysite/views.py</code>中的login方法(用于登录验证、页面跳转)</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="k">def</span> <span class="nf">login</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="n">username</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;username&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
    <span class="n">password</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;password&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
  
    <span class="n">user</span> <span class="o">=</span> <span class="n">auth</span><span class="o">.</span><span class="n">authenticate</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="n">password</span><span class="p">)</span>
    <span class="n">referer</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">META</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;HTTP_REFERER&#39;</span><span class="p">,</span> <span class="n">reverse</span><span class="p">(</span><span class="s1">&#39;home&#39;</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">user</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">auth</span><span class="o">.</span><span class="n">login</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">user</span><span class="p">)</span>  <span class="c1"># 自动登录</span>
        <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">referer</span><span class="p">)</span> <span class="c1"># 重定向到首页</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">&#39;error.html&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;message&#39;</span><span class="p">:</span> <span class="s1">&#39;用户名或密码不正确!!!&#39;</span><span class="p">})</span>  <span class="c1"># 跳转到错误页面</span>
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p><code>request.META.get('HTTP_REFERER', reverse('home'))</code> -  用于记录当前页面信息</p>
</li>
<li>
<p>第一个参数写死,第二个参数可选</p>
</li>
<li>
<p>redirect参数直接referer就行了</p>
</li>
</ul>
<h3 id="评论功能实现">评论功能实现</h3>
<h4 id="提交评论">提交评论</h4>
<ul>
<li>
<p>更改博客评论页面</p>
<p><code>blog_detail.html</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span><span class="lnt">78
</span><span class="lnt">79
</span><span class="lnt">80
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html">{% extends &#39;base.html&#39; %}
  
{% block title %}
    {{ blog.title }}
{% endblock %}
  
{% block content %}
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;container&#34;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;row&#34;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;col-xs-10 col-xs-offset-2&#34;</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">h3</span><span class="p">&gt;</span>标题:{{ blog.title }}<span class="p">&lt;/</span><span class="nt">h3</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">ul</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;blog_detail_ul&#34;</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;</span>作者:{{ blog.author }}<span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;</span>发表日期:{{ blog.create_time | date:&#34;Y-m-d Hⓜs&#34;}}<span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;</span>分类: <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;{% url &#39;blog_with_type&#39; blog.blog_type.pk %}&#34;</span><span class="p">&gt;</span>{{ blog.blog_type }}<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span> <span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">li</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;blog_detail_content&#34;</span><span class="p">&gt;</span>{{ blog.content | safe}}<span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
                <span class="p">&lt;/</span><span class="nt">ul</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">nav</span> <span class="na">aria-label</span><span class="o">=</span><span class="s">&#34;...&#34;</span><span class="p">&gt;</span>
                  <span class="p">&lt;</span><span class="nt">ul</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;pager&#34;</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;</span>
                        {% if previous_blog %}
                            上一篇:
                          <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;{% url &#39;blog_detail&#39; previous_blog.pk %}&#34;</span><span class="p">&gt;</span>
                                {{ previous_blog.title }}
                            <span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
                        {% else %}
                            上一篇:没有了
                        {% endif %}
                    <span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;</span>
                        {% if next_blog %}
                            下一篇:
                             <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;{% url &#39;blog_detail&#39; next_blog.pk %}&#34;</span><span class="p">&gt;</span>
                                {{ next_blog.title }}
                             <span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
                        {% else %}
                            下一篇:没有了
                        {% endif %}
                    <span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
                  <span class="p">&lt;/</span><span class="nt">ul</span><span class="p">&gt;</span>
                <span class="p">&lt;/</span><span class="nt">nav</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;row&#34;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">div</span> <span class="na">style</span><span class="o">=</span><span class="s">&#34;margin-top: 2em;border-bottom: 1px solid #000000;padding: 2em;&#34;</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">h2</span><span class="p">&gt;</span>评论区<span class="p">&lt;/</span><span class="nt">h2</span><span class="p">&gt;</span>
                {% if user.is_authenticated %}
                    {{ user }}
                    <span class="c">&lt;!-- form会将它内部的全部input等,全部作为提交数据提交给服务器 --&gt;</span>
                    <span class="p">&lt;</span><span class="nt">form</span> <span class="na">action</span><span class="o">=</span><span class="s">&#34;{% url &#39;update_comment&#39; %}&#34;</span> <span class="na">method</span><span class="o">=</span><span class="s">&#34;post&#34;</span><span class="p">&gt;</span>
                        {% csrf_token %}
                        <span class="c">&lt;!-- required会在表单提交时自动判断输入框内容是否为空 --&gt;</span>
                        <span class="p">&lt;</span><span class="nt">textarea</span> <span class="na">id</span><span class="o">=</span><span class="s">&#34;comment_text&#34;</span> <span class="na">name</span><span class="o">=</span><span class="s">&#34;text&#34;</span> <span class="na">placeholder</span><span class="o">=</span><span class="s">&#34;输入评论内容...&#34;</span> <span class="na">required</span><span class="o">=</span><span class="s">&#34;required&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">textarea</span><span class="p">&gt;</span>
                        <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;hidden&#34;</span> <span class="na">name</span><span class="o">=</span><span class="s">&#34;object_id&#34;</span> <span class="na">value</span><span class="o">=</span><span class="s">&#34;{{ blog.pk }}&#34;</span><span class="p">&gt;</span>
                        <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;hidden&#34;</span> <span class="na">name</span><span class="o">=</span><span class="s">&#34;content_type&#34;</span> <span class="na">value</span><span class="o">=</span><span class="s">&#34;blog&#34;</span><span class="p">&gt;</span>
                        <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;submit&#34;</span> <span class="na">value</span><span class="o">=</span><span class="s">&#34;send&#34;</span><span class="p">&gt;</span>
                    <span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
                {% else %}
                    未登录,登录之后方可评论
                    <span class="p">&lt;</span><span class="nt">form</span> <span class="na">action</span><span class="o">=</span><span class="s">&#34;{% url &#39;login&#39; %}&#34;</span> <span class="na">method</span><span class="o">=</span><span class="s">&#34;post&#34;</span><span class="p">&gt;</span>
                        {% csrf_token %}
                        用户名:<span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;text&#34;</span> <span class="na">name</span><span class="o">=</span><span class="s">&#34;username&#34;</span><span class="p">&gt;</span>
                        密码:<span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;password&#34;</span> <span class="na">name</span><span class="o">=</span><span class="s">&#34;password&#34;</span><span class="p">&gt;</span>
                        <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;submit&#34;</span> <span class="na">value</span><span class="o">=</span><span class="s">&#34;登录&#34;</span><span class="p">&gt;</span>
                    <span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
                {% endif %}
            <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">div</span> <span class="na">style</span><span class="o">=</span><span class="s">&#34;margin-top: 2em;border-bottom: 1px solid #000000;padding: 2em;&#34;</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">h2</span><span class="p">&gt;</span>评论列表<span class="p">&lt;/</span><span class="nt">h2</span><span class="p">&gt;</span>
                {% for item in comments %}
                    <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;</span>
                        {{ item.user.username }}
                        {{ item.text }}
                        {{ item.comment_time | date:&#34;Y-m-d Hⓜs&#34; }}
                    <span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
                {% endfor %}
            <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
{% endblock %}
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>上面页面中,提交评论的url是<code>update_comment</code>, 在<code>comment</code> - app的url中,创造这条路由</p>
<p><code>comment/urls,py</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">django.urls</span> <span class="kn">import</span> <span class="n">path</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">views</span>
  
<span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;update_comment/&#39;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">update_comment</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&#34;update_comment&#34;</span><span class="p">),</span>
<span class="p">]</span>
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>子路由必须在根路由中<code>include</code>一下,才能在项目中使用</p>
</li>
<li>
<p>在<code>comment/views.py</code>中</p>
</li>
<li>
<p>创建update_comment方法,处理上面的urls</p>
<p><code>comment/views.py</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">django.contrib.contenttypes.models</span> <span class="kn">import</span> <span class="n">ContentType</span>
<span class="kn">from</span> <span class="nn">django.shortcuts</span> <span class="kn">import</span> <span class="n">redirect</span><span class="p">,</span> <span class="n">render</span>
<span class="kn">from</span> <span class="nn">django.urls</span> <span class="kn">import</span> <span class="n">reverse</span>
<span class="kn">from</span> <span class="nn">.models</span> <span class="kn">import</span> <span class="n">Comment</span>
  
  
<span class="c1"># Create your views here.</span>
<span class="k">def</span> <span class="nf">update_comment</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="n">user</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">user</span><span class="o">.</span><span class="n">is_authenticated</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">&#39;error.html&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;message&#39;</span><span class="p">:</span> <span class="s1">&#39;非法操作,用户未登录!!!&#39;</span><span class="p">})</span>
  
    <span class="n">text</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;text&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">text</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">&#39;error.html&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;message&#39;</span><span class="p">:</span> <span class="s1">&#39;非法操作,评论内容为空!!!&#39;</span><span class="p">})</span>
  
    <span class="k">try</span><span class="p">:</span>
        <span class="n">object_id</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;object_id&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">))</span>
        <span class="n">content_type</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;content_type&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
  
        <span class="n">model_class</span> <span class="o">=</span> <span class="n">ContentType</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="n">content_type</span><span class="p">)</span><span class="o">.</span><span class="n">model_class</span><span class="p">()</span>
        <span class="n">model_obj</span> <span class="o">=</span> <span class="n">model_class</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="n">object_id</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">&#39;error.html&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;message&#39;</span><span class="p">:</span> <span class="s1">&#39;非法操作,评论博客不存在!!!&#39;</span><span class="p">})</span>
  
    <span class="n">comment</span> <span class="o">=</span> <span class="n">Comment</span><span class="p">()</span>
    <span class="n">comment</span><span class="o">.</span><span class="n">user</span> <span class="o">=</span> <span class="n">user</span>
    <span class="n">comment</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">text</span>
    <span class="n">comment</span><span class="o">.</span><span class="n">content_object</span> <span class="o">=</span> <span class="n">model_obj</span>
    <span class="n">comment</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
  
    <span class="n">referer</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">META</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;HTTP_REFERER&#39;</span><span class="p">,</span> <span class="n">reverse</span><span class="p">(</span><span class="s1">&#39;home&#39;</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">referer</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><ul>
<li>
<p>这里有几条需要重新学一下</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="n">model_class</span> <span class="o">=</span> <span class="n">ContentType</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="n">content_type</span><span class="p">)</span><span class="o">.</span><span class="n">model_class</span><span class="p">()</span>
<span class="n">model_obj</span> <span class="o">=</span> <span class="n">model_class</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="n">object_id</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><ul>
<li>
<p>1.<code>ContentType.objects.get(model=content_type)</code></p>
<blockquote>
<p>因为为了评论和浏览次数的通用性,都使用了django的ContentType不是吗</p>
<p>使用<code>ContentType.objects.get(model=content_type)</code></p>
<p>django就会在,你使用ContentType的所有表中,根据你给出的筛选字段,查出全部符合条件的对象,django将这些结果不做成一个集合,而是做成一个新的对象</p>
<p>这里就是查询出全部类型为blog的对象,而且这里的content_type是<code>评论 + ContentType</code>,和<code>浏览次数 + ContentType</code>还有区别</p>
</blockquote>
</li>
<li>
<p><code>model_class.objects.get(pk=object_id)</code></p>
<blockquote>
<p>接着上面</p>
<p>这个对象,等价于一个新的数据表</p>
<p>在这里就是一个Blog表,这里使用ContentType查询而不是直接使用Blog是因为<strong>为了通用性</strong></p>
<p>可以像查询普通表一样,查询它</p>
</blockquote>
</li>
<li>
<p>这里就是,你评论了这个,评论数据和博客id、博客类型等数据都被form发送到了views的方法中</p>
</li>
<li>
<p>通过id和类型,查询出这篇博客对象,就这么简单</p>
</li>
<li>
<p>用ContentType不用Blog是为了通用性考虑</p>
</li>
<li>
<p>2.request.user</p>
<blockquote>
<p>直接获取到发起请求的用户</p>
<p>user.is_authenticated, 判断用户是否登录</p>
</blockquote>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<hr>
<h4 id="显示评论列表">显示评论列表</h4>
<ul>
<li>
<p>这就需要在<code>blog/views.py</code>的<code>blog_detail</code>方法中,添加</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="n">blog_content_type</span> <span class="o">=</span> <span class="n">ContentType</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get_for_model</span><span class="p">(</span><span class="n">blog</span><span class="p">)</span>
<span class="n">comments</span> <span class="o">=</span> <span class="n">Comment</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">content_type</span><span class="o">=</span><span class="n">blog_content_type</span><span class="p">,</span> <span class="n">object_id</span><span class="o">=</span><span class="n">blog</span><span class="o">.</span><span class="n">pk</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><blockquote>
<p>1.通过博客对象,在ContentType中查询出<code>这个对象的类型</code>对应的<code>ContentType</code>类型</p>
<p>2.在评论表中,查询出全部符合条件的对象,这里就是,符合类型条件(ContentType + Blog) 和 博客id</p>
</blockquote>
</li>
<li>
<p>最后在前端页面遍历显示,前面的<code>blog_detail.html</code>已经写了</p>
</li>
</ul>
<hr>
<h2 id="使用django的form">使用django的form</h2>
<ul>
<li>
<p>在项目根应用创建forms.py</p>
<p><code>forms.py</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">django</span> <span class="kn">import</span> <span class="n">forms</span>
<span class="kn">from</span> <span class="nn">django.contrib</span> <span class="kn">import</span> <span class="n">auth</span>
  
  
<span class="k">class</span> <span class="nc">LoginForm</span><span class="p">(</span><span class="n">forms</span><span class="o">.</span><span class="n">Form</span><span class="p">):</span>
    <span class="n">username</span> <span class="o">=</span> <span class="n">forms</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;用户名&#39;</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>  <span class="c1"># required : 设置input,自动判断,内容是否为空</span>
    <span class="n">password</span> <span class="o">=</span> <span class="n">forms</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;密码&#39;</span><span class="p">,</span> <span class="n">widget</span><span class="o">=</span><span class="n">forms</span><span class="o">.</span><span class="n">PasswordInput</span><span class="p">)</span>  <span class="c1"># widget : 设置密码输入框为暗文</span>
  
    <span class="c1"># 获取输入框内容并过滤 </span>
    <span class="c1"># 你提交form表单后</span>
    <span class="c1"># 如果有这种过滤器存在,不会立即进入views.py中</span>
    <span class="c1"># 而是会先进入这个过滤器进行判断</span>
    <span class="c1"># 过滤器没通过,就根本不会进入views.py</span>
    <span class="k">def</span> <span class="nf">clean</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">username</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cleaned_data</span><span class="p">[</span><span class="s1">&#39;username&#39;</span><span class="p">]</span>
        <span class="n">password</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cleaned_data</span><span class="p">[</span><span class="s1">&#39;password&#39;</span><span class="p">]</span>
  
        <span class="c1"># 在数据库中判断user是否存在</span>
        <span class="n">user</span> <span class="o">=</span> <span class="n">auth</span><span class="o">.</span><span class="n">authenticate</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="n">password</span><span class="p">)</span>
        <span class="c1"># 如果用户不存在</span>
        <span class="k">if</span> <span class="n">user</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="c1"># 直接在前端显示一个错误信息</span>
            <span class="k">raise</span> <span class="n">forms</span><span class="o">.</span><span class="n">ValidationError</span><span class="p">(</span><span class="s1">&#39;用户名或密码不正确!!!&#39;</span><span class="p">)</span>
        <span class="c1"># 如果用户存在</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># 将这个用户存储到 self.cleaned_data 中,因为self.cleaned_data是输入框中的字段</span>
            <span class="c1"># 你在views.py之前对 post请求的信息进行了拦截过滤,判断完成,不得给人家把数据返回吗</span>
            <span class="c1"># 这里存储user是因为后端要登录</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cleaned_data</span><span class="p">[</span><span class="s1">&#39;user&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">user</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cleaned_data</span>
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>前面是,在博客详情页有输入框,登录直接提交到POST的views里面</p>
</li>
<li>
<p>现在改为,<strong>跳转到单独的一个登录页面</strong></p>
<p><code>blog_detail.html</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html">{% else %}
  未登录,登录之后方可评论
{% csrf_token %}
  <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;{% url &#39;login&#39; %}?from={{ request.get_full_path }}&#34;</span><span class="p">&gt;</span>登录<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
{% endif %}
</code></pre></td></tr></table>
</div>
</div><ul>
<li>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="n">request</span><span class="o">.</span><span class="n">get_full_path</span> 
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>是记录当前页面的完整路径</p>
</li>
</ul>
</li>
<li>
<p>因为上面的写法是</p>
</li>
<li>
<p>在<strong>博客详情页</strong>,就可以登录,登录成功跳转回到刚才的页面(博客详情页)</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="n">referer</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">META</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;HTTP_REFERER&#39;</span><span class="p">,</span> <span class="n">reverse</span><span class="p">(</span><span class="s1">&#39;home&#39;</span><span class="p">))</span>
<span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">referer</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>但是,现在是</p>
<ul>
<li>从<strong>博客详情页</strong> -&gt; <strong>登录页面</strong></li>
<li>登录成功后,回到博客详情页</li>
<li>这中间多了一个<strong>登录页面</strong></li>
<li>所以上面的方法无法使用</li>
<li>只能记录当前页面的完整路径,然后将它通过POST参数传递给后端</li>
<li>然后后端判断登录成功后,跳转到这个记录的历史路径</li>
</ul>
</li>
<li>
<p>写一个登录页面</p>
<p><code>login.html</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html">{% extends &#39;base.html&#39; %}
  
{% block title %}
    登录页面
{% endblock %}
  
{% block nav_home_active %}active{% endblock %}
  
{% block content %}
    <span class="p">&lt;</span><span class="nt">form</span> <span class="na">action</span><span class="o">=</span><span class="s">&#34;{% url &#39;login&#39; %}&#34;</span> <span class="na">method</span><span class="o">=</span><span class="s">&#34;post&#34;</span><span class="p">&gt;</span>
        {% csrf_token %}
        {{ login_form }}
        <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;submit&#34;</span> <span class="na">value</span><span class="o">=</span><span class="s">&#34;登录&#34;</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
{% endblock %}
</code></pre></td></tr></table>
</div>
</div><blockquote>
<p>这里的{{login_form}}就是django的form一个实例</p>
<p>这个对象,是使用你创建的forms.py实例化出来的</p>
<p>你在forms.py中实例化了哪些字段,输入框就有哪些字段</p>
</blockquote>
</li>
<li>
<p>最后,再更改<code>根应用</code>的login方法</p>
<p><code>views.py</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">django.contrib.contenttypes.models</span> <span class="kn">import</span> <span class="n">ContentType</span>
<span class="kn">from</span> <span class="nn">read_statistics.utils</span> <span class="kn">import</span> <span class="n">get_seven_days_read_data</span><span class="p">,</span> <span class="n">get_today_hot_data</span><span class="p">,</span> <span class="n">get_yesterday_hot_data</span>
<span class="kn">from</span> <span class="nn">django.core.cache</span> <span class="kn">import</span> <span class="n">cache</span>
<span class="kn">from</span> <span class="nn">blog.models</span> <span class="kn">import</span> <span class="n">Blog</span>
<span class="kn">from</span> <span class="nn">django.contrib</span> <span class="kn">import</span> <span class="n">auth</span>
<span class="kn">from</span> <span class="nn">django.shortcuts</span> <span class="kn">import</span> <span class="n">redirect</span><span class="p">,</span> <span class="n">render</span><span class="p">,</span> <span class="n">reverse</span>
<span class="kn">from</span> <span class="nn">.forms</span> <span class="kn">import</span> <span class="n">LoginForm</span>
  
  
<span class="k">def</span> <span class="nf">home</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="n">blog_content_type</span> <span class="o">=</span> <span class="n">ContentType</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get_for_model</span><span class="p">(</span><span class="n">Blog</span><span class="p">)</span>
  
    <span class="c1"># 从缓存表中获取key的value</span>
    <span class="n">today_hot_data</span> <span class="o">=</span> <span class="n">cache</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;today_hot_data&#39;</span><span class="p">)</span>
    <span class="c1"># 如果获取不到</span>
    <span class="k">if</span> <span class="n">today_hot_data</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="c1"># set一下</span>
        <span class="n">today_hot_data</span> <span class="o">=</span> <span class="n">get_today_hot_data</span><span class="p">(</span><span class="n">blog_content_type</span><span class="p">)</span>
        <span class="n">cache</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;today_hot_data&#39;</span><span class="p">,</span> <span class="n">today_hot_data</span><span class="p">,</span> <span class="mi">3600</span><span class="p">)</span>  <span class="c1"># 时间:3600秒</span>
        <span class="k">print</span><span class="p">(</span><span class="s1">&#39;init cache&#39;</span><span class="p">)</span>
    <span class="c1"># 如果获取到了</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&#34;use cache&#34;</span><span class="p">)</span>
  
    <span class="n">read_nums</span><span class="p">,</span> <span class="n">date_str_list</span> <span class="o">=</span> <span class="n">get_seven_days_read_data</span><span class="p">(</span><span class="n">blog_content_type</span><span class="p">)</span>
    <span class="c1"># today_hot_data = get_today_hot_data(blog_content_type)</span>
    <span class="n">yesterday_hot_data</span> <span class="o">=</span> <span class="n">get_yesterday_hot_data</span><span class="p">(</span><span class="n">blog_content_type</span><span class="p">)</span>
    <span class="n">content</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;read_nums&#39;</span><span class="p">:</span> <span class="n">read_nums</span><span class="p">,</span>
        <span class="s1">&#39;date_str_list&#39;</span><span class="p">:</span> <span class="n">date_str_list</span><span class="p">,</span>
        <span class="s1">&#39;today_hot_data&#39;</span><span class="p">:</span> <span class="n">today_hot_data</span><span class="p">,</span>  <span class="c1"># 直接使用缓存</span>
        <span class="s1">&#39;yesterday_hot_data&#39;</span><span class="p">:</span> <span class="n">yesterday_hot_data</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">&#39;home.html&#39;</span><span class="p">,</span> <span class="n">content</span><span class="p">)</span>
  
  
<span class="k">def</span> <span class="nf">login</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="c1"># 如果是post,说明已经在登录页面输入完,提交登录信息了</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;POST&#39;</span><span class="p">:</span>
        <span class="n">login_form</span> <span class="o">=</span> <span class="n">LoginForm</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">login_form</span><span class="o">.</span><span class="n">is_valid</span><span class="p">():</span>
            <span class="n">user</span> <span class="o">=</span> <span class="n">login_form</span><span class="o">.</span><span class="n">cleaned_data</span><span class="p">[</span><span class="s1">&#39;user&#39;</span><span class="p">]</span>
            <span class="n">auth</span><span class="o">.</span><span class="n">login</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">user</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">GET</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;from&#39;</span><span class="p">,</span> <span class="n">reverse</span><span class="p">(</span><span class="s1">&#39;home&#39;</span><span class="p">)))</span>
      
    <span class="c1"># 否则就是点击了博客详情页的登录超链接</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># 实例化一个forms对象,传给前端登录页面</span>
        <span class="n">login_form</span> <span class="o">=</span> <span class="n">LoginForm</span><span class="p">()</span>
  
    <span class="n">context</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">context</span><span class="p">[</span><span class="s1">&#39;login_form&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">login_form</span>
    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">&#39;login.html&#39;</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>整体的思路很乱,更改一下</p>
</li>
<li>
<p>先使用django-form,创建一个form实例<code>forms.py</code></p>
</li>
<li>
<p>然后,在login方法中</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="k">def</span> <span class="nf">login</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="c1"># 如果是post,说明已经在登录页面输入完,提交登录信息了</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;POST&#39;</span><span class="p">:</span>
        <span class="n">login_form</span> <span class="o">=</span> <span class="n">LoginForm</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">)</span>  <span class="c1"># 获取登录页面前端返回的内容,并生成一个 你刚才创建的 form实例</span>
        <span class="k">if</span> <span class="n">login_form</span><span class="o">.</span><span class="n">is_valid</span><span class="p">():</span>  <span class="c1"># 判断这个对象是否合法(合乎你声明的forms对象的规范以及是否通过过滤器等)</span>
            <span class="n">user</span> <span class="o">=</span> <span class="n">login_form</span><span class="o">.</span><span class="n">cleaned_data</span><span class="p">[</span><span class="s1">&#39;user&#39;</span><span class="p">]</span>   <span class="c1"># 取出form的过滤器中,储存起来的user</span>
            <span class="n">auth</span><span class="o">.</span><span class="n">login</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">user</span><span class="p">)</span>  <span class="c1"># 登录</span>
            <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">GET</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;from&#39;</span><span class="p">,</span> <span class="n">reverse</span><span class="p">(</span><span class="s1">&#39;home&#39;</span><span class="p">)))</span>  <span class="c1"># 取出,你在 博客详情页 点击登录时候,记录的 页面完整路径</span>
      
    <span class="c1"># 否则就是点击了博客详情页的登录超链接</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># 实例化一个forms对象,传给前端登录页面</span>
        <span class="n">login_form</span> <span class="o">=</span> <span class="n">LoginForm</span><span class="p">()</span>
  
    <span class="n">context</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">context</span><span class="p">[</span><span class="s1">&#39;login_form&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">login_form</span>
    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">&#39;login.html&#39;</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>如果你是在<code>博客详情页</code>点击的登录</p>
<ul>
<li>
<p>那就走else,因为是GET</p>
</li>
<li>
<p>else里啥都没有</p>
<ul>
<li>
<p>实例化一个刚才声明的forms对象</p>
</li>
<li>
<p>传给前端的登录页面</p>
<p><code>login.html</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html">{% extends &#39;base.html&#39; %}
      
{% block title %}
    登录页面
{% endblock %}
      
{% block nav_home_active %}active{% endblock %}
      
{% block content %}
    <span class="p">&lt;</span><span class="nt">form</span> <span class="na">action</span><span class="o">=</span><span class="s">&#34;{% url &#39;login&#39; %}&#34;</span> <span class="na">method</span><span class="o">=</span><span class="s">&#34;post&#34;</span><span class="p">&gt;</span>
        {% csrf_token %}
        {{ login_form }}
        <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;submit&#34;</span> <span class="na">value</span><span class="o">=</span><span class="s">&#34;登录&#34;</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
{% endblock %}
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>django会将django-form对象</p>
</li>
<li>
<p>渲染为输入框等一系列前端内容</p>
</li>
<li>
<p>生成哪些内容,取决于你创建的forms.py</p>
</li>
</ul>
</li>
</ul>
</li>
<li>
<p>如果你在登录页面中提交了表单</p>
<ul>
<li>那就走if,因为是POST</li>
<li>POST在上面</li>
</ul>
</li>
</ul>
<hr>
<h2 id="登录页美化--登录或注册">登录页美化 + 登录或注册</h2>
<ul>
<li>
<p>在博客详情页,添加一个注册选项</p>
<p><code>blog_detail.html</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span><span class="lnt">78
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html">{% extends &#39;base.html&#39; %}
  
{% block title %}
    {{ blog.title }}
{% endblock %}
  
{% block content %}
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;container&#34;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;row&#34;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;col-xs-10 col-xs-offset-2&#34;</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">h3</span><span class="p">&gt;</span>标题:{{ blog.title }}<span class="p">&lt;/</span><span class="nt">h3</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">ul</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;blog_detail_ul&#34;</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;</span>作者:{{ blog.author }}<span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;</span>发表日期:{{ blog.create_time | date:&#34;Y-m-d Hⓜs&#34;}}<span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;</span>分类: <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;{% url &#39;blog_with_type&#39; blog.blog_type.pk %}&#34;</span><span class="p">&gt;</span>{{ blog.blog_type }}<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span> <span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">li</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;blog_detail_content&#34;</span><span class="p">&gt;</span>{{ blog.content | safe}}<span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
                <span class="p">&lt;/</span><span class="nt">ul</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">nav</span> <span class="na">aria-label</span><span class="o">=</span><span class="s">&#34;...&#34;</span><span class="p">&gt;</span>
                  <span class="p">&lt;</span><span class="nt">ul</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;pager&#34;</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;</span>
                        {% if previous_blog %}
                            上一篇:
                          <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;{% url &#39;blog_detail&#39; previous_blog.pk %}&#34;</span><span class="p">&gt;</span>
                                {{ previous_blog.title }}
                            <span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
                        {% else %}
                            上一篇:没有了
                        {% endif %}
                    <span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;</span>
                        {% if next_blog %}
                            下一篇:
                             <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;{% url &#39;blog_detail&#39; next_blog.pk %}&#34;</span><span class="p">&gt;</span>
                                {{ next_blog.title }}
                             <span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
                        {% else %}
                            下一篇:没有了
                        {% endif %}
                    <span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
                  <span class="p">&lt;/</span><span class="nt">ul</span><span class="p">&gt;</span>
                <span class="p">&lt;/</span><span class="nt">nav</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;row&#34;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">div</span> <span class="na">style</span><span class="o">=</span><span class="s">&#34;margin-top: 2em;border-bottom: 1px solid #000000;padding: 2em;&#34;</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">h2</span><span class="p">&gt;</span>评论区<span class="p">&lt;/</span><span class="nt">h2</span><span class="p">&gt;</span>
                {% if user.is_authenticated %}
                    {{ user }}
                    <span class="c">&lt;!-- form会将它内部的全部input等,全部作为提交数据提交给服务器 --&gt;</span>
                    <span class="p">&lt;</span><span class="nt">form</span> <span class="na">action</span><span class="o">=</span><span class="s">&#34;{% url &#39;update_comment&#39; %}&#34;</span> <span class="na">method</span><span class="o">=</span><span class="s">&#34;post&#34;</span><span class="p">&gt;</span>
                        {% csrf_token %}
                        <span class="c">&lt;!-- required会在表单提交时自动判断输入框内容是否为空 --&gt;</span>
                        <span class="p">&lt;</span><span class="nt">textarea</span> <span class="na">id</span><span class="o">=</span><span class="s">&#34;comment_text&#34;</span> <span class="na">name</span><span class="o">=</span><span class="s">&#34;text&#34;</span> <span class="na">placeholder</span><span class="o">=</span><span class="s">&#34;输入评论内容...&#34;</span> <span class="na">required</span><span class="o">=</span><span class="s">&#34;required&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">textarea</span><span class="p">&gt;</span>
                        <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;hidden&#34;</span> <span class="na">name</span><span class="o">=</span><span class="s">&#34;object_id&#34;</span> <span class="na">value</span><span class="o">=</span><span class="s">&#34;{{ blog.pk }}&#34;</span><span class="p">&gt;</span>
                        <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;hidden&#34;</span> <span class="na">name</span><span class="o">=</span><span class="s">&#34;content_type&#34;</span> <span class="na">value</span><span class="o">=</span><span class="s">&#34;blog&#34;</span><span class="p">&gt;</span>
                        <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;submit&#34;</span> <span class="na">value</span><span class="o">=</span><span class="s">&#34;send&#34;</span><span class="p">&gt;</span>
                    <span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
                {% else %}
                    未登录,登录之后方可评论
                    {% csrf_token %}
                    <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;{% url &#39;login&#39; %}?from={{ request.get_full_path }}&#34;</span><span class="p">&gt;</span>登录<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span><span class="ni">&amp;nbsp;</span>
                    or<span class="ni">&amp;nbsp;</span>
                    <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;{% url &#39;register&#39; %}?from={{ request.get_full_path }}&#34;</span><span class="p">&gt;</span>注册<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
                {% endif %}
            <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">div</span> <span class="na">style</span><span class="o">=</span><span class="s">&#34;margin-top: 2em;border-bottom: 1px solid #000000;padding: 2em;&#34;</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">h2</span><span class="p">&gt;</span>评论列表<span class="p">&lt;/</span><span class="nt">h2</span><span class="p">&gt;</span>
                {% for item in comments %}
                    <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;</span>
                        {{ item.user.username }}
                        {{ item.text }}
                        {{ item.comment_time | date:&#34;Y-m-d Hⓜs&#34; }}
                    <span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
                {% endfor %}
            <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
{% endblock %}
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>将<code>登录</code>逻辑复制一份就行了</p>
<p><code>forms.py</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span><span class="lnt">78
</span><span class="lnt">79
</span><span class="lnt">80
</span><span class="lnt">81
</span><span class="lnt">82
</span><span class="lnt">83
</span><span class="lnt">84
</span><span class="lnt">85
</span><span class="lnt">86
</span><span class="lnt">87
</span><span class="lnt">88
</span><span class="lnt">89
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">django</span> <span class="kn">import</span> <span class="n">forms</span>
<span class="kn">from</span> <span class="nn">django.contrib</span> <span class="kn">import</span> <span class="n">auth</span>
<span class="kn">from</span> <span class="nn">django.contrib.auth.models</span> <span class="kn">import</span> <span class="n">User</span>
  
  
<span class="k">class</span> <span class="nc">LoginForm</span><span class="p">(</span><span class="n">forms</span><span class="o">.</span><span class="n">Form</span><span class="p">):</span>
    <span class="n">username</span> <span class="o">=</span> <span class="n">forms</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;用户名&#39;</span><span class="p">,</span>
                               <span class="n">widget</span><span class="o">=</span><span class="n">forms</span><span class="o">.</span><span class="n">TextInput</span><span class="p">(</span>
                                   <span class="n">attrs</span><span class="o">=</span><span class="p">{</span>
                                       <span class="s1">&#39;class&#39;</span><span class="p">:</span> <span class="s1">&#39;form-control&#39;</span><span class="p">,</span>
                                       <span class="s1">&#39;placeholder&#39;</span><span class="p">:</span> <span class="s1">&#39;请输入用户名&#39;</span>
                                   <span class="p">}))</span>  <span class="c1"># required : 设置input,自动判断,内容是否为空</span>
    <span class="n">password</span> <span class="o">=</span> <span class="n">forms</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;密码&#39;</span><span class="p">,</span>
                               <span class="n">widget</span><span class="o">=</span><span class="n">forms</span><span class="o">.</span><span class="n">PasswordInput</span><span class="p">(</span>
                                   <span class="n">attrs</span><span class="o">=</span><span class="p">{</span>
                                       <span class="s1">&#39;class&#39;</span><span class="p">:</span> <span class="s1">&#39;form-control&#39;</span><span class="p">,</span>
                                       <span class="s1">&#39;placeholder&#39;</span><span class="p">:</span> <span class="s1">&#39;请输入密码&#39;</span>
                                   <span class="p">}))</span>  <span class="c1"># widget : 设置密码输入框为暗文</span>
  
    <span class="c1"># 获取输入框内容并过滤 </span>
    <span class="c1"># 你提交form表单后</span>
    <span class="c1"># 如果有这种过滤器存在,不会立即进入views.py中</span>
    <span class="c1"># 而是会先进入这个过滤器进行判断</span>
    <span class="c1"># 过滤器没通过,就根本不会进入views.py</span>
    <span class="k">def</span> <span class="nf">clean</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">username</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cleaned_data</span><span class="p">[</span><span class="s1">&#39;username&#39;</span><span class="p">]</span>
        <span class="n">password</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cleaned_data</span><span class="p">[</span><span class="s1">&#39;password&#39;</span><span class="p">]</span>
  
        <span class="c1"># 在数据库中判断user是否存在</span>
        <span class="n">user</span> <span class="o">=</span> <span class="n">auth</span><span class="o">.</span><span class="n">authenticate</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="n">password</span><span class="p">)</span>
        <span class="c1"># 如果用户不存在</span>
        <span class="k">if</span> <span class="n">user</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="c1"># 直接在前端显示一个错误信息</span>
            <span class="k">raise</span> <span class="n">forms</span><span class="o">.</span><span class="n">ValidationError</span><span class="p">(</span><span class="s1">&#39;用户名或密码不正确!!!&#39;</span><span class="p">)</span>
        <span class="c1"># 如果用户存在</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># 将这个用户存储到 self.cleaned_data 中,因为self.cleaned_data是输入框中的字段</span>
            <span class="c1"># 你在views.py之前对 post请求的信息进行了拦截过滤,判断完成,不得给人家把数据返回吗</span>
            <span class="c1"># 这里存储user是因为后端要登录</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cleaned_data</span><span class="p">[</span><span class="s1">&#39;user&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">user</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cleaned_data</span>
  
  
<span class="k">class</span> <span class="nc">RegForm</span><span class="p">(</span><span class="n">forms</span><span class="o">.</span><span class="n">Form</span><span class="p">):</span>
    <span class="n">username</span> <span class="o">=</span> <span class="n">forms</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;用户名&#39;</span><span class="p">,</span>
                               <span class="n">widget</span><span class="o">=</span><span class="n">forms</span><span class="o">.</span><span class="n">TextInput</span><span class="p">(</span>
                                   <span class="n">attrs</span><span class="o">=</span><span class="p">{</span>
                                       <span class="s1">&#39;class&#39;</span><span class="p">:</span> <span class="s1">&#39;form-control&#39;</span><span class="p">,</span>
                                       <span class="s1">&#39;placeholder&#39;</span><span class="p">:</span> <span class="s1">&#39;请输入3-20位的用户名&#39;</span>
                                   <span class="p">}),</span>
                               <span class="n">max_length</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>
                               <span class="n">min_length</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">email</span> <span class="o">=</span> <span class="n">forms</span><span class="o">.</span><span class="n">EmailField</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;邮箱&#39;</span><span class="p">,</span>
                             <span class="n">widget</span><span class="o">=</span><span class="n">forms</span><span class="o">.</span><span class="n">EmailInput</span><span class="p">(</span>
                                 <span class="n">attrs</span><span class="o">=</span><span class="p">{</span>
                                     <span class="s1">&#39;class&#39;</span><span class="p">:</span> <span class="s1">&#39;form-control&#39;</span><span class="p">,</span>
                                     <span class="s1">&#39;placeholder&#39;</span><span class="p">:</span> <span class="s1">&#39;请输入用户名&#39;</span>
                                 <span class="p">}))</span>
    <span class="n">password</span> <span class="o">=</span> <span class="n">forms</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;密码&#39;</span><span class="p">,</span>
                               <span class="n">widget</span><span class="o">=</span><span class="n">forms</span><span class="o">.</span><span class="n">PasswordInput</span><span class="p">(</span>
                                   <span class="n">attrs</span><span class="o">=</span><span class="p">{</span>
                                       <span class="s1">&#39;class&#39;</span><span class="p">:</span> <span class="s1">&#39;form-control&#39;</span><span class="p">,</span>
                                       <span class="s1">&#39;placeholder&#39;</span><span class="p">:</span> <span class="s1">&#39;请输入密码&#39;</span>
                                   <span class="p">}))</span>  <span class="c1"># widget : 设置密码输入框为暗文</span>
    <span class="n">password_again</span> <span class="o">=</span> <span class="n">forms</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;再次确认密码&#39;</span><span class="p">,</span>
                                     <span class="n">widget</span><span class="o">=</span><span class="n">forms</span><span class="o">.</span><span class="n">PasswordInput</span><span class="p">(</span>
                                         <span class="n">attrs</span><span class="o">=</span><span class="p">{</span>
                                             <span class="s1">&#39;class&#39;</span><span class="p">:</span> <span class="s1">&#39;form-control&#39;</span><span class="p">,</span>
                                             <span class="s1">&#39;placeholder&#39;</span><span class="p">:</span> <span class="s1">&#39;请再次输入密码&#39;</span>
                                         <span class="p">}))</span>  <span class="c1"># widget : 设置密码输入框为暗文</span>
  
    <span class="k">def</span> <span class="nf">clean_username</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">username</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cleaned_data</span><span class="p">[</span><span class="s1">&#39;username&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">User</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="n">username</span><span class="p">)</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
            <span class="k">raise</span> <span class="n">forms</span><span class="o">.</span><span class="n">ValidationError</span><span class="p">(</span><span class="s1">&#39;用户名以存在&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">username</span>
  
    <span class="k">def</span> <span class="nf">clean_email</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">email</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cleaned_data</span><span class="p">[</span><span class="s1">&#39;email&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">User</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">email</span><span class="o">=</span><span class="n">email</span><span class="p">)</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
            <span class="k">raise</span> <span class="n">forms</span><span class="o">.</span><span class="n">ValidationError</span><span class="p">(</span><span class="s1">&#39;邮箱已被注册&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">email</span>
  
    <span class="k">def</span> <span class="nf">clean_password_again</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">password</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cleaned_data</span><span class="p">[</span><span class="s1">&#39;password&#39;</span><span class="p">]</span>
        <span class="n">password_again</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cleaned_data</span><span class="p">[</span><span class="s1">&#39;password_again&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">password</span> <span class="o">!=</span> <span class="n">password_again</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">forms</span><span class="o">.</span><span class="n">ValidationError</span><span class="p">(</span><span class="s1">&#39;两次输入不一致&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">password</span>
</code></pre></td></tr></table>
</div>
</div><p><code>register.html</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html">{% extends &#39;base.html&#39; %}
  
{% block title %}
    注册页面
{% endblock %}
  
{% block nav_home_active %}active{% endblock %}
  
{% block content %}
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;container&#34;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;row&#34;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;col-xs-4 col-xs-offset-4&#34;</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;panel panel-default&#34;</span><span class="p">&gt;</span>
                  <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;panel-heading&#34;</span><span class="p">&gt;</span>注册页面<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
                  <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;panel-body&#34;</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">form</span> <span class="na">action</span><span class="o">=</span><span class="s">&#34;{% url &#39;register&#39; %}&#34;</span> <span class="na">method</span><span class="o">=</span><span class="s">&#34;post&#34;</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;loginForm&#34;</span><span class="p">&gt;</span>
                        {% csrf_token %}
                        {% for field in reg_form %}
                            <span class="p">&lt;</span><span class="nt">label</span> <span class="na">for</span><span class="o">=</span><span class="s">&#34;{{ field.id_for_label }}&#34;</span><span class="p">&gt;</span>{{ field.label }}<span class="p">&lt;/</span><span class="nt">label</span><span class="p">&gt;</span>
                            {{ field }}
                          <span class="c">&lt;!-- 遍历form模型中的clean过滤器返回的信息,用于在触发错误时候显示对应的错误信息 --&gt;</span>
                            <span class="p">&lt;</span><span class="nt">p</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;text-danger&#34;</span><span class="p">&gt;</span>
                                {{ field.errors.as_text }}
                            <span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
                        {% endfor %}
                        <span class="c">&lt;!-- 放置错误信息的容器 --&gt;</span>
                        <span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;text-danger pull-left&#34;</span><span class="p">&gt;</span>
                            {{ reg_form.non_field_errors }}
                        <span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
                        <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;submit&#34;</span> <span class="na">value</span><span class="o">=</span><span class="s">&#34;注册&#34;</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;btn btn-primary pull-right&#34;</span><span class="p">&gt;</span>
                    <span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
                  <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
                <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
  
{% endblock %}
</code></pre></td></tr></table>
</div>
</div><p><code>mysite/views.py</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span><span class="lnt">78
</span><span class="lnt">79
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">django.contrib.contenttypes.models</span> <span class="kn">import</span> <span class="n">ContentType</span>
<span class="kn">from</span> <span class="nn">read_statistics.utils</span> <span class="kn">import</span> <span class="n">get_seven_days_read_data</span><span class="p">,</span> <span class="n">get_today_hot_data</span><span class="p">,</span> <span class="n">get_yesterday_hot_data</span>
<span class="kn">from</span> <span class="nn">django.core.cache</span> <span class="kn">import</span> <span class="n">cache</span>
<span class="kn">from</span> <span class="nn">blog.models</span> <span class="kn">import</span> <span class="n">Blog</span>
<span class="kn">from</span> <span class="nn">django.contrib</span> <span class="kn">import</span> <span class="n">auth</span>
<span class="kn">from</span> <span class="nn">django.shortcuts</span> <span class="kn">import</span> <span class="n">redirect</span><span class="p">,</span> <span class="n">render</span><span class="p">,</span> <span class="n">reverse</span>
<span class="kn">from</span> <span class="nn">.forms</span> <span class="kn">import</span> <span class="n">LoginForm</span><span class="p">,</span> <span class="n">RegForm</span>
<span class="kn">from</span> <span class="nn">django.contrib.auth.models</span> <span class="kn">import</span> <span class="n">User</span>
  
  
<span class="k">def</span> <span class="nf">home</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="n">blog_content_type</span> <span class="o">=</span> <span class="n">ContentType</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get_for_model</span><span class="p">(</span><span class="n">Blog</span><span class="p">)</span>
  
    <span class="c1"># 从缓存表中获取key的value</span>
    <span class="n">today_hot_data</span> <span class="o">=</span> <span class="n">cache</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;today_hot_data&#39;</span><span class="p">)</span>
    <span class="c1"># 如果获取不到</span>
    <span class="k">if</span> <span class="n">today_hot_data</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="c1"># set一下</span>
        <span class="n">today_hot_data</span> <span class="o">=</span> <span class="n">get_today_hot_data</span><span class="p">(</span><span class="n">blog_content_type</span><span class="p">)</span>
        <span class="n">cache</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;today_hot_data&#39;</span><span class="p">,</span> <span class="n">today_hot_data</span><span class="p">,</span> <span class="mi">3600</span><span class="p">)</span>  <span class="c1"># 时间:3600秒</span>
        <span class="k">print</span><span class="p">(</span><span class="s1">&#39;init cache&#39;</span><span class="p">)</span>
    <span class="c1"># 如果获取到了</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&#34;use cache&#34;</span><span class="p">)</span>
  
    <span class="n">read_nums</span><span class="p">,</span> <span class="n">date_str_list</span> <span class="o">=</span> <span class="n">get_seven_days_read_data</span><span class="p">(</span><span class="n">blog_content_type</span><span class="p">)</span>
    <span class="c1"># today_hot_data = get_today_hot_data(blog_content_type)</span>
    <span class="n">yesterday_hot_data</span> <span class="o">=</span> <span class="n">get_yesterday_hot_data</span><span class="p">(</span><span class="n">blog_content_type</span><span class="p">)</span>
    <span class="n">content</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;read_nums&#39;</span><span class="p">:</span> <span class="n">read_nums</span><span class="p">,</span>
        <span class="s1">&#39;date_str_list&#39;</span><span class="p">:</span> <span class="n">date_str_list</span><span class="p">,</span>
        <span class="s1">&#39;today_hot_data&#39;</span><span class="p">:</span> <span class="n">today_hot_data</span><span class="p">,</span>  <span class="c1"># 直接使用缓存</span>
        <span class="s1">&#39;yesterday_hot_data&#39;</span><span class="p">:</span> <span class="n">yesterday_hot_data</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">&#39;home.html&#39;</span><span class="p">,</span> <span class="n">content</span><span class="p">)</span>
  
  
<span class="k">def</span> <span class="nf">login</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="c1"># 如果是post,说明已经在登录页面输入完,提交登录信息了</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;POST&#39;</span><span class="p">:</span>
        <span class="n">login_form</span> <span class="o">=</span> <span class="n">LoginForm</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">login_form</span><span class="o">.</span><span class="n">is_valid</span><span class="p">():</span>
            <span class="n">user</span> <span class="o">=</span> <span class="n">login_form</span><span class="o">.</span><span class="n">cleaned_data</span><span class="p">[</span><span class="s1">&#39;user&#39;</span><span class="p">]</span>
            <span class="n">auth</span><span class="o">.</span><span class="n">login</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">user</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">GET</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;from&#39;</span><span class="p">,</span> <span class="n">reverse</span><span class="p">(</span><span class="s1">&#39;home&#39;</span><span class="p">)))</span>
      
    <span class="c1"># 否则就是点击了博客详情页的登录超链接</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># 实例化一个forms对象,传给前端登录页面</span>
        <span class="n">login_form</span> <span class="o">=</span> <span class="n">LoginForm</span><span class="p">()</span>
  
    <span class="n">context</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">context</span><span class="p">[</span><span class="s1">&#39;login_form&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">login_form</span>
    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">&#39;login.html&#39;</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>
  
  
<span class="k">def</span> <span class="nf">register</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="c1"># 如果是post,说明已经在登录页面输入完,提交登录信息了</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;POST&#39;</span><span class="p">:</span>
        <span class="n">reg_form</span> <span class="o">=</span> <span class="n">RegForm</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">reg_form</span><span class="o">.</span><span class="n">is_valid</span><span class="p">():</span>
            <span class="n">username</span> <span class="o">=</span> <span class="n">reg_form</span><span class="o">.</span><span class="n">cleaned_data</span><span class="p">[</span><span class="s1">&#39;username&#39;</span><span class="p">]</span>
            <span class="n">email</span> <span class="o">=</span> <span class="n">reg_form</span><span class="o">.</span><span class="n">cleaned_data</span><span class="p">[</span><span class="s1">&#39;email&#39;</span><span class="p">]</span>
            <span class="n">password</span> <span class="o">=</span> <span class="n">reg_form</span><span class="o">.</span><span class="n">cleaned_data</span><span class="p">[</span><span class="s1">&#39;password&#39;</span><span class="p">]</span>
            <span class="n">user</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create_user</span><span class="p">(</span><span class="n">username</span><span class="p">,</span> <span class="n">email</span><span class="p">,</span> <span class="n">password</span><span class="p">)</span>
            <span class="n">user</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
  
            <span class="n">user</span> <span class="o">=</span> <span class="n">auth</span><span class="o">.</span><span class="n">authenticate</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="n">password</span><span class="p">)</span>
            <span class="n">auth</span><span class="o">.</span><span class="n">login</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">user</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">GET</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;from&#39;</span><span class="p">,</span> <span class="n">reverse</span><span class="p">(</span><span class="s1">&#39;home&#39;</span><span class="p">)))</span>
      
    <span class="c1"># 否则就是点击了博客详情页的登录超链接</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># 实例化一个forms对象,传给前端登录页面</span>
        <span class="n">reg_form</span> <span class="o">=</span> <span class="n">RegForm</span><span class="p">()</span>
  
    <span class="n">context</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">context</span><span class="p">[</span><span class="s1">&#39;reg_form&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">reg_form</span>
    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">&#39;register.html&#39;</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><p><code>mysite/urls.py</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">django.contrib</span> <span class="kn">import</span> <span class="n">admin</span>
<span class="kn">from</span> <span class="nn">django.urls</span> <span class="kn">import</span> <span class="n">path</span><span class="p">,</span> <span class="n">include</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">views</span>
  
<span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">home</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;home&#39;</span><span class="p">),</span>  <span class="c1"># 默认是home.html</span>
    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;admin/&#39;</span><span class="p">,</span> <span class="n">admin</span><span class="o">.</span><span class="n">site</span><span class="o">.</span><span class="n">urls</span><span class="p">),</span>
    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;blog/&#39;</span><span class="p">,</span> <span class="n">include</span><span class="p">(</span><span class="s1">&#39;blog.urls&#39;</span><span class="p">)),</span>  <span class="c1"># 子路由</span>
    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;login/&#39;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">login</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&#34;login&#34;</span><span class="p">),</span>
    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;register/&#39;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">register</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&#34;register&#34;</span><span class="p">),</span>
    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;comment/&#39;</span><span class="p">,</span> <span class="n">include</span><span class="p">(</span><span class="s1">&#39;comment.urls&#39;</span><span class="p">)),</span>
<span class="p">]</span>
</code></pre></td></tr></table>
</div>
</div></li>
</ul>
<hr>
<h1 id="step03服务器部署django项目">Step03.服务器部署django项目</h1>
<h2 id="卸载服务器上原有的python">卸载服务器上原有的python</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">rpm -qa<span class="p">|</span>grep python3<span class="p">|</span>xargs rpm -ev --allmatches --nodeps
whereis python
</code></pre></td></tr></table>
</div>
</div><h2 id="更新服务器上python版本">更新服务器上python版本</h2>
<ul>
<li>
<p>我这里,项目用的是python3.8</p>
</li>
<li>
<p>服务器使用的是python3.6</p>
</li>
<li>
<p>需要更换一下python版本</p>
</li>
<li>
<p>服务器上下载python3.8</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">wget https://www.python.org/ftp/python/3.8.2/Python-3.8.2.tgz
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>解压</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">tar -xvzf Python-3.8.2.tgz
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>进入目录</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell"><span class="nb">cd</span> Python-3.8.2
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>执行以下命令</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell"><span class="c1"># 配置安装目录</span>
./configure --prefix<span class="o">=</span>/usr/python
  
<span class="c1"># 应用配置</span>
./configure --enable-optimizations
  
make
  
make install
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>重启服务器</p>
</li>
<li>
<p>查看python版本</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">python3 -V
</code></pre></td></tr></table>
</div>
</div></li>
</ul>
<hr>
<h2 id="服务器更新python导致yum不能用">服务器更新python导致yum不能用</h2>
<h1 id="django常见报错">django常见报错</h1>
<h2 id="文件编码错误">文件编码错误</h2>
<p><code>File &quot;D:\Python\Python37-32\lib\site-packages\django\views\debug.py&quot;, line 332, in get_traceback_html</code></p>
<p><code>t = DEBUG_ENGINE.from_string(fh.read())</code></p>
<p><code>UnicodeDecodeError: 'gbk' codec can't decode byte 0xa6 in position 9737: illegal multibyte sequence</code></p>
<p><code>解决</code></p>
<ul>
<li>
<p>打开django/views下的debug.py文件，转到</p>
<blockquote>
<p><strong>with Path(CURRENT_DIR, &lsquo;templates&rsquo;, &lsquo;technical_500.html&rsquo;).open() as fh</strong></p>
</blockquote>
</li>
<li>
<p>将其改成</p>
<blockquote>
<p><em>with Path(CURRENT_DIR, &lsquo;templates&rsquo;, &lsquo;technical_500.html&rsquo;).open(encoding=&quot;utf-8&rdquo;) as fh</em></p>
</blockquote>
</li>
</ul>
<hr>
<h2 id="更改数据表字段后无法makemigrations和migrate">更改数据表字段后,无法<code>makemigrations</code>和<code>migrate</code></h2>
<ul>
<li>
<p>删掉应用下的migrations目录下的缓存文件</p>
</li>
<li>
<p>删除数据库main下的所有数据表,不需要担心误删错删,有两个表是无法被删除的</p>
</li>
<li>
<p>重新执行</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">python manage.py makemigrations
python manage.py migrate
</code></pre></td></tr></table>
</div>
</div></li>
</ul>
<hr>

    </div>

    <div class="post-copyright">
  <p class="copyright-item">
    <span class="item-title">Author</span>
    <span class="item-content">Zhang's Blog</span>
  </p>
  <p class="copyright-item">
    <span class="item-title">LastMod</span>
    <span class="item-content">
        2022-03-10
        
    </span>
  </p>
  
  
</div>
<footer class="post-footer">
      <div class="post-tags">
          <a href="/tags/python/">Python</a>
          </div>
      <nav class="post-nav">
        <a class="prev" href="/post/uniapp/">
            <i class="iconfont icon-left"></i>
            <span class="prev-text nav-default">uniapp</span>
            <span class="prev-text nav-mobile">Prev</span>
          </a>
        <a class="next" href="/post/vue-pc%E7%BD%91%E9%A1%B5%E7%AB%AF%E9%9F%B3%E4%B9%90%E7%BD%91%E7%AB%99%E6%BA%90%E7%A0%81%E8%A7%A3%E8%AF%BB/">
            <span class="next-text nav-default">Vue-PC网页端音乐网站源码解读</span>
            <span class="next-text nav-mobile">Next</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>
        </div>
        

  

  

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
      <a href="mailto:your@email.com" class="iconfont icon-email" title="email"></a>
      <a href="https://stackoverflow.com/" class="iconfont icon-stack-overflow" title="stack-overflow"></a>
      <a href="https://twitter.com/" class="iconfont icon-twitter" title="twitter"></a>
      <a href="https://www.facebook.com/" class="iconfont icon-facebook" title="facebook"></a>
      <a href="https://www.linkedin.com/" class="iconfont icon-linkedin" title="linkedin"></a>
      <a href="https://www.google.com/" class="iconfont icon-google" title="google"></a>
      <a href="https://github.com/" class="iconfont icon-github" title="github"></a>
      <a href="https://weibo.com/" class="iconfont icon-weibo" title="weibo"></a>
      <a href="https://www.zhihu.com/" class="iconfont icon-zhihu" title="zhihu"></a>
      <a href="https://www.douban.com/" class="iconfont icon-douban" title="douban"></a>
      <a href="https://getpocket.com/" class="iconfont icon-pocket" title="pocket"></a>
      <a href="https://www.tumblr.com/" class="iconfont icon-tumblr" title="tumblr"></a>
      <a href="https://www.instagram.com/" class="iconfont icon-instagram" title="instagram"></a>
      <a href="https://about.gitlab.com/" class="iconfont icon-gitlab" title="gitlab"></a>
      <a href="https://www.bilibili.com/" class="iconfont icon-bilibili" title="bilibili"></a>
  <a href="http://localhost:1313/index.xml" type="application/rss+xml" class="iconfont icon-rss" title="rss"></a>
</div>

<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://golang.org/">GoLang</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Author - 
    <a class="theme-link" href="https://space.bilibili.com/628950169/">Mr'zhang</a>
  </span>

  

  <span class="copyright-year">
    &copy; 
    2017 - 
    2022<span class="heart"><i class="iconfont icon-heart"></i></span><span>Zhang's Blog</span>
  </span>
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/slideout@1.0.1/dist/slideout.min.js" integrity="sha256-t+zJ/g8/KXIJMjSVQdnibt4dlaDxc9zXr/9oNPeWqdg=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.js" integrity="sha256-XVLffZaxoWfGUEbdzuLi7pwaUJv1cecsQJQqGLe7axY=" crossorigin="anonymous"></script>



<script type="text/javascript" src="/js/main.min.c12618f9a600c40bd024996677e951e64d3487006775aeb22e200c990006c5c7.js"></script>








</body>
</html>
